// Generated by Construct 3, the game and app creator :: https://www.construct.net
'use strict';var cr=window.cr={};cr.plugins_={};cr.behaviors={};"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(b){return b.__proto__}:function(b){return b.constructor.prototype});
(function(){function b(e,w){this.x=e;this.y=w;cr.seal(this)}function l(e,w,I,N){this.set(e,w,I,N);cr.seal(this)}function q(){this.bly=this.blx=this.bry=this.brx=this.try_=this.trx=this.tly=this.tlx=0;cr.seal(this)}function A(e,w,I,N){e<w?I<N?(F=e<I?e:I,D=w>N?w:N):(F=e<N?e:N,D=w>I?w:I):I<N?(F=w<I?w:I,D=e>N?e:N):(F=w<N?w:N,D=e>I?e:I)}function M(){this.items=this.s=null;this.item_count=0;B&&(this.s=new Set);this.values_cache=[];this.cache_valid=!0;cr.seal(this)}function x(e){S[V++]=e}function m(){this.sum=
this.t=this.y=this.c=0;cr.seal(this)}function a(e,w){e||(e=[0,0,1,0,1,1,0,1]);this.pts_cache=[];this.bboxBottom=this.bboxRight=this.bboxTop=this.bboxLeft=0;this.convexpolys=null;this.enabled="undefined"===typeof w?!0:w;this.set_pts(e);cr.seal(this)}function c(e,w){this.cellwidth=e;this.cellheight=w;this.cells={}}function f(e,w){this.cellwidth=e;this.cellheight=w;this.cells={}}function n(e,w,I){c.prototype.totalCellCount++;if(d.length){var N=d.pop();N.grid=e;N.x=w;N.y=I;return N}return new cr.GridCell(e,
w,I)}function v(e,w,I){this.grid=e;this.x=w;this.y=I;this.objects=new cr.ObjectSet}function y(e,w,I){f.prototype.totalCellCount++;if(k.length){var N=k.pop();N.grid=e;N.x=w;N.y=I;return N}return new cr.RenderCell(e,w,I)}function K(e,w,I){this.grid=e;this.x=w;this.y=I;this.objects=[];this.is_sorted=!0;this.pending_removal=new cr.ObjectSet;this.any_pending_removal=!1}function u(e,w){return e.zindex-w.zindex}cr.logexport=function(e){window.console&&window.console.log&&window.console.log(e)};cr.logerror=
function(e){window.console&&window.console.error&&window.console.error(e)};cr.seal=function(e){return e};cr.freeze=function(e){return e};cr.is_undefined=function(e){return"undefined"===typeof e};cr.is_number=function(e){return"number"===typeof e};cr.is_string=function(e){return"string"===typeof e};cr.isPOT=function(e){return 0<e&&0===(e-1&e)};cr.nextHighestPowerOfTwo=function(e){--e;for(var w=1;32>w;w<<=1)e|=e>>w;return e+1};cr.abs=function(e){return 0>e?-e:e};cr.max=function(e,w){return e>w?e:w};
cr.min=function(e,w){return e<w?e:w};cr.PI=Math.PI;cr.round=function(e){return e+.5|0};cr.floor=function(e){return 0<=e?e|0:(e|0)-1};cr.ceil=function(e){var w=e|0;return w===e?w:w+1};b.prototype.offset=function(e,w){this.x+=e;this.y+=w;return this};b.prototype.mul=function(e,w){this.x*=e;this.y*=w;return this};cr.vector2=b;cr.segments_intersect=function(e,w,I,N,U,W,X,Y){if(e<I){var ea=e;var ha=I}else ea=I,ha=e;if(U<X){var g=U;var p=X}else g=X,p=U;if(ha<g||ea>p)return!1;w<N?(ea=w,ha=N):(ea=N,ha=w);
W<Y?(g=W,p=Y):(g=Y,p=W);if(ha<g||ea>p)return!1;ha=U-e+X-I;ea=W-w+Y-N;e=I-e;w=N-w;U=X-U;W=Y-W;Y=cr.abs(w*U-W*e);return cr.abs(U*ea-W*ha)>Y?!1:cr.abs(e*ea-w*ha)<=Y};l.prototype.set=function(e,w,I,N){this.left=e;this.top=w;this.right=I;this.bottom=N};l.prototype.copy=function(e){this.left=e.left;this.top=e.top;this.right=e.right;this.bottom=e.bottom};l.prototype.width=function(){return this.right-this.left};l.prototype.height=function(){return this.bottom-this.top};l.prototype.offset=function(e,w){this.left+=
e;this.top+=w;this.right+=e;this.bottom+=w;return this};l.prototype.normalize=function(){if(this.left>this.right){var e=this.left;this.left=this.right;this.right=e}this.top>this.bottom&&(e=this.top,this.top=this.bottom,this.bottom=e)};l.prototype.intersects_rect=function(e){return!(e.right<this.left||e.bottom<this.top||e.left>this.right||e.top>this.bottom)};l.prototype.intersects_rect_off=function(e,w,I){return!(e.right+w<this.left||e.bottom+I<this.top||e.left+w>this.right||e.top+I>this.bottom)};
l.prototype.contains_pt=function(e,w){return e>=this.left&&e<=this.right&&w>=this.top&&w<=this.bottom};l.prototype.equals=function(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom};cr.rect=l;q.prototype.set_from_rect=function(e){this.tlx=e.left;this.tly=e.top;this.trx=e.right;this.try_=e.top;this.brx=e.right;this.bry=e.bottom;this.blx=e.left;this.bly=e.bottom};q.prototype.set_from_rotated_rect=function(e,w){if(0===w)this.set_from_rect(e);else{var I=Math.sin(w),
N=Math.cos(w);w=e.left*I;var U=e.top*I,W=e.right*I;I*=e.bottom;var X=e.left*N,Y=e.top*N,ea=e.right*N;e=e.bottom*N;this.tlx=X-U;this.tly=Y+w;this.trx=ea-U;this.try_=Y+W;this.brx=ea-I;this.bry=e+W;this.blx=X-I;this.bly=e+w}};q.prototype.offset=function(e,w){this.tlx+=e;this.tly+=w;this.trx+=e;this.try_+=w;this.brx+=e;this.bry+=w;this.blx+=e;this.bly+=w;return this};var F=0,D=0;q.prototype.bounding_box=function(e){A(this.tlx,this.trx,this.brx,this.blx);e.left=F;e.right=D;A(this.tly,this.try_,this.bry,
this.bly);e.top=F;e.bottom=D};q.prototype.contains_pt=function(e,w){var I=this.tlx,N=this.tly,U=this.trx-I,W=this.try_-N,X=this.brx-I,Y=this.bry-N;e-=I;w-=N;var ea=U*U+W*W,ha=U*X+W*Y;W=U*e+W*w;var g=X*X+Y*Y,p=X*e+Y*w,C=1/(ea*g-ha*ha);U=(g*W-ha*p)*C;ea=(ea*p-ha*W)*C;if(0<=U&&0<ea&&1>U+ea)return!0;U=this.blx-I;W=this.bly-N;ea=U*U+W*W;ha=U*X+W*Y;W=U*e+W*w;C=1/(ea*g-ha*ha);U=(g*W-ha*p)*C;ea=(ea*p-ha*W)*C;return 0<=U&&0<ea&&1>U+ea};q.prototype.at=function(e,w){if(w)switch(e){case 0:return this.tlx;case 1:return this.trx;
case 2:return this.brx;case 3:return this.blx;case 4:return this.tlx;default:return this.tlx}else switch(e){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:return this.tly;default:return this.tly}};q.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4};q.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4};q.prototype.intersects_segment=function(e,w,I,N){if(this.contains_pt(e,w)||this.contains_pt(I,N))return!0;
var U;for(U=0;4>U;U++){var W=this.at(U,!0);var X=this.at(U,!1);var Y=this.at(U+1,!0);var ea=this.at(U+1,!1);if(cr.segments_intersect(e,w,I,N,W,X,Y,ea))return!0}return!1};q.prototype.intersects_quad=function(e){var w=e.midX(),I=e.midY();if(this.contains_pt(w,I))return!0;w=this.midX();I=this.midY();if(e.contains_pt(w,I))return!0;var N,U;for(N=0;4>N;N++)for(U=0;4>U;U++){w=this.at(N,!0);I=this.at(N,!1);var W=this.at(N+1,!0);var X=this.at(N+1,!1);var Y=e.at(U,!0);var ea=e.at(U,!1);var ha=e.at(U+1,!0);
var g=e.at(U+1,!1);if(cr.segments_intersect(w,I,W,X,Y,ea,ha,g))return!0}return!1};cr.quad=q;cr.RGB=function(e,w,I){return Math.max(Math.min(e,255),0)|Math.max(Math.min(w,255),0)<<8|Math.max(Math.min(I,255),0)<<16};cr.RGBAEx=function(e,w,I,N){e=cr.clamp(Math.floor(1024*e),-8192,8191);w=cr.clamp(Math.floor(1024*w),-8192,8191);I=cr.clamp(Math.floor(1024*I),-8192,8191);N=cr.clamp(Math.floor(1024*N),0,1024);0>e&&(e+=16384);0>w&&(w+=16384);0>I&&(I+=16384);return-(274877906944*e+16777216*w+1024*I+N)};cr.RGBEx=
function(e,w,I){return cr.RGBAEx(e,w,I,1)};cr.GetRValue=function(e){if(0<=e)return(e&255)/255;e=Math.floor(-e/274877906944);8191<e&&(e-=16384);return e/1024};cr.GetGValue=function(e){if(0<=e)return((e&65280)>>8)/255;e=Math.floor(-e%274877906944/16777216);8191<e&&(e-=16384);return e/1024};cr.GetBValue=function(e){if(0<=e)return((e&16711680)>>16)/255;e=Math.floor(-e%16777216/1024);8191<e&&(e-=16384);return e/1024};cr.GetAValue=function(e){return 0===e&&0>1/e?0:0<=e?1:Math.floor(-e%1024)/1024};cr.shallowCopy=
function(e,w,I){for(var N in w)w.hasOwnProperty(N)&&(e[N]=w[N]);return e};cr.arrayRemove=function(e,w){var I;w=cr.floor(w);if(!(0>w||w>=e.length)){for(I=e.length-1;w<I;w++)e[w]=e[w+1];cr.truncateArray(e,I)}};cr.truncateArray=function(e,w){e.length=w};cr.clearArray=function(e){cr.truncateArray(e,0)};cr.shallowAssignArray=function(e,w){cr.clearArray(e);var I;var N=0;for(I=w.length;N<I;++N)e[N]=w[N]};cr.appendArray=function(e,w){e.push.apply(e,w)};cr.fastIndexOf=function(e,w){var I;var N=0;for(I=e.length;N<
I;++N)if(e[N]===w)return N;return-1};cr.arrayFindRemove=function(e,w){w=cr.fastIndexOf(e,w);-1!==w&&cr.arrayRemove(e,w)};cr.clamp=function(e,w,I){return e<w?w:e>I?I:e};cr.to_radians=function(e){return e/(180/cr.PI)};cr.to_degrees=function(e){return 180/cr.PI*e};cr.clamp_angle_degrees=function(e){e%=360;0>e&&(e+=360);return e};cr.clamp_angle=function(e){e%=2*cr.PI;0>e&&(e+=2*cr.PI);return e};cr.to_clamped_degrees=function(e){return cr.clamp_angle_degrees(cr.to_degrees(e))};cr.to_clamped_radians=function(e){return cr.clamp_angle(cr.to_radians(e))};
cr.angleTo=function(e,w,I,N){return Math.atan2(N-w,I-e)};cr.angleDiff=function(e,w){if(e===w)return 0;e=Math.sin(e)*Math.sin(w)+Math.cos(e)*Math.cos(w);return 1<=e?0:-1>=e?cr.PI:Math.acos(e)};cr.angleRotate=function(e,w,I){var N=Math.sin(e),U=Math.cos(e),W=Math.sin(w),X=Math.cos(w);return Math.acos(N*W+U*X)>I?0<U*W-N*X?cr.clamp_angle(e+I):cr.clamp_angle(e-I):cr.clamp_angle(w)};cr.angleClockwise=function(e,w){return 0>=Math.cos(e)*Math.sin(w)-Math.sin(e)*Math.cos(w)};cr.rotatePtAround=function(e,w,
I,N,U,W){if(0===I)return W?e:w;var X=Math.sin(I);I=Math.cos(I);e-=N;w-=U;var Y=e*X;e=e*I-w*X;return W?e+N:w*I+Y+U};cr.distanceTo=function(e,w,I,N){e=I-e;w=N-w;return Math.sqrt(e*e+w*w)};cr.xor=function(e,w){return!e!==!w};cr.lerp=function(e,w,I){return e+(w-e)*I};cr.unlerp=function(e,w,I){return e===w?0:(I-e)/(w-e)};cr.anglelerp=function(e,w,I){var N=cr.angleDiff(e,w);return cr.angleClockwise(w,e)?e+N*I:e-N*I};cr.qarp=function(e,w,I,N){return cr.lerp(cr.lerp(e,w,N),cr.lerp(w,I,N),N)};cr.cubic=function(e,
w,I,N,U){return cr.lerp(cr.qarp(e,w,I,U),cr.qarp(w,I,N,U),U)};cr.cosp=function(e,w,I){return(e+w+(e-w)*Math.cos(I*Math.PI))/2};cr.hasAnyOwnProperty=function(e){for(var w in e)if(e.hasOwnProperty(w))return!0;return!1};cr.wipe=function(e){for(var w in e)e.hasOwnProperty(w)&&delete e[w]};var h=+new Date;cr.performance_now=function(){if("undefined"!==typeof window.performance){var e=window.performance;if("undefined"!==typeof e.now)return e.now();if("undefined"!==typeof e.webkitNow)return e.webkitNow();
if("undefined"!==typeof e.mozNow)return e.mozNow();if("undefined"!==typeof e.msNow)return e.msNow()}return Date.now()-h};var t=!1;"undefined"!==typeof window&&(t=/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent),!t&&/safari/i.test(navigator.userAgent),/(iphone|ipod|ipad)/i.test(navigator.userAgent));var B="undefined"!==typeof Set&&"undefined"!==typeof Set.prototype.forEach;M.prototype.contains=function(e){return this.isEmpty()?!1:B?this.s.has(e):this.items&&this.items.hasOwnProperty(e)};
M.prototype.add=function(e){if(B)this.s.has(e)||(this.s.add(e),this.cache_valid=!1);else{var w=e.toString(),I=this.items;I?I.hasOwnProperty(w)||(I[w]=e,this.item_count++,this.cache_valid=!1):(this.items={},this.items[w]=e,this.item_count=1,this.cache_valid=!1)}};M.prototype.remove=function(e){if(!this.isEmpty())if(B)this.s.has(e)&&(this.s["delete"](e),this.cache_valid=!1);else if(this.items){e=e.toString();var w=this.items;w.hasOwnProperty(e)&&(delete w[e],this.item_count--,this.cache_valid=!1)}};
M.prototype.clear=function(){this.isEmpty()||(B?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)};M.prototype.isEmpty=function(){return 0===this.count()};M.prototype.count=function(){return B?this.s.size:this.item_count};var S=null,V=0;M.prototype.update_cache=function(){if(!this.cache_valid){if(B)cr.clearArray(this.values_cache),S=this.values_cache,V=0,this.s.forEach(x),S=null,V=0;else{var e=this.values_cache;cr.clearArray(e);var w,I=0,N=this.items;
if(N)for(w in N)N.hasOwnProperty(w)&&(e[I++]=N[w])}this.cache_valid=!0}};M.prototype.valuesRef=function(){this.update_cache();return this.values_cache};cr.ObjectSet=M;var L=new cr.ObjectSet;cr.removeArrayDuplicates=function(e){var w;var I=0;for(w=e.length;I<w;++I)L.add(e[I]);cr.shallowAssignArray(e,L.valuesRef());L.clear()};cr.arrayRemoveAllFromObjectSet=function(e,w){B?cr.arrayRemoveAll_set(e,w.s):cr.arrayRemoveAll_arr(e,w.valuesRef())};cr.arrayRemoveAll_set=function(e,w){var I,N;var U=I=0;for(N=
e.length;I<N;++I){var W=e[I];w.has(W)||(e[U++]=W)}cr.truncateArray(e,U)};cr.arrayRemoveAll_arr=function(e,w){var I,N;var U=I=0;for(N=e.length;I<N;++I){var W=e[I];-1===cr.fastIndexOf(w,W)&&(e[U++]=W)}cr.truncateArray(e,U)};m.prototype.add=function(e){this.y=e-this.c;this.t=this.sum+this.y;this.c=this.t-this.sum-this.y;this.sum=this.t};m.prototype.reset=function(){this.sum=this.t=this.y=this.c=0};cr.KahanAdder=m;cr.regexp_escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};a.prototype.set_pts=
function(e){this.pts_array=e;this.pts_count=e.length/2;this.pts_cache.length=e.length;this.cache_height=this.cache_width=-1;this.cache_angle=0};a.prototype.is_empty=function(){return!this.pts_array.length};a.prototype.update_bbox=function(){for(var e=this.pts_cache,w=e[0],I=w,N=e[1],U=N,W,X,Y=1,ea=this.pts_count;Y<ea;++Y)X=2*Y,W=e[X],X=e[X+1],W<w&&(w=W),W>I&&(I=W),X<N&&(N=X),X>U&&(U=X);this.bboxLeft=w;this.bboxRight=I;this.bboxTop=N;this.bboxBottom=U};a.prototype.set_from_rect=function(e,w,I){this.pts_cache.length=
8;this.pts_count=4;var N=this.pts_cache;N[0]=e.left-w;N[1]=e.top-I;N[2]=e.right-w;N[3]=e.top-I;N[4]=e.right-w;N[5]=e.bottom-I;N[6]=e.left-w;N[7]=e.bottom-I;this.cache_width=e.right-e.left;this.cache_height=e.bottom-e.top;this.update_bbox()};a.prototype.set_from_quad=function(e,w,I,N,U){this.pts_cache.length=8;this.pts_count=4;var W=this.pts_cache;W[0]=e.tlx-w;W[1]=e.tly-I;W[2]=e.trx-w;W[3]=e.try_-I;W[4]=e.brx-w;W[5]=e.bry-I;W[6]=e.blx-w;W[7]=e.bly-I;this.cache_width=N;this.cache_height=U;this.update_bbox()};
a.prototype.set_from_poly=function(e){this.pts_count=e.pts_count;cr.shallowAssignArray(this.pts_cache,e.pts_cache);this.bboxLeft=e.bboxLeft;this.bboxTop-e.bboxTop;this.bboxRight=e.bboxRight;this.bboxBottom=e.bboxBottom};a.prototype.cache_poly=function(e,w,I){if(this.cache_width!==e||this.cache_height!==w||this.cache_angle!==I){this.cache_width=e;this.cache_height=w;this.cache_angle=I;var N,U=0,W=1,X=this.pts_array,Y=this.pts_cache;0!==I&&(U=Math.sin(I),W=Math.cos(I));I=0;for(N=this.pts_count;I<N;I++){var ea=
2*I;var ha=ea+1;var g=X[ea]*e;var p=X[ha]*w;Y[ea]=g*W-p*U;Y[ha]=p*W+g*U}this.update_bbox()}};a.prototype.contains_pt=function(e,w){var I=this.pts_cache;if(e===I[0]&&w===I[1])return!0;var N,U=this.pts_count,W=this.bboxLeft-110,X=this.bboxTop-101,Y=this.bboxRight+131,ea=this.bboxBottom+120,ha=0,g=0;for(N=0;N<U;N++){var p=2*N;var C=(N+1)%U*2;var G=I[p];p=I[p+1];var z=I[C];C=I[C+1];cr.segments_intersect(W,X,e,w,G,p,z,C)&&ha++;cr.segments_intersect(Y,ea,e,w,G,p,z,C)&&g++}return 1===ha%2||1===g%2};a.prototype.intersects_poly=
function(e,w,I){var N=e.pts_cache,U=this.pts_cache;if(this.contains_pt(N[0]+w,N[1]+I)||e.contains_pt(U[0]-w,U[1]-I))return!0;var W,X;var Y=0;for(W=this.pts_count;Y<W;Y++){var ea=2*Y;var ha=(Y+1)%W*2;var g=U[ea];ea=U[ea+1];var p=U[ha];var C=U[ha+1];ha=0;for(X=e.pts_count;ha<X;ha++){var G=2*ha;var z=(ha+1)%X*2;var J=N[G]+w;G=N[G+1]+I;var Q=N[z]+w;z=N[z+1]+I;if(cr.segments_intersect(g,ea,p,C,J,G,Q,z))return!0}}return!1};a.prototype.intersects_segment=function(e,w,I,N,U,W){var X=this.pts_cache;if(this.contains_pt(I-
e,N-w))return!0;var Y;var ea=0;for(Y=this.pts_count;ea<Y;ea++){var ha=2*ea;var g=(ea+1)%Y*2;var p=X[ha]+e;ha=X[ha+1]+w;var C=X[g]+e;g=X[g+1]+w;if(cr.segments_intersect(I,N,U,W,p,ha,C,g))return!0}return!1};a.prototype.mirror=function(e){var w;var I=0;for(w=this.pts_count;I<w;++I){var N=2*I;this.pts_cache[N]=2*e-this.pts_cache[N]}};a.prototype.flip=function(e){var w;var I=0;for(w=this.pts_count;I<w;++I){var N=2*I+1;this.pts_cache[N]=2*e-this.pts_cache[N]}};a.prototype.diag=function(){var e;var w=0;
for(e=this.pts_count;w<e;++w){var I=2*w;var N=I+1;var U=this.pts_cache[I];this.pts_cache[I]=this.pts_cache[N];this.pts_cache[N]=U}};a.prototype.is_enabled=function(){return this.enabled};cr.CollisionPoly=a;c.prototype.totalCellCount=0;c.prototype.getCell=function(e,w,I){var N=this.cells[e];return N?(N=N[w])?N:I?(N=n(this,e,w),this.cells[e][w]=N):null:I?(N=n(this,e,w),this.cells[e]={},this.cells[e][w]=N):null};c.prototype.XToCell=function(e){return cr.floor(e/this.cellwidth)};c.prototype.YToCell=function(e){return cr.floor(e/
this.cellheight)};c.prototype.update=function(e,w,I){var N,U,W;if(w){var X=w.left;for(N=w.right;X<=N;++X){var Y=w.top;for(U=w.bottom;Y<=U;++Y)if(!I||!I.contains_pt(X,Y))if(W=this.getCell(X,Y,!1))W.remove(e),W.isEmpty()&&(c.prototype.totalCellCount--,W.objects.clear(),1E3>d.length&&d.push(W),this.cells[X][Y]=null)}}if(I)for(X=I.left,N=I.right;X<=N;++X)for(Y=I.top,U=I.bottom;Y<=U;++Y)w&&w.contains_pt(X,Y)||this.getCell(X,Y,!0).insert(e)};c.prototype.queryRange=function(e,w){var I,N;var U=this.XToCell(e.left);
var W=this.YToCell(e.top);var X=this.XToCell(e.right);for(I=this.YToCell(e.bottom);U<=X;++U)for(e=W;e<=I;++e)(N=this.getCell(U,e,!1))&&N.dump(w)};cr.SparseGrid=c;f.prototype.totalCellCount=0;f.prototype.getCell=function(e,w,I){var N=this.cells[e];return N?(N=N[w])?N:I?(N=y(this,e,w),this.cells[e][w]=N):null:I?(N=y(this,e,w),this.cells[e]={},this.cells[e][w]=N):null};f.prototype.XToCell=function(e){return cr.floor(e/this.cellwidth)};f.prototype.YToCell=function(e){return cr.floor(e/this.cellheight)};
f.prototype.update=function(e,w,I){var N,U,W;if(w){var X=w.left;for(N=w.right;X<=N;++X){var Y=w.top;for(U=w.bottom;Y<=U;++Y)if(!I||!I.contains_pt(X,Y))if(W=this.getCell(X,Y,!1))W.remove(e),W.isEmpty()&&(f.prototype.totalCellCount--,W.reset(),1E3>k.length&&k.push(W),this.cells[X][Y]=null)}}if(I)for(X=I.left,N=I.right;X<=N;++X)for(Y=I.top,U=I.bottom;Y<=U;++Y)w&&w.contains_pt(X,Y)||this.getCell(X,Y,!0).insert(e)};f.prototype.queryRange=function(e,w,I,N,U){var W,X;e=this.XToCell(e);w=this.YToCell(w);
I=this.XToCell(I);for(W=this.YToCell(N);e<=I;++e)for(N=w;N<=W;++N)(X=this.getCell(e,N,!1))&&X.dump(U)};f.prototype.markRangeChanged=function(e){var w,I;var N=e.left;var U=e.top;var W=e.right;for(w=e.bottom;N<=W;++N)for(e=U;e<=w;++e)if(I=this.getCell(N,e,!1))I.is_sorted=!1};cr.RenderGrid=f;var d=[];v.prototype.isEmpty=function(){return this.objects.isEmpty()};v.prototype.insert=function(e){this.objects.add(e)};v.prototype.remove=function(e){this.objects.remove(e)};v.prototype.dump=function(e){cr.appendArray(e,
this.objects.valuesRef())};cr.GridCell=v;var k=[];K.prototype.isEmpty=function(){if(!this.objects.length)return!0;if(this.objects.length>this.pending_removal.count())return!1;this.flush_pending();return!0};K.prototype.insert=function(e){this.pending_removal.contains(e)?(this.pending_removal.remove(e),this.pending_removal.isEmpty()&&(this.any_pending_removal=!1)):this.objects.length?(this.objects[this.objects.length-1].get_zindex()>e.get_zindex()&&(this.is_sorted=!1),this.objects.push(e)):(this.objects.push(e),
this.is_sorted=!0)};K.prototype.remove=function(e){this.pending_removal.add(e);this.any_pending_removal=!0;30<=this.pending_removal.count()&&this.flush_pending()};K.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()===this.objects.length?this.reset():(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1))};K.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(u),this.is_sorted=
!0)};K.prototype.reset=function(){cr.clearArray(this.objects);this.is_sorted=!0;this.pending_removal.clear();this.any_pending_removal=!1};K.prototype.dump=function(e){this.flush_pending();this.ensure_sorted();this.objects.length&&e.push(this.objects)};cr.RenderCell=K;var E="lighter xor copy destination-over source-in destination-in source-out destination-out source-atop destination-atop".split(" ");cr.effectToCompositeOp=function(e){return 0>=e||11<=e?"source-over":E[e-1]};cr.setGLBlend=function(e,
w,I){if(I)switch(e.srcBlend=I.ONE,e.destBlend=I.ONE_MINUS_SRC_ALPHA,w){case 1:e.srcBlend=I.ONE;e.destBlend=I.ONE;break;case 3:e.srcBlend=I.ONE;e.destBlend=I.ZERO;break;case 4:e.srcBlend=I.ONE_MINUS_DST_ALPHA;e.destBlend=I.ONE;break;case 5:e.srcBlend=I.DST_ALPHA;e.destBlend=I.ZERO;break;case 6:e.srcBlend=I.ZERO;e.destBlend=I.SRC_ALPHA;break;case 7:e.srcBlend=I.ONE_MINUS_DST_ALPHA;e.destBlend=I.ZERO;break;case 8:e.srcBlend=I.ZERO;e.destBlend=I.ONE_MINUS_SRC_ALPHA;break;case 9:e.srcBlend=I.DST_ALPHA;
e.destBlend=I.ONE_MINUS_SRC_ALPHA;break;case 10:e.srcBlend=I.ONE_MINUS_DST_ALPHA,e.destBlend=I.SRC_ALPHA}};cr.round6dp=function(e){return Math.round(1E6*e)/1E6};cr.equals_nocase=function(e,w){return"string"!==typeof e||"string"!==typeof w||e.length!==w.length?!1:e===w?!0:e.toLowerCase()===w.toLowerCase()};cr.cssToCamelCase=function(e){var w="",I,N=!1;var U=0;for(I=e.length;U<I;++U){var W=e.charAt(U);"-"===W?N=!0:N?(w+=W.toUpperCase(),N=!1):w+=W}return w};cr.isCanvasInputEvent=function(e){e=e.target;
return!e||e===document||e===window||document&&document.body&&e===document.body||cr.equals_nocase(e.tagName,"canvas")?!0:!1}})();var MatrixArray="undefined"!==typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(b){var l=new MatrixArray(3);b&&(l[0]=b[0],l[1]=b[1],l[2]=b[2]);return l};vec3.set=function(b,l){l[0]=b[0];l[1]=b[1];l[2]=b[2];return l};
vec3.add=function(b,l,q){if(!q||b===q)return b[0]+=l[0],b[1]+=l[1],b[2]+=l[2],b;q[0]=b[0]+l[0];q[1]=b[1]+l[1];q[2]=b[2]+l[2];return q};vec3.subtract=function(b,l,q){if(!q||b===q)return b[0]-=l[0],b[1]-=l[1],b[2]-=l[2],b;q[0]=b[0]-l[0];q[1]=b[1]-l[1];q[2]=b[2]-l[2];return q};vec3.negate=function(b,l){l||(l=b);l[0]=-b[0];l[1]=-b[1];l[2]=-b[2];return l};vec3.scale=function(b,l,q){if(!q||b===q)return b[0]*=l,b[1]*=l,b[2]*=l,b;q[0]=b[0]*l;q[1]=b[1]*l;q[2]=b[2]*l;return q};
vec3.normalize=function(b,l){l||(l=b);var q=b[0],A=b[1];b=b[2];var M=Math.sqrt(q*q+A*A+b*b);if(M){if(1===M)return l[0]=q,l[1]=A,l[2]=b,l}else return l[0]=0,l[1]=0,l[2]=0,l;M=1/M;l[0]=q*M;l[1]=A*M;l[2]=b*M;return l};vec3.cross=function(b,l,q){q||(q=b);var A=b[0],M=b[1];b=b[2];var x=l[0],m=l[1];l=l[2];q[0]=M*l-b*m;q[1]=b*x-A*l;q[2]=A*m-M*x;return q};vec3.length=function(b){var l=b[0],q=b[1];b=b[2];return Math.sqrt(l*l+q*q+b*b)};vec3.dot=function(b,l){return b[0]*l[0]+b[1]*l[1]+b[2]*l[2]};
vec3.direction=function(b,l,q){q||(q=b);var A=b[0]-l[0],M=b[1]-l[1];b=b[2]-l[2];l=Math.sqrt(A*A+M*M+b*b);if(!l)return q[0]=0,q[1]=0,q[2]=0,q;l=1/l;q[0]=A*l;q[1]=M*l;q[2]=b*l;return q};vec3.lerp=function(b,l,q,A){A||(A=b);A[0]=b[0]+q*(l[0]-b[0]);A[1]=b[1]+q*(l[1]-b[1]);A[2]=b[2]+q*(l[2]-b[2]);return A};vec3.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+"]"};
mat3.create=function(b){var l=new MatrixArray(9);b&&(l[0]=b[0],l[1]=b[1],l[2]=b[2],l[3]=b[3],l[4]=b[4],l[5]=b[5],l[6]=b[6],l[7]=b[7],l[8]=b[8]);return l};mat3.set=function(b,l){l[0]=b[0];l[1]=b[1];l[2]=b[2];l[3]=b[3];l[4]=b[4];l[5]=b[5];l[6]=b[6];l[7]=b[7];l[8]=b[8];return l};mat3.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};
mat3.transpose=function(b,l){if(!l||b===l){l=b[1];var q=b[2],A=b[5];b[1]=b[3];b[2]=b[6];b[3]=l;b[5]=b[7];b[6]=q;b[7]=A;return b}l[0]=b[0];l[1]=b[3];l[2]=b[6];l[3]=b[1];l[4]=b[4];l[5]=b[7];l[6]=b[2];l[7]=b[5];l[8]=b[8];return l};mat3.toMat4=function(b,l){l||(l=mat4.create());l[15]=1;l[14]=0;l[13]=0;l[12]=0;l[11]=0;l[10]=b[8];l[9]=b[7];l[8]=b[6];l[7]=0;l[6]=b[5];l[5]=b[4];l[4]=b[3];l[3]=0;l[2]=b[2];l[1]=b[1];l[0]=b[0];return l};
mat3.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+"]"};mat4.create=function(b){var l=new MatrixArray(16);b&&(l[0]=b[0],l[1]=b[1],l[2]=b[2],l[3]=b[3],l[4]=b[4],l[5]=b[5],l[6]=b[6],l[7]=b[7],l[8]=b[8],l[9]=b[9],l[10]=b[10],l[11]=b[11],l[12]=b[12],l[13]=b[13],l[14]=b[14],l[15]=b[15]);return l};
mat4.set=function(b,l){l[0]=b[0];l[1]=b[1];l[2]=b[2];l[3]=b[3];l[4]=b[4];l[5]=b[5];l[6]=b[6];l[7]=b[7];l[8]=b[8];l[9]=b[9];l[10]=b[10];l[11]=b[11];l[12]=b[12];l[13]=b[13];l[14]=b[14];l[15]=b[15];return l};mat4.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};
mat4.transpose=function(b,l){if(!l||b===l){l=b[1];var q=b[2],A=b[3],M=b[6],x=b[7],m=b[11];b[1]=b[4];b[2]=b[8];b[3]=b[12];b[4]=l;b[6]=b[9];b[7]=b[13];b[8]=q;b[9]=M;b[11]=b[14];b[12]=A;b[13]=x;b[14]=m;return b}l[0]=b[0];l[1]=b[4];l[2]=b[8];l[3]=b[12];l[4]=b[1];l[5]=b[5];l[6]=b[9];l[7]=b[13];l[8]=b[2];l[9]=b[6];l[10]=b[10];l[11]=b[14];l[12]=b[3];l[13]=b[7];l[14]=b[11];l[15]=b[15];return l};
mat4.determinant=function(b){var l=b[0],q=b[1],A=b[2],M=b[3],x=b[4],m=b[5],a=b[6],c=b[7],f=b[8],n=b[9],v=b[10],y=b[11],K=b[12],u=b[13],F=b[14];b=b[15];return K*n*a*M-f*u*a*M-K*m*v*M+x*u*v*M+f*m*F*M-x*n*F*M-K*n*A*c+f*u*A*c+K*q*v*c-l*u*v*c-f*q*F*c+l*n*F*c+K*m*A*y-x*u*A*y-K*q*a*y+l*u*a*y+x*q*F*y-l*m*F*y-f*m*A*b+x*n*A*b+f*q*a*b-l*n*a*b-x*q*v*b+l*m*v*b};
mat4.inverse=function(b,l){l||(l=b);var q=b[0],A=b[1],M=b[2],x=b[3],m=b[4],a=b[5],c=b[6],f=b[7],n=b[8],v=b[9],y=b[10],K=b[11],u=b[12],F=b[13],D=b[14];b=b[15];var h=q*a-A*m,t=q*c-M*m,B=q*f-x*m,S=A*c-M*a,V=A*f-x*a,L=M*f-x*c,d=n*F-v*u,k=n*D-y*u,E=n*b-K*u,e=v*D-y*F,w=v*b-K*F,I=y*b-K*D,N=1/(h*I-t*w+B*e+S*E-V*k+L*d);l[0]=(a*I-c*w+f*e)*N;l[1]=(-A*I+M*w-x*e)*N;l[2]=(F*L-D*V+b*S)*N;l[3]=(-v*L+y*V-K*S)*N;l[4]=(-m*I+c*E-f*k)*N;l[5]=(q*I-M*E+x*k)*N;l[6]=(-u*L+D*B-b*t)*N;l[7]=(n*L-y*B+K*t)*N;l[8]=(m*w-a*E+f*d)*
N;l[9]=(-q*w+A*E-x*d)*N;l[10]=(u*V-F*B+b*h)*N;l[11]=(-n*V+v*B-K*h)*N;l[12]=(-m*e+a*k-c*d)*N;l[13]=(q*e-A*k+M*d)*N;l[14]=(-u*S+F*t-D*h)*N;l[15]=(n*S-v*t+y*h)*N;return l};mat4.toRotationMat=function(b,l){l||(l=mat4.create());l[0]=b[0];l[1]=b[1];l[2]=b[2];l[3]=b[3];l[4]=b[4];l[5]=b[5];l[6]=b[6];l[7]=b[7];l[8]=b[8];l[9]=b[9];l[10]=b[10];l[11]=b[11];l[12]=0;l[13]=0;l[14]=0;l[15]=1;return l};
mat4.toMat3=function(b,l){l||(l=mat3.create());l[0]=b[0];l[1]=b[1];l[2]=b[2];l[3]=b[4];l[4]=b[5];l[5]=b[6];l[6]=b[8];l[7]=b[9];l[8]=b[10];return l};mat4.toInverseMat3=function(b,l){var q=b[0],A=b[1],M=b[2],x=b[4],m=b[5],a=b[6],c=b[8],f=b[9];b=b[10];var n=b*m-a*f,v=-b*x+a*c,y=f*x-m*c,K=q*n+A*v+M*y;if(!K)return null;K=1/K;l||(l=mat3.create());l[0]=n*K;l[1]=(-b*A+M*f)*K;l[2]=(a*A-M*m)*K;l[3]=v*K;l[4]=(b*q-M*c)*K;l[5]=(-a*q+M*x)*K;l[6]=y*K;l[7]=(-f*q+A*c)*K;l[8]=(m*q-A*x)*K;return l};
mat4.multiply=function(b,l,q){q||(q=b);var A=b[0],M=b[1],x=b[2],m=b[3],a=b[4],c=b[5],f=b[6],n=b[7],v=b[8],y=b[9],K=b[10],u=b[11],F=b[12],D=b[13],h=b[14];b=b[15];var t=l[0],B=l[1],S=l[2],V=l[3],L=l[4],d=l[5],k=l[6],E=l[7],e=l[8],w=l[9],I=l[10],N=l[11],U=l[12],W=l[13],X=l[14];l=l[15];q[0]=t*A+B*a+S*v+V*F;q[1]=t*M+B*c+S*y+V*D;q[2]=t*x+B*f+S*K+V*h;q[3]=t*m+B*n+S*u+V*b;q[4]=L*A+d*a+k*v+E*F;q[5]=L*M+d*c+k*y+E*D;q[6]=L*x+d*f+k*K+E*h;q[7]=L*m+d*n+k*u+E*b;q[8]=e*A+w*a+I*v+N*F;q[9]=e*M+w*c+I*y+N*D;q[10]=e*
x+w*f+I*K+N*h;q[11]=e*m+w*n+I*u+N*b;q[12]=U*A+W*a+X*v+l*F;q[13]=U*M+W*c+X*y+l*D;q[14]=U*x+W*f+X*K+l*h;q[15]=U*m+W*n+X*u+l*b;return q};mat4.multiplyVec3=function(b,l,q){q||(q=l);var A=l[0],M=l[1];l=l[2];q[0]=b[0]*A+b[4]*M+b[8]*l+b[12];q[1]=b[1]*A+b[5]*M+b[9]*l+b[13];q[2]=b[2]*A+b[6]*M+b[10]*l+b[14];return q};
mat4.multiplyVec4=function(b,l,q){q||(q=l);var A=l[0],M=l[1],x=l[2];l=l[3];q[0]=b[0]*A+b[4]*M+b[8]*x+b[12]*l;q[1]=b[1]*A+b[5]*M+b[9]*x+b[13]*l;q[2]=b[2]*A+b[6]*M+b[10]*x+b[14]*l;q[3]=b[3]*A+b[7]*M+b[11]*x+b[15]*l;return q};
mat4.translate=function(b,l,q){var A=l[0],M=l[1];l=l[2];if(!q||b===q)return b[12]=b[0]*A+b[4]*M+b[8]*l+b[12],b[13]=b[1]*A+b[5]*M+b[9]*l+b[13],b[14]=b[2]*A+b[6]*M+b[10]*l+b[14],b[15]=b[3]*A+b[7]*M+b[11]*l+b[15],b;var x=b[0];var m=b[1];var a=b[2];var c=b[3];var f=b[4];var n=b[5];var v=b[6];var y=b[7];var K=b[8];var u=b[9];var F=b[10];var D=b[11];q[0]=x;q[1]=m;q[2]=a;q[3]=c;q[4]=f;q[5]=n;q[6]=v;q[7]=y;q[8]=K;q[9]=u;q[10]=F;q[11]=D;q[12]=x*A+f*M+K*l+b[12];q[13]=m*A+n*M+u*l+b[13];q[14]=a*A+v*M+F*l+b[14];
q[15]=c*A+y*M+D*l+b[15];return q};mat4.scale=function(b,l,q){var A=l[0],M=l[1];l=l[2];if(!q||b===q)return b[0]*=A,b[1]*=A,b[2]*=A,b[3]*=A,b[4]*=M,b[5]*=M,b[6]*=M,b[7]*=M,b[8]*=l,b[9]*=l,b[10]*=l,b[11]*=l,b;q[0]=b[0]*A;q[1]=b[1]*A;q[2]=b[2]*A;q[3]=b[3]*A;q[4]=b[4]*M;q[5]=b[5]*M;q[6]=b[6]*M;q[7]=b[7]*M;q[8]=b[8]*l;q[9]=b[9]*l;q[10]=b[10]*l;q[11]=b[11]*l;q[12]=b[12];q[13]=b[13];q[14]=b[14];q[15]=b[15];return q};
mat4.rotate=function(b,l,q,A){var M=q[0],x=q[1];q=q[2];var m=Math.sqrt(M*M+x*x+q*q);if(!m)return null;1!==m&&(m=1/m,M*=m,x*=m,q*=m);var a=Math.sin(l);var c=Math.cos(l);var f=1-c;l=b[0];m=b[1];var n=b[2];var v=b[3];var y=b[4];var K=b[5];var u=b[6];var F=b[7];var D=b[8];var h=b[9];var t=b[10];var B=b[11];var S=M*M*f+c;var V=x*M*f+q*a;var L=q*M*f-x*a;var d=M*x*f-q*a;var k=x*x*f+c;var E=q*x*f+M*a;var e=M*q*f+x*a;M=x*q*f-M*a;x=q*q*f+c;A?b!==A&&(A[12]=b[12],A[13]=b[13],A[14]=b[14],A[15]=b[15]):A=b;A[0]=
l*S+y*V+D*L;A[1]=m*S+K*V+h*L;A[2]=n*S+u*V+t*L;A[3]=v*S+F*V+B*L;A[4]=l*d+y*k+D*E;A[5]=m*d+K*k+h*E;A[6]=n*d+u*k+t*E;A[7]=v*d+F*k+B*E;A[8]=l*e+y*M+D*x;A[9]=m*e+K*M+h*x;A[10]=n*e+u*M+t*x;A[11]=v*e+F*M+B*x;return A};
mat4.rotateX=function(b,l,q){var A=Math.sin(l);l=Math.cos(l);var M=b[4],x=b[5],m=b[6],a=b[7],c=b[8],f=b[9],n=b[10],v=b[11];q?b!==q&&(q[0]=b[0],q[1]=b[1],q[2]=b[2],q[3]=b[3],q[12]=b[12],q[13]=b[13],q[14]=b[14],q[15]=b[15]):q=b;q[4]=M*l+c*A;q[5]=x*l+f*A;q[6]=m*l+n*A;q[7]=a*l+v*A;q[8]=M*-A+c*l;q[9]=x*-A+f*l;q[10]=m*-A+n*l;q[11]=a*-A+v*l;return q};
mat4.rotateY=function(b,l,q){var A=Math.sin(l);l=Math.cos(l);var M=b[0],x=b[1],m=b[2],a=b[3],c=b[8],f=b[9],n=b[10],v=b[11];q?b!==q&&(q[4]=b[4],q[5]=b[5],q[6]=b[6],q[7]=b[7],q[12]=b[12],q[13]=b[13],q[14]=b[14],q[15]=b[15]):q=b;q[0]=M*l+c*-A;q[1]=x*l+f*-A;q[2]=m*l+n*-A;q[3]=a*l+v*-A;q[8]=M*A+c*l;q[9]=x*A+f*l;q[10]=m*A+n*l;q[11]=a*A+v*l;return q};
mat4.rotateZ=function(b,l,q){var A=Math.sin(l);l=Math.cos(l);var M=b[0],x=b[1],m=b[2],a=b[3],c=b[4],f=b[5],n=b[6],v=b[7];q?b!==q&&(q[8]=b[8],q[9]=b[9],q[10]=b[10],q[11]=b[11],q[12]=b[12],q[13]=b[13],q[14]=b[14],q[15]=b[15]):q=b;q[0]=M*l+c*A;q[1]=x*l+f*A;q[2]=m*l+n*A;q[3]=a*l+v*A;q[4]=M*-A+c*l;q[5]=x*-A+f*l;q[6]=m*-A+n*l;q[7]=a*-A+v*l;return q};
mat4.frustum=function(b,l,q,A,M,x,m){m||(m=mat4.create());var a=l-b,c=A-q,f=x-M;m[0]=2*M/a;m[1]=0;m[2]=0;m[3]=0;m[4]=0;m[5]=2*M/c;m[6]=0;m[7]=0;m[8]=(l+b)/a;m[9]=(A+q)/c;m[10]=-(x+M)/f;m[11]=-1;m[12]=0;m[13]=0;m[14]=-(x*M*2)/f;m[15]=0;return m};mat4.perspective=function(b,l,q,A,M){b=q*Math.tan(b*Math.PI/360);l*=b;return mat4.frustum(-l,l,-b,b,q,A,M)};
mat4.ortho=function(b,l,q,A,M,x,m){m||(m=mat4.create());var a=l-b,c=A-q,f=x-M;m[0]=2/a;m[1]=0;m[2]=0;m[3]=0;m[4]=0;m[5]=2/c;m[6]=0;m[7]=0;m[8]=0;m[9]=0;m[10]=-2/f;m[11]=0;m[12]=-(b+l)/a;m[13]=-(A+q)/c;m[14]=-(x+M)/f;m[15]=1;return m};
mat4.lookAt=function(b,l,q,A){A||(A=mat4.create());var M=b[0],x=b[1];b=b[2];var m=q[0];var a=q[1];var c=q[2];q=l[1];var f=l[2];if(M===l[0]&&x===q&&b===f)return mat4.identity(A);q=M-l[0];f=x-l[1];var n=b-l[2];var v=1/Math.sqrt(q*q+f*f+n*n);q*=v;f*=v;n*=v;l=a*n-c*f;c=c*q-m*n;m=m*f-a*q;(v=Math.sqrt(l*l+c*c+m*m))?(v=1/v,l*=v,c*=v,m*=v):m=c=l=0;a=f*m-n*c;var y=n*l-q*m;var K=q*c-f*l;(v=Math.sqrt(a*a+y*y+K*K))?(v=1/v,a*=v,y*=v,K*=v):K=y=a=0;A[0]=l;A[1]=a;A[2]=q;A[3]=0;A[4]=c;A[5]=y;A[6]=f;A[7]=0;A[8]=m;
A[9]=K;A[10]=n;A[11]=0;A[12]=-(l*M+c*x+m*b);A[13]=-(a*M+y*x+K*b);A[14]=-(q*M+f*x+n*b);A[15]=1;return A};mat4.fromRotationTranslation=function(b,l,q){q||(q=mat4.create());var A=b[0],M=b[1],x=b[2],m=b[3],a=A+A,c=M+M,f=x+x;b=A*a;var n=A*c;A*=f;var v=M*c;M*=f;x*=f;a*=m;c*=m;m*=f;q[0]=1-(v+x);q[1]=n+m;q[2]=A-c;q[3]=0;q[4]=n-m;q[5]=1-(b+x);q[6]=M+a;q[7]=0;q[8]=A+c;q[9]=M-a;q[10]=1-(b+v);q[11]=0;q[12]=l[0];q[13]=l[1];q[14]=l[2];q[15]=1;return q};
mat4.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+"]"};quat4.create=function(b){var l=new MatrixArray(4);b&&(l[0]=b[0],l[1]=b[1],l[2]=b[2],l[3]=b[3]);return l};quat4.set=function(b,l){l[0]=b[0];l[1]=b[1];l[2]=b[2];l[3]=b[3];return l};
quat4.calculateW=function(b,l){var q=b[0],A=b[1],M=b[2];if(!l||b===l)return b[3]=-Math.sqrt(Math.abs(1-q*q-A*A-M*M)),b;l[0]=q;l[1]=A;l[2]=M;l[3]=-Math.sqrt(Math.abs(1-q*q-A*A-M*M));return l};quat4.inverse=function(b,l){if(!l||b===l)return b[0]*=-1,b[1]*=-1,b[2]*=-1,b;l[0]=-b[0];l[1]=-b[1];l[2]=-b[2];l[3]=b[3];return l};quat4.length=function(b){var l=b[0],q=b[1],A=b[2];b=b[3];return Math.sqrt(l*l+q*q+A*A+b*b)};
quat4.normalize=function(b,l){l||(l=b);var q=b[0],A=b[1],M=b[2];b=b[3];var x=Math.sqrt(q*q+A*A+M*M+b*b);if(0===x)return l[0]=0,l[1]=0,l[2]=0,l[3]=0,l;x=1/x;l[0]=q*x;l[1]=A*x;l[2]=M*x;l[3]=b*x;return l};quat4.multiply=function(b,l,q){q||(q=b);var A=b[0],M=b[1],x=b[2];b=b[3];var m=l[0],a=l[1],c=l[2];l=l[3];q[0]=A*l+b*m+M*c-x*a;q[1]=M*l+b*a+x*m-A*c;q[2]=x*l+b*c+A*a-M*m;q[3]=b*l-A*m-M*a-x*c;return q};
quat4.multiplyVec3=function(b,l,q){q||(q=l);var A=l[0],M=l[1],x=l[2];l=b[0];var m=b[1],a=b[2];b=b[3];var c=b*A+m*x-a*M,f=b*M+a*A-l*x,n=b*x+l*M-m*A;A=-l*A-m*M-a*x;q[0]=c*b+A*-l+f*-a-n*-m;q[1]=f*b+A*-m+n*-l-c*-a;q[2]=n*b+A*-a+c*-m-f*-l;return q};quat4.toMat3=function(b,l){l||(l=mat3.create());var q=b[0],A=b[1],M=b[2];b=b[3];var x=q+q,m=A+A,a=M+M,c=q*x,f=q*m;q*=a;var n=A*m;A*=a;M*=a;x*=b;m*=b;b*=a;l[0]=1-(n+M);l[1]=f+b;l[2]=q-m;l[3]=f-b;l[4]=1-(c+M);l[5]=A+x;l[6]=q+m;l[7]=A-x;l[8]=1-(c+n);return l};
quat4.toMat4=function(b,l){l||(l=mat4.create());var q=b[0],A=b[1],M=b[2];b=b[3];var x=q+q,m=A+A,a=M+M,c=q*x,f=q*m;q*=a;var n=A*m;A*=a;M*=a;x*=b;m*=b;b*=a;l[0]=1-(n+M);l[1]=f+b;l[2]=q-m;l[3]=0;l[4]=f-b;l[5]=1-(c+M);l[6]=A+x;l[7]=0;l[8]=q+m;l[9]=A-x;l[10]=1-(c+n);l[11]=0;l[12]=0;l[13]=0;l[14]=0;l[15]=1;return l};
quat4.slerp=function(b,l,q,A){A||(A=b);var M=b[0]*l[0]+b[1]*l[1]+b[2]*l[2]+b[3]*l[3];if(1<=Math.abs(M))return A!==b&&(A[0]=b[0],A[1]=b[1],A[2]=b[2],A[3]=b[3]),A;var x=Math.acos(M);var m=Math.sqrt(1-M*M);if(.001>Math.abs(m))return A[0]=.5*b[0]+.5*l[0],A[1]=.5*b[1]+.5*l[1],A[2]=.5*b[2]+.5*l[2],A[3]=.5*b[3]+.5*l[3],A;M=Math.sin((1-q)*x)/m;q=Math.sin(q*x)/m;A[0]=b[0]*M+l[0]*q;A[1]=b[1]*M+l[1]*q;A[2]=b[2]*M+l[2]*q;A[3]=b[3]*M+l[3]*q;return A};
quat4.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+"]"};
(function(){function b(a,c,f){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent);this.height=this.width=0;this.enableFrontToBack=!!f;this.isBatchInEarlyZPass=this.isEarlyZPass=!1;this.currentZ=0;this.zNear=1;this.zFar=1E3;this.zIncrement=(this.zFar-this.zNear)/32768;this.zA=this.zFar/(this.zFar-this.zNear);this.zB=this.zFar*this.zNear/(this.zNear-this.zFar);this.kzA=65536*this.zA;this.kzB=65536*this.zB;this.cam=vec3.create([0,0,100]);this.look=vec3.create([0,0,0]);this.up=
vec3.create([0,1,0]);this.worldScale=vec3.create([1,1,1]);this.enable_mipmaps=!0;this.matP=mat4.create();this.matMV=mat4.create();this.lastMV=mat4.create();this.currentMV=mat4.create();this.gl=a;this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1;this.timerExt=null;this.isTiming=!1;this.timerExt=2===this.version?this.gl.getExtension("EXT_disjoint_timer_query_webgl2")||this.gl.getExtension("EXT_disjoint_timer_query"):this.gl.getExtension("EXT_disjoint_timer_query");this.frameNumber=
0;this.timerResults=[];this.initState()}function l(a,c,f){this.gl=a;this.shaderProgram=c;this.name=f;this.locAPos=a.getAttribLocation(c,"aPos");this.locATex=a.getAttribLocation(c,"aTex");this.locMatP=a.getUniformLocation(c,"matP");this.locMatMV=a.getUniformLocation(c,"matMV");this.locOpacity=a.getUniformLocation(c,"opacity");this.locColorFill=a.getUniformLocation(c,"colorFill");this.locSamplerFront=a.getUniformLocation(c,"samplerFront");this.locSamplerBack=a.getUniformLocation(c,"samplerBack");this.locSrcStart=
a.getUniformLocation(c,"srcStart");this.locSrcEnd=a.getUniformLocation(c,"srcEnd");this.locSrcOriginStart=a.getUniformLocation(c,"srcOriginStart");this.locSrcOriginEnd=a.getUniformLocation(c,"srcOriginEnd");this.locLayoutStart=a.getUniformLocation(c,"layoutStart");this.locLayoutEnd=a.getUniformLocation(c,"layoutEnd");this.locDestStart=a.getUniformLocation(c,"destStart");this.locDestEnd=a.getUniformLocation(c,"destEnd");this.locSeconds=a.getUniformLocation(c,"seconds");this.locPixelSize=a.getUniformLocation(c,
"pixelSize");this.locLayerScale=a.getUniformLocation(c,"layerScale");this.locLayerAngle=a.getUniformLocation(c,"layerAngle");this.hasAnyOptionalUniforms=!!(this.locPixelSize||this.locSeconds||this.locSamplerBack||this.locSrcStart||this.locSrcEnd||this.locSrcOriginStart||this.locSrcOriginEnd||this.locLayoutStart||this.locLayoutEnd||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle);this.lpPixelHeight=this.lpPixelWidth=-999;this.lpOpacity=1;this.lpDestStartY=this.lpDestStartX=
this.lpLayoutEndY=this.lpLayoutEndX=this.lpLayoutStartY=this.lpLayoutStartX=this.lpSrcOriginEndY=this.lpSrcOriginEndX=this.lpSrcOriginStartY=this.lpSrcOriginStartX=this.lpSrcEndY=this.lpSrcEndX=this.lpSrcStartY=this.lpSrcStartX=0;this.lpLayerScale=this.lpDestEndY=this.lpDestEndX=1;this.lpSeconds=this.lpLayerAngle=0;this.lastCustomParams=[];this.lpMatMV=mat4.create();this.locOpacity&&a.uniform1f(this.locOpacity,1);this.locColorFill&&a.uniform4f(this.locColorFill,1,1,1,1);this.locSamplerFront&&a.uniform1i(this.locSamplerFront,
0);this.locSamplerBack&&a.uniform1i(this.locSamplerBack,1);this.locSrcStart&&a.uniform2f(this.locSrcStart,0,0);this.locSrcEnd&&a.uniform2f(this.locSrcEnd,1,1);this.locSrcOriginStart&&a.uniform2f(this.locSrcOriginStart,0,0);this.locSrcOriginEnd&&a.uniform2f(this.locSrcOriginEnd,0,0);this.locLayoutStart&&a.uniform2f(this.locLayoutStart,0,0);this.locLayoutEnd&&a.uniform2f(this.locLayoutEnd,0,0);this.locDestStart&&a.uniform2f(this.locDestStart,0,0);this.locDestEnd&&a.uniform2f(this.locDestEnd,1,1);this.locLayerScale&&
a.uniform1f(this.locLayerScale,1);this.locLayerAngle&&a.uniform1f(this.locLayerAngle,0);this.locSeconds&&a.uniform1f(this.locSeconds,0);this.hasCurrentMatMV=!1}function q(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]}function A(a,c){this.type=a;this.glwrap=c;this.gl=c.gl;this.indexCount=this.startIndex=this.opacityParam=
0;this.mat4param=this.texParam=null;this.layoutRect=quat4.create();this.srcOriginRect=quat4.create();this.shaderParams=[];cr.seal(this)}var M=mat4.create();b.prototype.initState=function(){var a=this.gl,c;this.lastOpacity=1;this.lastTexture1=this.lastTexture0=null;this.currentOpacity=1;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);a.disable(a.CULL_FACE);a.disable(a.STENCIL_TEST);a.disable(a.DITHER);this.enableFrontToBack?(a.enable(a.DEPTH_TEST),
a.depthFunc(a.LEQUAL)):a.disable(a.DEPTH_TEST);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.lastSrcBlend=a.ONE;this.lastDestBlend=a.ONE_MINUS_SRC_ALPHA;this.vertexData=new Float32Array(8E3*(this.enableFrontToBack?3:2));this.texcoordData=new Float32Array(16E3);this.pointData=new Float32Array(32E3);this.pointBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer);a.bufferData(a.ARRAY_BUFFER,this.pointData.byteLength,a.DYNAMIC_DRAW);this.vertexBuffers=Array(4);this.texcoordBuffers=
Array(4);for(c=0;4>c;c++)this.vertexBuffers[c]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[c]),a.bufferData(a.ARRAY_BUFFER,this.vertexData.byteLength,a.DYNAMIC_DRAW),this.texcoordBuffers[c]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[c]),a.bufferData(a.ARRAY_BUFFER,this.texcoordData.byteLength,a.DYNAMIC_DRAW);this.curBuffer=0;this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(var f=new Uint16Array(12E3),n=c=0;12E3>
c;)f[c++]=n,f[c++]=n+1,f[c++]=n+2,f[c++]=n,f[c++]=n+2,f[c++]=n+3,n+=4;a.bufferData(a.ELEMENT_ARRAY_BUFFER,f,a.STATIC_DRAW);this.pointPtr=this.texPtr=this.vertexPtr=0;this.shaderPrograms=[];c=this.enableFrontToBack?"attribute highp vec3 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);\n\tvTex = aTex;\n}":"attribute highp vec2 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tvTex = aTex;\n}";
f=this.createShaderProgram({src:"varying mediump vec2 vTex;\nuniform lowp float opacity;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex);\n\tgl_FragColor *= opacity;\n}"},c,"<default>");this.shaderPrograms.push(f);f=this.createShaderProgram({src:"uniform mediump sampler2D samplerFront;\nvarying lowp float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);\n\tgl_FragColor *= opacity;\n}"},"attribute vec4 aPos;\nvarying float opacity;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tgl_PointSize = aPos.z;\n\topacity = aPos.w;\n}",
"<point>");this.shaderPrograms.push(f);f=this.createShaderProgram({src:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tif (texture2D(samplerFront, vTex).a < 1.0)\n\t\tdiscard;\n}"},c,"<earlyz>");this.shaderPrograms.push(f);f=this.createShaderProgram({src:"uniform lowp vec4 colorFill;\nvoid main(void) {\n\tgl_FragColor = colorFill;\n}"},c,"<fill>");this.shaderPrograms.push(f);for(var v in cr.shaders)cr.shaders.hasOwnProperty(v)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[v],
c,v));a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,null);this.batch=[];this.batchPtr=0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.currentProgram=this.lastProgram=-1;this.currentShader=null;this.fbo=a.createFramebuffer();this.depthBuffer=this.renderToTex=null;this.attachedDepthBuffer=!1;this.enableFrontToBack&&(this.depthBuffer=a.createRenderbuffer());this.tmpVec3=vec3.create([0,0,0]);a=a.getParameter(a.ALIASED_POINT_SIZE_RANGE);this.minPointSize=a[0];this.maxPointSize=a[1];2048<
this.maxPointSize&&(this.maxPointSize=2048);this.switchProgram(0);cr.seal(this)};l.prototype.updateMatMV=function(a){q(this.lpMatMV,a)||(mat4.set(a,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,a))};b.prototype.createShaderProgram=function(a,c,f){var n=this.gl,v=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(v,a.src);n.compileShader(v);if(!n.getShaderParameter(v,n.COMPILE_STATUS))throw a=n.getShaderInfoLog(v),n.deleteShader(v),Error("error compiling fragment shader: "+a);var y=n.createShader(n.VERTEX_SHADER);
n.shaderSource(y,c);n.compileShader(y);if(!n.getShaderParameter(y,n.COMPILE_STATUS))throw a=n.getShaderInfoLog(y),n.deleteShader(v),n.deleteShader(y),Error("error compiling vertex shader: "+a);c=n.createProgram();n.attachShader(c,v);n.attachShader(c,y);n.linkProgram(c);if(!n.getProgramParameter(c,n.LINK_STATUS))throw a=n.getProgramInfoLog(c),n.deleteShader(v),n.deleteShader(y),n.deleteProgram(c),Error("error linking shader program: "+a);n.useProgram(c);n.deleteShader(v);n.deleteShader(y);v=new l(n,
c,f);v.extendBoxHorizontal=a.extendBoxHorizontal||0;v.extendBoxVertical=a.extendBoxVertical||0;v.crossSampling=!!a.crossSampling;v.preservesOpaqueness=!!a.preservesOpaqueness;v.animated=!!a.animated;v.parameters=a.parameters||[];a=0;for(y=v.parameters.length;a<y;a++)v.parameters[a][1]=n.getUniformLocation(c,v.parameters[a][0]),v.lastCustomParams.push(0);cr.seal(v);return v};b.prototype.getShaderIndex=function(a){var c;var f=0;for(c=this.shaderPrograms.length;f<c;f++)if(this.shaderPrograms[f].name===
a)return f;return-1};b.prototype.project=function(a,c,f){var n=this.matMV,v=this.matP,y=[0,0,0,0,0,0,0,0];y[0]=n[0]*a+n[4]*c+n[12];y[1]=n[1]*a+n[5]*c+n[13];y[2]=n[2]*a+n[6]*c+n[14];y[3]=n[3]*a+n[7]*c+n[15];y[4]=v[0]*y[0]+v[4]*y[1]+v[8]*y[2]+v[12]*y[3];y[5]=v[1]*y[0]+v[5]*y[1]+v[9]*y[2]+v[13]*y[3];y[6]=v[2]*y[0]+v[6]*y[1]+v[10]*y[2]+v[14]*y[3];y[7]=-y[2];0!==y[7]&&(y[7]=1/y[7],y[4]*=y[7],y[5]*=y[7],y[6]*=y[7],f[0]=(.5*y[4]+.5)*this.width,f[1]=(.5*y[5]+.5)*this.height)};b.prototype.setSize=function(a,
c,f){if(this.width!==a||this.height!==c||f){this.endBatch();f=this.gl;this.width=a;this.height=c;f.viewport(0,0,a,c);mat4.lookAt(this.cam,this.look,this.up,this.matMV);this.enableFrontToBack?(mat4.ortho(-a/2,a/2,c/2,-c/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1):(mat4.perspective(45,a/c,this.zNear,this.zFar,this.matP),a=[0,0],c=[0,0],this.project(0,0,a),this.project(1,1,c),this.worldScale[0]=1/(c[0]-a[0]),this.worldScale[1]=-1/(c[1]-a[1]));a=0;for(c=this.shaderPrograms.length;a<
c;a++){var n=this.shaderPrograms[a];n.hasCurrentMatMV=!1;n.locMatP&&(f.useProgram(n.shaderProgram),f.uniformMatrix4fv(n.locMatP,!1,this.matP))}f.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram);f.bindTexture(f.TEXTURE_2D,null);f.activeTexture(f.TEXTURE1);f.bindTexture(f.TEXTURE_2D,null);f.activeTexture(f.TEXTURE0);this.lastTexture1=this.lastTexture0=null;this.depthBuffer&&(f.bindFramebuffer(f.FRAMEBUFFER,this.fbo),f.bindRenderbuffer(f.RENDERBUFFER,this.depthBuffer),f.renderbufferStorage(f.RENDERBUFFER,
f.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),f.bindRenderbuffer(f.RENDERBUFFER,null),f.bindFramebuffer(f.FRAMEBUFFER,null),this.renderToTex=null)}};b.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV);mat4.scale(this.matMV,this.worldScale)};b.prototype.translate=function(a,c){if(0!==a||0!==c)this.tmpVec3[0]=a,this.tmpVec3[1]=
c,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3)};b.prototype.scale=function(a,c){if(1!==a||1!==c)this.tmpVec3[0]=a,this.tmpVec3[1]=c,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3)};b.prototype.rotateZ=function(a){0!==a&&mat4.rotateZ(this.matMV,a)};b.prototype.updateModelView=function(){if(!q(this.lastMV,this.matMV)){var a=this.pushBatch();a.type=5;a.mat4param?mat4.set(this.matMV,a.mat4param):a.mat4param=mat4.create(this.matMV);mat4.set(this.matMV,this.lastMV);this.hasPointBatchTop=
this.hasQuadBatchTop=!1}};b.prototype.setEarlyZIndex=function(a){this.enableFrontToBack&&(32760<a&&(a=32760),this.currentZ=this.cam[2]-this.zNear-a*this.zIncrement)};A.prototype.doSetEarlyZPass=function(){var a=this.gl,c=this.glwrap;0!==this.startIndex?(a.depthMask(!0),a.colorMask(!1,!1,!1,!1),a.disable(a.BLEND),a.bindFramebuffer(a.FRAMEBUFFER,c.fbo),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),a.clear(a.DEPTH_BUFFER_BIT),a.bindFramebuffer(a.FRAMEBUFFER,null),c.isBatchInEarlyZPass=
!0):(a.depthMask(!1),a.colorMask(!0,!0,!0,!0),a.enable(a.BLEND),c.isBatchInEarlyZPass=!1)};A.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)};A.prototype.doSetTexture1=function(){var a=this.gl;a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,this.texParam);a.activeTexture(a.TEXTURE0)};A.prototype.doSetOpacity=function(){var a=this.opacityParam,c=this.glwrap;c.currentOpacity=a;c=c.currentShader;c.locOpacity&&c.lpOpacity!==a&&(c.lpOpacity=a,this.gl.uniform1f(c.locOpacity,
a))};A.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)};A.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)};A.prototype.doUpdateModelView=function(){var a,c=this.glwrap.shaderPrograms,f=this.glwrap.currentProgram;var n=0;for(a=c.length;n<a;n++){var v=c[n];n===f&&v.locMatMV?(v.updateMatMV(this.mat4param),v.hasCurrentMatMV=!0):v.hasCurrentMatMV=!1}mat4.set(this.mat4param,this.glwrap.currentMV)};
A.prototype.doRenderToTexture=function(){var a=this.gl,c=this.glwrap;this.texParam?(c.lastTexture1===this.texParam&&(a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,null),c.lastTexture1=null,a.activeTexture(a.TEXTURE0)),a.bindFramebuffer(a.FRAMEBUFFER,c.fbo),c.isBatchInEarlyZPass||a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texParam,0)):(c.enableFrontToBack||a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),a.bindFramebuffer(a.FRAMEBUFFER,
null))};A.prototype.doClear=function(){var a=this.gl,c=this.startIndex;0===c?(a.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clear(a.COLOR_BUFFER_BIT)):1===c?(a.enable(a.SCISSOR_TEST),a.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.SCISSOR_TEST)):a.clear(a.DEPTH_BUFFER_BIT)};A.prototype.doSetDepthTestEnabled=function(){var a=this.gl;0!==this.startIndex?a.enable(a.DEPTH_TEST):
a.disable(a.DEPTH_TEST)};A.prototype.doPoints=function(){var a=this.gl,c=this.glwrap;c.enableFrontToBack&&a.disable(a.DEPTH_TEST);var f=c.shaderPrograms[1];a.useProgram(f.shaderProgram);!f.hasCurrentMatMV&&f.locMatMV&&(f.updateMatMV(c.currentMV),f.hasCurrentMatMV=!0);a.enableVertexAttribArray(f.locAPos);a.bindBuffer(a.ARRAY_BUFFER,c.pointBuffer);a.vertexAttribPointer(f.locAPos,4,a.FLOAT,!1,0,0);a.drawArrays(a.POINTS,this.startIndex/4,this.indexCount);f=c.currentShader;a.useProgram(f.shaderProgram);
0<=f.locAPos&&(a.enableVertexAttribArray(f.locAPos),a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffers[c.curBuffer]),a.vertexAttribPointer(f.locAPos,c.enableFrontToBack?3:2,a.FLOAT,!1,0,0));0<=f.locATex&&(a.enableVertexAttribArray(f.locATex),a.bindBuffer(a.ARRAY_BUFFER,c.texcoordBuffers[c.curBuffer]),a.vertexAttribPointer(f.locATex,2,a.FLOAT,!1,0,0));c.enableFrontToBack&&a.enable(a.DEPTH_TEST)};A.prototype.doSetProgram=function(){var a=this.gl,c=this.glwrap,f=c.shaderPrograms[this.startIndex];c.currentProgram=
this.startIndex;c.currentShader=f;a.useProgram(f.shaderProgram);!f.hasCurrentMatMV&&f.locMatMV&&(f.updateMatMV(c.currentMV),f.hasCurrentMatMV=!0);f.locOpacity&&f.lpOpacity!==c.currentOpacity&&(f.lpOpacity=c.currentOpacity,a.uniform1f(f.locOpacity,c.currentOpacity));0<=f.locAPos&&(a.enableVertexAttribArray(f.locAPos),a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffers[c.curBuffer]),a.vertexAttribPointer(f.locAPos,c.enableFrontToBack?3:2,a.FLOAT,!1,0,0));0<=f.locATex&&(a.enableVertexAttribArray(f.locATex),
a.bindBuffer(a.ARRAY_BUFFER,c.texcoordBuffers[c.curBuffer]),a.vertexAttribPointer(f.locATex,2,a.FLOAT,!1,0,0))};A.prototype.doSetColor=function(){var a=this.mat4param;this.gl.uniform4f(this.glwrap.currentShader.locColorFill,a[0],a[1],a[2],a[3])};A.prototype.doSetProgramParameters=function(){var a=this.glwrap.currentShader,c=this.gl;var f=this.mat4param;var n=this.layoutRect;var v=this.srcOriginRect;a.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,
this.texParam),this.glwrap.lastTexture1=this.texParam,c.activeTexture(c.TEXTURE0));var y=f[0],K=f[1];!a.locPixelSize||y===a.lpPixelWidth&&K===a.lpPixelHeight||(a.lpPixelWidth=y,a.lpPixelHeight=K,c.uniform2f(a.locPixelSize,y,K));y=f[2];K=f[3];!a.locDestStart||y===a.lpDestStartX&&K===a.lpDestStartY||(a.lpDestStartX=y,a.lpDestStartY=K,c.uniform2f(a.locDestStart,y,K));y=f[4];K=f[5];!a.locDestEnd||y===a.lpDestEndX&&K===a.lpDestEndY||(a.lpDestEndX=y,a.lpDestEndY=K,c.uniform2f(a.locDestEnd,y,K));y=f[6];
a.locLayerScale&&y!==a.lpLayerScale&&(a.lpLayerScale=y,c.uniform1f(a.locLayerScale,y));y=f[7];a.locLayerAngle&&y!==a.lpLayerAngle&&(a.lpLayerAngle=y,c.uniform1f(a.locLayerAngle,y));y=f[12];K=f[13];!a.locSrcStart||y===a.lpSrcStartX&&K===a.lpSrcStartY||(a.lpSrcStartX=y,a.lpSrcStartY=K,c.uniform2f(a.locSrcStart,y,K));y=f[14];K=f[15];!a.locSrcEnd||y===a.lpSrcEndX&&K===a.lpSrcEndY||(a.lpSrcEndX=y,a.lpSrcEndY=K,c.uniform2f(a.locSrcEnd,y,K));y=v[0];K=v[1];!a.locSrcOriginStart||y===a.lpSrcOriginStartX&&K===
a.lpSrcOriginStartY||(a.lpSrcOriginStartX=y,a.lpSrcOriginStartY=K,c.uniform2f(a.locSrcOriginStart,y,K));y=v[2];K=v[3];!a.locSrcOriginEnd||y===a.lpSrcOriginEndX&&K===a.lpSrcOriginEndY||(a.lpSrcOriginEndX=y,a.lpSrcOriginEndY=K,c.uniform2f(a.locSrcOriginEnd,y,K));y=n[0];K=n[1];!a.locLayoutStart||y===a.lpLayoutStartX&&K===a.lpLayoutStartY||(a.lpLayoutStartX=y,a.lpLayoutStartY=K,c.uniform2f(a.locLayoutStart,y,K));y=n[2];K=n[3];!a.locLayoutEnd||y===a.lpLayoutEndX&&K===a.lpLayoutEndY||(a.lpLayoutEndX=y,
a.lpLayoutEndY=K,c.uniform2f(a.locLayoutEnd,y,K));y=this.startIndex;a.locSeconds&&y!==a.lpSeconds&&(a.lpSeconds=y,c.uniform1f(a.locSeconds,y));if(a.parameters.length)for(f=0,n=a.parameters.length;f<n;f++)y=this.shaderParams[f],Array.isArray(y)?c.uniform3fv(a.parameters[f][1],y):y!==a.lastCustomParams[f]&&(a.lastCustomParams[f]=y,c.uniform1f(a.parameters[f][1],y))};b.prototype.pushBatch=function(){this.batchPtr===this.batch.length&&this.batch.push(new A(0,this));return this.batch[this.batchPtr++]};
b.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){this.maybeStartTiming();var a=this.gl;0<this.pointPtr&&(a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer),a.bufferSubData(a.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),c&&0<=c.locAPos&&"<point>"===c.name&&a.vertexAttribPointer(c.locAPos,4,a.FLOAT,!1,0,0));if(0<this.vertexPtr){var c=this.currentShader;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]);a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexData.subarray(0,
this.vertexPtr));c&&0<=c.locAPos&&"<point>"!==c.name&&a.vertexAttribPointer(c.locAPos,this.enableFrontToBack?3:2,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]);a.bufferSubData(a.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr));c&&0<=c.locATex&&"<point>"!==c.name&&a.vertexAttribPointer(c.locATex,2,a.FLOAT,!1,0,0)}a=0;for(c=this.batchPtr;a<c;a++){var f=this.batch[a];switch(f.type){case 1:f.doQuad();break;case 2:f.doSetTexture();break;case 3:f.doSetOpacity();
break;case 4:f.doSetBlend();break;case 5:f.doUpdateModelView();break;case 6:f.doRenderToTexture();break;case 7:f.doClear();break;case 8:f.doPoints();break;case 9:f.doSetProgram();break;case 10:f.doSetProgramParameters();break;case 11:f.doSetTexture1();break;case 12:f.doSetColor();break;case 13:f.doSetDepthTestEnabled();break;case 14:f.doSetEarlyZPass()}}this.pointPtr=this.texPtr=this.vertexPtr=this.batchPtr=0;this.isBatchInEarlyZPass=this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.curBuffer++;
4<=this.curBuffer&&(this.curBuffer=0)}};b.prototype.maybeStartTiming=function(){if(!this.isTiming&&this.timerExt){this.isTiming=!0;var a={frameNumber:this.frameNumber,query:null,result:0};2===this.version?(a.query=this.gl.createQuery(),this.gl.beginQuery(this.timerExt.TIME_ELAPSED_EXT,a.query)):(a.query=this.timerExt.createQueryEXT(),this.timerExt.beginQueryEXT(this.timerExt.TIME_ELAPSED_EXT,a.query));this.timerResults.push(a);1E3<this.timerResults.length&&(a=this.timerResults.shift(),a.query&&(2===
this.version?this.gl.deleteQuery(a.query):this.timerExt.deleteQueryEXT(a.query)))}};b.prototype.maybeFinishTiming=function(){this.isTiming&&this.timerResults.length&&(2===this.version?this.gl.endQuery(this.timerExt.TIME_ELAPSED_EXT):this.timerExt.endQueryEXT(this.timerExt.TIME_ELAPSED_EXT),this.isTiming=!1)};b.prototype.checkForTimerResults=function(a){var c;var f=0;for(c=this.timerResults.length;f<c;++f){var n=this.timerResults[f];if(n.frameNumber>=a)break;if(n.query){var v=2===this.version?this.gl.getQueryParameter(n.query,
this.gl.QUERY_RESULT_AVAILABLE):this.timerExt.getQueryObjectEXT(n.query,this.timerExt.QUERY_RESULT_AVAILABLE_EXT);var y=this.gl.getParameter(this.timerExt.GPU_DISJOINT_EXT);v&&!y&&(n.result=2===this.version?this.gl.getQueryParameter(n.query,this.gl.QUERY_RESULT):this.timerExt.getQueryObjectEXT(n.query,this.timerExt.QUERY_RESULT_EXT),n.result/=1E9);if(v||y)2===this.version?this.gl.deleteQuery(n.query):this.timerExt.deleteQueryEXT(n.query),n.query=null}}};b.prototype.getFrameRangeTimerResults=function(a,
c){if(c<=a)return-1;var f,n=0,v=0;var y=0;for(f=this.timerResults.length;y<f;++y){var K=this.timerResults[y];if(K.frameNumber>=c)break;if(K.frameNumber>=a){if(K.query)return-1;n+=K.result;v++}}return v<c-a?-1:n};b.prototype.deleteTimerResultsToFrame=function(a){var c;var f=0;for(c=this.timerResults.length;f<c;++f){var n=this.timerResults[f];if(n.frameNumber>=a){0<f&&this.timerResults.splice(0,f);break}}};b.prototype.setOpacity=function(a){if(a!==this.lastOpacity&&!this.isEarlyZPass){var c=this.pushBatch();
c.type=3;this.lastOpacity=c.opacityParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.setTexture=function(a){if(a!==this.lastTexture0){var c=this.pushBatch();c.type=2;this.lastTexture0=c.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.setBlend=function(a,c){if((a!==this.lastSrcBlend||c!==this.lastDestBlend)&&!this.isEarlyZPass){var f=this.pushBatch();f.type=4;f.startIndex=a;f.indexCount=c;this.lastSrcBlend=a;this.lastDestBlend=c;this.hasPointBatchTop=this.hasQuadBatchTop=
!1}};b.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA};b.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)};b.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};b.prototype.quad=function(a,c,f,n,v,y,K,u){15992<=this.vertexPtr&&this.endBatch();var F=this.vertexPtr,D=this.texPtr,h=this.vertexData,t=this.texcoordData,
B=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var S=this.pushBatch();S.type=1;S.startIndex=this.enableFrontToBack?F:F/2*3;S.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}this.enableFrontToBack?(h[F++]=a,h[F++]=c,h[F++]=B,h[F++]=f,h[F++]=n,h[F++]=B,h[F++]=v,h[F++]=y,h[F++]=B,h[F++]=K,h[F++]=u,h[F++]=B):(h[F++]=a,h[F++]=c,h[F++]=f,h[F++]=n,h[F++]=v,h[F++]=y,h[F++]=K,h[F++]=u);t[D++]=0;t[D++]=0;t[D++]=1;t[D++]=0;t[D++]=1;t[D++]=1;t[D++]=0;t[D++]=
1;this.vertexPtr=F;this.texPtr=D};b.prototype.quadTex=function(a,c,f,n,v,y,K,u,F){15992<=this.vertexPtr&&this.endBatch();var D=this.vertexPtr,h=this.texPtr,t=this.vertexData,B=this.texcoordData,S=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var V=this.pushBatch();V.type=1;V.startIndex=this.enableFrontToBack?D:D/2*3;V.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}V=F.left;var L=F.top,d=F.right;F=F.bottom;this.enableFrontToBack?(t[D++]=a,t[D++]=
c,t[D++]=S,t[D++]=f,t[D++]=n,t[D++]=S,t[D++]=v,t[D++]=y,t[D++]=S,t[D++]=K,t[D++]=u,t[D++]=S):(t[D++]=a,t[D++]=c,t[D++]=f,t[D++]=n,t[D++]=v,t[D++]=y,t[D++]=K,t[D++]=u);B[h++]=V;B[h++]=L;B[h++]=d;B[h++]=L;B[h++]=d;B[h++]=F;B[h++]=V;B[h++]=F;this.vertexPtr=D;this.texPtr=h};b.prototype.quadTexUV=function(a,c,f,n,v,y,K,u,F,D,h,t,B,S,V,L){15992<=this.vertexPtr&&this.endBatch();var d=this.vertexPtr,k=this.texPtr,E=this.vertexData,e=this.texcoordData,w=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-
1].indexCount+=6;else{var I=this.pushBatch();I.type=1;I.startIndex=this.enableFrontToBack?d:d/2*3;I.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}this.enableFrontToBack?(E[d++]=a,E[d++]=c,E[d++]=w,E[d++]=f,E[d++]=n,E[d++]=w,E[d++]=v,E[d++]=y,E[d++]=w,E[d++]=K,E[d++]=u,E[d++]=w):(E[d++]=a,E[d++]=c,E[d++]=f,E[d++]=n,E[d++]=v,E[d++]=y,E[d++]=K,E[d++]=u);e[k++]=F;e[k++]=D;e[k++]=h;e[k++]=t;e[k++]=B;e[k++]=S;e[k++]=V;e[k++]=L;this.vertexPtr=d;this.texPtr=k};b.prototype.convexPoly=function(a){var c=
a.length/2-2,f=c-1,n=a[0],v=a[1],y;for(y=0;y<c;y+=2){var K=2*y;var u=a[K+2];var F=a[K+3];var D=a[K+4];var h=a[K+5];if(y===f)this.quad(n,v,u,F,D,h,D,h);else{var t=a[K+6];K=a[K+7];this.quad(n,v,u,F,D,h,t,K)}}};b.prototype.point=function(a,c,f,n){7996<=this.pointPtr&&this.endBatch();var v=this.pointPtr,y=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var K=this.pushBatch();K.type=8;K.startIndex=v;K.indexCount=1;this.hasPointBatchTop=!0;this.hasQuadBatchTop=!1}y[v++]=
a;y[v++]=c;y[v++]=f;y[v++]=n;this.pointPtr=v};b.prototype.switchProgram=function(a){if(this.lastProgram!==a){if(!this.shaderPrograms[a]){if(0===this.lastProgram)return;a=0}var c=this.pushBatch();c.type=9;this.lastProgram=c.startIndex=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.programUsesDest=function(a){a=this.shaderPrograms[a];return!(!a.locDestStart&&!a.locDestEnd)};b.prototype.programUsesCrossSampling=function(a){a=this.shaderPrograms[a];return!!(a.locDestStart||a.locDestEnd||
a.crossSampling)};b.prototype.programPreservesOpaqueness=function(a){return this.shaderPrograms[a].preservesOpaqueness};b.prototype.programExtendsBox=function(a){a=this.shaderPrograms[a];return 0!==a.extendBoxHorizontal||0!==a.extendBoxVertical};b.prototype.getProgramBoxExtendHorizontal=function(a){return this.shaderPrograms[a].extendBoxHorizontal};b.prototype.getProgramBoxExtendVertical=function(a){return this.shaderPrograms[a].extendBoxVertical};b.prototype.getProgramParameterType=function(a,c){return this.shaderPrograms[a].parameters[c][2]};
b.prototype.programIsAnimated=function(a){return this.shaderPrograms[a].animated};b.prototype.setProgramParameters=function(a,c,f,n,v,y,K,u,F,D,h,t,B,S,V,L,d,k,E,e,w,I,N){var U=this.shaderPrograms[this.lastProgram];if(U.hasAnyOptionalUniforms||N.length){var W=this.pushBatch();W.type=10;W.mat4param?mat4.set(this.matMV,W.mat4param):W.mat4param=mat4.create();var X=W.mat4param;X[0]=c;X[1]=f;X[2]=L;X[3]=d;X[4]=k;X[5]=E;X[6]=e;X[7]=w;X[12]=n;X[13]=v;X[14]=y;X[15]=K;c=W.srcOriginRect;c[0]=u;c[1]=F;c[2]=
D;c[3]=h;u=W.layoutRect;u[0]=t;u[1]=V;u[2]=S;u[3]=B;W.startIndex=I;W.texParam=U.locSamplerBack?a:null;if(N.length)for(B=W.shaderParams,B.length=N.length,a=0,t=N.length;a<t;a++)B[a]=N[a];this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.clear=function(a,c,f,n){var v=this.pushBatch();v.type=7;v.startIndex=0;v.mat4param||(v.mat4param=mat4.create());v.mat4param[0]=a;v.mat4param[1]=c;v.mat4param[2]=f;v.mat4param[3]=n;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.clearRect=function(a,
c,f,n){if(!(0>f||0>n)){var v=this.pushBatch();v.type=7;v.startIndex=1;v.mat4param||(v.mat4param=mat4.create());v.mat4param[0]=a;v.mat4param[1]=c;v.mat4param[2]=f;v.mat4param[3]=n;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.clearDepth=function(){var a=this.pushBatch();a.type=7;a.startIndex=2;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.setEarlyZPass=function(a){if(this.enableFrontToBack&&(a=!!a,this.isEarlyZPass!==a)){var c=this.pushBatch();c.type=14;c.startIndex=a?1:
0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.isEarlyZPass=a;this.renderToTex=null;this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}};b.prototype.setDepthTestEnabled=function(a){if(this.enableFrontToBack){var c=this.pushBatch();c.type=13;c.startIndex=a?1:0;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,M);this.resetModelView();this.updateModelView();var a=this.width/2,c=this.height/2;this.quad(-a,c,a,c,a,-c,-a,-c);mat4.set(M,
this.matMV);this.updateModelView()};b.prototype.setColorFillMode=function(a,c,f,n){this.switchProgram(3);var v=this.pushBatch();v.type=12;v.mat4param||(v.mat4param=mat4.create());v.mat4param[0]=a;v.mat4param[1]=c;v.mat4param[2]=f;v.mat4param[3]=n;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.setTextureFillMode=function(){this.switchProgram(0)};b.prototype.restoreEarlyZMode=function(){this.switchProgram(2)};b.prototype.getFrameNumber=function(){return this.frameNumber};b.prototype.present=
function(){this.endBatch();this.maybeFinishTiming();this.gl.flush();this.checkForTimerResults(this.frameNumber);this.frameNumber++};b.prototype.supportsGpuProfiling=function(){return!!this.timerExt};var x=[],m={};b.prototype.contextLost=function(){cr.clearArray(x);m={}};b.prototype.loadTexture=function(a,c,f,n,v,y){c=!!c;f=!!f;var K=a.src+","+c+","+f+(c?","+v:"");if("undefined"!==typeof a.src&&m.hasOwnProperty(K)){var u=m[K];u.c2refcount++;return u}this.endBatch();var F=this.gl,D=cr.isPOT(a.width)&&
cr.isPOT(a.height);u=F.createTexture();F.bindTexture(F.TEXTURE_2D,u);F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var h=F.RGBA,t=F.RGBA,B=F.UNSIGNED_BYTE;if(n&&!this.isIE)switch(n){case 1:t=h=F.RGB;break;case 2:B=F.UNSIGNED_SHORT_4_4_4_4;break;case 3:B=F.UNSIGNED_SHORT_5_5_5_1;break;case 4:t=h=F.RGB,B=F.UNSIGNED_SHORT_5_6_5}if(1===this.version&&!D&&c){n=document.createElement("canvas");n.width=cr.nextHighestPowerOfTwo(a.width);n.height=cr.nextHighestPowerOfTwo(a.height);var S=n.getContext("2d");
S.imageSmoothingEnabled=f;S.drawImage(a,0,0,a.width,a.height,0,0,n.width,n.height);F.texImage2D(F.TEXTURE_2D,0,h,t,B,n)}else F.texImage2D(F.TEXTURE_2D,0,h,t,B,a);c?"repeat-x"===v?(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.REPEAT),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE)):("repeat-y"===v?F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE):F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.REPEAT),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.REPEAT)):(F.texParameteri(F.TEXTURE_2D,
F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE));f?(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),(D||2<=this.version)&&this.enable_mipmaps&&!y?(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR_MIPMAP_LINEAR),F.generateMipmap(F.TEXTURE_2D)):F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR)):(F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.NEAREST),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.NEAREST));F.bindTexture(F.TEXTURE_2D,
null);this.lastTexture0=null;u.c2width=a.width;u.c2height=a.height;u.c2refcount=1;u.c2texkey=K;x.push(u);return m[K]=u};b.prototype.createEmptyTexture=function(a,c,f,n,v){this.endBatch();var y=this.gl;this.isIE&&(n=!1);var K=y.createTexture();y.bindTexture(y.TEXTURE_2D,K);y.texImage2D(y.TEXTURE_2D,0,y.RGBA,a,c,0,y.RGBA,n?y.UNSIGNED_SHORT_4_4_4_4:y.UNSIGNED_BYTE,null);v?(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.REPEAT),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.REPEAT)):(y.texParameteri(y.TEXTURE_2D,
y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE));y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,f?y.LINEAR:y.NEAREST);y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,f?y.LINEAR:y.NEAREST);y.bindTexture(y.TEXTURE_2D,null);this.lastTexture0=null;K.c2width=a;K.c2height=c;x.push(K);return K};b.prototype.videoToTexture=function(a,c,f){this.endBatch();var n=this.gl;this.isIE&&(f=!1);n.bindTexture(n.TEXTURE_2D,c);n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
!0);try{n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,f?n.UNSIGNED_SHORT_4_4_4_4:n.UNSIGNED_BYTE,a)}catch(v){console&&console.error&&console.error("Error updating WebGL texture: ",v)}n.bindTexture(n.TEXTURE_2D,null);this.lastTexture0=null};b.prototype.deleteTexture=function(a){a&&("undefined"!==typeof a.c2refcount&&1<a.c2refcount?a.c2refcount--:(this.endBatch(),a===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),a===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),
this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(x,a),"undefined"!==typeof a.c2texkey&&delete m[a.c2texkey],this.gl.deleteTexture(a)))};b.prototype.estimateVRAM=function(){var a=this.width*this.height*8,c;var f=0;for(c=x.length;f<c;f++){var n=x[f];a+=n.c2width*n.c2height*4}return a};b.prototype.textureCount=function(){return x.length};b.prototype.setRenderingToTexture=function(a){if(a!==this.renderToTex){var c=this.pushBatch();
c.type=6;this.renderToTex=c.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};cr.GLWrap=b})();
(function(){function b(g){var p=g.canvas,C=g.projectDataUrl;p||(p=document.createElement("canvas"),document.body.appendChild(p));if(p&&p.getContext){window.c3runtime=this;window.c3canvas=p;var G=this;this.exportType=g.exportType;this.isPreview="preview"===this.exportType;this.isRemotePreview=!!g.isRemotePreview;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!("undefined"===typeof window.c2isCrosswalk||!window.c2isCrosswalk);this.isPhoneGap=this.isCordova=
"cordova"===this.exportType;this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent);this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge;this.isTizen=/tizen/i.test(navigator.userAgent);this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge;this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;
this.isiPad=/ipad/i.test(navigator.userAgent);this.isiOS=this.isiPhone||this.isiPad;this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent);this.isFirefox=/firefox/i.test(navigator.userAgent);this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge;this.isWindows=/windows/i.test(navigator.userAgent);this.isNodeWebkit=
this.isNWjs="nwjs"===this.exportType||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent);this.isArcade="scirra-arcade"===this.exportType;this.isWindows8App=!("undefined"===typeof window.c2isWindows8||!window.c2isWindows8);this.isWindowsPhone8=!("undefined"===typeof window.c2isWindowsPhone8||!window.c2isWindowsPhone8);this.isWindowsPhone81=!("undefined"===typeof window.c2isWindowsPhone81||!window.c2isWindowsPhone81);this.isWindows10="windows-uwp"===this.exportType;this.isWinJS=
this.isWindows8App||this.isWindowsPhone81||this.isWindows10;this.isBlackberry10=!("undefined"===typeof window.c2isBlackberry10||!window.c2isBlackberry10);this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp;this.devicePixelRatio=1;this.isMobile=this.isCordova||this.isCrosswalk||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen;this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent));
this.isWKWebView=!(!this.isiOS||!this.isCordova);this.isPreview&&!this.isNWjs&&("?nw"===window.location.search||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent))&&(this.isNWjs=!0);this.isDebug=this.isPreview&&-1<window.location.search.indexOf("debug");this.useFbInstant="undefined"!==typeof FBInstant&&!this.isPreview&&!this.isCordova;this.hasInitialized=!1;this.canvas=p;this.glwrap=this.gl=null;this.glUnmaskedRenderer="(unavailable)";this.enableFrontToBack=!1;this.earlyz_index=
0;this.ctx=null;this.firstInFullscreen=!1;this.oldHeight=this.oldWidth=0;this.canvas.oncontextmenu=function(z){z.preventDefault&&z.preventDefault();return!1};this.canvas.onselectstart=function(z){z.preventDefault&&z.preventDefault();return!1};this.canvas.ontouchstart=function(z){z.preventDefault&&z.preventDefault();return!1};this.isNWjs&&(window.ondragover=function(z){z.preventDefault();return!1},window.ondrop=function(z){z.preventDefault();return!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache());
if(this.isCordova&&this.isiOS){function z(){var J=document.activeElement;if(!J)return!1;var Q=J.tagName.toLowerCase(),R="email number password search tel text url".split(" ");if("textarea"===Q)return!0;if("input"===Q)return-1<R.indexOf(J.type.toLowerCase()||"text");a:{do{if(J.parentNode&&J.hasAttribute("contenteditable")){J=!0;break a}J=J.parentNode}while(J);J=!1}return J}window.addEventListener("focusout",function(){z()||(document.scrollingElement.scrollTop=0)})}this.projectDataUrl=C||"";this.width=
p.width;this.height=p.height;this.draw_width=this.width;this.draw_height=this.height;this.cssWidth=this.width;this.cssHeight=this.height;this.lastWindowWidth=window.innerWidth;this.lastWindowHeight=window.innerHeight;this.forceCanvasAlpha=!1;this.redraw=!0;this.isSuspended=!1;Date.now||(Date.now=function(){return+new Date});this.plugins=[];this.types={};this.types_lowercase={};this.types_by_index=[];this.behaviors=[];this.layouts={};this.layouts_by_index=[];this.eventsheets={};this.eventsheets_by_index=
[];this.wait_for_textures=[];this.triggers_to_postinit=[];this.all_global_vars=[];this.all_local_vars=[];this.shadowcasterBehavior=this.jumpthruBehavior=this.solidBehavior=null;this.deathRow={};this.isInClearDeathRow=this.hasPendingInstances=!1;this.isInOnDestroy=0;this.isEndingLayout=this.isRunningEvents=!1;this.createRow=[];this.isLoadingState=!1;this.loadFromSlot=this.saveToSlot="";this.loadFromJson=null;this.lastSaveJson="";this.suspendDrawing=this.signalledContinuousPreview=!1;this.fireOnCreateAfterLoad=
[];this.dt1=this.dt=0;this.minimumFramerate=30;this.cpuutilisation=this.logictime=0;this.timescale=1;this.kahanTime=new cr.KahanAdder;this.wallTime=new cr.KahanAdder;this.gpuTimeEndFrame=this.gpuTimeStartFrame=this.objectcount=this.framecount=this.execcount=this.tickcount_nosave=this.tickcount=this.last_fps_time=this.fps=this.last_tick_time=0;this.gpuCurUtilisation=-1;this.gpuLastUtilisation=0;this.changelayout=null;this.destroycallbacks=[];this.event_stack=[];this.event_stack_index=-1;this.localvar_stack=
[[]];this.trigger_depth=this.localvar_stack_index=0;this.pushEventStack(null);this.loop_stack=[];this.loop_stack_index=-1;this.next_puid=this.next_uid=0;this.layout_first_tick=!0;this.family_count=0;this.suspend_events=[];this.timeout_id=this.raf_id=-1;this.isloading=!0;this.stackLocalCount=this.loadingprogress=0;this.audioInstance=null;this.isInUserInputEvent=this.had_a_click=!1;this.objects_to_pretick=new cr.ObjectSet;this.objects_to_tick=new cr.ObjectSet;this.objects_to_tick2=new cr.ObjectSet;
this.registered_collisions=[];this.temp_poly=new cr.CollisionPoly([]);this.temp_poly2=new cr.CollisionPoly([]);this.allGroups=[];this.groups_by_name={};this.cndsBySid={};this.actsBySid={};this.varsBySid={};this.blocksBySid={};this.layout_ctx=this.layout_canvas=this.layout_tex=this.layer_tex=this.layer_ctx=this.layer_canvas=this.running_layout=null;this.uses_background_blending=this.is_WebGL_context_lost=!1;this.fx_tex=[null,null];this.fullscreen_scaling=0;this.files_subfolder="";this.objectsByUid=
{};this.webFontNames=this.loaderlogos=null;this.enhancedAccelerationPrecision=!0;this.snapshotCanvas=null;this.snapshotData="";this.objectRefTable=[];"html5"===this.exportType&&"file"===location.protocol.substr(0,4)&&alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)");this.useFbInstant?(FBInstant.initializeAsync().then(function(){G.requestProjectData()}).catch(function(z){console.warn("[Instant Games] Unable to load: ",
z);G.requestProjectData()}),window.setTimeout(function(){G.hasInitialized||(console.warn("[Instant Games] Initialization timed out after 4 seconds. Continuing with Instant Games disabled."),G.useFbInstant=!1,G.requestProjectData())},4E3)):this.requestProjectData()}}function l(){var g=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;"object"!==typeof g&&Promise.reject("Permission API is not loaded");return Promise.resolve(g)}function q(g){return l().then(function(p){return new Promise(function(C,
G){p.requestPermission(p[g],function(z){C(z.hasPermission)},G)})})}function A(g){return l().then(function(p){return new Promise(function(C,G){p.checkPermission(p[g],function(z){C(z.hasPermission)},G)})})}function M(){try{return!!window.indexedDB}catch(g){return!1}}function x(g){g.target.result.createObjectStore("saves",{keyPath:"slot"})}function m(g,p,C,G){try{var z=indexedDB.open("_C2SaveStates");z.onupgradeneeded=x;z.onerror=G;z.onsuccess=function(J){J=J.target.result;J.onerror=G;J.transaction(["saves"],
"readwrite").objectStore("saves").put({slot:g,data:p}).onsuccess=C}}catch(J){G(J)}}function a(g,p,C){try{var G=indexedDB.open("_C2SaveStates");G.onupgradeneeded=x;G.onerror=C;G.onsuccess=function(z){z=z.target.result;z.onerror=C;var J=z.transaction(["saves"]).objectStore("saves").get(g);J.onsuccess=function(Q){J.result?p(J.result.data):p(null)}}}catch(z){C(z)}}function c(){cr.logexport("Reloading for continuous preview");-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location+=
"?continuous"}function f(g){var p,C={};for(p in g)!g.hasOwnProperty(p)||g[p]instanceof cr.ObjectSet||g[p]&&"undefined"!==typeof g[p].c2userdata||"spriteCreatedDestroyCallback"!==p&&(C[p]=g[p]);return C}var n=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,v=new Audio,y={"audio/webm; codecs=opus":!!v.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!v.canPlayType("audio/ogg; codecs=opus"),
"audio/webm; codecs=vorbis":!!v.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!v.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!v.canPlayType("audio/mp4"),"audio/mpeg":!!v.canPlayType("audio/mpeg")};v=null;b.prototype.requestProjectData=function(){if(!this.hasInitialized){this.hasInitialized=!0;var g=this;if(this.isWKWebView)this.fetchLocalFileViaCordovaAsText("data.js",function(z){g.loadProject(JSON.parse(z))},function(z){alert("Error fetching data.js")});else{var p=
this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var C=this.projectDataUrl||"data.js";if(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)C="data.json";p.open("GET",C,!0);var G=!1;if("response"in p&&"responseType"in p)try{p.responseType="json",G="json"===p.responseType}catch(z){G=!1}if(!G&&"responseType"in p)try{p.responseType="text"}catch(z){}if("overrideMimeType"in p)try{p.overrideMimeType("application/json; charset=utf-8")}catch(z){}this.isWindowsPhone8?
p.onreadystatechange=function(){4===p.readyState&&g.loadProject(JSON.parse(p.responseText))}:(p.onload=function(){G?g.loadProject(p.response):g.loadProject(JSON.parse(p.responseText))},p.onerror=function(z){cr.logerror("Error requesting "+C+":");cr.logerror(z)});p.send()}}};b.prototype.initRendererAndLoader=function(){var g=this,p,C;this.isRetina=this.useHighDpi&&!this.isAndroidStockBrowser;0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1);var G=window.devicePixelRatio||window.webkitDevicePixelRatio||
window.mozDevicePixelRatio||window.msDevicePixelRatio||1;this.devicePixelRatio=this.isRetina?G:1;"object"===typeof window.StatusBar&&window.StatusBar.hide();"object"===typeof window.AndroidFullScreen&&window.AndroidFullScreen.immersiveMode();this.ClearDeathRow();0<this.fullscreen_mode&&this.setSize(window.innerWidth,window.innerHeight,!0);try{if(this.enableWebGL){var z={alpha:!0,depth:!1,antialias:!1,failIfMajorPerformanceCaveat:!0};this.isAndroid||(this.gl=this.canvas.getContext("webgl2",z));this.gl||
(this.gl=this.canvas.getContext("webgl",z)||this.canvas.getContext("experimental-webgl",z))}}catch(ba){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");if(G=this.gl.getExtension("WEBGL_debug_renderer_info"))z=this.gl.getParameter(G.UNMASKED_VENDOR_WEBGL),this.glUnmaskedRenderer=this.gl.getParameter(G.UNMASKED_RENDERER_WEBGL)+" ["+z+"]";this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]");this.overlay_canvas=document.createElement("canvas");this.canvas.parentNode.appendChild(this.overlay_canvas);
this.overlay_canvas.oncontextmenu=function(ba){return!1};this.overlay_canvas.onselectstart=function(ba){return!1};this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio);this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio);this.overlay_canvas.style.width=this.cssWidth+"px";this.overlay_canvas.style.height=this.cssHeight+"px";this.overlay_canvas.style.position="absolute";this.overlay_ctx=this.overlay_canvas.getContext("2d");this.glwrap=new cr.GLWrap(this.gl,
this.isMobile,this.enableFrontToBack);this.glwrap.setSize(this.canvas.width,this.canvas.height);this.glwrap.enable_mipmaps=0!==this.downscalingQuality;this.ctx=null;this.canvas.addEventListener("webglcontextlost",function(ba){ba.preventDefault();g.onContextLost();cr.logexport("[Construct 2] WebGL context lost");window.cr_setSuspended(!0)},!1);this.canvas.addEventListener("webglcontextrestored",function(ba){g.glwrap.initState();g.glwrap.setSize(g.glwrap.width,g.glwrap.height,!0);g.layer_tex=null;g.layout_tex=
null;g.fx_tex[0]=null;g.fx_tex[1]=null;g.onContextRestored();g.redraw=!0;cr.logexport("[Construct 2] WebGL context restored");window.cr_setSuspended(!1)},!1);this.glwrap.supportsGpuProfiling()||(this.gpuLastUtilisation=NaN);G=0;for(z=this.types_by_index.length;G<z;G++){var J=this.types_by_index[G];var Q=0;for(p=J.effect_types.length;Q<p;Q++){var R=J.effect_types[Q];R.shaderindex=this.glwrap.getShaderIndex(R.id);R.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(R.shaderindex);this.uses_background_blending=
this.uses_background_blending||this.glwrap.programUsesDest(R.shaderindex)}}G=0;for(z=this.layouts_by_index.length;G<z;G++){var T=this.layouts_by_index[G];Q=0;for(p=T.effect_types.length;Q<p;Q++)R=T.effect_types[Q],R.shaderindex=this.glwrap.getShaderIndex(R.id),R.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(R.shaderindex);T.updateActiveEffects();Q=0;for(p=T.layers.length;Q<p;Q++){var fa=T.layers[Q];J=0;for(C=fa.effect_types.length;J<C;J++)R=fa.effect_types[J],R.shaderindex=this.glwrap.getShaderIndex(R.id),
R.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(R.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(R.shaderindex);fa.updateActiveEffects()}}}else z={alpha:!0},this.ctx=this.canvas.getContext("2d",z),this.ctx.imageSmoothingEnabled=this.linearSampling,this.overlay_ctx=this.overlay_canvas=null,this.gpuLastUtilisation=NaN,this.fullscreenScalingQuality=this.wantFullscreenScalingQuality=!0;this.tickFunc=function(ba){g.tick(!1,ba)};window==
window.top||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0));this.isPreview&&(-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(window.addEventListener("focus",function(){g.setSuspended(!1)}),window.addEventListener("blur",
function(){var ba=window.parent;ba&&ba.document.hasFocus()||g.setSuspended(!0)})));window.addEventListener("blur",function(){g.onWindowBlur()});G=function(ba){"mousedown"===ba.type&&1===ba.button&&ba.preventDefault();if(cr.isCanvasInputEvent(ba)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(Z){}};"undefined"!==typeof PointerEvent?document.addEventListener("pointerdown",G):window.navigator.msPointerEnabled?
document.addEventListener("MSPointerDown",G):document.addEventListener("touchstart",G);document.addEventListener("mousedown",G);0===this.fullscreen_mode&&this.isRetina&&1<this.devicePixelRatio?this.setSize(this.original_width,this.original_height,!0):this.setSize(window.innerWidth,window.innerHeight,!0);this.tryLockOrientation();this.getready();this.go();this.extra={};cr.seal(this)};b.prototype.setSize=function(g,p,C){var G=0,z=0;if(this.lastWindowWidth!==g||this.lastWindowHeight!==p||C){if(this.isiPhone&&
this.isCordova&&window.screen){var J=document.documentElement.style;var Q=document.body.style;var R=window.innerWidth<window.innerHeight;var T=R?window.screen.height:window.screen.width;R=R?window.screen.width:window.screen.height;T&&R&&(Q.height=J.height=T+"px",Q.width=J.width=R+"px")}this.lastWindowWidth=g;this.lastWindowHeight=p;J=this.fullscreen_mode;if((Q=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen)&&!this.isCordova)||0!==this.fullscreen_mode||
C)Q&&(J=this.fullscreen_scaling),C=this.devicePixelRatio,4<=J?(5===J&&1!==C&&(g+=1,p+=1),Q=this.original_width/this.original_height,g/p>Q?(Q*=p,5===J?(G=Q*C/this.original_width,1<G?G=Math.floor(G):1>G&&(G=1/Math.ceil(1/G)),Q=this.original_width*G/C,T=this.original_height*G/C,G=(g-Q)/2,z=(p-T)/2,g=Q,p=T):(G=(g-Q)/2,g=Q)):(T=g/Q,5===J?(G=T*C/this.original_height,1<G?G=Math.floor(G):1>G&&(G=1/Math.ceil(1/G)),Q=this.original_width*G/C,T=this.original_height*G/C,G=(g-Q)/2,z=(p-T)/2,g=Q):z=(p-T)/2,p=T)):
Q&&0===J&&(G=Math.floor((g-this.original_width)/2),z=Math.floor((p-this.original_height)/2),g=this.original_width,p=this.original_height),2>J&&(this.aspect_scale=C),this.cssWidth=Math.round(g),this.cssHeight=Math.round(p),this.width=Math.round(g*C),this.height=Math.round(p*C),this.redraw=!0,this.wantFullscreenScalingQuality?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):this.width<this.original_width&&this.height<this.original_height||1===J?(this.draw_width=
this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===J?(Q=this.original_width/this.original_height,J=this.lastWindowWidth/this.lastWindowHeight,J<Q?this.draw_width=this.draw_height*J:J>Q&&(this.draw_height=this.draw_width/J)):3===J&&(Q=this.original_width/this.original_height,J=this.lastWindowWidth/this.lastWindowHeight,J>Q?this.draw_width=this.draw_height*J:J<Q&&(this.draw_height=
this.draw_width/J))),this.canvas&&(this.canvas.width=Math.round(g*C),this.canvas.height=Math.round(p*C),this.isRetina&&(this.canvas.style.width=Math.round(g)+"px",this.canvas.style.height=Math.round(p)+"px"),this.canvas.style.marginLeft=Math.floor(G)+"px",this.canvas.style.marginTop=Math.floor(z)+"px"),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(g*C),this.overlay_canvas.height=Math.round(p*C),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+
"px",this.overlay_canvas.style.left=Math.floor(G)+"px",this.overlay_canvas.style.top=Math.floor(z)+"px"),this.glwrap&&this.glwrap.setSize(Math.round(g*C),Math.round(p*C)),this.ctx&&(this.ctx.imageSmoothingEnabled=this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}};b.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var g="portrait";2===this.orientations&&(g="landscape");try{screen.orientation&&screen.orientation.lock?
screen.orientation.lock(g).catch(function(){}):screen.lockOrientation?screen.lockOrientation(g):screen.webkitLockOrientation?screen.webkitLockOrientation(g):screen.mozLockOrientation?screen.mozLockOrientation(g):screen.msLockOrientation&&screen.msLockOrientation(g)}catch(p){console&&console.warn&&console.warn("Failed to lock orientation: ",p)}}};b.prototype.onContextLost=function(){this.glwrap.contextLost();this.is_WebGL_context_lost=!0;var g;var p=0;for(g=this.types_by_index.length;p<g;p++){var C=
this.types_by_index[p];if(C.onLostWebGLContext)C.onLostWebGLContext()}};b.prototype.onContextRestored=function(){this.is_WebGL_context_lost=!1;var g;var p=0;for(g=this.types_by_index.length;p<g;p++){var C=this.types_by_index[p];if(C.onRestoreWebGLContext)C.onRestoreWebGLContext()}};var K=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;b.prototype.setSuspended=function(g){var p;if(g&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),
this.isSuspended=!0,-1!==this.raf_id&&K(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),g=0,p=this.suspend_events.length;g<p;g++)this.suspend_events[g](!0);else if(!g&&this.isSuspended){cr.logexport("[Construct 2] Resuming");this.isSuspended=!1;this.last_tick_time=cr.performance_now();this.last_fps_time=cr.performance_now();g=this.logictime=this.framecount=0;for(p=this.suspend_events.length;g<p;g++)this.suspend_events[g](!1);this.tick(!1)}};b.prototype.addSuspendCallback=function(g){this.suspend_events.push(g)};
b.prototype.GetObjectReference=function(g){return this.objectRefTable[g]};b.prototype.loadProject=function(g){g&&g.project||cr.logerror("Project model unavailable");g=g.project;this.name=g[0];this.first_layout=g[1];this.fullscreen_mode=g[12];this.fullscreen_mode_set=g[12];this.original_width=g[10];this.original_height=g[11];this.parallax_x_origin=this.original_width/2;this.parallax_y_origin=this.original_height/2;this.uses_loader_layout=g[18];this.loaderstyle=g[19];this.iconsFolder=g[28];this.webFontNames=
g[29].map(function(ka){return ka[0]});if(0===this.loaderstyle){var p=new Image;p.crossOrigin="anonymous";var C=this.loaderlogos={logo:p};p.addEventListener("error",function(){C.logo=null});var G=g[39];G=this.isPreview?this.getProjectFileUrl(G):this.iconsFolder+G;this.setImageSrc(p,G)}else if(4===this.loaderstyle){p=new Image;p.src="splash-images/splash-logo.svg";G=new Image;G.src="splash-images/splash-poweredby-512.png";var z=new Image;z.src="splash-images/splash-poweredby-256.png";var J=new Image;
J.src="splash-images/splash-poweredby-128.png";var Q=new Image;Q.src="splash-images/splash-website-512.png";var R=new Image;R.src="splash-images/splash-website-256.png";var T=new Image;T.src="splash-images/splash-website-128.png";this.loaderlogos={logo:p,powered:[G,z,J],website:[Q,R,T]}}this.next_uid=g[21];this.objectRefTable=cr.getObjectRefTable();this.system=new cr.system_object(this);p=0;for(G=g[2].length;p<G;p++){T=g[2][p];z=this.GetObjectReference(T[0]);cr.add_common_aces(T,z.prototype);var fa=
new z(this);fa.singleglobal=T[1];fa.is_world=T[2];fa.is_rotatable=T[5];fa.must_predraw=T[9];if(fa.onCreate)fa.onCreate();cr.seal(fa);this.plugins.push(fa)}this.objectRefTable=cr.getObjectRefTable();p=0;for(G=g[3].length;p<G;p++){T=g[3][p];Q=this.GetObjectReference(T[1]);fa=null;z=0;for(J=this.plugins.length;z<J;z++)if(this.plugins[z]instanceof Q){fa=this.plugins[z];break}var ba=new fa.Type(fa);ba.name=T[0];ba.is_family=T[2];ba.instvar_sids=T[3].slice(0);ba.vars_count=T[3].length;ba.behs_count=T[4];
ba.fx_count=T[5];ba.sid=T[11];ba.is_family?(ba.members=[],ba.family_index=this.family_count++,ba.families=null):(ba.members=null,ba.family_index=-1,ba.families=[]);ba.family_var_map=null;ba.family_beh_map=null;ba.family_fx_map=null;ba.is_contained=!1;ba.container=null;T[6]?(ba.texture_file=T[6][0],ba.texture_filesize=T[6][1],ba.texture_pixelformat=T[6][2],ba.texture_data=T[6]):(ba.texture_file=null,ba.texture_filesize=0,ba.texture_pixelformat=0,ba.texture_data=null);ba.animations=T[7]?T[7]:null;ba.index=
p;ba.instances=[];ba.deadCache=[];ba.solstack=[new cr.selection(ba)];ba.cur_sol=0;ba.default_instance=null;ba.default_layerindex=0;ba.stale_iids=!0;ba.updateIIDs=cr.type_updateIIDs;ba.getFirstPicked=cr.type_getFirstPicked;ba.getPairedInstance=cr.type_getPairedInstance;ba.getCurrentSol=cr.type_getCurrentSol;ba.pushCleanSol=cr.type_pushCleanSol;ba.pushCopySol=cr.type_pushCopySol;ba.popSol=cr.type_popSol;ba.getBehaviorByName=cr.type_getBehaviorByName;ba.getBehaviorIndexByName=cr.type_getBehaviorIndexByName;
ba.getEffectIndexByName=cr.type_getEffectIndexByName;ba.applySolToContainer=cr.type_applySolToContainer;ba.getInstanceByIID=cr.type_getInstanceByIID;ba.collision_grid=new cr.SparseGrid(this.original_width,this.original_height);ba.any_cell_changed=!0;ba.any_instance_parallaxed=!1;ba.extra={};ba.toString=cr.type_toString;ba.behaviors=[];z=0;for(J=T[8].length;z<J;z++){var Z=T[8][z];var da=this.GetObjectReference(Z[1]),ia=null;Q=0;for(R=this.behaviors.length;Q<R;Q++)if(this.behaviors[Q]instanceof da){ia=
this.behaviors[Q];break}if(!ia){ia=new da(this);ia.my_types=[];ia.my_instances=new cr.ObjectSet;if(ia.onCreate)ia.onCreate();cr.seal(ia);this.behaviors.push(ia);cr.behaviors.solid&&ia instanceof cr.behaviors.solid&&(this.solidBehavior=ia);cr.behaviors.jumpthru&&ia instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=ia);cr.behaviors.shadowcaster&&ia instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=ia)}-1===ia.my_types.indexOf(ba)&&ia.my_types.push(ba);Q=new ia.Type(ia,ba);Q.name=
Z[0];Q.sid=Z[2];Q.onCreate();cr.seal(Q);ba.behaviors.push(Q)}ba.global=T[9];ba.isOnLoaderLayout=T[10];ba.effect_types=[];z=0;for(J=T[12].length;z<J;z++)ba.effect_types.push({id:T[12][z][0],name:T[12][z][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:z});ba.tile_poly_data=T[13];if(!this.uses_loader_layout||ba.is_family||ba.isOnLoaderLayout||!fa.is_world)ba.onCreate(),cr.seal(ba);ba.name&&(this.types[ba.name]=ba,this.types_lowercase[ba.name.toLowerCase()]=ba);this.types_by_index.push(ba);
fa.singleglobal&&(z=new fa.Instance(ba),z.uid=this.next_uid++,z.puid=this.next_puid++,z.iid=0,z.get_iid=cr.inst_get_iid,z.toString=cr.inst_toString,z.properties=T[16],z.onCreate(),cr.seal(z),ba.instances.push(z),this.objectsByUid[z.uid.toString()]=z)}p=0;for(G=g[4].length;p<G;p++)for(Q=g[4][p],R=this.types_by_index[Q[0]],z=1,J=Q.length;z<J;z++)T=this.types_by_index[Q[z]],T.families.push(R),R.members.push(T);p=0;for(G=g[27].length;p<G;p++){Q=g[27][p];R=[];z=0;for(J=Q.length;z<J;z++)R.push(this.types_by_index[Q[z]]);
z=0;for(J=R.length;z<J;z++)R[z].is_contained=!0,R[z].container=R}if(0<this.family_count)for(p=0,G=this.types_by_index.length;p<G;p++)if(T=this.types_by_index[p],!T.is_family&&T.families.length){T.family_var_map=Array(this.family_count);T.family_beh_map=Array(this.family_count);T.family_fx_map=Array(this.family_count);ba=[];z=ia=da=Z=0;for(J=T.families.length;z<J;z++)for(fa=T.families[z],T.family_var_map[fa.family_index]=Z,Z+=fa.vars_count,T.family_beh_map[fa.family_index]=da,da+=fa.behs_count,T.family_fx_map[fa.family_index]=
ia,ia+=fa.fx_count,Q=0,R=fa.effect_types.length;Q<R;Q++)ba.push(cr.shallowCopy({},fa.effect_types[Q]));T.effect_types=ba.concat(T.effect_types);z=0;for(J=T.effect_types.length;z<J;z++)T.effect_types[z].index=z}p=0;for(G=g[5].length;p<G;p++)T=g[5][p],z=new cr.layout(this,T),cr.seal(z),this.layouts[z.name]=z,this.layouts_by_index.push(z);p=0;for(G=g[6].length;p<G;p++)T=g[6][p],z=new cr.eventsheet(this,T),cr.seal(z),this.eventsheets[z.name]=z,this.eventsheets_by_index.push(z);p=0;for(G=this.eventsheets_by_index.length;p<
G;p++)this.eventsheets_by_index[p].postInit();p=0;for(G=this.eventsheets_by_index.length;p<G;p++)this.eventsheets_by_index[p].updateDeepIncludes();p=0;for(G=this.triggers_to_postinit.length;p<G;p++)this.triggers_to_postinit[p].postInit();cr.clearArray(this.triggers_to_postinit);this.audio_files_info=g[7];this.audio_files_map={};p=0;for(G=this.audio_files_info.length;p<G;++p)z=this.audio_files_info[p],this.audio_files_map[z[0]]=z[1];this.files_subfolder=g[8];this.pixel_rounding=g[9];this.aspect_scale=
1;this.enableWebGL=g[13];this.linearSampling=g[14];this.clearBackground=g[15];this.versionstr=g[16];this.useHighDpi=g[17];this.orientations=g[20];this.autoLockOrientation=0<this.orientations;this.pauseOnBlur=g[22];this.fullscreenScalingQuality=this.wantFullscreenScalingQuality=g[23];this.downscalingQuality=g[24];this.preloadSounds=g[25];this.enableFrontToBack=g[26]&&!this.isIE;this.enhancedAccelerationPrecision=g[30];this.start_time=Date.now();cr.clearArray(this.objectRefTable);this.preloadSounds||
y["audio/webm; codecs=opus"]||!window.OpusDecoder||window.OpusDecoder.Initialise();this.initRendererAndLoader()};var u=!1;b.prototype.waitForImageLoad=function(g,p){window.cr_remotePreviewImageFiles&&p&&"blob:"!==p.substr(0,5)&&(p=window.cr_remotePreviewImageFiles[p]);g.onerror=function(C){u=g.c2error=!0;console&&console.error&&console.error("Error loading image '"+g.src+"': ",C)};g.src||("undefined"!==typeof XAPKReader?XAPKReader.get(p,function(C){g.src=C},function(C){u=g.c2error=!0;console&&console.error&&
console.error("Error extracting image '"+p+"' from expansion file: ",C)}):(g.crossOrigin="anonymous",this.setImageSrc(g,p)));this.wait_for_textures.push(g)};b.prototype.findWaitingTexture=function(g){var p;var C=0;for(p=this.wait_for_textures.length;C<p;C++)if(this.wait_for_textures[C].cr_src===g)return this.wait_for_textures[C];return null};var F=0,D=!1;b.prototype.getready=function(){if(this.audioInstance&&this.preloadSounds){var g=[],p;var C=0;for(p=this.audio_files_info.length;C<p;++C){var G=
this.audio_files_info[C];var z=G[0];var J=G[2];(G=this.getPreferredAudioFile(z))&&!J&&g.push({filename:z+G[1],size:G[2],type:G[0]})}F=this.audioInstance.setPreloadList(g)}};b.prototype.areAllTexturesAndSoundsLoaded=function(){var g=F,p=0,C=!0,G;var z=0;for(G=this.wait_for_textures.length;z<G;z++){var J=this.wait_for_textures[z];var Q=J.cr_filesize;if(!Q||0>=Q)Q=5E4;g+=Q;J.src&&J.complete&&!J.c2error?p+=Q:C=!1}C&&this.preloadSounds&&this.audioInstance&&(D||(this.audioInstance.startPreloads(),D=!0),
z=this.audioInstance.getPreloadedSize(),p+=z,z<F&&(C=!1));this.progress=0==g?1:p/g;return C};var h=!1;b.prototype.go=function(){if(this.ctx||this.glwrap){var g=this.ctx||this.overlay_ctx;if(0<this.fullscreen_mode){var p=window.innerWidth,C=window.innerHeight;this.lastWindowWidth===p&&this.lastWindowHeight===C||this.setSize(p,C)}this.progress=0;this.last_progress=-1;var G=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||h))this.useFbInstant?FBInstant.startGameAsync().then(function(){G.go_loading_finished()}):
this.go_loading_finished();else{this.useFbInstant&&FBInstant.setLoadingProgress(100*this.progress);C=Date.now()-this.start_time;if(g){var z=this.width,J=this.height;p=this.devicePixelRatio;if(3>this.loaderstyle&&500<=C&&this.last_progress!=this.progress){g.clearRect(0,0,z,J);C=z/2;J/=2;z=0===this.loaderstyle&&this.loaderlogos.logo&&this.loaderlogos.logo.complete;var Q=40*p,R=0,T=80*p;if(z){var fa=this.loaderlogos.logo;T=fa.width*p;var ba=fa.height*p;Q=T/2;R=ba/2;g.drawImage(fa,cr.floor(C-Q),cr.floor(J-
R),T,ba)}1>=this.loaderstyle?(J+=R+(z?12*p:0),C=cr.floor(C-Q)+.5,J=cr.floor(J)+.5,g.fillStyle=u?"red":"DodgerBlue",g.fillRect(C,J,Math.floor(T*this.progress),6*p),g.strokeStyle="black",g.strokeRect(C,J,T,6*p),g.strokeStyle="white",g.strokeRect(C-1*p,J-1*p,T+2*p,8*p)):2===this.loaderstyle&&(g.font="12pt Arial",g.fillStyle=u?"#f00":"#999",g.textBaseLine="middle",p=Math.round(100*this.progress)+"%",z=g.measureText?g.measureText(p):null,g.fillText(p,C-(z?z.width:0)/2,J));this.last_progress=this.progress}else if(4===
this.loaderstyle){this.draw_c3_splash_loader(g);n?n(function(){G.go()}):setTimeout(function(){G.go()},16);return}}setTimeout(function(){G.go()},100)}}};var t=-1,B=!0,S=!1,V=0,L=0,d=null,k=null,E=0;b.prototype.draw_c3_splash_loader=function(g){if(!h){var p=this.isPreview||this.useFbInstant,C=p?0:200,G=p?0:3E3,z=Math.ceil(this.width),J=Math.ceil(this.height),Q=this.loaderlogos.logo,R=this.loaderlogos.powered,T=this.loaderlogos.website;if(Q.complete){for(var fa=0;3>fa;++fa)if(!R[fa].complete||!T[fa].complete)return;
0===E&&(t=Date.now());fa=Date.now();var ba=!1,Z=g;B||S?(g.clearRect(0,0,z,J),d&&d.width===z&&d.height===J||(d=document.createElement("canvas"),d.width=z,d.height=J,k=d.getContext("2d")),Z=k,ba=!0,B&&1===E&&(t=Date.now())):g.globalAlpha=1;Z.fillStyle="#3B4045";Z.fillRect(0,0,z,J);try{if(256<this.cssHeight){var da=1.5*cr.clamp(.22*J,105,.6*z);var ia=da/8;Z.drawImage(128>=da?R[2]:256>=da?R[1]:R[0],.5*z-da/2,.2*J-ia/2,da,ia);ia=da=Math.min(.395*J,.95*z);Z.drawImage(Q,.5*z-da/2,.485*J-ia/2,da,ia);da=1.5*
cr.clamp(.22*J,105,.6*z);ia=da/8;Z.drawImage(128>=da?T[2]:256>=da?T[1]:T[0],.5*z-da/2,.868*J-ia/2,da,ia);Z.fillStyle="#4D565D";da=z;ia=Math.max(.005*J,2);Z.fillRect(0,.8*J-ia/2,da,ia);Z.fillStyle=u?"red":"#29F3D0";da=z*this.progress;Z.fillRect(.5*z-da/2,.8*J-ia/2,da,ia)}else ia=da=.55*J,Z.drawImage(Q,.5*z-da/2,.45*J-ia/2,da,ia),Z.fillStyle="#4D565D",da=z,ia=Math.max(.005*J,2),Z.fillRect(0,.85*J-ia/2,da,ia),Z.fillStyle=u?"red":"#29F3D0",da=z*this.progress,Z.fillRect(.5*z-da/2,.85*J-ia/2,da,ia);ba&&
(B?g.globalAlpha=0===E?0:Math.min((fa-t)/300,1):S&&(g.globalAlpha=Math.max(1-(fa-L)/300,0)),g.drawImage(d,0,0,z,J))}catch(ka){}B&&300<=fa-t&&2<=E&&(B=!1,V=fa);!B&&fa-V>=G&&!S&&1<=this.progress&&(S=!0,L=fa);if(S&&fa-L>=300+C||p&&1<=this.progress&&500>Date.now()-t)h=!0,S=B=!1,this.loaderlogos=k=d=null;++E}}};b.prototype.go_loading_finished=function(){if(this.webFontNames.length&&document.fonts&&document.fonts.load){var g=this;Promise.all(this.webFontNames.map(function(p){return document.fonts.load("1em '"+
p+"'")})).then(function(){g.start_first_layout()})}else this.start_first_layout()};b.prototype.start_first_layout=function(){this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_canvas=this.overlay_ctx=null);this.start_time=Date.now();this.last_fps_time=cr.performance_now();var g;if(this.uses_loader_layout){var p=0;for(g=this.types_by_index.length;p<g;p++){var C=this.types_by_index[p];C.is_family||C.isOnLoaderLayout||!C.plugin.is_world||(C.onCreate(),cr.seal(C))}}else this.isloading=
!1;p=0;for(g=this.layouts_by_index.length;p<g;p++)this.layouts_by_index[p].createGlobalNonWorlds();2<=this.fullscreen_mode&&(p=this.original_width/this.original_height,g=this.width/this.height,this.aspect_scale=2!==this.fullscreen_mode&&g>p||2===this.fullscreen_mode&&g<p?this.height/this.original_height:this.width/this.original_width);p=0;for(g=this.types_by_index.length;p<g;p++)if(C=this.types_by_index[p],C.onBeforeAppBegin)C.onBeforeAppBegin();this.first_layout?this.layouts[this.first_layout].startRunning():
this.layouts_by_index[0].startRunning();this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&window.C3_RegisterSW());navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide();p=0;for(g=this.types_by_index.length;p<g;p++)if(C=this.types_by_index[p],C.onAppBegin)C.onAppBegin();p=function(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):
window.cr_setSuspended(!1)};document.addEventListener("visibilitychange",p,!1);document.addEventListener("mozvisibilitychange",p,!1);document.addEventListener("webkitvisibilitychange",p,!1);document.addEventListener("msvisibilitychange",p,!1);this.isCordova&&(document.addEventListener("pause",function(){window.cr_setSuspended(!0)}),document.addEventListener("resume",function(){window.cr_setSuspended(!1)}));document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):
this.tick(!1)};b.prototype.tick=function(g,p,C){if(this.running_layout){var G=cr.performance_now();if(C||!this.isSuspended||g){g||(n?this.raf_id=n(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16));p=p||G;var z=this.fullscreen_mode;(C=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova)&&0<this.fullscreen_scaling&&(z=this.fullscreen_scaling);if(0<z){z=window.innerWidth;var J=window.innerHeight;this.lastWindowWidth===
z&&this.lastWindowHeight===J||this.setSize(z,J)}C?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height);this.isloading&&(C=this.areAllTexturesAndSoundsLoaded(),this.loadingprogress=this.progress,C&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,
null),window.C3_RegisterSW&&window.C3_RegisterSW()));this.logic(p);!this.redraw||this.is_WebGL_context_lost||this.suspendDrawing||g||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null));this.hit_breakpoint||
(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++);this.logictime+=cr.performance_now()-G}}};b.prototype.logic=function(g){var p;1E3<=g-this.last_fps_time&&(this.last_fps_time+=1E3,1E3<=g-this.last_fps_time&&(this.last_fps_time=g),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=Math.min(this.logictime,1E3),this.logictime=0,this.glwrap&&0===this.gpuTimeEndFrame&&(this.gpuTimeEndFrame=this.glwrap.getFrameNumber(),this.gpuCurUtilisation=-1));this.glwrap&&-1===
this.gpuCurUtilisation&&this.glwrap.supportsGpuProfiling()&&(this.gpuCurUtilisation=this.glwrap.getFrameRangeTimerResults(this.gpuTimeStartFrame,this.gpuTimeEndFrame),-1!==this.gpuCurUtilisation&&(this.glwrap.deleteTimerResultsToFrame(this.gpuTimeEndFrame),this.gpuLastUtilisation=Math.min(this.gpuCurUtilisation,1),this.gpuTimeStartFrame=this.gpuTimeEndFrame,this.gpuTimeEndFrame=0));if(0!==this.last_tick_time){var C=g-this.last_tick_time;0>C&&(C=0);this.dt1=C/1E3;.5<this.dt1?this.dt1=0:this.dt1>1/
this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=g;this.dt=this.dt1*this.timescale;this.kahanTime.add(this.dt);this.wallTime.add(this.dt1);g=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if(2<=this.fullscreen_mode||g&&0<this.fullscreen_scaling){C=this.original_width/this.original_height;var G=this.width/this.height;var z=this.fullscreen_mode;g&&0<this.fullscreen_scaling&&(z=this.fullscreen_scaling);
this.aspect_scale=2!==z&&G>C||2===z&&G<C?this.height/this.original_height:this.width/this.original_width;this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow();this.isInOnDestroy++;this.system.runWaits();this.isInOnDestroy--;this.ClearDeathRow();this.isInOnDestroy++;G=this.objects_to_pretick.valuesRef();g=0;for(C=G.length;g<C;g++)G[g].pretick();
g=0;for(C=this.types_by_index.length;g<C;g++){var J=this.types_by_index[g];if(!J.is_family&&(J.behaviors.length||J.families.length))for(G=0,z=J.instances.length;G<z;G++){var Q=J.instances[G];var R=0;for(p=Q.behavior_insts.length;R<p;R++)Q.behavior_insts[R].tick()}}g=0;for(C=this.types_by_index.length;g<C;g++)if(J=this.types_by_index[g],!J.is_family&&(J.behaviors.length||J.families.length))for(G=0,z=J.instances.length;G<z;G++)for(Q=J.instances[G],R=0,p=Q.behavior_insts.length;R<p;R++){var T=Q.behavior_insts[R];
T.posttick&&T.posttick()}G=this.objects_to_tick.valuesRef();g=0;for(C=G.length;g<C;g++)G[g].tick();this.isInOnDestroy--;this.handleSaveLoad();for(g=0;this.changelayout&&10>g++;)this.doChangeLayout(this.changelayout);g=0;for(C=this.eventsheets_by_index.length;g<C;g++)this.eventsheets_by_index[g].hasRun=!1;this.running_layout.event_sheet&&this.running_layout.event_sheet.run();cr.clearArray(this.registered_collisions);this.layout_first_tick=!1;this.isInOnDestroy++;g=0;for(C=this.types_by_index.length;g<
C;g++)if(J=this.types_by_index[g],!J.is_family&&(J.behaviors.length||J.families.length))for(G=0,z=J.instances.length;G<z;G++)for(Q=J.instances[G],R=0,p=Q.behavior_insts.length;R<p;R++)T=Q.behavior_insts[R],T.tick2&&T.tick2();G=this.objects_to_tick2.valuesRef();g=0;for(C=G.length;g<C;g++)G[g].tick2();this.isInOnDestroy--};b.prototype.onWindowBlur=function(){var g,p,C;var G=0;for(g=this.types_by_index.length;G<g;G++){var z=this.types_by_index[G];if(!z.is_family){var J=0;for(p=z.instances.length;J<p;J++){var Q=
z.instances[J];if(Q.onWindowBlur)Q.onWindowBlur();if(Q.behavior_insts){var R=0;for(C=Q.behavior_insts.length;R<C;R++){var T=Q.behavior_insts[R];if(T.onWindowBlur)T.onWindowBlur()}}}}}};b.prototype.doChangeLayout=function(g){var p=this.running_layout;this.running_layout.stopRunning();var C;if(this.glwrap){var G=0;for(C=this.types_by_index.length;G<C;G++){var z=this.types_by_index[G];z.is_family||!z.unloadTextures||z.global&&0!==z.instances.length||-1!==g.initial_types.indexOf(z)||z.unloadTextures()}}p==
g&&cr.clearArray(this.system.waits);cr.clearArray(this.registered_collisions);this.runLayoutChangeMethods(!0);g.startRunning();this.runLayoutChangeMethods(!1);this.layout_first_tick=this.redraw=!0;this.ClearDeathRow()};b.prototype.runLayoutChangeMethods=function(g){var p,C,G;var z=0;for(p=this.behaviors.length;z<p;z++){var J=this.behaviors[z];if(g){if(J.onBeforeLayoutChange)J.onBeforeLayoutChange()}else if(J.onLayoutChange)J.onLayoutChange()}z=0;for(p=this.types_by_index.length;z<p;z++)if(J=this.types_by_index[z],
J.global||J.plugin.singleglobal){var Q=0;for(C=J.instances.length;Q<C;Q++){var R=J.instances[Q];if(g){if(R.onBeforeLayoutChange)R.onBeforeLayoutChange()}else if(R.onLayoutChange)R.onLayoutChange();if(R.behavior_insts){var T=0;for(G=R.behavior_insts.length;T<G;T++){var fa=R.behavior_insts[T];if(g){if(fa.onBeforeLayoutChange)fa.onBeforeLayoutChange()}else if(fa.onLayoutChange)fa.onLayoutChange()}}}}};b.prototype.pretickMe=function(g){this.objects_to_pretick.add(g)};b.prototype.unpretickMe=function(g){this.objects_to_pretick.remove(g)};
b.prototype.tickMe=function(g){this.objects_to_tick.add(g)};b.prototype.untickMe=function(g){this.objects_to_tick.remove(g)};b.prototype.tick2Me=function(g){this.objects_to_tick2.add(g)};b.prototype.untick2Me=function(g){this.objects_to_tick2.remove(g)};b.prototype.getDt=function(g){return g&&-1!==g.my_timescale?this.dt1*g.my_timescale:this.dt};b.prototype.draw=function(){this.running_layout.draw(this.ctx)};b.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap));
this.running_layout.drawGL(this.glwrap);this.glwrap.present()};b.prototype.addDestroyCallback=function(g){g&&this.destroycallbacks.push(g)};b.prototype.removeDestroyCallback=function(g){cr.arrayFindRemove(this.destroycallbacks,g)};b.prototype.getObjectByUID=function(g){g=g.toString();return this.objectsByUid.hasOwnProperty(g)?this.objectsByUid[g]:null};var e=[];b.prototype.DestroyInstance=function(g){var p;var C=g.type.name;if(this.deathRow.hasOwnProperty(C)){var G=this.deathRow[C];if(G.contains(g))return}else G=
e.length?e.pop():new cr.ObjectSet,this.deathRow[C]=G;g.isDestroyed=!0;G.add(g);this.hasPendingInstances=!0;if(g.is_contained)for(C=0,p=g.siblings.length;C<p;C++)this.DestroyInstance(g.siblings[C]);this.isInClearDeathRow&&G.values_cache.push(g);this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(g.type.plugin).cnds.OnDestroyed,g),this.isInOnDestroy--)};b.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var g,p;this.isInClearDeathRow=!0;var C=0;for(g=this.createRow.length;C<
g;++C){var G=this.createRow[C];var z=G.type;z.instances.push(G);var J=0;for(p=z.families.length;J<p;++J)z.families[J].instances.push(G),z.families[J].stale_iids=!0}cr.clearArray(this.createRow);this.IterateDeathRow();cr.wipe(this.deathRow);this.hasPendingInstances=this.isInClearDeathRow=!1}};b.prototype.IterateDeathRow=function(){for(var g in this.deathRow)this.deathRow.hasOwnProperty(g)&&this.ClearDeathRowForType(this.deathRow[g])};b.prototype.ClearDeathRowForType=function(g){var p=g.valuesRef(),
C=p[0].type,G,z;cr.arrayRemoveAllFromObjectSet(C.instances,g);C.stale_iids=!0;0===C.instances.length&&(C.any_instance_parallaxed=!1);var J=0;for(G=C.families.length;J<G;++J){var Q=C.families[J];cr.arrayRemoveAllFromObjectSet(Q.instances,g);Q.stale_iids=!0}J=0;for(G=this.system.waits.length;J<G;++J){var R=this.system.waits[J];R.sols.hasOwnProperty(C.index)&&cr.arrayRemoveAllFromObjectSet(R.sols[C.index].insts,g);if(!C.is_family){var T=0;for(z=C.families.length;T<z;++T)Q=C.families[T],R.sols.hasOwnProperty(Q.index)&&
cr.arrayRemoveAllFromObjectSet(R.sols[Q.index].insts,g)}}if(R=p[0].layer){if(R.useRenderCells)for(T=R.instances,J=0,G=T.length;J<G;++J)z=T[J],g.contains(z)&&(z.update_bbox(),R.render_grid.update(z,z.rendercells,null),z.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(R.instances,g);R.setZIndicesStaleFrom(0)}for(J=0;J<p.length;++J)this.ClearDeathRowForSingleInstance(p[J],C);g.clear();e.push(g);this.redraw=!0};b.prototype.ClearDeathRowForSingleInstance=function(g,p){var C;var G=0;for(C=this.destroycallbacks.length;G<
C;++G)this.destroycallbacks[G](g);g.collcells&&p.collision_grid.update(g,g.collcells,null);(G=g.layer)&&G.removeFromInstanceList(g,!0);if(g.behavior_insts)for(G=0,C=g.behavior_insts.length;G<C;++G){var z=g.behavior_insts[G];if(z.onDestroy)z.onDestroy();z.behavior.my_instances.remove(g)}this.objects_to_pretick.remove(g);this.objects_to_tick.remove(g);this.objects_to_tick2.remove(g);if(g.onDestroy)g.onDestroy();this.objectsByUid.hasOwnProperty(g.uid.toString())&&delete this.objectsByUid[g.uid.toString()];
this.objectcount--;100>p.deadCache.length&&p.deadCache.push(g)};b.prototype.createInstance=function(g,p,C,G){if(g.is_family){var z=cr.floor(Math.random()*g.members.length);return this.createInstance(g.members[z],p,C,G)}return g.default_instance?this.createInstanceFromInit(g.default_instance,p,!1,C,G,!1):null};var w=[];b.prototype.createInstanceFromInit=function(g,p,C,G,z,J){var Q,R;if(!g)return null;var T=this.types_by_index[g[1]],fa=T.plugin.is_world;if(this.isloading&&fa&&!T.isOnLoaderLayout||fa&&
!this.glwrap&&11===g[0][11])return null;var ba=p;fa||(p=null);if(T.deadCache.length){var Z=T.deadCache.pop();Z.recycled=!0;T.plugin.Instance.call(Z,T)}else Z=new T.plugin.Instance(T),Z.recycled=!1;!C||J||this.objectsByUid.hasOwnProperty(g[2].toString())?Z.uid=this.next_uid++:Z.uid=g[2];this.objectsByUid[Z.uid.toString()]=Z;Z.puid=this.next_puid++;Z.iid=T.instances.length;var da=0;for(Q=this.createRow.length;da<Q;++da)this.createRow[da].type===T&&Z.iid++;Z.get_iid=cr.inst_get_iid;Z.toString=cr.inst_toString;
Z.isDestroyed=!1;var ia=g[3];if(Z.recycled)cr.wipe(Z.extra);else{Z.extra={};if(this.isPreview)for(Z.instance_var_names=[],Z.instance_var_names.length=ia.length,da=0,Q=ia.length;da<Q;da++)Z.instance_var_names[da]=ia[da][1];Z.instance_vars=[];Z.instance_vars.length=ia.length}da=0;for(Q=ia.length;da<Q;da++)Z.instance_vars[da]=ia[da][0];if(fa){var ka=g[0];Z.x=cr.is_undefined(G)?ka[0]:G;Z.y=cr.is_undefined(z)?ka[1]:z;Z.z=ka[2];Z.width=ka[3];Z.height=ka[4];Z.depth=ka[5];Z.angle=ka[6];Z.opacity=ka[7];Z.hotspotX=
ka[8];Z.hotspotY=ka[9];Z.blend_mode=ka[10];da=ka[11];!this.glwrap&&T.effect_types.length&&(Z.blend_mode=da);Z.compositeOp=cr.effectToCompositeOp(Z.blend_mode);this.gl&&cr.setGLBlend(Z,Z.blend_mode,this.gl);if(Z.recycled){da=0;for(Q=ka[12].length;da<Q;da++)for(ia=0,R=ka[12][da].length;ia<R;ia++)Z.effect_params[da][ia]=ka[12][da][ia],Array.isArray(Z.effect_params[da][ia])&&(Z.effect_params[da][ia]=Z.effect_params[da][ia].slice(0));Z.bbox.set(0,0,0,0);Z.collcells.set(0,0,-1,-1);Z.rendercells.set(0,0,
-1,-1);Z.bquad.set_from_rect(Z.bbox);cr.clearArray(Z.bbox_changed_callbacks)}else{Z.effect_params=ka[12].slice(0);da=0;for(Q=Z.effect_params.length;da<Q;da++)for(Z.effect_params[da]=ka[12][da].slice(0),ia=0,R=Z.effect_params[da].length;ia<R;++ia)Array.isArray(Z.effect_params[da][ia])&&(Z.effect_params[da][ia]=Z.effect_params[da][ia].slice(0));Z.active_effect_types=[];Z.active_effect_flags=[];Z.active_effect_flags.length=T.effect_types.length;Z.bbox=new cr.rect(0,0,0,0);Z.collcells=new cr.rect(0,0,
-1,-1);Z.rendercells=new cr.rect(0,0,-1,-1);Z.bquad=new cr.quad;Z.bbox_changed_callbacks=[];Z.set_bbox_changed=cr.set_bbox_changed;Z.add_bbox_changed_callback=cr.add_bbox_changed_callback;Z.contains_pt=cr.inst_contains_pt;Z.update_bbox=cr.update_bbox;Z.update_render_cell=cr.update_render_cell;Z.update_collision_cell=cr.update_collision_cell;Z.get_zindex=cr.inst_get_zindex}Z.tilemap_exists=!1;Z.tilemap_width=0;Z.tilemap_height=0;Z.tilemap_data=null;14===ka.length&&(Z.tilemap_exists=!0,Z.tilemap_width=
ka[13][0],Z.tilemap_height=ka[13][1],Z.tilemap_data=ka[13][2]);da=0;for(Q=T.effect_types.length;da<Q;da++)Z.active_effect_flags[da]=!0;Z.shaders_preserve_opaqueness=!0;Z.updateActiveEffects=cr.inst_updateActiveEffects;Z.updateActiveEffects();Z.uses_shaders=!!Z.active_effect_types.length;Z.bbox_changed=!0;Z.cell_changed=!0;T.any_cell_changed=!0;Z.visible=!0;Z.my_timescale=-1;Z.layer=p;Z.zindex=p.instances.length;Z.earlyz_index=0;"undefined"===typeof Z.collision_poly&&(Z.collision_poly=null);this.redraw=
Z.collisionsEnabled=!0}cr.clearArray(w);da=0;for(Q=T.families.length;da<Q;da++)w.push.apply(w,T.families[da].behaviors);w.push.apply(w,T.behaviors);if(Z.recycled)for(da=0,Q=w.length;da<Q;da++){var ta=w[da];var qa=Z.behavior_insts[da];qa.recycled=!0;ta.behavior.Instance.call(qa,ta,Z);ka=g[4][da];ia=0;for(R=ka.length;ia<R;ia++)qa.properties[ia]=ka[ia];qa.onCreate();ta.behavior.my_instances.add(Z)}else for(Z.behavior_insts=[],da=0,Q=w.length;da<Q;da++)ta=w[da],qa=new ta.behavior.Instance(ta,Z),qa.recycled=
!1,qa.properties=g[4][da].slice(0),qa.onCreate(),cr.seal(qa),Z.behavior_insts.push(qa),ta.behavior.my_instances.add(Z);ka=g[5];if(Z.recycled)for(da=0,Q=ka.length;da<Q;da++)Z.properties[da]=ka[da];else Z.properties=ka.slice(0);this.createRow.push(Z);this.hasPendingInstances=!0;p&&(p.appendToInstanceList(Z,!0),1!==p.parallaxX||1!==p.parallaxY)&&(T.any_instance_parallaxed=!0);this.objectcount++;if(T.is_contained){if(Z.is_contained=!0,Z.recycled?cr.clearArray(Z.siblings):Z.siblings=[],!C&&!J){da=0;for(Q=
T.container.length;da<Q;da++)if(T.container[da]!==T){if(!T.container[da].default_instance)return null;Z.siblings.push(this.createInstanceFromInit(T.container[da].default_instance,ba,!1,fa?Z.x:G,fa?Z.y:z,!0))}da=0;for(Q=Z.siblings.length;da<Q;da++)for(Z.siblings[da].siblings.push(Z),ia=0;ia<Q;ia++)da!==ia&&Z.siblings[da].siblings.push(Z.siblings[ia])}}else Z.is_contained=!1,Z.siblings=null;Z.onCreate();Z.recycled||cr.seal(Z);da=0;for(Q=Z.behavior_insts.length;da<Q;da++)Z.behavior_insts[da].postCreate&&
Z.behavior_insts[da].postCreate();return Z};b.prototype.getLayerByName=function(g){var p;var C=0;for(p=this.running_layout.layers.length;C<p;C++){var G=this.running_layout.layers[C];if(cr.equals_nocase(G.name,g))return G}return null};b.prototype.getLayerByNumber=function(g){g=cr.floor(g);0>g&&(g=0);g>=this.running_layout.layers.length&&(g=this.running_layout.layers.length-1);return this.running_layout.layers[g]};b.prototype.getLayer=function(g){return cr.is_number(g)?this.getLayerByNumber(g):this.getLayerByName(g.toString())};
b.prototype.clearSol=function(g){var p;var C=0;for(p=g.length;C<p;C++)g[C].getCurrentSol().select_all=!0};b.prototype.pushCleanSol=function(g){var p;var C=0;for(p=g.length;C<p;C++)g[C].pushCleanSol()};b.prototype.pushCopySol=function(g){var p;var C=0;for(p=g.length;C<p;C++)g[C].pushCopySol()};b.prototype.popSol=function(g){var p;var C=0;for(p=g.length;C<p;C++)g[C].popSol()};b.prototype.updateAllCells=function(g){if(g.any_cell_changed){var p,C=g.instances;var G=0;for(p=C.length;G<p;++G)C[G].update_collision_cell();
C=this.createRow;G=0;for(p=C.length;G<p;++G)C[G].type===g&&C[G].update_collision_cell();g.any_cell_changed=!1}};b.prototype.getCollisionCandidates=function(g,p,C,G){var z,J=g?1!==g.parallaxX||1!==g.parallaxY:!1;if(p.is_family)for(g=0,z=p.members.length;g<z;++g){var Q=p.members[g];J||Q.any_instance_parallaxed?cr.appendArray(G,Q.instances):(this.updateAllCells(Q),Q.collision_grid.queryRange(C,G))}else J||p.any_instance_parallaxed?cr.appendArray(G,p.instances):(this.updateAllCells(p),p.collision_grid.queryRange(C,
G))};b.prototype.getTypesCollisionCandidates=function(g,p,C,G){var z;var J=0;for(z=p.length;J<z;++J)this.getCollisionCandidates(g,p[J],C,G)};b.prototype.getSolidCollisionCandidates=function(g,p,C){var G=this.getSolidBehavior();if(!G)return null;this.getTypesCollisionCandidates(g,G.my_types,p,C)};b.prototype.getJumpthruCollisionCandidates=function(g,p,C){var G=this.getJumpthruBehavior();if(!G)return null;this.getTypesCollisionCandidates(g,G.my_types,p,C)};b.prototype.testAndSelectCanvasPointOverlap=
function(g,p,C,G){var z=g.getCurrentSol(),J,Q=this.getCurrentEventStack().current_event.orblock;if(z.select_all){G||(z.select_all=!1,cr.clearArray(z.instances));var R=0;for(J=g.instances.length;R<J;R++){var T=g.instances[R];T.update_bbox();var fa=T.layer.canvasToLayer(p,C,!0);var ba=T.layer.canvasToLayer(p,C,!1);if(T.contains_pt(fa,ba)){if(G)return!1;z.instances.push(T)}else Q&&z.else_instances.push(T)}}else{var Z=0;var da=Q?z.else_instances:z.instances;R=0;for(J=da.length;R<J;R++)if(T=da[R],T.update_bbox(),
fa=T.layer.canvasToLayer(p,C,!0),ba=T.layer.canvasToLayer(p,C,!1),T.contains_pt(fa,ba)){if(G)return!1;Q?z.instances.push(T):(z.instances[Z]=z.instances[R],Z++)}G||(da.length=Z)}g.applySolToContainer();return G?!0:z.hasObjects()};b.prototype.testOverlap=function(g,p){if(!(g&&p&&g!==p&&g.collisionsEnabled&&p.collisionsEnabled))return!1;g.update_bbox();p.update_bbox();var C=g.layer,G=p.layer,z;if(C===G||C.parallaxX===G.parallaxX&&G.parallaxY===G.parallaxY&&C.scale===G.scale&&C.angle===G.angle&&C.zoomRate===
G.zoomRate){if(!g.bbox.intersects_rect(p.bbox)||!g.bquad.intersects_quad(p.bquad)||g.tilemap_exists&&p.tilemap_exists)return!1;if(g.tilemap_exists)return this.testTilemapOverlap(g,p);if(p.tilemap_exists)return this.testTilemapOverlap(p,g);var J=g.collision_poly&&!g.collision_poly.is_empty();var Q=p.collision_poly&&!p.collision_poly.is_empty();if(!J&&!Q)return!0;J?(g.collision_poly.cache_poly(g.width,g.height,g.angle),J=g.collision_poly):(this.temp_poly.set_from_quad(g.bquad,g.x,g.y,g.width,g.height),
J=this.temp_poly);if(Q){p.collision_poly.cache_poly(p.width,p.height,p.angle);var R=p.collision_poly}else this.temp_poly.set_from_quad(p.bquad,p.x,p.y,p.width,p.height),R=this.temp_poly;return J.intersects_poly(R,p.x-g.x,p.y-g.y)}J=g.collision_poly&&!g.collision_poly.is_empty();Q=p.collision_poly&&!p.collision_poly.is_empty();J?(g.collision_poly.cache_poly(g.width,g.height,g.angle),this.temp_poly.set_from_poly(g.collision_poly)):this.temp_poly.set_from_quad(g.bquad,g.x,g.y,g.width,g.height);J=this.temp_poly;
Q?(p.collision_poly.cache_poly(p.width,p.height,p.angle),this.temp_poly2.set_from_poly(p.collision_poly)):this.temp_poly2.set_from_quad(p.bquad,p.x,p.y,p.width,p.height);R=this.temp_poly2;Q=0;for(z=J.pts_count;Q<z;Q++){var T=2*Q;var fa=T+1;var ba=J.pts_cache[T];var Z=J.pts_cache[fa];J.pts_cache[T]=C.layerToCanvas(ba+g.x,Z+g.y,!0);J.pts_cache[fa]=C.layerToCanvas(ba+g.x,Z+g.y,!1)}J.update_bbox();Q=0;for(z=R.pts_count;Q<z;Q++)T=2*Q,fa=T+1,ba=R.pts_cache[T],Z=R.pts_cache[fa],R.pts_cache[T]=G.layerToCanvas(ba+
p.x,Z+p.y,!0),R.pts_cache[fa]=G.layerToCanvas(ba+p.x,Z+p.y,!1);R.update_bbox();return J.intersects_poly(R,0,0)};var I=new cr.quad,N=new cr.rect(0,0,0,0),U=[];b.prototype.testTilemapOverlap=function(g,p){var C,G=p.bbox,z=g.x,J=g.y;g.getCollisionRectCandidates(G,U);var Q=p.collision_poly&&!p.collision_poly.is_empty();g=0;for(C=U.length;g<C;++g){var R=U[g];var T=R.rc;if(G.intersects_rect_off(T,z,J)&&(I.set_from_rect(T),I.offset(z,J),I.intersects_quad(p.bquad)))if(Q)if(p.collision_poly.cache_poly(p.width,
p.height,p.angle),R.poly){if(R.poly.intersects_poly(p.collision_poly,p.x-(z+T.left),p.y-(J+T.top)))return cr.clearArray(U),!0}else{if(this.temp_poly.set_from_quad(I,0,0,T.right-T.left,T.bottom-T.top),this.temp_poly.intersects_poly(p.collision_poly,p.x,p.y))return cr.clearArray(U),!0}else if(R.poly){if(this.temp_poly.set_from_quad(p.bquad,0,0,p.width,p.height),R.poly.intersects_poly(this.temp_poly,-(z+T.left),-(J+T.top)))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);return!1};
b.prototype.testRectOverlap=function(g,p){if(!p||!p.collisionsEnabled)return!1;p.update_bbox();if(!p.bbox.intersects_rect(g))return!1;if(p.tilemap_exists){p.getCollisionRectCandidates(g,U);var C,G=p.x,z=p.y;p=0;for(C=U.length;p<C;++p){var J=U[p];var Q=J.rc;if(g.intersects_rect_off(Q,G,z))if(J.poly){if(this.temp_poly.set_from_rect(g,0,0),J.poly.intersects_poly(this.temp_poly,-(G+Q.left),-(z+Q.top)))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);return!1}I.set_from_rect(g);
if(!p.bquad.intersects_quad(I))return!1;if(!p.collision_poly||p.collision_poly.is_empty())return!0;p.collision_poly.cache_poly(p.width,p.height,p.angle);I.offset(-g.left,-g.top);this.temp_poly.set_from_quad(I,0,0,1,1);return p.collision_poly.intersects_poly(this.temp_poly,g.left-p.x,g.top-p.y)};b.prototype.testSegmentOverlap=function(g,p,C,G,z){if(!z||!z.collisionsEnabled)return!1;z.update_bbox();N.set(cr.min(g,C),cr.min(p,G),cr.max(g,C),cr.max(p,G));if(!z.bbox.intersects_rect(N))return!1;if(z.tilemap_exists){z.getCollisionRectCandidates(N,
U);var J,Q=z.x,R=z.y;z=0;for(J=U.length;z<J;++z){var T=U[z];var fa=T.rc;if(N.intersects_rect_off(fa,Q,R)&&(I.set_from_rect(fa),I.offset(Q,R),I.intersects_segment(g,p,C,G)))if(T.poly){if(T.poly.intersects_segment(Q+fa.left,R+fa.top,g,p,C,G))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);return!1}if(!z.bquad.intersects_segment(g,p,C,G))return!1;if(!z.collision_poly||z.collision_poly.is_empty())return!0;z.collision_poly.cache_poly(z.width,z.height,z.angle);return z.collision_poly.intersects_segment(z.x,
z.y,g,p,C,G)};b.prototype.typeHasBehavior=function(g,p){if(!p)return!1;var C,G;var z=0;for(C=g.behaviors.length;z<C;z++)if(g.behaviors[z].behavior instanceof p)return!0;if(!g.is_family)for(z=0,C=g.families.length;z<C;z++){var J=g.families[z];var Q=0;for(G=J.behaviors.length;Q<G;Q++)if(J.behaviors[Q].behavior instanceof p)return!0}return!1};b.prototype.typeHasNoSaveBehavior=function(g){return this.typeHasBehavior(g,cr.behaviors.NoSave)};b.prototype.typeHasPersistBehavior=function(g){return this.typeHasBehavior(g,
cr.behaviors.Persist)};b.prototype.getSolidBehavior=function(){return this.solidBehavior};b.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var W=[];b.prototype.testOverlapSolid=function(g){var p;g.update_bbox();this.getSolidCollisionCandidates(g.layer,g.bbox,W);var C=0;for(p=W.length;C<p;++C){var G=W[C];if(G.extra.solidEnabled&&this.testOverlap(g,G))return cr.clearArray(W),G}cr.clearArray(W);return null};b.prototype.testRectOverlapSolid=function(g){var p;this.getSolidCollisionCandidates(null,
g,W);var C=0;for(p=W.length;C<p;++C){var G=W[C];if(G.extra.solidEnabled&&this.testRectOverlap(g,G))return cr.clearArray(W),G}cr.clearArray(W);return null};var X=[];b.prototype.testOverlapJumpThru=function(g,p){var C=null;p&&(C=X,cr.clearArray(C));g.update_bbox();this.getJumpthruCollisionCandidates(g.layer,g.bbox,W);var G;var z=0;for(G=W.length;z<G;++z){var J=W[z];if(J.extra.jumpthruEnabled&&this.testOverlap(g,J))if(p)C.push(J);else return cr.clearArray(W),J}cr.clearArray(W);return C};b.prototype.pushOutSolid=
function(g,p,C,G,z,J){G=G||50;var Q=g.x,R=g.y,T,fa=null,ba=null;for(T=0;T<G;T++)if(g.x=Q+p*T,g.y=R+C*T,g.set_bbox_changed(),!this.testOverlap(g,fa)&&((fa=this.testOverlapSolid(g))&&(ba=fa),!fa&&(z&&(fa=J?this.testOverlap(g,J)?J:null:this.testOverlapJumpThru(g))&&(ba=fa),!fa)))return ba&&this.pushInFractional(g,p,C,ba,16),!0;g.x=Q;g.y=R;g.set_bbox_changed();return!1};b.prototype.pushOutSolidAxis=function(g,p,C,G){G=G||50;var z=g.x,J=g.y,Q=null,R=null,T,fa;for(T=0;T<G;++T)for(fa=0;2>fa;++fa){var ba=
2*fa-1;g.x=z+p*T*ba;g.y=J+C*T*ba;g.set_bbox_changed();if(!this.testOverlap(g,Q))if(Q=this.testOverlapSolid(g))R=Q;else return R&&this.pushInFractional(g,p*ba,C*ba,R,16),!0}g.x=z;g.y=J;g.set_bbox_changed();return!1};b.prototype.pushOut=function(g,p,C,G,z){G=G||50;var J=g.x,Q=g.y,R;for(R=0;R<G;R++)if(g.x=J+p*R,g.y=Q+C*R,g.set_bbox_changed(),!this.testOverlap(g,z))return!0;g.x=J;g.y=Q;g.set_bbox_changed();return!1};b.prototype.pushInFractional=function(g,p,C,G,z){var J=2,Q=!1;var R=!1;for(var T=g.x,
fa=g.y;J<=z;)R=1/J,J*=2,g.x+=p*R*(Q?1:-1),g.y+=C*R*(Q?1:-1),g.set_bbox_changed(),this.testOverlap(g,G)?R=Q=!0:(R=Q=!1,T=g.x,fa=g.y);R&&(g.x=T,g.y=fa,g.set_bbox_changed())};b.prototype.pushOutSolidNearest=function(g,p){p=cr.is_undefined(p)?100:p;var C=0,G=g.x,z=g.y,J=0,Q=0,R=0,T=this.testOverlapSolid(g);if(!T)return!0;for(;C<=p;){switch(J){case 0:Q=0;R=-1;C++;break;case 1:Q=1;R=-1;break;case 2:Q=1;R=0;break;case 3:R=Q=1;break;case 4:Q=0;R=1;break;case 5:Q=-1;R=1;break;case 6:Q=-1;R=0;break;case 7:R=
Q=-1}J=(J+1)%8;g.x=cr.floor(G+Q*C);g.y=cr.floor(z+R*C);g.set_bbox_changed();if(!this.testOverlap(g,T)&&(T=this.testOverlapSolid(g),!T))return!0}g.x=G;g.y=z;g.set_bbox_changed();return!1};b.prototype.registerCollision=function(g,p){g.collisionsEnabled&&p.collisionsEnabled&&this.registered_collisions.push([g,p])};b.prototype.addRegisteredCollisionCandidates=function(g,p,C){var G;var z=0;for(G=this.registered_collisions.length;z<G;++z){var J=this.registered_collisions[z];if(J[0]===g)J=J[1];else if(J[1]===
g)J=J[0];else continue;if(p.is_family){if(-1===p.members.indexOf(p))continue}else if(J.type!==p)continue;-1===C.indexOf(J)&&C.push(J)}};b.prototype.checkRegisteredCollision=function(g,p){var C;var G=0;for(C=this.registered_collisions.length;G<C;G++){var z=this.registered_collisions[G];if(z[0]===g&&z[1]===p||z[0]===p&&z[1]===g)return!0}return!1};b.prototype.calculateSolidBounceAngle=function(g,p,C,G){var z=g.x,J=g.y,Q=cr.max(10,cr.distanceTo(p,C,z,J)),R=cr.angleTo(p,C,z,J),T=G||this.testOverlapSolid(g);
if(!T)return cr.clamp_angle(R+cr.PI);var fa=T,ba,Z=cr.to_radians(5);for(ba=1;36>ba;ba++){var da=R-ba*Z;g.x=p+Math.cos(da)*Q;g.y=C+Math.sin(da)*Q;g.set_bbox_changed();if(!this.testOverlap(g,fa)&&(fa=G?null:this.testOverlapSolid(g),!fa)){var ia=da;break}}36===ba&&(ia=cr.clamp_angle(R+cr.PI));fa=T;for(ba=1;36>ba;ba++)if(da=R+ba*Z,g.x=p+Math.cos(da)*Q,g.y=C+Math.sin(da)*Q,g.set_bbox_changed(),!this.testOverlap(g,fa)&&(fa=G?null:this.testOverlapSolid(g),!fa)){var ka=da;break}36===ba&&(ka=cr.clamp_angle(R+
cr.PI));g.x=z;g.y=J;g.set_bbox_changed();if(ka===ia)return ka;g=cr.angleDiff(ka,ia)/2;g=cr.angleClockwise(ka,ia)?cr.clamp_angle(ia+g+cr.PI):cr.clamp_angle(ka+g);ia=Math.cos(R);R=Math.sin(R);ka=Math.cos(g);g=Math.sin(g);p=ia*ka+R*g;return cr.angleTo(0,0,ia-2*p*ka,R-2*p*g)};var Y=-1;b.prototype.trigger=function(g,p,C){if(!this.running_layout)return!1;var G=this.running_layout.event_sheet;if(!G)return!1;var z=!1,J;Y++;var Q=G.deep_includes;var R=0;for(J=Q.length;R<J;++R){var T=this.triggerOnSheet(g,
p,Q[R],C);z=z||T}T=this.triggerOnSheet(g,p,G,C);Y--;return z||T};b.prototype.triggerOnSheet=function(g,p,C,G){var z=!1,J;if(p){var Q=this.triggerOnSheetForTypeName(g,p,p.type.name,C,G);z=z||Q;var R=p.type.families;var T=0;for(J=R.length;T<J;++T)Q=this.triggerOnSheetForTypeName(g,p,R[T].name,C,G),z=z||Q}else Q=this.triggerOnSheetForTypeName(g,p,"system",C,G),z=z||Q;return z};b.prototype.triggerOnSheetForTypeName=function(g,p,C,G,z){var J,Q=!1;var R="undefined"!==typeof z;var T=(R?G.fasttriggers:G.triggers)[C];
if(!T)return Q;var fa=null;G=0;for(J=T.length;G<J;++G)if(T[G].method==g){fa=T[G].evs;break}if(!fa)return Q;g=R?fa[z]:fa;if(!g)return null;G=0;for(J=g.length;G<J;G++)z=g[G][0],R=g[G][1],z=this.executeSingleTrigger(p,C,z,R),Q=Q||z;return Q};b.prototype.executeSingleTrigger=function(g,p,C,G){var z,J=!1;this.trigger_depth++;var Q=this.getCurrentEventStack().current_event;Q&&this.pushCleanSol(Q.solModifiersIncludingParents);var R=1<this.trigger_depth;this.pushCleanSol(C.solModifiersIncludingParents);R&&
this.pushLocalVarStack();var T=this.pushEventStack(C);T.current_event=C;if(g){var fa=this.types[p].getCurrentSol();fa.select_all=!1;cr.clearArray(fa.instances);fa.instances[0]=g;this.types[p].applySolToContainer()}g=!0;if(C.parent){p=T.temp_parents_arr;for(fa=C.parent;fa;)p.push(fa),fa=fa.parent;p.reverse();fa=0;for(z=p.length;fa<z;fa++)if(!p[fa].run_pretrigger()){g=!1;break}}g&&(this.execcount++,C.orblock?C.run_orblocktrigger(G):C.run(),J=J||T.last_event_true);this.popEventStack();R&&this.popLocalVarStack();
this.popSol(C.solModifiersIncludingParents);Q&&this.popSol(Q.solModifiersIncludingParents);this.hasPendingInstances&&0===this.isInOnDestroy&&0===Y&&!this.isRunningEvents&&this.ClearDeathRow();this.trigger_depth--;return J};b.prototype.getCurrentCondition=function(){var g=this.getCurrentEventStack();return g.current_event.conditions[g.cndindex]};b.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type};b.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex};
b.prototype.getCurrentAction=function(){var g=this.getCurrentEventStack();return g.current_event.actions[g.actindex]};b.prototype.pushLocalVarStack=function(){this.localvar_stack_index++;this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])};b.prototype.popLocalVarStack=function(){this.localvar_stack_index--};b.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]};b.prototype.pushEventStack=function(g){this.event_stack_index++;
this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var p=this.getCurrentEventStack();p.reset(g);return p};b.prototype.popEventStack=function(){this.event_stack_index--};b.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]};b.prototype.pushLoopStack=function(g){this.loop_stack_index++;this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:g,index:0,stopped:!1}));var p=this.getCurrentLoop();
p.name=g;p.index=0;p.stopped=!1;return p};b.prototype.popLoopStack=function(){this.loop_stack_index--};b.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]};b.prototype.getEventVariableByName=function(g,p){for(var C,G,z,J,Q;p;){C=0;for(G=p.subevents.length;C<G;C++)if(Q=p.subevents[C],Q instanceof cr.eventvariable&&cr.equals_nocase(g,Q.name))return Q;p=p.parent}C=0;for(G=this.eventsheets_by_index.length;C<G;C++)for(J=this.eventsheets_by_index[C],p=0,z=J.events.length;p<
z;p++)if(Q=J.events[p],Q instanceof cr.eventvariable&&cr.equals_nocase(g,Q.name))return Q;return null};b.prototype.getLayoutBySid=function(g){var p;var C=0;for(p=this.layouts_by_index.length;C<p;C++)if(this.layouts_by_index[C].sid===g)return this.layouts_by_index[C];return null};b.prototype.getObjectTypeBySid=function(g){var p;var C=0;for(p=this.types_by_index.length;C<p;C++)if(this.types_by_index[C].sid===g)return this.types_by_index[C];return null};b.prototype.getGroupBySid=function(g){var p;var C=
0;for(p=this.allGroups.length;C<p;C++)if(this.allGroups[C].sid===g)return this.allGroups[C];return null};b.prototype.requirePermissions=function(g){return this.getPermissions(g).then(function(p){if(!1===p)return Promise.reject("Permission not granted")})};b.prototype.getPermissions=function(g){return this.isCordova&&this.isAndroid?g.reduce(function(p,C){return p.then(function(G){return!1===G?!1:A(C).then(function(z){return z?!0:q(C)})})},Promise.resolve(!0)):Promise.resolve(!0)};b.prototype.doCanvasSnapshot=
function(g,p){this.snapshotCanvas=[g,p];this.redraw=!0};b.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0};b.prototype.handleSaveLoad=function(){var g=this,p=this.saveToSlot,C=this.lastSaveJson,G=this.loadFromSlot,z=!1;this.signalledContinuousPreview&&(z=!0,p="__c2_continuouspreview",this.signalledContinuousPreview=!1);if(p.length){this.ClearDeathRow();C=this.saveToJSONString();if(M())m(p,C,function(){cr.logexport("Saved state to IndexedDB storage ("+C.length+" bytes)");
g.lastSaveJson=C;g.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);C=g.lastSaveJson="";z&&c()},function(J){try{localStorage.setItem("__c2save_"+p,C),cr.logexport("Saved state to WebStorage ("+C.length+" bytes)"),g.lastSaveJson=C,g.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),C=g.lastSaveJson="",z&&c()}catch(Q){cr.logexport("Failed to save game state: "+J+"; "+Q),g.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+p,
C),cr.logexport("Saved state to WebStorage ("+C.length+" bytes)"),g.lastSaveJson=C,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),C=g.lastSaveJson="",z&&c()}catch(J){cr.logexport("Error saving to WebStorage: "+J),g.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.loadFromSlot=this.saveToSlot="";this.loadFromJson=null}if(G.length){if(M())a(G,function(J){J?(g.loadFromJson=J,cr.logexport("Loaded state from IndexedDB storage ("+g.loadFromJson.length+" bytes)")):(g.loadFromJson=
localStorage.getItem("__c2save_"+G)||"",cr.logexport("Loaded state from WebStorage ("+g.loadFromJson.length+" bytes)"));g.suspendDrawing=!1;g.loadFromJson||(g.loadFromJson=null,g.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(J){g.loadFromJson=localStorage.getItem("__c2save_"+G)||"";cr.logexport("Loaded state from WebStorage ("+g.loadFromJson.length+" bytes)");g.suspendDrawing=!1;g.loadFromJson||(g.loadFromJson=null,g.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});
else{try{this.loadFromJson=localStorage.getItem("__c2save_"+G)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(J){this.loadFromJson=null}this.suspendDrawing=!1;g.loadFromJson||(g.loadFromJson=null,g.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.saveToSlot=this.loadFromSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,
null),this.lastSaveJson=""):g.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)};b.prototype.saveToJSONString=function(){var g,p,C,G={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}};var z=0;for(g=
this.types_by_index.length;z<g;z++){var J=this.types_by_index[z];if(!J.is_family&&!this.typeHasNoSaveBehavior(J)){var Q={instances:[]};cr.hasAnyOwnProperty(J.extra)&&(Q.ex=f(J.extra));var R=0;for(p=J.instances.length;R<p;R++)Q.instances.push(this.saveInstanceToJSON(J.instances[R]));G.types[J.sid.toString()]=Q}}z=0;for(g=this.layouts_by_index.length;z<g;z++)R=this.layouts_by_index[z],G.layouts[R.sid.toString()]=R.saveToJSON();p=G.events.groups;z=0;for(g=this.allGroups.length;z<g;z++)R=this.allGroups[z],
p[R.sid.toString()]=this.groups_by_name[R.group_name].group_active;g=G.events.cnds;for(C in this.cndsBySid)this.cndsBySid.hasOwnProperty(C)&&(z=this.cndsBySid[C],cr.hasAnyOwnProperty(z.extra)&&(g[C]={ex:f(z.extra)}));g=G.events.acts;for(C in this.actsBySid)this.actsBySid.hasOwnProperty(C)&&(z=this.actsBySid[C],cr.hasAnyOwnProperty(z.extra)&&(g[C]={ex:f(z.extra)}));g=G.events.vars;for(C in this.varsBySid)this.varsBySid.hasOwnProperty(C)&&(z=this.varsBySid[C],z.is_constant||z.parent&&!z.is_static||
(g[C]=z.data));G.system=this.system.saveToJSON();return JSON.stringify(G)};b.prototype.refreshUidMap=function(){var g,p;this.objectsByUid={};var C=0;for(g=this.types_by_index.length;C<g;C++){var G=this.types_by_index[C];if(!G.is_family){var z=0;for(p=G.instances.length;z<p;z++){var J=G.instances[z];this.objectsByUid[J.uid.toString()]=J}}}};b.prototype.loadFromJSONString=function(g){try{var p=JSON.parse(g)}catch(ba){return!1}if(!p.c2save||1<p.version)return!1;this.isLoadingState=!0;g=p.rt;this.kahanTime.reset();
this.kahanTime.sum=g.time;this.wallTime.reset();this.wallTime.sum=g.walltime||0;this.timescale=g.timescale;this.tickcount=g.tickcount;this.execcount=g.execcount;this.start_time=Date.now()-g.start_time_offset;var C=g.running_layout;if(C!==this.running_layout.sid)if(C=this.getLayoutBySid(C))this.doChangeLayout(C);else return;var G,z,J;var Q=p.types;for(z in Q)if(Q.hasOwnProperty(z)&&(J=this.getObjectTypeBySid(parseInt(z,10)))&&!J.is_family&&!this.typeHasNoSaveBehavior(J)){Q[z].ex?J.extra=Q[z].ex:cr.wipe(J.extra);
var R=J.instances;var T=Q[z].instances;C=0;for(G=cr.min(R.length,T.length);C<G;C++)this.loadInstanceFromJSON(R[C],T[C]);C=T.length;for(G=R.length;C<G;C++)this.DestroyInstance(R[C]);C=R.length;for(G=T.length;C<G;C++){R=null;if(J.plugin.is_world&&(R=this.running_layout.getLayerBySid(T[C].w.l),!R))continue;R=this.createInstanceFromInit(J.default_instance,R,!1,0,0,!0);this.loadInstanceFromJSON(R,T[C])}J.stale_iids=!0}this.ClearDeathRow();this.refreshUidMap();G=p.layouts;for(z in G)G.hasOwnProperty(z)&&
(C=this.getLayoutBySid(parseInt(z,10)))&&C.loadFromJSON(G[z]);G=p.events.groups;for(z in G)G.hasOwnProperty(z)&&(C=this.getGroupBySid(parseInt(z,10)))&&this.groups_by_name[C.group_name]&&this.groups_by_name[C.group_name].setGroupActive(G[z]);C=p.events.cnds;for(z in this.cndsBySid)this.cndsBySid.hasOwnProperty(z)&&(C.hasOwnProperty(z)?this.cndsBySid[z].extra=C[z].ex:this.cndsBySid[z].extra={});C=p.events.acts;for(z in this.actsBySid)this.actsBySid.hasOwnProperty(z)&&(C.hasOwnProperty(z)?this.actsBySid[z].extra=
C[z].ex:this.actsBySid[z].extra={});C=p.events.vars;for(z in C)C.hasOwnProperty(z)&&this.varsBySid.hasOwnProperty(z)&&(this.varsBySid[z].data=C[z]);this.next_uid=g.next_uid;this.isLoadingState=!1;C=0;for(G=this.fireOnCreateAfterLoad.length;C<G;++C)R=this.fireOnCreateAfterLoad[C],this.trigger(Object.getPrototypeOf(R.type.plugin).cnds.OnCreated,R);cr.clearArray(this.fireOnCreateAfterLoad);this.system.loadFromJSON(p.system);C=0;for(G=this.types_by_index.length;C<G;C++)if(J=this.types_by_index[C],!J.is_family&&
!this.typeHasNoSaveBehavior(J))for(p=0,z=J.instances.length;p<z;p++){R=J.instances[p];if(J.is_contained)for(Q=R.get_iid(),cr.clearArray(R.siblings),g=0,T=J.container.length;g<T;g++){var fa=J.container[g];J!==fa&&R.siblings.push(fa.instances[Q])}R.afterLoad&&R.afterLoad();if(R.behavior_insts)for(g=0,T=R.behavior_insts.length;g<T;g++)Q=R.behavior_insts[g],Q.afterLoad&&Q.afterLoad()}return this.redraw=!0};b.prototype.saveInstanceToJSON=function(g,p){var C;var G=g.type;var z=G.plugin;var J={};p?J.c2=
!0:J.uid=g.uid;cr.hasAnyOwnProperty(g.extra)&&(J.ex=f(g.extra));if(g.instance_vars&&g.instance_vars.length)for(J.ivs={},p=0,C=g.instance_vars.length;p<C;p++)J.ivs[g.type.instvar_sids[p].toString()]=g.instance_vars[p];if(z.is_world){z={x:g.x,y:g.y,w:g.width,h:g.height,l:g.layer.sid,zi:g.get_zindex()};0!==g.angle&&(z.a=g.angle);1!==g.opacity&&(z.o=g.opacity);.5!==g.hotspotX&&(z.hX=g.hotspotX);.5!==g.hotspotY&&(z.hY=g.hotspotY);0!==g.blend_mode&&(z.bm=g.blend_mode);g.visible||(z.v=g.visible);g.collisionsEnabled||
(z.ce=g.collisionsEnabled);-1!==g.my_timescale&&(z.mts=g.my_timescale);if(G.effect_types.length)for(z.fx=[],p=0,C=G.effect_types.length;p<C;p++){var Q=G.effect_types[p];z.fx.push({name:Q.name,active:g.active_effect_flags[Q.index],params:g.effect_params[Q.index]})}J.w=z}if(g.behavior_insts&&g.behavior_insts.length)for(J.behs={},p=0,C=g.behavior_insts.length;p<C;p++)G=g.behavior_insts[p],G.saveToJSON&&(J.behs[G.type.sid.toString()]=G.saveToJSON());g.saveToJSON&&(J.data=g.saveToJSON());return J};b.prototype.getInstanceVarIndexBySid=
function(g,p){var C;var G=0;for(C=g.instvar_sids.length;G<C;G++)if(g.instvar_sids[G]===p)return G;return-1};b.prototype.getBehaviorIndexBySid=function(g,p){var C;var G=0;for(C=g.behavior_insts.length;G<C;G++)if(g.behavior_insts[G].type.sid===p)return G;return-1};b.prototype.loadInstanceFromJSON=function(g,p,C){var G,z;var J=g.type;var Q=J.plugin;if(C){if(!p.c2)return}else g.uid=p.uid;p.ex?g.extra=p.ex:cr.wipe(g.extra);if(z=p.ivs)for(G in z)if(z.hasOwnProperty(G)){var R=this.getInstanceVarIndexBySid(J,
parseInt(G,10));if(!(0>R||R>=g.instance_vars.length)){var T=z[G];null===T&&(T=NaN);g.instance_vars[R]=T}}if(Q.is_world){R=p.w;g.layer.sid!==R.l&&(z=g.layer,g.layer=this.running_layout.getLayerBySid(R.l),g.layer?(z.removeFromInstanceList(g,!0),g.layer.appendToInstanceList(g,!0),g.set_bbox_changed(),g.layer.setZIndicesStaleFrom(0)):(g.layer=z,C||this.DestroyInstance(g)));g.x=R.x;g.y=R.y;g.width=R.w;g.height=R.h;g.zindex=R.zi;g.angle=R.hasOwnProperty("a")?R.a:0;g.opacity=R.hasOwnProperty("o")?R.o:1;
g.hotspotX=R.hasOwnProperty("hX")?R.hX:.5;g.hotspotY=R.hasOwnProperty("hY")?R.hY:.5;g.visible=R.hasOwnProperty("v")?R.v:!0;g.collisionsEnabled=R.hasOwnProperty("ce")?R.ce:!0;g.my_timescale=R.hasOwnProperty("mts")?R.mts:-1;g.blend_mode=R.hasOwnProperty("bm")?R.bm:0;g.compositeOp=cr.effectToCompositeOp(g.blend_mode);this.gl&&cr.setGLBlend(g,g.blend_mode,this.gl);g.set_bbox_changed();if(R.hasOwnProperty("fx"))for(C=0,z=R.fx.length;C<z;C++)T=J.getEffectIndexByName(R.fx[C].name),0>T||(g.active_effect_flags[T]=
R.fx[C].active,g.effect_params[T]=R.fx[C].params);g.updateActiveEffects()}if(J=p.behs)for(G in J)J.hasOwnProperty(G)&&(C=this.getBehaviorIndexBySid(g,parseInt(G,10)),0>C||g.behavior_insts[C].loadFromJSON(J[G]));p.data&&g.loadFromJSON(p.data)};b.prototype.getProjectFileUrl=function(g){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(g.toLowerCase())?window.cr_previewProjectFiles[g.toLowerCase()]:g:this.files_subfolder+g};b.prototype.getProjectFileBlob=function(g){return this.isPreview?
window.cr_previewProjectFileBlobs&&window.cr_previewProjectFiles.hasOwnProperty(g.toLowerCase())?window.cr_previewProjectFileBlobs[g.toLowerCase()]:null:null};b.prototype.getLocalFileUrl=function(g){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(g.toLowerCase())?window.cr_previewProjectFiles[g.toLowerCase()]:g:g};b.prototype.fetchLocalFileViaCordova=function(g,p,C){window.resolveLocalFileSystemURL(window.cordova.file.applicationDirectory+"www/"+g,function(G){G.file(p,C)},C)};b.prototype.fetchLocalFileViaCordovaAsText=
function(g,p,C){this.fetchLocalFileViaCordova(g,function(G){var z=new FileReader;z.onload=function(J){p(J.target.result)};z.onerror=C;z.readAsText(G)},C)};var ea=[],ha=0;b.prototype.maybeStartNextArrayBufferRead=function(){if(ea.length&&!(8<=ha)){ha++;var g=ea.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(g.filename,g.successCallback,g.errorCallback)}};b.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(g,p,C){var G=this;ea.push({filename:g,successCallback:function(z){ha--;G.maybeStartNextArrayBufferRead();
p(z)},errorCallback:function(z){ha--;G.maybeStartNextArrayBufferRead();C(z)}});this.maybeStartNextArrayBufferRead()};b.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(g,p,C){this.fetchLocalFileViaCordova(g,function(G){var z=new FileReader;z.onload=function(J){p(J.target.result)};z.readAsArrayBuffer(G)},C)};b.prototype.fetchLocalFileViaCordovaAsURL=function(g,p,C){var G="",z=g.toLowerCase(),J=z.substr(z.length-4);z=z.substr(z.length-5);".mp4"===J?G="video/mp4":".webm"===z?G="video/webm":
".m4a"===J?G="audio/mp4":".mp3"===J&&(G="audio/mpeg");this.fetchLocalFileViaCordovaAsArrayBuffer(g,function(Q){Q=new Blob([Q],{type:G});Q=URL.createObjectURL(Q);p(Q)},C)};b.prototype.isAbsoluteUrl=function(g){return/^(?:[a-z]+:)?\/\//.test(g)||"data:"===g.substr(0,5)||"blob:"===g.substr(0,5)};b.prototype.setImageSrc=function(g,p){this.isWKWebView&&!this.isAbsoluteUrl(p)?this.fetchLocalFileViaCordovaAsURL(p,function(C){g.src=C},function(C){alert("Failed to load image: "+C)}):this.isPreview&&!this.isAbsoluteUrl(p)?
g.src=this.getLocalFileUrl(p):(this.isAbsoluteUrl(p)||(p=p.toLowerCase()),g.src=p)};b.prototype.getPreferredAudioFile=function(g){g=g.toLowerCase();if(!this.audio_files_map.hasOwnProperty(g))return null;g=this.audio_files_map[g];var p=null,C;var G=0;for(C=g.length;G<C;++G){var z=g[G];var J=z[0];p||"audio/webm; codecs=opus"!==J||(p=z);if(y[J])return z}return p};b.prototype.getProjectAudioFileUrl=function(g){var p=g.toLowerCase();return(g=this.getPreferredAudioFile(g))?{url:this.getProjectFileUrl(p+
g[1]),type:g[0]}:null};b.prototype.getStatusInfo=function(){return{fps:this.fps,cpu:this.cpuutilisation/1E3,gpu:this.gpuLastUtilisation,layout:this.running_layout?this.running_layout.name:"",renderer:this.glUnmaskedRenderer}};b.prototype.accelerate=function(g,p,C,G,z){return this.enhancedAccelerationPrecision?cr.clamp(g*z+.5*G*z*z,p*z,C*z):g*z};cr.runtime=b;cr.createRuntime=function(g){return new b(g)};window.cr_createRuntime=cr.createRuntime})();
window.cr_getSnapshot=function(b,l){var q=window.c3runtime;q&&q.doCanvasSnapshot(b,l)};window.cr_sizeCanvas=function(b,l){if(0!==b&&0!==l){var q=window.c3runtime;q&&q.setSize(b,l)}};window.cr_setSuspended=function(b){var l=window.c3runtime;l&&l.setSuspended(b)};
(function(){function b(a,c){return a.zindex-c.zindex}function l(a,c){this.layout=a;this.runtime=a.runtime;this.instances=[];this.scale=1;this.angle=0;this.disableAngle=!1;this.tmprect=new cr.rect(0,0,0,0);this.tmpquad=new cr.quad;this.viewBottom=this.viewTop=this.viewRight=this.viewLeft=0;this.zindices_stale=!1;this.zindices_stale_from=-1;this.clear_earlyz_index=0;this.name=c[0];this.index=c[1];this.sid=c[2];this.visible=c[3];this.background_color=c[4];this.transparent=c[5];this.parallaxX=c[6];this.parallaxY=
c[7];this.opacity=c[8];this.forceOwnTexture=c[9];this.useRenderCells=c[10];this.zoomRate=c[11];this.blend_mode=c[12];this.effect_fallback=c[13];this.compositeOp="source-over";this.destBlend=this.srcBlend=0;this.render_grid=null;this.last_render_list=q();this.render_list_stale=!0;this.last_render_cells=new cr.rect(0,0,-1,-1);this.cur_render_cells=new cr.rect(0,0,-1,-1);this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height));this.render_offscreen=
!1;a=c[14];var f;this.startup_initial_instances=[];this.initial_instances=[];this.created_globals=[];var n=0;for(f=a.length;n<f;n++){var v=a[n],y=this.runtime.types_by_index[v[1]];y.default_instance||(y.default_instance=v,y.default_layerindex=this.index);this.initial_instances.push(v);-1===this.layout.initial_types.indexOf(y)&&this.layout.initial_types.push(y)}cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances);this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=
!0;this.effect_params=[];n=0;for(f=c[15].length;n<f;n++)this.effect_types.push({id:c[15][n][0],name:c[15][n][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:n}),this.effect_params.push(c[15][n][2].slice(0));this.updateActiveEffects();this.rcTexBounce=new cr.rect(0,0,1,1);this.rcTexDest=new cr.rect(0,0,1,1);this.rcTexOrigin=new cr.rect(0,0,1,1)}function q(){return M.length?M.pop():[]}function A(a){cr.clearArray(a);M.push(a)}l.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);
this.shaders_preserve_opaqueness=!0;var a;var c=0;for(a=this.effect_types.length;c<a;c++){var f=this.effect_types[c];f.active&&(this.active_effect_types.push(f),f.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))}};l.prototype.getEffectByName=function(a){var c;var f=0;for(c=this.effect_types.length;f<c;f++){var n=this.effect_types[f];if(n.name===a)return n}return null};l.prototype.createInitialInstances=function(a){var c,f;var n=c=0;for(f=this.initial_instances.length;c<f;c++){var v=this.initial_instances[c];
var y=this.runtime.types_by_index[v[1]];var K=this.runtime.typeHasPersistBehavior(y);y=!0;if(!K||this.layout.first_visit){v=this.runtime.createInstanceFromInit(v,this,!0);if(!v)continue;a.push(v);v.type.global&&(y=!1,this.created_globals.push(v.uid))}y&&(this.initial_instances[n]=this.initial_instances[c],n++)}this.initial_instances.length=n;this.runtime.ClearDeathRow();!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback);this.compositeOp=cr.effectToCompositeOp(this.blend_mode);
this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl);this.render_list_stale=!0};l.prototype.recreateInitialObjects=function(a,c){var f,n=this.runtime.types_by_index,v=a.is_family,y=a.members;var K=0;for(f=this.initial_instances.length;K<f;++K){var u=this.initial_instances[K];var F=u[0];var D=F[0];F=F[1];if(c.contains_pt(D,F)){D=n[u[1]];if(D!==a)if(v){if(0>y.indexOf(D))continue}else continue;u=this.runtime.createInstanceFromInit(u,this,!1);this.runtime.isInOnDestroy++;this.runtime.trigger(Object.getPrototypeOf(D.plugin).cnds.OnCreated,
u);if(u.is_contained)for(D=0,F=u.siblings.length;D<F;D++){var h=u.siblings[K];this.runtime.trigger(Object.getPrototypeOf(h.type.plugin).cnds.OnCreated,h)}this.runtime.isInOnDestroy--}}};l.prototype.removeFromInstanceList=function(a,c){var f=cr.fastIndexOf(this.instances,a);0>f||(c&&this.useRenderCells&&a.rendercells&&a.rendercells.right>=a.rendercells.left&&(a.update_bbox(),this.render_grid.update(a,a.rendercells,null),a.rendercells.set(0,0,-1,-1)),f===this.instances.length-1?this.instances.pop():
(cr.arrayRemove(this.instances,f),this.setZIndicesStaleFrom(f)),this.render_list_stale=!0)};l.prototype.appendToInstanceList=function(a,c){a.zindex=this.instances.length;this.instances.push(a);c&&this.useRenderCells&&a.rendercells&&a.set_bbox_changed();this.render_list_stale=!0};l.prototype.prependToInstanceList=function(a,c){this.instances.unshift(a);this.setZIndicesStaleFrom(0);c&&this.useRenderCells&&a.rendercells&&a.set_bbox_changed()};l.prototype.moveInstanceAdjacent=function(a,c,f){var n=a.get_zindex();
c=c.get_zindex();cr.arrayRemove(this.instances,n);n<c&&c--;f&&c++;c===this.instances.length?this.instances.push(a):this.instances.splice(c,0,a);this.setZIndicesStaleFrom(n<c?n:c)};l.prototype.setZIndicesStaleFrom=function(a){-1===this.zindices_stale_from?this.zindices_stale_from=a:a<this.zindices_stale_from&&(this.zindices_stale_from=a);this.render_list_stale=this.zindices_stale=!0};l.prototype.updateZIndices=function(){if(this.zindices_stale){-1===this.zindices_stale_from&&(this.zindices_stale_from=
0);var a;if(this.useRenderCells){var c=this.zindices_stale_from;for(a=this.instances.length;c<a;++c){var f=this.instances[c];f.zindex=c;this.render_grid.markRangeChanged(f.rendercells)}}else for(c=this.zindices_stale_from,a=this.instances.length;c<a;++c)this.instances[c].zindex=c;this.zindices_stale=!1;this.zindices_stale_from=-1}};l.prototype.getScale=function(a){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||a?this.runtime.aspect_scale:1)};l.prototype.getNormalScale=function(){return(this.scale*
this.layout.scale-1)*this.zoomRate+1};l.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var M=[],x=[],m=[];l.prototype.getRenderCellInstancesToDraw=function(){this.updateZIndices();this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,m);if(!m.length)return q();if(1===m.length){var a=q();cr.shallowAssignArray(a,m[0]);cr.clearArray(m);return a}for(var c=!0;1<m.length;){var f;a=m;var n=c;var v=0;for(f=a.length;v<
f-1;v+=2){var y=a[v];var K=a[v+1];c=q();var u=y,F=K,D=c,h=0,t=0,B=0,S=u.length,V=F.length;for(D.length=S+V;h<S&&t<V;++B){var L=u[h];var d=F[t];L.zindex<d.zindex?(D[B]=L,++h):(D[B]=d,++t)}for(;h<S;++h,++B)D[B]=u[h];for(;t<V;++t,++B)D[B]=F[t];n||(A(y),A(K));x.push(c)}1===f%2&&(n?(y=q(),cr.shallowAssignArray(y,a[f-1]),x.push(y)):x.push(a[f-1]));cr.shallowAssignArray(a,x);cr.clearArray(x);c=!1}a=m[0];cr.clearArray(m);return a};l.prototype.draw=function(a){this.render_offscreen=this.forceOwnTexture||1!==
this.opacity||0!==this.blend_mode;var c=this.runtime.canvas,f=a,n=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),c=this.runtime.layer_canvas,c.width=this.runtime.draw_width,c.height=this.runtime.draw_height,this.runtime.layer_ctx=c.getContext("2d"),n=!0),c=this.runtime.layer_canvas,f=this.runtime.layer_ctx,c.width!==this.runtime.draw_width&&(c.width=this.runtime.draw_width,n=!0),c.height!==this.runtime.draw_height&&(c.height=this.runtime.draw_height,
n=!0),n&&(f.imageSmoothingEnabled=this.runtime.linearSampling),this.transparent&&f.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height));f.globalAlpha=1;f.globalCompositeOperation="source-over";this.transparent||(f.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",f.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height));f.save();this.disableAngle=!0;n=this.canvasToLayer(0,0,!0,!0);var v=this.canvasToLayer(0,0,!1,!0);this.disableAngle=
!1;this.runtime.pixel_rounding&&(n=Math.round(n),v=Math.round(v));this.rotateViewport(n,v,f);var y=this.getScale();f.scale(y,y);f.translate(-n,-v);this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?
(A(this.last_render_list),n=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):n=this.last_render_list):n=this.instances;var K=null;v=0;for(y=n.length;v<y;++v){var u=n[v];u!==K&&(this.drawInstance(u,f),K=u)}this.useRenderCells&&(this.last_render_list=n);f.restore();this.render_offscreen&&(a.globalCompositeOperation=this.compositeOp,a.globalAlpha=this.opacity,a.drawImage(c,0,0))};l.prototype.drawInstance=function(a,c){if(a.visible&&0!==
a.width&&0!==a.height){a.update_bbox();var f=a.bbox;f.right<this.viewLeft||f.bottom<this.viewTop||f.left>this.viewRight||f.top>this.viewBottom||(c.globalCompositeOperation=a.compositeOp,a.draw(c))}};l.prototype.updateViewport=function(a){this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0),f=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),f=Math.round(f));this.rotateViewport(c,f,a)};l.prototype.rotateViewport=function(a,c,f){var n=this.getScale();
this.viewLeft=a;this.viewTop=c;this.viewRight=a+1/n*this.runtime.draw_width;this.viewBottom=c+1/n*this.runtime.draw_height;a=this.getAngle();0!==a&&(f&&(f.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),f.rotate(-a),f.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,
a),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)};l.prototype.drawGL_earlyZPass=function(a){if(this.render_offscreen=this.forceOwnTexture){this.runtime.layer_tex||(this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));
if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)a.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layer_tex)}this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0),f=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),f=Math.round(f));
this.rotateViewport(c,f,null);c=this.getScale();a.resetModelView();a.scale(c,c);a.rotateZ(-this.getAngle());a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);a.updateModelView();this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),
this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(A(this.last_render_list),c=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):c=this.last_render_list):c=this.instances;var n=null;for(f=c.length-1;0<=f;--f){var v=c[f];v!==n&&(this.drawInstanceGL_earlyZPass(c[f],a),n=v)}this.useRenderCells&&(this.last_render_list=c);this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,a.setEarlyZIndex(this.clear_earlyz_index),
a.setColorFillMode(1,1,1,1),a.fullscreenQuad(),a.restoreEarlyZMode())};l.prototype.drawGL=function(a){if(this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode){this.runtime.layer_tex||(this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)a.deleteTexture(this.runtime.layer_tex),
this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layer_tex);this.transparent&&a.clear(0,0,0,0)}this.transparent||(this.runtime.enableFrontToBack?(a.setEarlyZIndex(this.clear_earlyz_index),a.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),a.fullscreenQuad(),a.setTextureFillMode()):a.clear(this.background_color[0]/255,this.background_color[1]/
255,this.background_color[2]/255,1));this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0);var f=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),f=Math.round(f));this.rotateViewport(c,f,null);c=this.getScale();a.resetModelView();a.scale(c,c);a.rotateZ(-this.getAngle());a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);a.updateModelView();this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),
this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(A(this.last_render_list),f=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):f=this.last_render_list):f=this.instances;var n,v=null;if(2.220446049250313e-16<
this.getNormalScale()){var y=0;for(n=f.length;y<n;++y){var K=f[y];K!==v&&(this.drawInstanceGL(f[y],a),v=K)}}this.useRenderCells&&(this.last_render_list=f);this.render_offscreen&&(f=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,y=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!a.programUsesCrossSampling(f)&&1===this.opacity?(1===this.active_effect_types.length?(a.switchProgram(f),
a.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,0,0,1,1,c,this.getAngle(),this.runtime.kahanTime.sum,this.effect_params[y]),a.programIsAnimated(f)&&(this.runtime.redraw=!0)):a.switchProgram(0),a.setRenderingToTexture(this.layout.getRenderTarget()),a.setOpacity(this.opacity),a.setTexture(this.runtime.layer_tex),a.setBlend(this.srcBlend,this.destBlend),a.resetModelView(),
a.updateModelView(),c=this.runtime.draw_width/2,f=this.runtime.draw_height/2,a.quad(-c,f,c,f,c,-f,-c,-f),a.setTexture(null)):this.layout.renderEffectChain(a,this,null,this.layout.getRenderTarget()))};l.prototype.drawInstanceGL=function(a,c){if(a.visible&&0!==a.width&&0!==a.height){a.update_bbox();var f=a.bbox;f.right<this.viewLeft||f.bottom<this.viewTop||f.left>this.viewRight||f.top>this.viewBottom||(c.setEarlyZIndex(a.earlyz_index),a.uses_shaders?this.drawInstanceWithShadersGL(a,c):(c.switchProgram(0),
c.setBlend(a.srcBlend,a.destBlend),a.drawGL(c)))}};l.prototype.drawInstanceGL_earlyZPass=function(a,c){if(a.visible&&0!==a.width&&0!==a.height){a.update_bbox();var f=a.bbox;f.right<this.viewLeft||f.bottom<this.viewTop||f.left>this.viewRight||f.top>this.viewBottom||(a.earlyz_index=this.runtime.earlyz_index++,0===a.blend_mode&&1===a.opacity&&a.shaders_preserve_opaqueness&&a.drawGL_earlyZPass&&(c.setEarlyZIndex(a.earlyz_index),a.drawGL_earlyZPass(c)))}};l.prototype.drawInstanceWithShadersGL=function(a,
c){var f=a.active_effect_types[0].shaderindex,n=a.active_effect_types[0].index,v=this.getScale(),y=this.runtime.draw_width,K=this.runtime.draw_height;if(1!==a.active_effect_types.length||c.programUsesCrossSampling(f)||c.programExtendsBox(f)||(a.angle||a.layer.getAngle())&&c.programUsesDest(f)||1!==a.opacity||a.type.plugin.must_predraw)this.layout.renderEffectChain(c,this,a,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),c.resetModelView(),c.scale(v,v),c.rotateZ(-this.getAngle()),
c.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),c.updateModelView();else{c.switchProgram(f);c.setBlend(a.srcBlend,a.destBlend);c.programIsAnimated(f)&&(this.runtime.redraw=!0);var u=0,F=0,D=0,h=0;c.programUsesDest(f)&&(h=a.bbox,u=this.layerToCanvas(h.left,h.top,!0,!0),F=this.layerToCanvas(h.left,h.top,!1,!0),D=this.layerToCanvas(h.right,h.bottom,!0,!0),h=this.layerToCanvas(h.right,h.bottom,!1,!0),u/=y,F=1-F/K,D/=y,h=1-h/K);K=y=0;var t=f=1,B=1/a.width,S=1/a.height;
a.curFrame&&a.curFrame.sheetTex&&(y=a.curFrame.sheetTex.left,K=a.curFrame.sheetTex.top,f=a.curFrame.sheetTex.right,t=a.curFrame.sheetTex.bottom,a.curFrame.texture_img&&(B=1/a.curFrame.texture_img.width,S=1/a.curFrame.texture_img.height));c.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),B,S,y,K,f,t,y,K,f,t,a.bbox.left,a.bbox.top,a.bbox.right,a.bbox.bottom,u,F,D,h,v,this.getAngle(),this.runtime.kahanTime.sum,a.effect_params[n]);a.drawGL(c)}};l.prototype.canvasToLayer=
function(a,c,f,n){var v=this.runtime.devicePixelRatio;this.runtime.isRetina&&(a*=v,c*=v);v=this.runtime.parallax_x_origin;var y=this.runtime.parallax_y_origin;v=(this.layout.scrollX-v)*this.parallaxX+v;y=(this.layout.scrollY-y)*this.parallaxY+y;var K=v,u=y,F=1/this.getScale(!n);n?(K-=this.runtime.draw_width*F/2,u-=this.runtime.draw_height*F/2):(K-=this.runtime.width*F/2,u-=this.runtime.height*F/2);K+=a*F;u+=c*F;c=this.getAngle();0!==c&&(K-=v,u-=y,a=Math.cos(c),c=Math.sin(c),n=K*a-u*c,u=u*a+K*c,K=
n+v,u+=y);return f?K:u};l.prototype.layerToCanvas=function(a,c,f,n){var v=this.runtime.parallax_x_origin,y=this.runtime.parallax_y_origin,K=(this.layout.scrollX-v)*this.parallaxX+v,u=(this.layout.scrollY-y)*this.parallaxY+y;y=K;v=u;var F=this.getAngle();if(0!==F){a-=K;c-=u;var D=Math.cos(-F);F=Math.sin(-F);var h=a*D-c*F;c=c*D+a*F;a=h+K;c+=u}K=1/this.getScale(!n);n?(y-=this.runtime.draw_width*K/2,v-=this.runtime.draw_height*K/2):(y-=this.runtime.width*K/2,v-=this.runtime.height*K/2);y=(a-y)/K;v=(c-
v)/K;a=this.runtime.devicePixelRatio;this.runtime.isRetina&&!n&&(y/=a,v/=a);return f?y:v};l.prototype.rotatePt=function(a,c,f){if(0===this.getAngle())return f?a:c;var n=this.layerToCanvas(a,c,!0);c=this.layerToCanvas(a,c,!1);this.disableAngle=!0;a=this.canvasToLayer(n,c,!0);n=this.canvasToLayer(n,c,!0);this.disableAngle=!1;return f?a:n};l.prototype.saveToJSON=function(){var a,c={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,
t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]};var f=0;for(a=this.effect_types.length;f<a;f++){var n=this.effect_types[f];c.fx.push({name:n.name,active:n.active,params:this.effect_params[n.index]})}return c};l.prototype.loadFromJSON=function(a){var c;this.scale=a.s;this.angle=a.a;this.viewLeft=a.vl;this.viewTop=a.vt;this.viewRight=a.vr;this.viewBottom=a.vb;this.visible=a.v;this.background_color=a.bc;this.transparent=
a.t;this.parallaxX=a.px;this.parallaxY=a.py;this.opacity=a.o;this.zoomRate=a.zr;this.created_globals=a.cg||[];cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var f=new cr.ObjectSet;var n=0;for(c=this.created_globals.length;n<c;++n)f.add(this.created_globals[n]);var v=n=0;for(c=this.initial_instances.length;n<c;++n)f.contains(this.initial_instances[n][2])||(this.initial_instances[v]=this.initial_instances[n],++v);cr.truncateArray(this.initial_instances,v);v=a.fx;n=0;for(c=
v.length;n<c;n++)if(a=this.getEffectByName(v[n].name))a.active=v[n].active,this.effect_params[a.index]=v[n].params;this.updateActiveEffects();this.instances.sort(b);this.zindices_stale=!0};cr.layer=l})();
(function(){function b(m,a){this.runtime=m;this.event_sheet=null;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;this.scale=1;this.angle=0;this.first_visit=!0;this.name=a[0];this.originalWidth=a[1];this.originalHeight=a[2];this.width=a[1];this.height=a[2];this.unbounded_scrolling=a[3];this.sheetname=a[4];this.sid=a[5];var c=a[6],f;this.layers=[];this.initial_types=[];m=0;for(f=c.length;m<f;m++){var n=new cr.layer(this,c[m]);n.number=m;cr.seal(n);this.layers.push(n)}c=
a[7];this.initial_nonworld=[];m=0;for(f=c.length;m<f;m++){n=c[m];var v=this.runtime.types_by_index[n[1]];v.default_instance||(v.default_instance=n);this.initial_nonworld.push(n);-1===this.initial_types.indexOf(v)&&this.initial_types.push(v)}this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=!0;this.effect_params=[];m=0;for(f=a[8].length;m<f;m++)this.effect_types.push({id:a[8][m][0],name:a[8][m][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:m}),this.effect_params.push(a[8][m][2].slice(0));
this.updateActiveEffects();this.rcTexBounce=new cr.rect(0,0,1,1);this.rcTexDest=new cr.rect(0,0,1,1);this.rcTexOrigin=new cr.rect(0,0,1,1);this.viewRect=new cr.rect(0,0,0,0);this.persist_data={}}function l(m,a){return m.zindex-a.zindex}function q(m){return m.some(function(a){return a.plugin.is_world})}b.prototype.saveObjectToPersist=function(m){var a=m.type.sid.toString();this.persist_data.hasOwnProperty(a)||(this.persist_data[a]=[]);this.persist_data[a].push(this.runtime.saveInstanceToJSON(m))};
b.prototype.hasOpaqueBottomLayer=function(){var m=this.layers[0];return!m.transparent&&1===m.opacity&&!m.forceOwnTexture&&m.visible};b.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);this.shaders_preserve_opaqueness=!0;var m;var a=0;for(m=this.effect_types.length;a<m;a++){var c=this.effect_types[a];c.active&&(this.active_effect_types.push(c),c.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))}};b.prototype.getEffectByName=function(m){var a;var c=0;for(a=
this.effect_types.length;c<a;c++){var f=this.effect_types[c];if(f.name===m)return f}return null};var A=[],M=!0;b.prototype.startRunning=function(){this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes());this.runtime.running_layout=this;this.width=this.originalWidth;this.height=this.originalHeight;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;var m,a;var c=0;for(m=this.runtime.types_by_index.length;c<
m;c++){var f=this.runtime.types_by_index[c];if(!f.is_family){var n=f.instances;f=0;for(a=n.length;f<a;f++){var v=n[f];if(v.layer){var y=v.layer.number;y>=this.layers.length&&(y=this.layers.length-1);v.layer=this.layers[y];-1===v.layer.instances.indexOf(v)&&v.layer.instances.push(v);v.layer.zindices_stale=!0}}}}if(!M)for(c=0,m=this.layers.length;c<m;++c)this.layers[c].instances.sort(l);cr.clearArray(A);this.boundScrolling();c=0;for(m=this.layers.length;c<m;c++)v=this.layers[c],v.createInitialInstances(A),
v.updateViewport(null);n=!1;if(!this.first_visit){for(K in this.persist_data)if(this.persist_data.hasOwnProperty(K)&&(f=this.runtime.getObjectTypeBySid(parseInt(K,10)))&&!f.is_family&&this.runtime.typeHasPersistBehavior(f)){a=this.persist_data[K];c=0;for(m=a.length;c<m;c++){v=null;if(f.plugin.is_world&&(v=this.getLayerBySid(a[c].w.l),!v))continue;v=this.runtime.createInstanceFromInit(f.default_instance,v,!1,0,0,!0);this.runtime.loadInstanceFromJSON(v,a[c]);n=!0;A.push(v)}cr.clearArray(a)}c=0;for(m=
this.layers.length;c<m;c++)this.layers[c].instances.sort(l),this.layers[c].zindices_stale=!0}n&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap());this.createAndLinkContainerInstances(A);c=0;for(m=this.initial_nonworld.length;c<m;c++){var K=this.initial_nonworld[c];f=this.runtime.types_by_index[K[1]];f.is_contained||this.runtime.createInstanceFromInit(this.initial_nonworld[c],null,!0)}this.runtime.changelayout=null;this.runtime.ClearDeathRow();if(this.runtime.ctx)for(c=0,m=this.runtime.types_by_index.length;c<
m;c++)K=this.runtime.types_by_index[c],!K.is_family&&K.instances.length&&K.preloadCanvas2D&&K.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,A);else for(c=0,m=A.length;c<m;c++)v=A[c],this.runtime.trigger(Object.getPrototypeOf(v.type.plugin).cnds.OnCreated,v);cr.clearArray(A);this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null);this.first_visit=!1};b.prototype.createAndLinkContainerInstances=
function(m){var a,c;for(a=0;a<m.length;a++){var f=m[a];if(f.type.is_contained){var n=f.get_iid();var v=0;for(c=f.type.container.length;v<c;v++){var y=f.type.container[v];if(f.type!==y)if(y.instances.length>n)f.siblings.push(y.instances[n]);else if(y.default_instance){var K=this.runtime.createInstanceFromInit(y.default_instance,f.layer,!0,f.x,f.y,!0);this.runtime.ClearDeathRow();y.updateIIDs();f.siblings.push(K);m.push(K)}}}}};b.prototype.createGlobalNonWorlds=function(){var m,a,c=[];var f=m=0;for(a=
this.initial_nonworld.length;m<a;m++){var n=this.initial_nonworld[m];var v=this.runtime.types_by_index[n[1]];v.global?v.is_contained&&q(v.container)||c.push(this.runtime.createInstanceFromInit(n,null,!0)):(this.initial_nonworld[f]=n,f++)}cr.truncateArray(this.initial_nonworld,f);this.runtime.ClearDeathRow();this.createAndLinkContainerInstances(c)};b.prototype.stopRunning=function(){this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null);this.runtime.isEndingLayout=
!0;cr.clearArray(this.runtime.system.waits);var m,a;if(!this.first_visit){var c=0;for(m=this.layers.length;c<m;c++){this.layers[c].updateZIndices();var f=this.layers[c].instances;var n=0;for(a=f.length;n<a;n++){var v=f[n];v.type.global||this.runtime.typeHasPersistBehavior(v.type)&&this.saveObjectToPersist(v)}}}c=0;for(m=this.layers.length;c<m;c++){f=this.layers[c].instances;n=0;for(a=f.length;n<a;n++)v=f[n],v.type.global||this.runtime.DestroyInstance(v);this.runtime.ClearDeathRow();cr.clearArray(f);
this.layers[c].zindices_stale=!0}c=0;for(m=this.runtime.types_by_index.length;c<m;c++)if(f=this.runtime.types_by_index[c],!(f.global||f.plugin.is_world||f.plugin.singleglobal||f.is_family)){n=0;for(a=f.instances.length;n<a;n++)this.runtime.DestroyInstance(f.instances[n]);this.runtime.ClearDeathRow()}M=!1;this.runtime.isEndingLayout=!1};var x=new cr.rect(0,0,0,0);b.prototype.recreateInitialObjects=function(m,a,c,f,n){x.set(a,c,f,n);a=0;for(c=this.layers.length;a<c;a++)this.layers[a].recreateInitialObjects(m,
x)};b.prototype.draw=function(m){var a=m,c=!1,f=!this.runtime.fullscreenScalingQuality;if(f){if(!this.runtime.layout_canvas){this.runtime.layout_canvas=document.createElement("canvas");var n=this.runtime.layout_canvas;n.width=this.runtime.draw_width;n.height=this.runtime.draw_height;this.runtime.layout_ctx=n.getContext("2d");c=!0}n=this.runtime.layout_canvas;a=this.runtime.layout_ctx;n.width!==this.runtime.draw_width&&(n.width=this.runtime.draw_width,c=!0);n.height!==this.runtime.draw_height&&(n.height=
this.runtime.draw_height,c=!0);c&&(a.imageSmoothingEnabled=this.runtime.linearSampling)}a.globalAlpha=1;a.globalCompositeOperation="source-over";this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&a.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height);var v;c=0;for(v=this.layers.length;c<v;c++){var y=this.layers[c];y.visible&&0<y.opacity&&11!==y.blend_mode&&(y.instances.length||!y.transparent)?y.draw(a):y.updateViewport(null)}f&&m.drawImage(n,0,0,this.runtime.width,this.runtime.height)};
b.prototype.drawGL_earlyZPass=function(m){m.setEarlyZPass(!0);this.runtime.layout_tex||(this.runtime.layout_tex=m.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)m.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=m.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);m.setRenderingToTexture(this.runtime.layout_tex);
this.runtime.fullscreenScalingQuality||m.setSize(this.runtime.draw_width,this.runtime.draw_height);var a;for(a=this.layers.length-1;0<=a;--a){var c=this.layers[a];c.visible&&1===c.opacity&&c.shaders_preserve_opaqueness&&0===c.blend_mode&&(c.instances.length||!c.transparent)?c.drawGL_earlyZPass(m):c.updateViewport(null)}m.setEarlyZPass(!1)};b.prototype.drawGL=function(m){var a=0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;
if(a){this.runtime.layout_tex||(this.runtime.layout_tex=m.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)m.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=m.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);m.setRenderingToTexture(this.runtime.layout_tex);this.runtime.fullscreenScalingQuality||
m.setSize(this.runtime.draw_width,this.runtime.draw_height)}else this.runtime.layout_tex&&(m.setRenderingToTexture(null),m.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null);this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&m.clear(0,0,0,0);var c;var f=0;for(c=this.layers.length;f<c;f++){var n=this.layers[f];n.visible&&0<n.opacity&&(n.instances.length||!n.transparent)?n.drawGL(m):n.updateViewport(null)}a&&(0===this.active_effect_types.length||1===this.active_effect_types.length&&
this.runtime.fullscreenScalingQuality?(1===this.active_effect_types.length?(a=this.active_effect_types[0].index,f=this.calculateViewRect(),m.switchProgram(this.active_effect_types[0].shaderindex),m.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,f.left,f.top,f.right,f.bottom,0,0,1,1,this.scale,this.angle,this.runtime.kahanTime.sum,this.effect_params[a]),m.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)):m.switchProgram(0),
this.runtime.fullscreenScalingQuality||m.setSize(this.runtime.width,this.runtime.height),m.setRenderingToTexture(null),m.setDepthTestEnabled(!1),m.setOpacity(1),m.setTexture(this.runtime.layout_tex),m.setAlphaBlend(),m.resetModelView(),m.updateModelView(),a=this.runtime.width/2,f=this.runtime.height/2,m.quad(-a,f,a,f,a,-f,-a,-f),m.setTexture(null),m.setDepthTestEnabled(!0)):this.renderEffectChain(m,null,null,null))};b.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||
this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null};b.prototype.getMinLayerScale=function(){var m=this.layers[0].getScale(),a;var c=1;for(a=this.layers.length;c<a;c++){var f=this.layers[c];(0!==f.parallaxX||0!==f.parallaxY)&&f.getScale()<m&&(m=f.getScale())}return m};b.prototype.scrollToX=function(m){if(!this.unbounded_scrolling){var a=this.runtime.draw_width*(1/this.getMinLayerScale())/2;m>this.width-a&&(m=this.width-
a);m<a&&(m=a)}this.scrollX!==m&&(this.scrollX=m,this.runtime.redraw=!0)};b.prototype.scrollToY=function(m){if(!this.unbounded_scrolling){var a=this.runtime.draw_height*(1/this.getMinLayerScale())/2;m>this.height-a&&(m=this.height-a);m<a&&(m=a)}this.scrollY!==m&&(this.scrollY=m,this.runtime.redraw=!0)};b.prototype.boundScrolling=function(){this.scrollToX(this.scrollX);this.scrollToY(this.scrollY)};b.prototype.calculateViewRect=function(){var m=this.scrollX,a=this.scrollY,c=1/(this.scale*this.runtime.aspect_scale);
m-=this.runtime.width*c/2;a-=this.runtime.height*c/2;this.viewRect.set(m,a,m+this.runtime.draw_width*c,a+this.runtime.draw_height*c);return this.viewRect};b.prototype.renderEffectChain=function(m,a,c,f){var n=c?c.active_effect_types:a?a.active_effect_types:this.active_effect_types;if(c){var v=c.layer.getScale();var y=c.layer.getAngle();var K=c.layer.viewLeft;var u=c.layer.viewTop;var F=c.layer.viewRight;var D=c.layer.viewBottom}else a?(v=a.getScale(),y=a.getAngle(),K=a.viewLeft,u=a.viewTop,F=a.viewRight,
D=a.viewBottom):(v=this.scale,y=this.angle,D=this.calculateViewRect(),K=D.left,u=D.top,F=D.right,D=D.bottom);var h=this.runtime.fx_tex,t,B,S=0,V=1,L=this.runtime.draw_width,d=this.runtime.draw_height,k=L/2,E=d/2,e=a?a.rcTexBounce:this.rcTexBounce,w=a?a.rcTexDest:this.rcTexDest,I=a?a.rcTexOrigin:this.rcTexOrigin,N=0,U=0,W=0,X=0,Y=L,ea=L,ha=d,g=d,p=B=0,C=c?c.layer.getAngle():0;if(c){var G=0;for(t=n.length;G<t;G++)B+=m.getProgramBoxExtendHorizontal(n[G].shaderindex),p+=m.getProgramBoxExtendVertical(n[G].shaderindex);
X=c.bbox;N=a.layerToCanvas(X.left,X.top,!0,!0);W=a.layerToCanvas(X.left,X.top,!1,!0);Y=a.layerToCanvas(X.right,X.bottom,!0,!0);ha=a.layerToCanvas(X.right,X.bottom,!1,!0);if(0!==C){G=a.layerToCanvas(X.right,X.top,!0,!0);t=a.layerToCanvas(X.right,X.top,!1,!0);U=a.layerToCanvas(X.left,X.bottom,!0,!0);X=a.layerToCanvas(X.left,X.bottom,!1,!0);var z=Math.min(N,Y,G,U);Y=Math.max(N,Y,G,U);N=z;z=Math.min(W,ha,t,X);ha=Math.max(W,ha,t,X);W=z}I.left=N/L;I.top=1-W/d;I.right=Y/L;I.bottom=1-ha/d;N-=B;W-=p;Y+=B;
ha+=p;w.left=N/L;w.top=1-W/d;w.right=Y/L;w.bottom=1-ha/d;U=N=cr.floor(N);X=W=cr.floor(W);ea=Y=cr.ceil(Y);g=ha=cr.ceil(ha);U-=B;X-=p;ea+=B;g+=p;0>N&&(N=0);0>W&&(W=0);Y>L&&(Y=L);ha>d&&(ha=d);0>U&&(U=0);0>X&&(X=0);ea>L&&(ea=L);g>d&&(g=d);e.left=N/L;e.top=1-W/d;e.right=Y/L;e.bottom=1-ha/d}else e.left=w.left=I.left=0,e.top=w.top=I.top=0,e.right=w.right=I.right=1,e.bottom=w.bottom=1;p=c&&(m.programUsesDest(n[0].shaderindex)||0!==B||0!==p||1!==c.opacity||c.type.plugin.must_predraw)||a&&!c&&1!==a.opacity;
m.setAlphaBlend();if(p){h[S]||(h[S]=m.createEmptyTexture(L,d,this.runtime.linearSampling));if(h[S].c2width!==L||h[S].c2height!==d)m.deleteTexture(h[S]),h[S]=m.createEmptyTexture(L,d,this.runtime.linearSampling);m.switchProgram(0);m.setRenderingToTexture(h[S]);var J=g-X;m.clearRect(U,d-X-J,ea-U,J);c?c.drawGL(m):(m.setTexture(this.runtime.layer_tex),m.setOpacity(a.opacity),m.resetModelView(),m.translate(-k,-E),m.updateModelView(),m.quadTex(N,ha,Y,ha,Y,W,N,W,e));w.left=w.top=0;w.right=w.bottom=1;c&&
(z=e.top,e.top=e.bottom,e.bottom=z);S=1;V=0}m.setOpacity(1);B=n.length-1;C=m.programUsesCrossSampling(n[B].shaderindex)||!a&&!c&&!this.runtime.fullscreenScalingQuality;G=0;for(t=n.length;G<t;G++){h[S]||(h[S]=m.createEmptyTexture(L,d,this.runtime.linearSampling));if(h[S].c2width!==L||h[S].c2height!==d)m.deleteTexture(h[S]),h[S]=m.createEmptyTexture(L,d,this.runtime.linearSampling);m.switchProgram(n[G].shaderindex);z=n[G].index;m.programIsAnimated(n[G].shaderindex)&&(this.runtime.redraw=!0);if(0!=G||
p){m.setProgramParameters(f,1/L,1/d,0,0,1,1,I.left,I.top,I.right,I.bottom,K,u,F,D,w.left,w.top,w.right,w.bottom,v,y,this.runtime.kahanTime.sum,c?c.effect_params[z]:a?a.effect_params[z]:this.effect_params[z]);m.setTexture(null);if(G!==B||C){m.setRenderingToTexture(h[S]);J=g-X;var Q=d-X-J;m.clearRect(U,Q,ea-U,J)}else c?m.setBlend(c.srcBlend,c.destBlend):a&&m.setBlend(a.srcBlend,a.destBlend),m.setRenderingToTexture(f);m.setTexture(h[V]);m.resetModelView();m.translate(-k,-E);m.updateModelView();m.quadTex(N,
ha,Y,ha,Y,W,N,W,e);G!==B||C||m.setTexture(null)}else{m.setRenderingToTexture(h[S]);J=g-X;Q=d-X-J;m.clearRect(U,Q,ea-U,J);if(c){Q=V=0;var R=J=1,T=1/c.width,fa=1/c.height;c.curFrame&&c.curFrame.sheetTex&&(V=c.curFrame.sheetTex.left,Q=c.curFrame.sheetTex.top,J=c.curFrame.sheetTex.right,R=c.curFrame.sheetTex.bottom,c.curFrame.texture_img&&(T=1/c.curFrame.texture_img.width,fa=1/c.curFrame.texture_img.height));m.setProgramParameters(f,T,fa,V,Q,J,R,V,Q,J,R,c.bbox.left,c.bbox.top,c.bbox.right,c.bbox.bottom,
w.left,w.top,w.right,w.bottom,v,y,this.runtime.kahanTime.sum,c.effect_params[z]);c.drawGL(m)}else m.setProgramParameters(f,1/L,1/d,0,0,1,1,0,0,1,1,K,u,F,D,0,0,1,1,v,y,this.runtime.kahanTime.sum,a?a.effect_params[z]:this.effect_params[z]),m.setTexture(a?this.runtime.layer_tex:this.runtime.layout_tex),m.resetModelView(),m.translate(-k,-E),m.updateModelView(),m.quadTex(N,ha,Y,ha,Y,W,N,W,e);w.left=w.top=0;w.right=w.bottom=1;c&&!C&&(z=ha,ha=W,W=z)}S=0===S?1:0;V=0===S?1:0}C&&(m.switchProgram(0),c?m.setBlend(c.srcBlend,
c.destBlend):a?m.setBlend(a.srcBlend,a.destBlend):this.runtime.fullscreenScalingQuality||(m.setSize(this.runtime.width,this.runtime.height),k=this.runtime.width/2,E=this.runtime.height/2,W=N=0,Y=this.runtime.width,ha=this.runtime.height),m.setRenderingToTexture(f),m.setTexture(h[V]),m.resetModelView(),m.translate(-k,-E),m.updateModelView(),c&&1===n.length&&!p?m.quadTex(N,W,Y,W,Y,ha,N,ha,e):m.quadTex(N,ha,Y,ha,Y,W,N,W,e),m.setTexture(null))};b.prototype.getLayerBySid=function(m){var a;var c=0;for(a=
this.layers.length;c<a;c++)if(this.layers[c].sid===m)return this.layers[c];return null};b.prototype.saveToJSON=function(){var m,a={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}};var c=0;for(m=this.effect_types.length;c<m;c++){var f=this.effect_types[c];a.fx.push({name:f.name,active:f.active,params:this.effect_params[f.index]})}c=0;for(m=this.layers.length;c<m;c++)f=this.layers[c],a.layers[f.sid.toString()]=
f.saveToJSON();return a};b.prototype.loadFromJSON=function(m){var a,c,f;this.scrollX=m.sx;this.scrollY=m.sy;this.scale=m.s;this.angle=m.a;this.width=m.w;this.height=m.h;this.persist_data=m.persist;"undefined"!==typeof m.fv&&(this.first_visit=m.fv);var n=m.fx;var v=0;for(a=n.length;v<a;v++)if(c=this.getEffectByName(n[v].name))c.active=n[v].active,this.effect_params[c.index]=n[v].params;this.updateActiveEffects();v=m.layers;for(f in v)v.hasOwnProperty(f)&&(m=this.getLayerBySid(parseInt(f,10)))&&m.loadFromJSON(v[f])};
cr.layout=b})();
(function(){function b(h,t){var B,S=h.length;switch(S){case 0:return!0;case 1:return h[0]===t[0];case 2:return h[0]===t[0]&&h[1]===t[1];default:for(B=0;B<S;B++)if(h[B]!==t[B])return!1;return!0}}function l(h,t){return h.index-t.index}function q(h){var t;if(2===h.length){if(h[0].index>h[1].index){var B=h[0];h[0]=h[1];h[1]=B}}else 2<h.length&&h.sort(l);h.length>=u.length&&(u.length=h.length+1);u[h.length]||(u[h.length]=[]);var S=u[h.length];B=0;for(t=S.length;B<t;B++){var V=S[B];if(b(h,V))return V}S.push(h);
return h}function A(h,t){this.runtime=h;this.triggers={};this.fasttriggers={};this.hasRun=!1;this.includes=new cr.ObjectSet;this.deep_includes=[];this.already_included_sheets=[];this.name=t[0];h=t[1];this.events=[];var B;t=0;for(B=h.length;t<B;t++)this.init_event(h[t],null,this.events)}function M(h){this.type=h;this.instances=[];this.else_instances=[];this.select_all=!0}function x(h,t,B){this.sheet=h;this.parent=t;this.runtime=h.runtime;this.solModifiers=[];this.solModifiersIncludingParents=[];this.has_else_block=
this.toplevelgroup=this.toplevelevent=this.initially_activated=this.group=this.solWriterAfterCnds=!1;this.conditions=[];this.actions=[];this.subevents=[];this.group_name="";this.group_active=this.initially_activated=this.group=!1;this.contained_includes=null;3===B[0]&&(this.group_name=B[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!B[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=
this);this.orblock=B[2];this.sid=B[4];this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var S=B[6];h=0;for(t=S.length;h<t;h++){var V=new cr.condition(this,S[h]);V.index=h;cr.seal(V);this.conditions.push(V);this.addSolModifier(V.type)}S=B[7];h=0;for(t=S.length;h<t;h++)V=new cr.action(this,S[h]),V.index=h,cr.seal(V),this.actions.push(V);if(9===B.length)for(B=B[8],h=0,t=B.length;h<t;h++)this.sheet.init_event(B[h],this,this.subevents);this.is_else_block=!1;this.conditions.length&&(this.is_else_block=
null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function m(h,t){var B;if(h&&(-1===t.indexOf(h)&&t.push(h),h.is_contained)){var S=0;for(B=h.container.length;S<B;S++){var V=h.container[S];h!==V&&-1===t.indexOf(V)&&t.push(V)}}}function a(h,t){this.block=h;this.sheet=h.sheet;this.runtime=h.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=!1;this.func=this.runtime.GetObjectReference(t[1]);this.trigger=0<
t[3];this.fasttrigger=2===t[3];this.looping=t[4];this.inverted=t[5];this.isstatic=t[6];this.sid=t[7];this.runtime.cndsBySid[this.sid.toString()]=this;-1===t[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[t[0]],this.run=this.isstatic?this.run_static:this.run_object,t[2]?(this.behaviortype=this.type.getBehaviorByName(t[2]),this.beh_index=this.type.getBehaviorIndexByName(t[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&
this.block.parent.setSolWriterAfterCnds());this.fasttrigger&&(this.run=this.run_true);if(10===t.length){var B=t[9];h=0;for(t=B.length;h<t;h++){var S=new cr.parameter(this,B[h]);cr.seal(S);this.parameters.push(S)}this.results.length=B.length}}function c(h,t){this.block=h;this.sheet=h.sheet;this.runtime=h.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=!1;this.func=this.runtime.GetObjectReference(t[1]);-1===t[0]?(this.type=null,this.run=this.run_system,
this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[t[0]],this.run=this.run_object,t[2]?(this.behaviortype=this.type.getBehaviorByName(t[2]),this.beh_index=this.type.getBehaviorIndexByName(t[2])):(this.behaviortype=null,this.beh_index=-1));this.sid=t[3];this.runtime.actsBySid[this.sid.toString()]=this;if(7===t.length){var B=t[6];h=0;for(t=B.length;h<t;h++){var S=new cr.parameter(this,B[h]);cr.seal(S);this.parameters.push(S)}this.results.length=B.length}}function f(){D++;
F.length===D&&F.push(new cr.expvalue);return F[D]}function n(h,t){this.owner=h;this.block=h.block;this.sheet=h.sheet;this.runtime=h.runtime;this.type=t[0];this.expression=null;this.solindex=0;this.get=null;this.combosel=0;this.layout=null;this.key=0;this.object=null;this.index=0;this.variadicret=this.subparams=this.fileinfo=this.eventvar=this.varname=null;this.variesPerInstance=!1;var B;switch(this.type){case 0:case 7:this.expression=new cr.expNode(this,t[1]);this.solindex=0;this.get=this.get_exp;
break;case 1:case 14:this.expression=new cr.expNode(this,t[1]);this.solindex=0;this.get=this.get_exp_str;14===this.type&&(this.block.setAllSolModifiers(),this.owner instanceof cr.action&&this.block.setSolWriterAfterCnds());break;case 5:this.expression=new cr.expNode(this,t[1]);this.solindex=0;this.get=this.get_layer;break;case 3:case 8:this.combosel=t[1];this.get=this.get_combosel;break;case 16:this.combosel=t[1]?1:0;this.get=this.get_boolean;break;case 6:this.layout=this.runtime.layouts[t[1]];this.get=
this.get_layout;break;case 9:this.key=t[1];this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[t[1]];this.get=this.get_object;this.block.addSolModifier(this.object);this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=t[1];h.type&&h.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=t[1];this.eventvar=null;
this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=t[1];this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],h=1,B=t.length;h<B;h++){var S=new cr.parameter(this.owner,t[h]);cr.seal(S);this.subparams.push(S);this.variadicret.push(0)}}}function v(h,t,B){this.sheet=h;this.parent=t;this.runtime=h.runtime;this.solModifiers=[];this.name=B[1];this.vartype=B[2];this.initial=B[3];this.is_static=!!B[4];this.is_constant=!!B[5];this.sid=B[6];
this.runtime.varsBySid[this.sid.toString()]=this;this.data=this.initial;this.parent?(this.localIndex=this.is_static||this.is_constant?-1:this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function y(h,t,B){this.sheet=h;this.parent=t;this.runtime=h.runtime;this.solModifiers=[];this.include_sheet=null;this.include_sheet_name=B[1];this.active=!0}function K(){this.temp_parents_arr=[];this.reset(null);cr.seal(this)}var u=
[];A.prototype.toString=function(){return this.name};A.prototype.init_event=function(h,t,B){switch(h[0]){case 0:case 3:h=new cr.eventblock(this,t,h);cr.seal(h);if(h.orblock)for(B.push(h),B=0,t=h.conditions.length;B<t;B++)h.conditions[B].trigger&&this.init_trigger(h,B);else h.is_trigger()?this.init_trigger(h,0):B.push(h);break;case 1:h=new cr.eventvariable(this,t,h);cr.seal(h);B.push(h);break;case 2:h=new cr.eventinclude(this,t,h),cr.seal(h),B.push(h)}};A.prototype.postInit=function(){var h;var t=
0;for(h=this.events.length;t<h;t++)this.events[t].postInit(t<h-1&&this.events[t+1].is_else_block)};A.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes);cr.clearArray(this.already_included_sheets);this.addDeepIncludes(this);cr.clearArray(this.already_included_sheets)};A.prototype.addDeepIncludes=function(h){var t,B=h.deep_includes,S=h.already_included_sheets,V=this.includes.valuesRef();var L=0;for(t=V.length;L<t;++L){var d=V[L];var k=d.include_sheet;!d.isActive()||h===k||-1<
S.indexOf(k)||(S.push(k),k.addDeepIncludes(h),B.push(k))}};A.prototype.run=function(h){this.runtime.resuming_breakpoint||(this.hasRun=!0,h||(this.runtime.isRunningEvents=!0));var t;var B=0;for(t=this.events.length;B<t;B++){var S=this.events[B];S.run();this.runtime.clearSol(S.solModifiers);this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}h||(this.runtime.isRunningEvents=!1)};A.prototype.init_trigger=function(h,t){h.orblock||this.runtime.triggers_to_postinit.push(h);var B,S,V=h.conditions[t];
var L=V.type?V.type.name:"system";var d=(B=V.fasttrigger)?this.fasttriggers:this.triggers;d[L]||(d[L]=[]);L=d[L];d=V.func;if(B){if(V.parameters.length&&(V=V.parameters[0],1===V.type&&2===V.expression.type)){V=V.expression.value.toLowerCase();B=0;for(S=L.length;B<S;B++)if(L[B].method==d){B=L[B].evs;B[V]?B[V].push([h,t]):B[V]=[[h,t]];return}B={};B[V]=[[h,t]];L.push({method:d,evs:B})}}else{B=0;for(S=L.length;B<S;B++)if(L[B].method==d){L[B].evs.push([h,t]);return}V=cr.plugins_.Sprite&&d===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged?
!0:!1;V?L.unshift({method:d,evs:[[h,t]]}):L.push({method:d,evs:[[h,t]]})}};cr.eventsheet=A;M.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length};M.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances};M.prototype.pick_one=function(h){h&&(h.runtime.getCurrentEventStack().current_event.orblock?(this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,h.type.instances),this.select_all=
!1),h=this.else_instances.indexOf(h),-1!==h&&(this.instances.push(this.else_instances[h]),this.else_instances.splice(h,1))):(this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=h))};cr.selection=M;x.prototype.postInit=function(h){var t,B=this.parent;if(this.group)for(this.toplevelgroup=!0;B;){if(!B.group){this.toplevelgroup=!1;break}B=B.parent}this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup);this.has_else_block=!!h;B=this.runtime.types_by_index;
if(this.solModifiers===B)this.solModifiersIncludingParents=B;else{this.solModifiersIncludingParents=this.solModifiers.slice(0);for(B=this.parent;B;){h=0;for(t=B.solModifiers.length;h<t;h++)this.addParentSolModifier(B.solModifiers[h]);B=B.parent}this.solModifiers=q(this.solModifiers);this.solModifiersIncludingParents=q(this.solModifiersIncludingParents)}h=0;for(t=this.conditions.length;h<t;h++)this.conditions[h].postInit();h=0;for(t=this.actions.length;h<t;h++)this.actions[h].postInit();h=0;for(t=
this.subevents.length;h<t;h++)this.subevents[h].postInit(h<t-1&&this.subevents[h+1].is_else_block)};x.prototype.setGroupActive=function(h){if(this.group_active!==!!h){this.group_active=!!h;var t;h=0;for(t=this.contained_includes.length;h<t;++h)this.contained_includes[h].updateActive();0<t&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}};x.prototype.addSolModifier=function(h){m(h,this.solModifiers)};x.prototype.addParentSolModifier=function(h){m(h,
this.solModifiersIncludingParents)};x.prototype.setAllSolModifiers=function(){this.solModifiers=this.runtime.types_by_index};x.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0;this.parent&&this.parent.setSolWriterAfterCnds()};x.prototype.is_trigger=function(){return this.conditions.length?this.conditions[0].trigger:!1};x.prototype.run=function(){var h,t=!1,B=this.runtime,S=this.runtime.getCurrentEventStack();S.current_event=this;var V=this.conditions;this.is_else_block||(S.else_branch_ran=
!1);if(this.orblock){0===V.length&&(t=!0);S.cndindex=0;for(h=V.length;S.cndindex<h;S.cndindex++){var L=V[S.cndindex];L.trigger||(L=L.run())&&(t=!0)}(S.last_event_true=t)&&this.run_actions_and_subevents()}else{S.cndindex=0;for(h=V.length;S.cndindex<h;S.cndindex++)if(L=V[S.cndindex].run(),!L){S.last_event_true=!1;this.toplevelevent&&B.hasPendingInstances&&B.ClearDeathRow();return}S.last_event_true=!0;this.run_actions_and_subevents()}this.end_run(S)};x.prototype.end_run=function(h){h.last_event_true&&
this.has_else_block&&(h.else_branch_ran=!0);this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()};x.prototype.run_orblocktrigger=function(h){this.runtime.getCurrentEventStack().current_event=this;this.conditions[h].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)};x.prototype.run_actions_and_subevents=function(){var h=this.runtime.getCurrentEventStack(),t;h.actindex=0;for(t=this.actions.length;h.actindex<t;h.actindex++)if(this.actions[h.actindex].run())return;
this.run_subevents()};x.prototype.resume_actions_and_subevents=function(){var h=this.runtime.getCurrentEventStack(),t;for(t=this.actions.length;h.actindex<t;h.actindex++)if(this.actions[h.actindex].run())return;this.run_subevents()};x.prototype.run_subevents=function(){if(this.subevents.length){var h,t,B=this.subevents.length-1;this.runtime.pushEventStack(this);if(this.solWriterAfterCnds){var S=0;for(h=this.subevents.length;S<h;S++){var V=this.subevents[S];(t=!this.toplevelgroup||!this.group&&S<B)&&
this.runtime.pushCopySol(V.solModifiers);V.run();t?this.runtime.popSol(V.solModifiers):this.runtime.clearSol(V.solModifiers)}}else for(S=0,h=this.subevents.length;S<h;S++)this.subevents[S].run();this.runtime.popEventStack()}};x.prototype.run_pretrigger=function(){var h=this.runtime.getCurrentEventStack();h.current_event=this;var t=!1,B;h.cndindex=0;for(B=this.conditions.length;h.cndindex<B;h.cndindex++)if(this.conditions[h.cndindex].run())t=!0;else if(!this.orblock)return!1;return this.orblock?t:
!0};x.prototype.retrigger=function(){this.runtime.execcount++;var h=this.runtime.getCurrentEventStack().cndindex,t=this.runtime.pushEventStack(this);if(!this.orblock)for(t.cndindex=h+1,h=this.conditions.length;t.cndindex<h;t.cndindex++)if(!this.conditions[t.cndindex].run())return this.runtime.popEventStack(),!1;this.run_actions_and_subevents();this.runtime.popEventStack();return!0};x.prototype.isFirstConditionOfType=function(h){var t=h.index;if(0===t)return!0;for(--t;0<=t;--t)if(this.conditions[t].type===
h.type)return!1;return!0};cr.eventblock=x;a.prototype.postInit=function(){var h;var t=0;for(h=this.parameters.length;t<h;t++){var B=this.parameters[t];B.postInit();B.variesPerInstance&&(this.anyParamVariesPerInstance=!0)}};a.prototype.run_true=function(){return!0};a.prototype.run_system=function(){var h;var t=0;for(h=this.parameters.length;t<h;t++)this.results[t]=this.parameters[t].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)};a.prototype.run_static=function(){var h;
var t=0;for(h=this.parameters.length;t<h;t++)this.results[t]=this.parameters[t].get();t=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);this.type.applySolToContainer();return t};a.prototype.run_object=function(){var h,t,B,S=this.type,V=S.getCurrentSol(),L=this.block.orblock&&!this.trigger,d=S.is_contained,k=S.is_family,E=S.family_index,e=this.beh_index,w=-1<e,I=this.anyParamVariesPerInstance,N=this.parameters,U=this.results,W=this.inverted,X=this.func;if(I){var Y=0;for(t=
N.length;Y<t;++Y){var ea=N[Y];ea.variesPerInstance||(U[Y]=ea.get(0))}}else for(Y=0,t=N.length;Y<t;++Y)U[Y]=N[Y].get(0);if(V.select_all){cr.clearArray(V.instances);cr.clearArray(V.else_instances);var ha=S.instances;var g=0;for(h=ha.length;g<h;++g){var p=ha[g];if(I)for(Y=0,t=N.length;Y<t;++Y)ea=N[Y],ea.variesPerInstance&&(U[Y]=ea.get(g));w?(Y=0,k&&(Y=p.type.family_beh_map[E]),Y=X.apply(p.behavior_insts[e+Y],U)):Y=X.apply(p,U);(B=cr.xor(Y,W))?V.instances.push(p):L&&V.else_instances.push(p)}S.finish&&
S.finish(!0);V.select_all=!1;S.applySolToContainer();return V.hasObjects()}var C=0;ha=(B=L&&!this.block.isFirstConditionOfType(this))?V.else_instances:V.instances;var G=!1;g=0;for(h=ha.length;g<h;++g){p=ha[g];if(I)for(Y=0,t=N.length;Y<t;++Y)ea=N[Y],ea.variesPerInstance&&(U[Y]=ea.get(g));w?(Y=0,k&&(Y=p.type.family_beh_map[E]),Y=X.apply(p.behavior_insts[e+Y],U)):Y=X.apply(p,U);if(cr.xor(Y,W))if(G=!0,B){if(V.instances.push(p),d)for(Y=0,t=p.siblings.length;Y<t;Y++)ea=p.siblings[Y],ea.type.getCurrentSol().instances.push(ea)}else{ha[C]=
p;if(d)for(Y=0,t=p.siblings.length;Y<t;Y++)ea=p.siblings[Y],ea.type.getCurrentSol().instances[C]=ea;C++}else if(B){ha[C]=p;if(d)for(Y=0,t=p.siblings.length;Y<t;Y++)ea=p.siblings[Y],ea.type.getCurrentSol().else_instances[C]=ea;C++}else if(L&&(V.else_instances.push(p),d))for(Y=0,t=p.siblings.length;Y<t;Y++)ea=p.siblings[Y],ea.type.getCurrentSol().else_instances.push(ea)}cr.truncateArray(ha,C);if(d)for(k=S.container,g=0,h=k.length;g<h;g++)p=k[g].getCurrentSol(),B?cr.truncateArray(p.else_instances,C):
cr.truncateArray(p.instances,C);C=G;if(B&&!G)for(g=0,h=V.instances.length;g<h;g++){p=V.instances[g];if(I)for(Y=0,t=N.length;Y<t;Y++)ea=N[Y],ea.variesPerInstance&&(U[Y]=ea.get(g));Y=w?X.apply(p.behavior_insts[e],U):X.apply(p,U);if(cr.xor(Y,W)){G=!0;break}}S.finish&&S.finish(C||L);return L?G:V.hasObjects()};cr.condition=a;c.prototype.postInit=function(){var h;var t=0;for(h=this.parameters.length;t<h;t++){var B=this.parameters[t];B.postInit();B.variesPerInstance&&(this.anyParamVariesPerInstance=!0)}};
c.prototype.run_system=function(){var h=this.runtime,t,B=this.parameters,S=this.results;var V=0;for(t=B.length;V<t;++V)S[V]=B[V].get();return this.func.apply(h.system,S)};c.prototype.run_object=function(){var h=this.type,t=this.beh_index,B=h.family_index,S=this.anyParamVariesPerInstance,V=this.parameters,L=this.results,d=this.func,k=h.getCurrentSol().getObjects();h=h.is_family;var E=-1<t,e,w;if(S){var I=0;for(w=V.length;I<w;++I){var N=V[I];N.variesPerInstance||(L[I]=N.get(0))}}else for(I=0,w=V.length;I<
w;++I)L[I]=V[I].get(0);var U=0;for(e=k.length;U<e;++U){var W=k[U];if(S)for(I=0,w=V.length;I<w;++I)N=V[I],N.variesPerInstance&&(L[I]=N.get(U));E?(I=0,h&&(I=W.type.family_beh_map[B]),d.apply(W.behavior_insts[t+I],L)):d.apply(W,L)}return!1};cr.action=c;var F=[],D=-1;n.prototype.postInit=function(){var h;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type){var t=0;for(h=this.subparams.length;t<h;t++)this.subparams[t].postInit()}this.expression&&
this.expression.postInit()};n.prototype.maybeVaryForType=function(h){this.variesPerInstance||!h||h.plugin.singleglobal||(this.variesPerInstance=!0)};n.prototype.setVaries=function(){this.variesPerInstance=!0};n.prototype.get_exp=function(h){this.solindex=h||0;h=f();this.expression.get(h);D--;return h.data};n.prototype.get_exp_str=function(h){this.solindex=h||0;h=f();this.expression.get(h);D--;return cr.is_string(h.data)?h.data:""};n.prototype.get_object=function(){return this.object};n.prototype.get_combosel=
function(){return this.combosel};n.prototype.get_boolean=function(){return!!this.combosel};n.prototype.get_layer=function(h){this.solindex=h||0;h=f();this.expression.get(h);D--;return h.is_number()?this.runtime.getLayerByNumber(h.data):this.runtime.getLayerByName(h.data)};n.prototype.get_layout=function(){return this.layout};n.prototype.get_key=function(){return this.key};n.prototype.get_instvar=function(){return this.index};n.prototype.get_familyvar=function(h){var t=h||0;h=this.owner.type;var B=
h.getCurrentSol(),S=B.getObjects();if(S.length)t=S[t%S.length].type;else if(B.else_instances.length)t=B.else_instances[t%B.else_instances.length].type;else if(h.instances.length)t=h.instances[t%h.instances.length].type;else return 0;return this.index+t.family_var_map[h.family_index]};n.prototype.get_eventvar=function(){return this.eventvar};n.prototype.get_audiofile=function(){return this.fileinfo};n.prototype.get_variadic=function(){var h;var t=0;for(h=this.subparams.length;t<h;t++)this.variadicret[t]=
this.subparams[t].get();return this.variadicret};cr.parameter=n;v.prototype.postInit=function(){this.solModifiers=q(this.solModifiers)};v.prototype.setValue=function(h){var t=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&t?(this.localIndex>=t.length&&(t.length=this.localIndex+1),t[this.localIndex]=h):this.data=h};v.prototype.getValue=function(){var h=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!h||this.is_constant?this.data:this.localIndex>=h.length||
"undefined"===typeof h[this.localIndex]?this.initial:h[this.localIndex]};v.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)};cr.eventvariable=v;y.prototype.toString=function(){return"include:"+this.include_sheet.toString()};y.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name];this.sheet.includes.add(this);this.solModifiers=q(this.solModifiers);for(var h=this.parent;h;)h.group&&h.contained_includes.push(this),
h=h.parent;this.updateActive()};y.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index);this.include_sheet.hasRun||this.include_sheet.run(!0);this.parent&&this.runtime.popSol(this.runtime.types_by_index)};y.prototype.updateActive=function(){for(var h=this.parent;h;){if(h.group&&!h.group_active){this.active=!1;return}h=h.parent}this.active=!0};y.prototype.isActive=function(){return this.active};cr.eventinclude=y;K.prototype.reset=function(h){this.current_event=
h;this.actindex=this.cndindex=0;cr.clearArray(this.temp_parents_arr);this.any_true_state=this.else_branch_ran=this.last_event_true=!1};K.prototype.isModifierAfterCnds=function(){return this.current_event.solWriterAfterCnds?!0:this.cndindex<this.current_event.conditions.length-1?!!this.current_event.solModifiers.length:!1};cr.eventStackFrame=K})();
(function(){function b(m,a){this.owner=m;this.runtime=m.runtime;this.type=a[0];this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,
this.eval_eventvar_exp][this.type];var c=null;this.object_type=this.parameters=this.results=this.func=this.third=this.second=this.first=this.value=null;this.beh_index=-1;this.instance_expr=null;this.varindex=-1;this.eventvar=this.varname=this.behavior_type=null;this.return_string=!1;switch(this.type){case 0:case 1:case 2:this.value=a[1];break;case 3:this.first=new cr.expNode(m,a[1]);break;case 18:this.first=new cr.expNode(m,a[1]);this.second=new cr.expNode(m,a[2]);this.third=new cr.expNode(m,a[3]);
break;case 19:this.func=this.runtime.GetObjectReference(a[1]);this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries();this.results=[];this.parameters=[];3===a.length?(c=a[2],this.results.length=c.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[a[1]];this.beh_index=-1;this.func=this.runtime.GetObjectReference(a[2]);this.return_string=a[3];cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&
this.owner.setVaries();this.instance_expr=a[4]?new cr.expNode(m,a[4]):null;this.results=[];this.parameters=[];6===a.length?(c=a[5],this.results.length=c.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[a[1]];this.return_string=a[2];this.instance_expr=a[3]?new cr.expNode(m,a[3]):null;this.varindex=a[4];break;case 22:this.object_type=this.runtime.types_by_index[a[1]];this.behavior_type=this.object_type.getBehaviorByName(a[2]);this.beh_index=this.object_type.getBehaviorIndexByName(a[2]);
this.func=this.runtime.GetObjectReference(a[3]);this.return_string=a[4];this.instance_expr=a[5]?new cr.expNode(m,a[5]):null;this.results=[];this.parameters=[];7===a.length?(c=a[6],this.results.length=c.length+1):this.results.length=1;break;case 23:this.varname=a[1],this.eventvar=null}this.owner.maybeVaryForType(this.object_type);4<=this.type&&17>=this.type&&(this.first=new cr.expNode(m,a[1]),this.second=new cr.expNode(m,a[2]));if(c){var f;a=0;for(f=c.length;a<f;a++)this.parameters.push(new cr.expNode(m,
c[a]))}cr.seal(this)}function l(){++x;M.length===x&&M.push(new cr.expvalue);return M[x]}function q(m,a,c){var f;var n=0;for(f=m.length;n<f;++n)m[n].get(c),a[n+1]=c.data}function A(m,a){this.type=m||cr.exptype.Integer;this.data=a||0;this.object_class=null;this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data));cr.seal(this)}b.prototype.postInit=function(){23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent));this.first&&this.first.postInit();
this.second&&this.second.postInit();this.third&&this.third.postInit();this.instance_expr&&this.instance_expr.postInit();if(this.parameters){var m;var a=0;for(m=this.parameters.length;a<m;a++)this.parameters[a].postInit()}};var M=[],x=-1;b.prototype.eval_system_exp=function(m){var a=this.parameters,c=this.results;c[0]=m;m=l();q(a,c,m);--x;this.func.apply(this.runtime.system,c)};b.prototype.eval_object_exp=function(m){var a=this.object_type,c=this.results,f=this.parameters,n=this.instance_expr,v=this.func,
y=this.owner.solindex,K=a.getCurrentSol(),u=K.getObjects();if(!u.length)if(K.else_instances.length)u=K.else_instances;else{this.return_string?m.set_string(""):m.set_int(0);return}c[0]=m;m.object_class=a;m=l();q(f,c,m);n&&(n.get(m),m.is_number()&&(y=m.data,u=a.instances));--x;a=u.length;if(y>=a||y<=-a)y%=a;0>y&&(y+=a);v.apply(u[y],c)};b.prototype.eval_behavior_exp=function(m){var a=this.object_type,c=this.results,f=this.parameters,n=this.instance_expr,v=this.beh_index,y=this.func,K=this.owner.solindex,
u=a.getCurrentSol(),F=u.getObjects();if(!F.length)if(u.else_instances.length)F=u.else_instances;else{this.return_string?m.set_string(""):m.set_int(0);return}c[0]=m;m.object_class=a;m=l();q(f,c,m);n&&(n.get(m),m.is_number()&&(K=m.data,F=a.instances));--x;f=F.length;if(K>=f||K<=-f)K%=f;0>K&&(K+=f);K=F[K];F=0;a.is_family&&(F=K.type.family_beh_map[a.family_index]);y.apply(K.behavior_insts[v+F],c)};b.prototype.eval_instvar_exp=function(m){var a=this.instance_expr,c=this.object_type,f=this.varindex,n=this.owner.solindex,
v=c.getCurrentSol(),y=v.getObjects();if(!y.length)if(v.else_instances.length)y=v.else_instances;else{this.return_string?m.set_string(""):m.set_int(0);return}if(a){v=l();a.get(v);if(v.is_number()){n=v.data;y=c.instances;0!==y.length&&(n%=y.length,0>n&&(n+=y.length));n=c.getInstanceByIID(n);c=n.instance_vars[f];cr.is_string(c)?m.set_string(c):m.set_float(c);--x;return}--x}a=y.length;if(n>=a||n<=-a)n%=a;0>n&&(n+=a);n=y[n];y=0;c.is_family&&(y=n.type.family_var_map[c.family_index]);c=n.instance_vars[f+
y];cr.is_string(c)?m.set_string(c):m.set_float(c)};b.prototype.eval_int=function(m){m.type=cr.exptype.Integer;m.data=this.value};b.prototype.eval_float=function(m){m.type=cr.exptype.Float;m.data=this.value};b.prototype.eval_string=function(m){m.type=cr.exptype.String;m.data=this.value};b.prototype.eval_unaryminus=function(m){this.first.get(m);m.is_number()&&(m.data=-m.data)};b.prototype.eval_add=function(m){this.first.get(m);var a=l();this.second.get(a);m.is_number()&&a.is_number()&&(m.data+=a.data,
a.is_float()&&m.make_float());--x};b.prototype.eval_subtract=function(m){this.first.get(m);var a=l();this.second.get(a);m.is_number()&&a.is_number()&&(m.data-=a.data,a.is_float()&&m.make_float());--x};b.prototype.eval_multiply=function(m){this.first.get(m);var a=l();this.second.get(a);m.is_number()&&a.is_number()&&(m.data*=a.data,a.is_float()&&m.make_float());--x};b.prototype.eval_divide=function(m){this.first.get(m);var a=l();this.second.get(a);m.is_number()&&a.is_number()&&(m.data/=a.data,m.make_float());
--x};b.prototype.eval_mod=function(m){this.first.get(m);var a=l();this.second.get(a);m.is_number()&&a.is_number()&&(m.data%=a.data,a.is_float()&&m.make_float());--x};b.prototype.eval_power=function(m){this.first.get(m);var a=l();this.second.get(a);m.is_number()&&a.is_number()&&(m.data=Math.pow(m.data,a.data),a.is_float()&&m.make_float());--x};b.prototype.eval_and=function(m){this.first.get(m);var a=l();this.second.get(a);a.is_string()||m.is_string()?this.eval_and_stringconcat(m,a):this.eval_and_logical(m,
a);--x};b.prototype.eval_and_stringconcat=function(m,a){m.is_string()&&a.is_string()?this.eval_and_stringconcat_str_str(m,a):this.eval_and_stringconcat_num(m,a)};b.prototype.eval_and_stringconcat_str_str=function(m,a){m.data+=a.data};b.prototype.eval_and_stringconcat_num=function(m,a){m.is_string()?m.data+=(Math.round(1E10*a.data)/1E10).toString():m.set_string(m.data.toString()+a.data)};b.prototype.eval_and_logical=function(m,a){m.set_int(m.data&&a.data?1:0)};b.prototype.eval_or=function(m){this.first.get(m);
var a=l();this.second.get(a);m.is_number()&&a.is_number()&&(m.data||a.data?m.set_int(1):m.set_int(0));--x};b.prototype.eval_conditional=function(m){this.first.get(m);m.data?this.second.get(m):this.third.get(m)};b.prototype.eval_equal=function(m){this.first.get(m);var a=l();this.second.get(a);m.set_int(m.data===a.data?1:0);--x};b.prototype.eval_notequal=function(m){this.first.get(m);var a=l();this.second.get(a);m.set_int(m.data!==a.data?1:0);--x};b.prototype.eval_less=function(m){this.first.get(m);
var a=l();this.second.get(a);m.set_int(m.data<a.data?1:0);--x};b.prototype.eval_lessequal=function(m){this.first.get(m);var a=l();this.second.get(a);m.set_int(m.data<=a.data?1:0);--x};b.prototype.eval_greater=function(m){this.first.get(m);var a=l();this.second.get(a);m.set_int(m.data>a.data?1:0);--x};b.prototype.eval_greaterequal=function(m){this.first.get(m);var a=l();this.second.get(a);m.set_int(m.data>=a.data?1:0);--x};b.prototype.eval_eventvar_exp=function(m){var a=this.eventvar.getValue();"number"===
typeof a?m.set_float(a):"boolean"===typeof a?m.set_int(a?1:0):m.set_string(a)};cr.expNode=b;A.prototype.is_int=function(){return this.type===cr.exptype.Integer};A.prototype.is_float=function(){return this.type===cr.exptype.Float};A.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float};A.prototype.is_string=function(){return this.type===cr.exptype.String};A.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&
(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)};A.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)};A.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)};A.prototype.set_int=function(m){this.type=cr.exptype.Integer;this.data=Math.floor(m)};A.prototype.set_float=function(m){this.type=cr.exptype.Float;this.data=m};A.prototype.set_string=function(m){this.type=
cr.exptype.String;this.data=m};A.prototype.set_any=function(m){cr.is_number(m)?(this.type=cr.exptype.Float,this.data=m):cr.is_string(m)?(this.type=cr.exptype.String,this.data=m.toString()):(this.type=cr.exptype.Integer,this.data=0)};cr.expvalue=A;cr.exptype={Integer:0,Float:1,String:2}})();cr.system_object=function(b){this.runtime=b;this.waits=[]};
cr.system_object.prototype.saveToJSON=function(){var b={},l,q,A;b.waits=[];var M=b.waits;var x=0;for(l=this.waits.length;x<l;x++){var m=this.waits[x];var a={t:m.time,st:m.signaltag,s:m.signalled,ev:m.ev.sid,sm:[],sols:{}};m.ev.actions[m.actindex]&&(a.act=m.ev.actions[m.actindex].sid);var c=0;for(q=m.solModifiers.length;c<q;c++)a.sm.push(m.solModifiers[c].sid);for(A in m.sols)if(m.sols.hasOwnProperty(A)){var f=this.runtime.types_by_index[parseInt(A,10)];var n={sa:m.sols[A].sa,insts:[]};c=0;for(q=m.sols[A].insts.length;c<
q;c++)n.insts.push(m.sols[A].insts[c].uid);a.sols[f.sid.toString()]=n}M.push(a)}return b};
cr.system_object.prototype.loadFromJSON=function(b){b=b.waits;var l,q,A,M,x;cr.clearArray(this.waits);var m=0;for(l=b.length;m<l;m++){var a=b[m];if(M=this.runtime.blocksBySid[a.ev.toString()]){var c=-1;var f=0;for(q=M.actions.length;f<q;f++)if(M.actions[f].sid===a.act){c=f;break}if(-1!==c){var n={sols:{},solModifiers:[],deleteme:!1};n.time=a.t;n.signaltag=a.st||"";n.signalled=!!a.s;n.ev=M;n.actindex=c;f=0;for(q=a.sm.length;f<q;f++)(M=this.runtime.getObjectTypeBySid(a.sm[f]))&&n.solModifiers.push(M);
for(A in a.sols)if(a.sols.hasOwnProperty(A)&&(M=this.runtime.getObjectTypeBySid(parseInt(A,10)))){c=a.sols[A];var v={sa:c.sa,insts:[]};f=0;for(q=c.insts.length;f<q;f++)(x=this.runtime.getObjectByUID(c.insts[f]))&&v.insts.push(x);n.sols[M.index.toString()]=v}this.waits.push(n)}}}};
(function(){function b(){}function l(d,k){d=d.extra.c2_feo_val;k=k.extra.c2_feo_val;if(cr.is_number(d)&&cr.is_number(k))return d-k;d=""+d;k=""+k;return d<k?-1:d>k?1:0}function q(d,k){K&&d===u&&k===F||(K=new RegExp(d,k),u=d,F=k);K.lastIndex=0;return K}function A(){}function M(){var d=h.length?h.pop():{sols:{},solModifiers:[]};d.deleteme=!1;return d}function x(){var d=t.length?t.pop():{insts:[]};d.sa=!1;return d}function m(d,k){var E=d[0]-k[0];return 0!==E?E:d[1]-k[1]}function a(d,k){return d[1]-k[1]}
function c(){}function f(d,k,E){if(d!==S||k!==V||E!==L){var e=q(k,E);B=d.match(e);S=d;V=k;L=E}}var n=cr.system_object.prototype;b.prototype.EveryTick=function(){return!0};b.prototype.OnLayoutStart=function(){return!0};b.prototype.OnLayoutEnd=function(){return!0};b.prototype.Compare=function(d,k,E){return cr.do_cmp(d,k,E)};b.prototype.CompareTime=function(d,k){var E=this.runtime.kahanTime.sum;return 0===d?(d=this.runtime.getCurrentCondition(),!d.extra.CompareTime_executed&&E>=k?d.extra.CompareTime_executed=
!0:!1):cr.do_cmp(E,d,k)};b.prototype.LayerVisible=function(d){return d?d.visible:!1};b.prototype.LayerEmpty=function(d){return d?!d.instances.length:!1};b.prototype.LayerCmpOpacity=function(d,k,E){return d?cr.do_cmp(100*d.opacity,k,E):!1};b.prototype.Repeat=function(d){var k=this.runtime.getCurrentEventStack(),E=k.current_event,e=k.isModifierAfterCnds();k=this.runtime.pushLoopStack();if(e)for(e=0;e<d&&!k.stopped;e++)this.runtime.pushCopySol(E.solModifiers),k.index=e,E.retrigger(),this.runtime.popSol(E.solModifiers);
else for(e=0;e<d&&!k.stopped;e++)k.index=e,E.retrigger();this.runtime.popLoopStack();return!1};b.prototype.While=function(d){var k=this.runtime.getCurrentEventStack();d=k.current_event;var E=k.isModifierAfterCnds();k=this.runtime.pushLoopStack();if(E)for(E=0;!k.stopped;E++)this.runtime.pushCopySol(d.solModifiers),k.index=E,d.retrigger()||(k.stopped=!0),this.runtime.popSol(d.solModifiers);else for(E=0;!k.stopped;E++)k.index=E,d.retrigger()||(k.stopped=!0);this.runtime.popLoopStack();return!1};b.prototype.For=
function(d,k,E){var e=this.runtime.getCurrentEventStack(),w=e.current_event;e=e.isModifierAfterCnds();d=this.runtime.pushLoopStack(d);if(E<k)if(e)for(;k>=E&&!d.stopped;--k)this.runtime.pushCopySol(w.solModifiers),d.index=k,w.retrigger(),this.runtime.popSol(w.solModifiers);else for(;k>=E&&!d.stopped;--k)d.index=k,w.retrigger();else if(e)for(;k<=E&&!d.stopped;++k)this.runtime.pushCopySol(w.solModifiers),d.index=k,w.retrigger(),this.runtime.popSol(w.solModifiers);else for(;k<=E&&!d.stopped;++k)d.index=
k,w.retrigger();this.runtime.popLoopStack();return!1};var v=[],y=-1;b.prototype.ForEach=function(d){var k=d.getCurrentSol();y++;v.length===y&&v.push([]);var E=v[y];cr.shallowAssignArray(E,k.getObjects());var e=this.runtime.getCurrentEventStack(),w=e.current_event,I=e.isModifierAfterCnds();e=this.runtime.pushLoopStack();var N,U,W=d.is_contained;if(I)for(I=0,N=E.length;I<N&&!e.stopped;I++){this.runtime.pushCopySol(w.solModifiers);var X=E[I];k=d.getCurrentSol();k.select_all=!1;cr.clearArray(k.instances);
k.instances[0]=X;if(W){var Y=0;for(U=X.siblings.length;Y<U;Y++){var ea=X.siblings[Y];var ha=ea.type.getCurrentSol();ha.select_all=!1;cr.clearArray(ha.instances);ha.instances[0]=ea}}e.index=I;w.retrigger();this.runtime.popSol(w.solModifiers)}else for(k.select_all=!1,cr.clearArray(k.instances),I=0,N=E.length;I<N&&!e.stopped;I++){X=E[I];k.instances[0]=X;if(W)for(Y=0,U=X.siblings.length;Y<U;Y++)ea=X.siblings[Y],ha=ea.type.getCurrentSol(),ha.select_all=!1,cr.clearArray(ha.instances),ha.instances[0]=ea;
e.index=I;w.retrigger()}cr.clearArray(E);this.runtime.popLoopStack();y--;return!1};b.prototype.ForEachOrdered=function(d,k,E){k=d.getCurrentSol();y++;v.length===y&&v.push([]);var e=v[y];cr.shallowAssignArray(e,k.getObjects());var w=this.runtime.getCurrentEventStack(),I=w.current_event,N=this.runtime.getCurrentCondition(),U=w.isModifierAfterCnds();w=this.runtime.pushLoopStack();var W;var X=0;for(W=e.length;X<W;X++)e[X].extra.c2_feo_val=N.parameters[1].get(X);e.sort(l);1===E&&e.reverse();E=d.is_contained;
if(U)for(X=0,W=e.length;X<W&&!w.stopped;X++){this.runtime.pushCopySol(I.solModifiers);var Y=e[X];k=d.getCurrentSol();k.select_all=!1;cr.clearArray(k.instances);k.instances[0]=Y;if(E)for(N=0,U=Y.siblings.length;N<U;N++){var ea=Y.siblings[N];var ha=ea.type.getCurrentSol();ha.select_all=!1;cr.clearArray(ha.instances);ha.instances[0]=ea}w.index=X;I.retrigger();this.runtime.popSol(I.solModifiers)}else for(k.select_all=!1,cr.clearArray(k.instances),X=0,W=e.length;X<W&&!w.stopped;X++){Y=e[X];k.instances[0]=
Y;if(E)for(N=0,U=Y.siblings.length;N<U;N++)ea=Y.siblings[N],ha=ea.type.getCurrentSol(),ha.select_all=!1,cr.clearArray(ha.instances),ha.instances[0]=ea;w.index=X;I.retrigger()}cr.clearArray(e);this.runtime.popLoopStack();y--;return!1};b.prototype.PickByComparison=function(d,k,E,e){var w,I;if(d){y++;v.length===y&&v.push([]);var N=v[y],U=d.getCurrentSol();cr.shallowAssignArray(N,U.getObjects());U.select_all&&cr.clearArray(U.else_instances);var W=this.runtime.getCurrentCondition();var X=w=0;for(I=N.length;w<
I;w++){var Y=N[w];N[X]=Y;k=W.parameters[1].get(w);e=W.parameters[3].get(w);cr.do_cmp(k,E,e)?X++:U.else_instances.push(Y)}cr.truncateArray(N,X);U.select_all=!1;cr.shallowAssignArray(U.instances,N);cr.clearArray(N);y--;d.applySolToContainer();return!!U.instances.length}};b.prototype.PickByEvaluate=function(d,k){var E,e;if(d){y++;v.length===y&&v.push([]);var w=v[y],I=d.getCurrentSol();cr.shallowAssignArray(w,I.getObjects());I.select_all&&cr.clearArray(I.else_instances);var N=this.runtime.getCurrentCondition();
var U=E=0;for(e=w.length;E<e;E++){var W=w[E];w[U]=W;(k=N.parameters[1].get(E))?U++:I.else_instances.push(W)}cr.truncateArray(w,U);I.select_all=!1;cr.shallowAssignArray(I.instances,w);cr.clearArray(w);y--;d.applySolToContainer();return!!I.instances.length}};b.prototype.TriggerOnce=function(){var d=this.runtime.getCurrentCondition().extra;"undefined"===typeof d.TriggerOnce_lastTick&&(d.TriggerOnce_lastTick=-1);var k=d.TriggerOnce_lastTick,E=this.runtime.tickcount;d.TriggerOnce_lastTick=E;return this.runtime.layout_first_tick||
k!==E-1};b.prototype.Every=function(d){var k=this.runtime.getCurrentCondition(),E=k.extra.Every_lastTime||0,e=this.runtime.kahanTime.sum;"undefined"===typeof k.extra.Every_seconds&&(k.extra.Every_seconds=d);var w=k.extra.Every_seconds;if(e>=E+w)return k.extra.Every_lastTime=E+w,e>=k.extra.Every_lastTime+.04&&(k.extra.Every_lastTime=e),k.extra.Every_seconds=d,!0;e<E-.1&&(k.extra.Every_lastTime=e);return!1};b.prototype.PickNth=function(d,k){if(!d)return!1;var E=d.getCurrentSol(),e=E.getObjects();k=
cr.floor(k);if(0>k||k>=e.length)return!1;E.pick_one(e[k]);d.applySolToContainer();return!0};b.prototype.PickRandom=function(d){if(!d)return!1;var k=d.getCurrentSol(),E=k.getObjects(),e=cr.floor(Math.random()*E.length);if(e>=E.length)return!1;k.pick_one(E[e]);d.applySolToContainer();return!0};b.prototype.CompareVar=function(d,k,E){return cr.do_cmp(d.getValue(),k,E)};b.prototype.CompareBoolVar=function(d){return d.getValue()};b.prototype.IsGroupActive=function(d){return(d=this.runtime.groups_by_name[d.toLowerCase()])&&
d.group_active};b.prototype.IsPreview=function(){return this.runtime.isPreview};b.prototype.PickAll=function(d){if(!d||!d.instances.length)return!1;d.getCurrentSol().select_all=!0;d.applySolToContainer();return!0};b.prototype.IsMobile=function(){return this.runtime.isMobile};b.prototype.CompareBetween=function(d,k,E){return d>=k&&d<=E};b.prototype.Else=function(){var d=this.runtime.getCurrentEventStack();return d.else_branch_ran?!1:!d.last_event_true};b.prototype.OnLoadFinished=function(){return!0};
b.prototype.OnCanvasSnapshot=function(){return!0};b.prototype.EffectsSupported=function(){return!!this.runtime.glwrap};b.prototype.OnSaveComplete=function(){return!0};b.prototype.OnSaveFailed=function(){return!0};b.prototype.OnLoadComplete=function(){return!0};b.prototype.OnLoadFailed=function(){return!0};b.prototype.ObjectUIDExists=function(d){return!!this.runtime.getObjectByUID(d)};b.prototype.IsOnPlatform=function(d){var k=this.runtime;switch(d){case 0:return!k.isNodeWebkit&&!k.isCordova&&!k.isWinJS&&
!k.isWindowsPhone8&&!k.isBlackberry10&&!k.isAmazonWebApp;case 1:return k.isiOS;case 2:return k.isAndroid;case 3:return k.isWindows8App;case 4:return k.isWindowsPhone8;case 5:return k.isBlackberry10;case 6:return k.isTizen;case 7:return!1;case 8:return k.isCordova;case 9:return k.isArcade;case 10:return k.isNodeWebkit;case 11:return k.isCrosswalk;case 12:return k.isAmazonWebApp;case 13:return k.isWindows10;default:return!1}};var K=null,u="",F="";b.prototype.RegexTest=function(d,k,E){return q(k,E).test(d)};
var D=[];b.prototype.PickOverlappingPoint=function(d,k,E){if(!d)return!1;var e=d.getCurrentSol(),w=e.getObjects(),I=this.runtime.getCurrentEventStack().current_event.orblock,N=this.runtime.getCurrentCondition(),U;e.select_all?(cr.shallowAssignArray(D,w),cr.clearArray(e.else_instances),e.select_all=!1,cr.clearArray(e.instances)):I?(cr.shallowAssignArray(D,e.else_instances),cr.clearArray(e.else_instances)):(cr.shallowAssignArray(D,w),cr.clearArray(e.instances));w=0;for(I=D.length;w<I;++w){var W=D[w];
W.update_bbox();(U=cr.xor(W.contains_pt(k,E),N.inverted))?e.instances.push(W):e.else_instances.push(W)}d.applySolToContainer();return cr.xor(!!e.instances.length,N.inverted)};b.prototype.PickLastCreated=function(d){if(!d)return!1;var k=this.runtime.createRow,E,e=null,w=d.is_family;for(E=k.length-1;0<=E;--E){var I=k[E];if(w){if(0<=I.type.families.indexOf(d)){e=I;break}}else if(I.type===d){e=I;break}}!e&&d.instances.length&&(e=d.instances[d.instances.length-1]);if(!e)return!1;d.getCurrentSol().pick_one(e);
d.applySolToContainer();return!0};b.prototype.IsNaN=function(d){return!!isNaN(d)};b.prototype.AngleWithin=function(d,k,E){return cr.angleDiff(cr.to_radians(d),cr.to_radians(E))<=cr.to_radians(k)};b.prototype.IsClockwiseFrom=function(d,k){return cr.angleClockwise(cr.to_radians(d),cr.to_radians(k))};b.prototype.IsBetweenAngles=function(d,k,E){d=cr.to_clamped_radians(d);k=cr.to_clamped_radians(k);E=cr.to_clamped_radians(E);return cr.angleClockwise(E,k)?cr.angleClockwise(d,k)&&!cr.angleClockwise(d,E):
!(!cr.angleClockwise(d,k)&&cr.angleClockwise(d,E))};b.prototype.IsValueType=function(d,k){return"number"===typeof d?0===k:1===k};n.cnds=new b;A.prototype.GoToLayout=function(d){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=d)};A.prototype.NextPrevLayout=function(d){if(!this.runtime.isloading&&!this.runtime.changelayout){var k=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if(!d||0!==k)if(d||k!==this.runtime.layouts_by_index.length-1)this.runtime.changelayout=
this.runtime.layouts_by_index[k+(d?-1:1)]}};A.prototype.CreateObject=function(d,k,E,e){if(k&&d&&(k=this.runtime.createInstance(d,k,E,e))){this.runtime.isInOnDestroy++;this.runtime.trigger(Object.getPrototypeOf(d.plugin).cnds.OnCreated,k);if(k.is_contained)for(E=0,e=k.siblings.length;E<e;E++){var w=k.siblings[E];this.runtime.trigger(Object.getPrototypeOf(w.type.plugin).cnds.OnCreated,w)}this.runtime.isInOnDestroy--;d=d.getCurrentSol();d.select_all=!1;cr.clearArray(d.instances);d.instances[0]=k;if(k.is_contained)for(E=
0,e=k.siblings.length;E<e;E++)w=k.siblings[E],d=w.type.getCurrentSol(),d.select_all=!1,cr.clearArray(d.instances),d.instances[0]=w}};A.prototype.CreateObjectByName=function(d,k,E,e){k&&d&&(d=this.runtime.types_lowercase[d.toLowerCase()])&&A.prototype.CreateObject.call(this,d,k,E,e)};A.prototype.SetLayerVisible=function(d,k){d&&d.visible!==k&&(d.visible=k,this.runtime.redraw=!0)};A.prototype.SetLayerOpacity=function(d,k){d&&(k=cr.clamp(k/100,0,1),d.opacity!==k&&(d.opacity=k,this.runtime.redraw=!0))};
A.prototype.SetLayerScaleRate=function(d,k){d&&d.zoomRate!==k&&(d.zoomRate=k,this.runtime.redraw=!0)};A.prototype.SetLayerForceOwnTexture=function(d,k){d&&(k=!!k,d.forceOwnTexture!==k&&(d.forceOwnTexture=k,this.runtime.redraw=!0))};A.prototype.SetLayoutScale=function(d){this.runtime.running_layout&&this.runtime.running_layout.scale!==d&&(this.runtime.running_layout.scale=d,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)};A.prototype.ScrollX=function(d){this.runtime.running_layout.scrollToX(d)};
A.prototype.ScrollY=function(d){this.runtime.running_layout.scrollToY(d)};A.prototype.Scroll=function(d,k){this.runtime.running_layout.scrollToX(d);this.runtime.running_layout.scrollToY(k)};A.prototype.ScrollToObject=function(d){if(d=d.getFirstPicked())this.runtime.running_layout.scrollToX(d.x),this.runtime.running_layout.scrollToY(d.y)};A.prototype.SetVar=function(d,k){0===d.vartype?cr.is_number(k)?d.setValue(k):d.setValue(parseFloat(k)):1===d.vartype&&d.setValue(k.toString())};A.prototype.AddVar=
function(d,k){0===d.vartype?cr.is_number(k)?d.setValue(d.getValue()+k):d.setValue(d.getValue()+parseFloat(k)):1===d.vartype&&d.setValue(d.getValue()+k.toString())};A.prototype.SubVar=function(d,k){0===d.vartype&&(cr.is_number(k)?d.setValue(d.getValue()-k):d.setValue(d.getValue()-parseFloat(k)))};A.prototype.SetBoolVar=function(d,k){d.setValue(0!==k)};A.prototype.ToggleBoolVar=function(d){d.setValue(!d.getValue())};A.prototype.SetGroupActive=function(d,k){if(d=this.runtime.groups_by_name[d.toLowerCase()])switch(k){case 0:d.setGroupActive(!1);
break;case 1:d.setGroupActive(!0);break;case 2:d.setGroupActive(!d.group_active)}};A.prototype.SetTimescale=function(d){0>d&&(d=0);this.runtime.timescale=d};A.prototype.SetObjectTimescale=function(d,k){0>k&&(k=0);if(d){d=d.getCurrentSol().getObjects();var E;var e=0;for(E=d.length;e<E;e++)d[e].my_timescale=k}};A.prototype.RestoreObjectTimescale=function(d){if(!d)return!1;d=d.getCurrentSol().getObjects();var k;var E=0;for(k=d.length;E<k;E++)d[E].my_timescale=-1};var h=[],t=[];A.prototype.Wait=function(d){if(!(0>
d)){var k,E=this.runtime.getCurrentEventStack(),e=M();e.time=this.runtime.kahanTime.sum+d;e.signaltag="";e.signalled=!1;e.ev=E.current_event;e.actindex=E.actindex+1;d=0;for(k=this.runtime.types_by_index.length;d<k;d++){var w=this.runtime.types_by_index[d];var I=w.getCurrentSol();I.select_all&&-1===E.current_event.solModifiers.indexOf(w)||(e.solModifiers.push(w),w=x(),w.sa=I.select_all,cr.shallowAssignArray(w.insts,I.instances),e.sols[d.toString()]=w)}this.waits.push(e);return!0}};A.prototype.WaitForSignal=
function(d){var k,E=this.runtime.getCurrentEventStack(),e=M();e.time=-1;e.signaltag=d.toLowerCase();e.signalled=!1;e.ev=E.current_event;e.actindex=E.actindex+1;d=0;for(k=this.runtime.types_by_index.length;d<k;d++){var w=this.runtime.types_by_index[d];var I=w.getCurrentSol();I.select_all&&-1===E.current_event.solModifiers.indexOf(w)||(e.solModifiers.push(w),w=x(),w.sa=I.select_all,cr.shallowAssignArray(w.insts,I.instances),e.sols[d.toString()]=w)}this.waits.push(e);return!0};A.prototype.Signal=function(d){d=
d.toLowerCase();var k;var E=0;for(k=this.waits.length;E<k;++E){var e=this.waits[E];-1===e.time&&e.signaltag===d&&(e.signalled=!0)}};A.prototype.SetLayerScale=function(d,k){d&&d.scale!==k&&(d.scale=k,this.runtime.redraw=!0)};A.prototype.ResetGlobals=function(){var d;var k=0;for(d=this.runtime.all_global_vars.length;k<d;k++){var E=this.runtime.all_global_vars[k];E.data=E.initial}};A.prototype.SetLayoutAngle=function(d){d=cr.to_radians(d);d=cr.clamp_angle(d);this.runtime.running_layout&&this.runtime.running_layout.angle!==
d&&(this.runtime.running_layout.angle=d,this.runtime.redraw=!0)};A.prototype.SetLayerAngle=function(d,k){d&&(k=cr.to_radians(k),k=cr.clamp_angle(k),d.angle!==k&&(d.angle=k,this.runtime.redraw=!0))};A.prototype.SetLayerParallax=function(d,k,E){if(d&&(d.parallaxX!==k/100||d.parallaxY!==E/100)){d.parallaxX=k/100;d.parallaxY=E/100;if(1!==d.parallaxX||1!==d.parallaxY)for(E=d.instances,d=0,k=E.length;d<k;++d)E[d].type.any_instance_parallaxed=!0;this.runtime.redraw=!0}};A.prototype.SetLayerBackground=function(d,
k){if(d){var E=cr.clamp(Math.floor(255*cr.GetRValue(k)),0,255),e=cr.clamp(Math.floor(255*cr.GetGValue(k)),0,255);k=cr.clamp(Math.floor(255*cr.GetBValue(k)),0,255);if(d.background_color[0]!==E||d.background_color[1]!==e||d.background_color[2]!==k)d.background_color[0]=E,d.background_color[1]=e,d.background_color[2]=k,this.runtime.redraw=!0}};A.prototype.SetLayerTransparent=function(d,k){d&&!!k!==!!d.transparent&&(d.transparent=!!k,this.runtime.redraw=!0)};A.prototype.SetLayerBlendMode=function(d,k){d&&
d.blend_mode!==k&&(d.blend_mode=k,d.compositeOp=cr.effectToCompositeOp(d.blend_mode),this.runtime.gl&&cr.setGLBlend(d,d.blend_mode,this.runtime.gl),this.runtime.redraw=!0)};A.prototype.StopLoop=function(){0>this.runtime.loop_stack_index||(this.runtime.getCurrentLoop().stopped=!0)};A.prototype.GoToLayoutByName=function(d){if(!this.runtime.isloading&&!this.runtime.changelayout)for(var k in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(k)&&cr.equals_nocase(k,d)){this.runtime.changelayout=
this.runtime.layouts[k];break}};A.prototype.RestartLayout=function(d){if(!this.runtime.isloading&&!this.runtime.changelayout&&this.runtime.running_layout){this.runtime.changelayout=this.runtime.running_layout;var k;d=0;for(k=this.runtime.allGroups.length;d<k;d++){var E=this.runtime.allGroups[d];E.setGroupActive(E.initially_activated)}}};A.prototype.SnapshotCanvas=function(d,k){this.runtime.doCanvasSnapshot(0===d?"image/png":"image/jpeg",k/100)};A.prototype.SetCanvasSize=function(d,k){if(!(0>=d||0>=
k)){var E=this.runtime.fullscreen_mode;(document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen)&&0<this.runtime.fullscreen_scaling&&(E=this.runtime.fullscreen_scaling);0===E?this.runtime.setSize(d,k,!0):(this.runtime.original_width=d,this.runtime.original_height=k,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}};A.prototype.SetLayoutEffectEnabled=function(d,k){this.runtime.running_layout&&this.runtime.glwrap&&(k=
this.runtime.running_layout.getEffectByName(k))&&(d=1===d,k.active!=d&&(k.active=d,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0))};A.prototype.SetLayerEffectEnabled=function(d,k,E){d&&this.runtime.glwrap&&(E=d.getEffectByName(E))&&(k=1===k,E.active!=k&&(E.active=k,d.updateActiveEffects(),this.runtime.redraw=!0))};A.prototype.SetLayoutEffectParam=function(d,k,E){if(this.runtime.running_layout&&this.runtime.glwrap&&(d=this.runtime.running_layout.getEffectByName(d))){var e=
this.runtime.running_layout.effect_params[d.index];k=Math.floor(k);if(!(0>k||k>=e.length)){var w=this.runtime.glwrap.getProgramParameterType(d.shaderindex,k);1===w?E/=100:2===w&&(E=[cr.GetRValue(E),cr.GetGValue(E),cr.GetBValue(E)]);e[k]!==E&&(e[k]=E,d.active&&(this.runtime.redraw=!0))}}};A.prototype.SetLayerEffectParam=function(d,k,E,e){if(d&&this.runtime.glwrap&&(k=d.getEffectByName(k))&&(d=d.effect_params[k.index],E=Math.floor(E),!(0>E||E>=d.length))){var w=this.runtime.glwrap.getProgramParameterType(k.shaderindex,
E);1===w?e/=100:2===w&&(e=[cr.GetRValue(e),cr.GetGValue(e),cr.GetBValue(e)]);d[E]!==e&&(d[E]=e,k.active&&(this.runtime.redraw=!0))}};A.prototype.SaveState=function(d){this.runtime.saveToSlot=d};A.prototype.LoadState=function(d){this.runtime.loadFromSlot=d};A.prototype.LoadStateJSON=function(d){this.runtime.loadFromJson=d};A.prototype.SetHalfFramerateMode=function(d){this.runtime.halfFramerateMode=0!==d};A.prototype.SetFullscreenQuality=function(d){if(document.mozFullScreen||document.webkitIsFullScreen||
document.msFullscreenElement||document.fullScreen||0!==this.runtime.fullscreen_mode)this.runtime.wantFullscreenScalingQuality=0!==d,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0)};A.prototype.ResetPersisted=function(){var d;var k=0;for(d=this.runtime.layouts_by_index.length;k<d;++k)this.runtime.layouts_by_index[k].persist_data={},this.runtime.layouts_by_index[k].first_visit=!0};A.prototype.RecreateInitialObjects=function(d,k,E,e,w){d&&this.runtime.running_layout.recreateInitialObjects(d,
k,E,e,w)};A.prototype.SetPixelRounding=function(d){this.runtime.pixel_rounding=0!==d;this.runtime.redraw=!0};A.prototype.SetMinimumFramerate=function(d){1>d&&(d=1);120<d&&(d=120);this.runtime.minimumFramerate=d};A.prototype.SortZOrderByInstVar=function(d,k){if(d){var E;var e=d.getCurrentSol().getObjects();var w=[],I=[],N=this.runtime.running_layout,U=d.is_family,W=d.family_index,X=!1;d=0;for(E=e.length;d<E;++d){var Y=e[d];if(Y.layer){var ea=U?Y.instance_vars[k+Y.type.family_var_map[W]]:Y.instance_vars[k];
w.push([Y.layer.index,Y.get_zindex()]);I.push([Y,ea])}}if(w.length){w.sort(m);I.sort(a);d=0;for(E=w.length;d<E;++d)Y=I[d][0],k=N.layers[w[d][0]],e=w[d][1],k.instances[e]!==Y&&(k.instances[e]=Y,Y.layer=k,k.setZIndicesStaleFrom(e),X=!0);X&&(this.runtime.redraw=!0)}}};n.acts=new A;c.prototype.int=function(d,k){cr.is_string(k)?(d.set_int(parseInt(k,10)),isNaN(d.data)&&(d.data=0)):d.set_int(k)};c.prototype.float=function(d,k){cr.is_string(k)?(d.set_float(parseFloat(k)),isNaN(d.data)&&(d.data=0)):d.set_float(k)};
c.prototype.str=function(d,k){cr.is_string(k)?d.set_string(k):d.set_string(k.toString())};c.prototype.len=function(d,k){d.set_int(k.length||0)};c.prototype.random=function(d,k,E){void 0===E?d.set_float(Math.random()*k):d.set_float(Math.random()*(E-k)+k)};c.prototype.sqrt=function(d,k){d.set_float(Math.sqrt(k))};c.prototype.abs=function(d,k){d.set_float(Math.abs(k))};c.prototype.round=function(d,k){d.set_int(Math.round(k))};c.prototype.floor=function(d,k){d.set_int(Math.floor(k))};c.prototype.ceil=
function(d,k){d.set_int(Math.ceil(k))};c.prototype.sign=function(d,k){d.set_float(Math.sign(k))};c.prototype.sin=function(d,k){d.set_float(Math.sin(cr.to_radians(k)))};c.prototype.cos=function(d,k){d.set_float(Math.cos(cr.to_radians(k)))};c.prototype.tan=function(d,k){d.set_float(Math.tan(cr.to_radians(k)))};c.prototype.asin=function(d,k){d.set_float(cr.to_degrees(Math.asin(k)))};c.prototype.acos=function(d,k){d.set_float(cr.to_degrees(Math.acos(k)))};c.prototype.atan=function(d,k){d.set_float(cr.to_degrees(Math.atan(k)))};
c.prototype.exp=function(d,k){d.set_float(Math.exp(k))};c.prototype.ln=function(d,k){d.set_float(Math.log(k))};c.prototype.log10=function(d,k){d.set_float(Math.log(k)/Math.LN10)};c.prototype.max=function(d){var k=arguments[1];"number"!==typeof k&&(k=0);var E;var e=2;for(E=arguments.length;e<E;e++){var w=arguments[e];"number"===typeof w&&k<w&&(k=w)}d.set_float(k)};c.prototype.min=function(d){var k=arguments[1];"number"!==typeof k&&(k=0);var E;var e=2;for(E=arguments.length;e<E;e++){var w=arguments[e];
"number"===typeof w&&k>w&&(k=w)}d.set_float(k)};c.prototype.dt=function(d){d.set_float(this.runtime.dt)};c.prototype.timescale=function(d){d.set_float(this.runtime.timescale)};c.prototype.wallclocktime=function(d){d.set_float((Date.now()-this.runtime.start_time)/1E3)};c.prototype.unixtime=function(d){d.set_float(Date.now())};c.prototype.time=function(d){d.set_float(this.runtime.kahanTime.sum)};c.prototype.tickcount=function(d){d.set_int(this.runtime.tickcount)};c.prototype.objectcount=function(d){d.set_int(this.runtime.objectcount)};
c.prototype.fps=function(d){d.set_int(this.runtime.fps)};c.prototype.loopindex=function(d,k){var E;if(this.runtime.loop_stack.length)if(k){for(E=this.runtime.loop_stack_index;0<=E;--E){var e=this.runtime.loop_stack[E];if(e.name===k){d.set_int(e.index);return}}d.set_int(0)}else e=this.runtime.getCurrentLoop(),d.set_int(e?e.index:-1);else d.set_int(0)};c.prototype.distance=function(d,k,E,e,w){d.set_float(cr.distanceTo(k,E,e,w))};c.prototype.angle=function(d,k,E,e,w){d.set_float(cr.to_degrees(cr.angleTo(k,
E,e,w)))};c.prototype.scrollx=function(d){d.set_float(this.runtime.running_layout.scrollX)};c.prototype.scrolly=function(d){d.set_float(this.runtime.running_layout.scrollY)};c.prototype.newline=function(d){d.set_string("\n")};c.prototype.lerp=function(d,k,E,e){d.set_float(cr.lerp(k,E,e))};c.prototype.qarp=function(d,k,E,e,w){d.set_float(cr.qarp(k,E,e,w))};c.prototype.cubic=function(d,k,E,e,w,I){d.set_float(cr.cubic(k,E,e,w,I))};c.prototype.cosp=function(d,k,E,e){d.set_float(cr.cosp(k,E,e))};c.prototype.windowwidth=
function(d){d.set_int(this.runtime.width)};c.prototype.windowheight=function(d){d.set_int(this.runtime.height)};c.prototype.uppercase=function(d,k){d.set_string(cr.is_string(k)?k.toUpperCase():"")};c.prototype.lowercase=function(d,k){d.set_string(cr.is_string(k)?k.toLowerCase():"")};c.prototype.clamp=function(d,k,E,e){k<E?d.set_float(E):k>e?d.set_float(e):d.set_float(k)};c.prototype.layerscale=function(d,k){(k=this.runtime.getLayer(k))?d.set_float(k.scale):d.set_float(0)};c.prototype.layeropacity=
function(d,k){(k=this.runtime.getLayer(k))?d.set_float(100*k.opacity):d.set_float(0)};c.prototype.layerscalerate=function(d,k){(k=this.runtime.getLayer(k))?d.set_float(k.zoomRate):d.set_float(0)};c.prototype.layerparallaxx=function(d,k){(k=this.runtime.getLayer(k))?d.set_float(100*k.parallaxX):d.set_float(0)};c.prototype.layerparallaxy=function(d,k){(k=this.runtime.getLayer(k))?d.set_float(100*k.parallaxY):d.set_float(0)};c.prototype.layerindex=function(d,k){(k=this.runtime.getLayer(k))?d.set_int(k.index):
d.set_int(-1)};c.prototype.layoutscale=function(d){this.runtime.running_layout?d.set_float(this.runtime.running_layout.scale):d.set_float(0)};c.prototype.layoutangle=function(d){d.set_float(cr.to_degrees(this.runtime.running_layout.angle))};c.prototype.layerangle=function(d,k){(k=this.runtime.getLayer(k))?d.set_float(cr.to_degrees(k.angle)):d.set_float(0)};c.prototype.layoutwidth=function(d){d.set_int(this.runtime.running_layout.width)};c.prototype.layoutheight=function(d){d.set_int(this.runtime.running_layout.height)};
c.prototype.find=function(d,k,E){cr.is_string(k)&&cr.is_string(E)?d.set_int(k.search(new RegExp(cr.regexp_escape(E),"i"))):d.set_int(-1)};c.prototype.findcase=function(d,k,E){cr.is_string(k)&&cr.is_string(E)?d.set_int(k.search(new RegExp(cr.regexp_escape(E),""))):d.set_int(-1)};c.prototype.left=function(d,k,E){d.set_string(cr.is_string(k)?k.substr(0,E):"")};c.prototype.right=function(d,k,E){d.set_string(cr.is_string(k)?k.substr(k.length-E):"")};c.prototype.mid=function(d,k,E,e){d.set_string(cr.is_string(k)?
k.substr(E,e):"")};c.prototype.tokenat=function(d,k,E,e){cr.is_string(k)&&cr.is_string(e)?(k=k.split(e),E=cr.floor(E),0>E||E>=k.length?d.set_string(""):d.set_string(k[E])):d.set_string("")};c.prototype.tokencount=function(d,k,E){cr.is_string(k)&&k.length?d.set_int(k.split(E).length):d.set_int(0)};c.prototype.replace=function(d,k,E,e){cr.is_string(k)&&cr.is_string(E)&&cr.is_string(e)?d.set_string(k.replace(new RegExp(cr.regexp_escape(E),"gi"),e)):d.set_string(cr.is_string(k)?k:"")};c.prototype.trim=
function(d,k){d.set_string(cr.is_string(k)?k.trim():"")};c.prototype.pi=function(d){d.set_float(cr.PI)};c.prototype.layoutname=function(d){this.runtime.running_layout?d.set_string(this.runtime.running_layout.name):d.set_string("")};c.prototype.renderer=function(d){d.set_string(this.runtime.gl?"webgl":"canvas2d")};c.prototype.rendererdetail=function(d){d.set_string(this.runtime.glUnmaskedRenderer)};c.prototype.anglediff=function(d,k,E){d.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(k),cr.to_radians(E))))};
c.prototype.choose=function(d){var k=cr.floor(Math.random()*(arguments.length-1));d.set_any(arguments[k+1])};c.prototype.rgb=function(d,k,E,e){d.set_int(cr.RGB(k,E,e))};c.prototype.rgbex=function(d,k,E,e){d.set_float(cr.RGBEx(k/100,E/100,e/100))};c.prototype.projectversion=function(d){d.set_string(this.runtime.versionstr)};c.prototype.projectname=function(d){d.set_string(this.runtime.name)};c.prototype.anglelerp=function(d,k,E,e){k=cr.to_radians(k);E=cr.to_radians(E);var w=cr.angleDiff(k,E);cr.angleClockwise(E,
k)?d.set_float(cr.to_clamped_degrees(k+w*e)):d.set_float(cr.to_clamped_degrees(k-w*e))};c.prototype.anglerotate=function(d,k,E,e){k=cr.to_radians(k);E=cr.to_radians(E);e=cr.to_radians(e);d.set_float(cr.to_clamped_degrees(cr.angleRotate(k,E,e)))};c.prototype.zeropad=function(d,k,E){var e=0>k?"-":"";0>k&&(k=-k);E-=k.toString().length;for(var w=0;w<E;w++)e+="0";d.set_string(e+k.toString())};c.prototype.cpuutilisation=function(d){d.set_float(this.runtime.cpuutilisation/1E3)};c.prototype.gpuutilisation=
function(d){d.set_float(this.runtime.gpuLastUtilisation)};c.prototype.viewportleft=function(d,k){k=this.runtime.getLayer(k);d.set_float(k?k.viewLeft:0)};c.prototype.viewporttop=function(d,k){k=this.runtime.getLayer(k);d.set_float(k?k.viewTop:0)};c.prototype.viewportright=function(d,k){k=this.runtime.getLayer(k);d.set_float(k?k.viewRight:0)};c.prototype.viewportbottom=function(d,k){k=this.runtime.getLayer(k);d.set_float(k?k.viewBottom:0)};c.prototype.loadingprogress=function(d){d.set_float(this.runtime.loadingprogress)};
c.prototype.unlerp=function(d,k,E,e){d.set_float(cr.unlerp(k,E,e))};c.prototype.canvassnapshot=function(d){d.set_string(this.runtime.snapshotData)};c.prototype.urlencode=function(d,k){d.set_string(encodeURIComponent(k))};c.prototype.urldecode=function(d,k){d.set_string(decodeURIComponent(k))};c.prototype.canvastolayerx=function(d,k,E,e){k=this.runtime.getLayer(k);d.set_float(k?k.canvasToLayer(E,e,!0):0)};c.prototype.canvastolayery=function(d,k,E,e){k=this.runtime.getLayer(k);d.set_float(k?k.canvasToLayer(E,
e,!1):0)};c.prototype.layertocanvasx=function(d,k,E,e){k=this.runtime.getLayer(k);d.set_float(k?k.layerToCanvas(E,e,!0):0)};c.prototype.layertocanvasy=function(d,k,E,e){k=this.runtime.getLayer(k);d.set_float(k?k.layerToCanvas(E,e,!1):0)};c.prototype.savestatejson=function(d){d.set_string(this.runtime.lastSaveJson)};c.prototype.imagememoryusage=function(d){this.runtime.glwrap?d.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):d.set_float(0)};c.prototype.regexsearch=function(d,
k,E,e){E=q(E,e);d.set_int(k?k.search(E):-1)};c.prototype.regexreplace=function(d,k,E,e,w){E=q(E,e);d.set_string(k?k.replace(E,w):"")};var B=[],S="",V="",L="";c.prototype.regexmatchcount=function(d,k,E,e){q(E,e);f(k.toString(),E,e);d.set_int(B?B.length:0)};c.prototype.regexmatchat=function(d,k,E,e,w){w=Math.floor(w);q(E,e);f(k.toString(),E,e);!B||0>w||w>=B.length?d.set_string(""):d.set_string(B[w])};c.prototype.infinity=function(d){d.set_float(Infinity)};c.prototype.setbit=function(d,k,E,e){E|=0;d.set_int((k|
0)&~(1<<E)|(0!==e?1:0)<<E)};c.prototype.togglebit=function(d,k,E){d.set_int((k|0)^1<<(E|0))};c.prototype.getbit=function(d,k,E){d.set_int((k|0)&1<<(E|0)?1:0)};c.prototype.originalwindowwidth=function(d){d.set_int(this.runtime.original_width)};c.prototype.originalwindowheight=function(d){d.set_int(this.runtime.original_height)};c.prototype.originalviewportwidth=function(d){d.set_int(this.runtime.original_width)};c.prototype.originalviewportheight=function(d){d.set_int(this.runtime.original_height)};
n.exps=new c;n.runWaits=function(){var d,k=this.runtime.getCurrentEventStack();var E=0;for(d=this.waits.length;E<d;E++){var e=this.waits[E];if(-1===e.time){if(!e.signalled)continue}else if(e.time>this.runtime.kahanTime.sum)continue;k.current_event=e.ev;k.actindex=e.actindex;k.cndindex=0;for(N in e.sols)if(e.sols.hasOwnProperty(N)){var w=this.runtime.types_by_index[parseInt(N,10)].getCurrentSol();var I=e.sols[N];w.select_all=I.sa;cr.shallowAssignArray(w.instances,I.insts);w=I;cr.clearArray(w.insts);
t.push(w)}e.ev.resume_actions_and_subevents();this.runtime.clearSol(e.solModifiers);e.deleteme=!0}var N=E=0;for(d=this.waits.length;E<d;E++)e=this.waits[E],this.waits[N]=e,e.deleteme?(cr.wipe(e.sols),cr.clearArray(e.solModifiers),h.push(e)):N++;cr.truncateArray(this.waits,N)}})();
(function(){cr.add_common_aces=function(l,q){var A=l[1],M=l[3],x=l[4],m=l[5],a=l[6],c=l[7],f=l[8],n=l[10],v=l[11];l=l[12];q.cnds||(q.cnds={});q.acts||(q.acts={});q.exps||(q.exps={});var y=q.cnds,K=q.acts;q=q.exps;M&&(y.CompareX=function(u,F){return cr.do_cmp(this.x,u,F)},y.CompareY=function(u,F){return cr.do_cmp(this.y,u,F)},y.IsOnScreen=function(){var u=this.layer;this.update_bbox();var F=this.bbox;return!(F.right<u.viewLeft||F.bottom<u.viewTop||F.left>u.viewRight||F.top>u.viewBottom)},y.IsOutsideLayout=
function(){this.update_bbox();var u=this.bbox,F=this.runtime.running_layout;return 0>u.right||0>u.bottom||u.left>F.width||u.top>F.height},y.PickDistance=function(u,F,D){var h=this.getCurrentSol(),t=h.getObjects();if(!t.length)return!1;var B=t[0],S=B,V=cr.distanceTo(B.x,B.y,F,D),L;var d=1;for(L=t.length;d<L;d++){B=t[d];var k=cr.distanceTo(B.x,B.y,F,D);if(0===u&&k<V||1===u&&k>V)V=k,S=B}h.pick_one(S);return!0},K.SetX=function(u){this.x!==u&&(this.x=u,this.set_bbox_changed())},K.SetY=function(u){this.y!==
u&&(this.y=u,this.set_bbox_changed())},K.SetPos=function(u,F){if(this.x!==u||this.y!==F)this.x=u,this.y=F,this.set_bbox_changed()},K.SetPosToObject=function(u,F){var D=u.getPairedInstance(this);D&&(D.getImagePoint?(u=D.getImagePoint(F,!0),F=D.getImagePoint(F,!1)):(u=D.x,F=D.y),this.x!==u||this.y!==F)&&(this.x=u,this.y=F,this.set_bbox_changed())},K.MoveForward=function(u){0!==u&&(this.x+=Math.cos(this.angle)*u,this.y+=Math.sin(this.angle)*u,this.set_bbox_changed())},K.MoveAtAngle=function(u,F){0!==
F&&(this.x+=Math.cos(cr.to_radians(u))*F,this.y+=Math.sin(cr.to_radians(u))*F,this.set_bbox_changed())},q.X=function(u){u.set_float(this.x)},q.Y=function(u){u.set_float(this.y)},q.dt=function(u){u.set_float(this.runtime.getDt(this))});x&&(y.CompareWidth=function(u,F){return cr.do_cmp(this.width,u,F)},y.CompareHeight=function(u,F){return cr.do_cmp(this.height,u,F)},K.SetWidth=function(u){this.width!==u&&(this.width=u,this.set_bbox_changed())},K.SetHeight=function(u){this.height!==u&&(this.height=u,
this.set_bbox_changed())},K.SetSize=function(u,F){if(this.width!==u||this.height!==F)this.width=u,this.height=F,this.set_bbox_changed()},q.Width=function(u){u.set_float(this.width)},q.Height=function(u){u.set_float(this.height)},q.BBoxLeft=function(u){this.update_bbox();u.set_float(this.bbox.left)},q.BBoxTop=function(u){this.update_bbox();u.set_float(this.bbox.top)},q.BBoxRight=function(u){this.update_bbox();u.set_float(this.bbox.right)},q.BBoxBottom=function(u){this.update_bbox();u.set_float(this.bbox.bottom)});
m&&(y.AngleWithin=function(u,F){return cr.angleDiff(this.angle,cr.to_radians(F))<=cr.to_radians(u)},y.IsClockwiseFrom=function(u){return cr.angleClockwise(this.angle,cr.to_radians(u))},y.IsBetweenAngles=function(u,F){u=cr.to_clamped_radians(u);F=cr.to_clamped_radians(F);var D=cr.clamp_angle(this.angle);return cr.angleClockwise(F,u)?cr.angleClockwise(D,u)&&!cr.angleClockwise(D,F):!(!cr.angleClockwise(D,u)&&cr.angleClockwise(D,F))},K.SetAngle=function(u){u=cr.to_radians(cr.clamp_angle_degrees(u));isNaN(u)||
this.angle===u||(this.angle=u,this.set_bbox_changed())},K.RotateClockwise=function(u){0===u||isNaN(u)||(this.angle+=cr.to_radians(u),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},K.RotateCounterclockwise=function(u){0===u||isNaN(u)||(this.angle-=cr.to_radians(u),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},K.RotateTowardAngle=function(u,F){u=cr.angleRotate(this.angle,cr.to_radians(F),cr.to_radians(u));isNaN(u)||this.angle===u||(this.angle=u,this.set_bbox_changed())},
K.RotateTowardPosition=function(u,F,D){u=cr.angleRotate(this.angle,Math.atan2(D-this.y,F-this.x),cr.to_radians(u));isNaN(u)||this.angle===u||(this.angle=u,this.set_bbox_changed())},K.SetTowardPosition=function(u,F){u=Math.atan2(F-this.y,u-this.x);isNaN(u)||this.angle===u||(this.angle=u,this.set_bbox_changed())},q.Angle=function(u){u.set_float(cr.to_clamped_degrees(this.angle))});A||(y.CompareInstanceVar=function(u,F,D){return cr.do_cmp(this.instance_vars[u],F,D)},y.IsBoolInstanceVarSet=function(u){return this.instance_vars[u]},
y.PickInstVarHiLow=function(u,F){var D=this.getCurrentSol(),h=D.getObjects();if(!h.length)return!1;var t=h[0],B=t,S=t.instance_vars[F],V;var L=1;for(V=h.length;L<V;L++){t=h[L];var d=t.instance_vars[F];if(0===u&&d<S||1===u&&d>S)S=d,B=t}D.pick_one(B);return!0},y.PickByUID=function(u){var F;if(this.runtime.getCurrentCondition().inverted){var D=this.getCurrentSol();if(D.select_all){D.select_all=!1;cr.clearArray(D.instances);cr.clearArray(D.else_instances);var h=this.instances;var t=0;for(F=h.length;t<
F;t++){var B=h[t];B.uid===u?D.else_instances.push(B):D.instances.push(B)}}else{h=t=0;for(F=D.instances.length;t<F;t++)B=D.instances[t],D.instances[h]=B,B.uid===u?D.else_instances.push(B):h++;cr.truncateArray(D.instances,h)}this.applySolToContainer();return!!D.instances.length}B=this.runtime.getObjectByUID(u);if(!B)return!1;D=this.getCurrentSol();if(!D.select_all&&-1===D.instances.indexOf(B))return!1;if(this.is_family)for(u=B.type.families,t=0,F=u.length;t<F;t++){if(u[t]===this)return D.pick_one(B),
this.applySolToContainer(),!0}else if(B.type===this)return D.pick_one(B),this.applySolToContainer(),!0;return!1},y.OnCreated=function(){return!0},y.OnDestroyed=function(){return!0},K.SetInstanceVar=function(u,F){var D=this.instance_vars;cr.is_number(D[u])?cr.is_number(F)?D[u]=F:D[u]=parseFloat(F):cr.is_string(D[u])&&(cr.is_string(F)?D[u]=F:D[u]=F.toString())},K.AddInstanceVar=function(u,F){var D=this.instance_vars;cr.is_number(D[u])?cr.is_number(F)?D[u]+=F:D[u]+=parseFloat(F):cr.is_string(D[u])&&
(cr.is_string(F)?D[u]+=F:D[u]+=F.toString())},K.SubInstanceVar=function(u,F){var D=this.instance_vars;cr.is_number(D[u])&&(cr.is_number(F)?D[u]-=F:D[u]-=parseFloat(F))},K.SetBoolInstanceVar=function(u,F){this.instance_vars[u]=F?1:0},K.ToggleBoolInstanceVar=function(u){this.instance_vars[u]=1-this.instance_vars[u]},K.Destroy=function(){this.runtime.DestroyInstance(this)},K.LoadFromJsonString||(K.LoadFromJsonString=function(u){try{var F=JSON.parse(u)}catch(h){return}this.runtime.loadInstanceFromJSON(this,
F,!0);this.afterLoad&&this.afterLoad();if(this.behavior_insts)for(u=0,F=this.behavior_insts.length;u<F;++u){var D=this.behavior_insts[u];D.afterLoad&&D.afterLoad()}}),q.Count=function(u){var F=u.object_class.instances.length,D;var h=0;for(D=this.runtime.createRow.length;h<D;h++){var t=this.runtime.createRow[h];u.object_class.is_family?0<=t.type.families.indexOf(u.object_class)&&F++:t.type===u.object_class&&F++}u.set_int(F)},q.PickedCount=function(u){u.set_int(u.object_class.getCurrentSol().getObjects().length)},
q.UID=function(u){u.set_int(this.uid)},q.IID=function(u){u.set_int(this.get_iid())},q.AsJSON||(q.AsJSON=function(u){u.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))}));a&&(y.IsVisible=function(){return this.visible},K.SetVisible=function(u){u=2===u?!this.visible:0!==u;u!==this.visible&&(this.visible=u,this.runtime.redraw=!0)},y.CompareOpacity=function(u,F){return cr.do_cmp(cr.round6dp(100*this.opacity),u,F)},K.SetOpacity=function(u){u/=100;0>u?u=0:1<u&&(u=1);u!==this.opacity&&
(this.opacity=u,this.runtime.redraw=!0)},q.Opacity=function(u){u.set_float(cr.round6dp(100*this.opacity))});c&&(y.IsOnLayer=function(u){return u?this.layer===u:!1},y.PickTopBottom=function(u){var F=this.getCurrentSol(),D=F.getObjects();if(!D.length)return!1;var h=D[0],t=h,B;var S=1;for(B=D.length;S<B;S++)if(h=D[S],0===u){if(h.layer.index>t.layer.index||h.layer.index===t.layer.index&&h.get_zindex()>t.get_zindex())t=h}else if(h.layer.index<t.layer.index||h.layer.index===t.layer.index&&h.get_zindex()<
t.get_zindex())t=h;F.pick_one(t);return!0},K.MoveToTop=function(){var u=this.layer,F=u.instances;F.length&&F[F.length-1]===this||(u.removeFromInstanceList(this,!1),u.appendToInstanceList(this,!1),this.runtime.redraw=!0)},K.MoveToBottom=function(){var u=this.layer,F=u.instances;F.length&&F[0]===this||(u.removeFromInstanceList(this,!1),u.prependToInstanceList(this,!1),this.runtime.redraw=!0)},K.MoveToLayer=function(u){u&&u!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=u,u.appendToInstanceList(this,
!0),this.runtime.redraw=!0)},K.ZMoveToObject=function(u,F){u=0===u;F&&(F=F.getFirstPicked(this))&&F.uid!==this.uid&&(this.layer.index!==F.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=F.layer,F.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,F,u),this.runtime.redraw=!0)},q.LayerNumber=function(u){u.set_int(this.layer.number)},q.LayerName=function(u){u.set_string(this.layer.name)},q.ZIndex=function(u){u.set_int(this.get_zindex())});f&&(K.SetEffectEnabled=
function(u,F){this.runtime.glwrap&&(F=this.type.getEffectIndexByName(F),0>F||(u=1===u,this.active_effect_flags[F]!==u&&(this.active_effect_flags[F]=u,this.updateActiveEffects(),this.runtime.redraw=!0)))},K.SetEffectParam=function(u,F,D){if(this.runtime.glwrap){var h=this.type.getEffectIndexByName(u);if(!(0>h||(u=this.type.effect_types[h],h=this.effect_params[h],F=Math.floor(F),0>F||F>=h.length))){var t=this.runtime.glwrap.getProgramParameterType(u.shaderindex,F);1===t&&(D/=100);if(2===t){t=cr.GetRValue(D);
var B=cr.GetGValue(D);D=cr.GetBValue(D);F=h[F];if(F[0]===t&&F[1]===B&&F[2]===D)return;F[0]=t;F[1]=B;F[2]=D}else{if(h[F]===D)return;h[F]=D}u.active&&(this.runtime.redraw=!0)}}});n&&(K.SetVisible=function(u){this.visible=0!==u},K.SetCSSStyle=function(u,F){this.elem.style[cr.cssToCamelCase(u)]=F});v&&(K.SetFocus=function(){(this.inputElem||this.elem).focus()},K.SetBlur=function(){(this.inputElem||this.elem).blur()});l&&(K.SetEnabled=function(u){(this.inputElem||this.elem).disabled=0===u})};cr.set_bbox_changed=
function(){this.cell_changed=this.bbox_changed=!0;this.type.any_cell_changed=!0;this.runtime.redraw=!0;var l,q=this.bbox_changed_callbacks;var A=0;for(l=q.length;A<l;++A)q[A](this);this.layer.useRenderCells&&this.update_bbox()};cr.add_bbox_changed_callback=function(l){l&&this.bbox_changed_callbacks.push(l)};cr.update_bbox=function(){if(this.bbox_changed){var l=this.bbox,q=this.bquad;l.set(this.x,this.y,this.x+this.width,this.y+this.height);l.offset(-this.hotspotX*this.width,-this.hotspotY*this.height);
this.angle?(l.offset(-this.x,-this.y),q.set_from_rotated_rect(l,this.angle),q.offset(this.x,this.y),q.bounding_box(l)):q.set_from_rect(l);l.normalize();this.bbox_changed=!1;this.update_render_cell()}};var b=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var l=this.layer.render_grid,q=this.bbox;b.set(l.XToCell(q.left),l.YToCell(q.top),l.XToCell(q.right),l.YToCell(q.bottom));this.rendercells.equals(b)||(this.rendercells.right<this.rendercells.left?l.update(this,
null,b):l.update(this,this.rendercells,b),this.rendercells.copy(b),this.layer.render_list_stale=!0)}};cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var l=this.type.collision_grid,q=this.bbox;b.set(l.XToCell(q.left),l.YToCell(q.top),l.XToCell(q.right),l.YToCell(q.bottom));this.collcells.equals(b)||(this.collcells.right<this.collcells.left?l.update(this,null,b):l.update(this,this.collcells,b),this.collcells.copy(b),this.cell_changed=!1)}};cr.inst_contains_pt=
function(l,q){return this.bbox.contains_pt(l,q)&&this.bquad.contains_pt(l,q)?this.tilemap_exists?this.testPointOverlapTile(l,q):this.collision_poly&&!this.collision_poly.is_empty()?(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(l-this.x,q-this.y)):!0:!1};cr.inst_get_iid=function(){this.type.updateIIDs();return this.iid};cr.inst_get_zindex=function(){this.layer.updateZIndices();return this.zindex};cr.inst_updateActiveEffects=function(){cr.clearArray(this.active_effect_types);
var l,q=!0;var A=0;for(l=this.active_effect_flags.length;A<l;A++)if(this.active_effect_flags[A]){var M=this.type.effect_types[A];this.active_effect_types.push(M);M.preservesOpaqueness||(q=!1)}this.uses_shaders=!!this.active_effect_types.length;this.shaders_preserve_opaqueness=q};cr.inst_toString=function(){return"Inst"+this.puid};cr.type_getFirstPicked=function(l){if(l&&l.is_contained&&l.type!=this){var q;var A=0;for(q=l.siblings.length;A<q;A++){var M=l.siblings[A];if(M.type==this)return M}}l=this.getCurrentSol().getObjects();
return l.length?l[0]:null};cr.type_getPairedInstance=function(l){var q=this.getCurrentSol().getObjects();return q.length?q[l.get_iid()%q.length]:null};cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var l;var q=0;for(l=this.instances.length;q<l;q++)this.instances[q].iid=q;var A=q,M=this.runtime.createRow;q=0;for(l=M.length;q<l;++q)M[q].type===this&&(M[q].iid=A++);this.stale_iids=!1}};cr.type_getInstanceByIID=function(l){if(l<this.instances.length)return this.instances[l];l-=this.instances.length;
var q=this.runtime.createRow,A;var M=0;for(A=q.length;M<A;++M)if(q[M].type===this){if(0===l)return q[M];--l}return null};cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]};cr.type_pushCleanSol=function(){this.cur_sol++;this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))};cr.type_pushCopySol=function(){this.cur_sol++;this.cur_sol===this.solstack.length&&
this.solstack.push(new cr.selection(this));var l=this.solstack[this.cur_sol],q=this.solstack[this.cur_sol-1];q.select_all?l.select_all=!0:(l.select_all=!1,cr.shallowAssignArray(l.instances,q.instances));cr.clearArray(l.else_instances)};cr.type_popSol=function(){this.cur_sol--};cr.type_getBehaviorByName=function(l){var q,A,M=0;if(!this.is_family){var x=0;for(q=this.families.length;x<q;x++){var m=this.families[x];var a=0;for(A=m.behaviors.length;a<A;a++){if(l===m.behaviors[a].name)return this.extra.lastBehIndex=
M,m.behaviors[a];M++}}}x=0;for(q=this.behaviors.length;x<q;x++){if(l===this.behaviors[x].name)return this.extra.lastBehIndex=M,this.behaviors[x];M++}return null};cr.type_getBehaviorIndexByName=function(l){return this.getBehaviorByName(l)?this.extra.lastBehIndex:-1};cr.type_getEffectIndexByName=function(l){var q;var A=0;for(q=this.effect_types.length;A<q;A++)if(this.effect_types[A].name===l)return A;return-1};cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var l,q,A;this.updateIIDs();
var M=this.getCurrentSol();var x=M.select_all,m=(l=this.runtime.getCurrentEventStack())&&l.current_event&&l.current_event.orblock;l=0;for(q=this.container.length;l<q;l++){var a=this.container[l];if(a!==this){a.updateIIDs();var c=a.getCurrentSol();c.select_all=x;if(!x){cr.clearArray(c.instances);var f=0;for(A=M.instances.length;f<A;++f)c.instances[f]=a.getInstanceByIID(M.instances[f].iid);if(m)for(cr.clearArray(c.else_instances),f=0,A=M.else_instances.length;f<A;++f)c.else_instances[f]=a.getInstanceByIID(M.else_instances[f].iid)}}}}};
cr.type_toString=function(){return"Type"+this.sid};cr.do_cmp=function(l,q,A){if("undefined"===typeof l||"undefined"===typeof A)return!1;switch(q){case 0:return l===A;case 1:return l!==A;case 2:return l<A;case 3:return l<=A;case 4:return l>A;case 5:return l>=A;default:return!1}}})();cr.shaders={};cr.plugins_.Sprite=function(b){this.runtime=b};
(function(){function b(){if(0===this.datauri.length){var L=document.createElement("canvas");L.width=this.width;L.height=this.height;var d=L.getContext("2d");this.spritesheeted?d.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):d.drawImage(this.texture_img,0,0,this.width,this.height);this.datauri=L.toDataURL("image/png")}return this.datauri}function l(){}function q(L){L[0]=0;L[1]=0;L[2]=0;u.push(L)}function A(L,d){return L<d?""+L+","+d:""+d+","+L}function M(L,
d,k,E){d=d.uid;k=k.uid;var e=A(d,k);if(L.hasOwnProperty(e))L[e][2]=E;else{var w=u.length?u.pop():[0,0,0];w[0]=d;w[1]=k;w[2]=E;L[e]=w}}function x(L,d,k){d=A(d.uid,k.uid);L.hasOwnProperty(d)&&(q(L[d]),delete L[d])}function m(L,d,k){d=A(d.uid,k.uid);if(L.hasOwnProperty(d))return F=L[d][2],!0;F=-2;return!1}function a(L,d,k){if(!L)return!1;var E=0!==d||0!==k,e=!1,w=this.runtime.getCurrentCondition(),I=w.type;w=w.inverted;var N=L.getCurrentSol();var U=this.runtime.getCurrentEventStack().current_event.orblock;
N.select_all?(this.update_bbox(),V.copy(this.bbox),V.offset(d,k),this.runtime.getCollisionCandidates(this.layer,L,V,S),N=S):N=U?this.runtime.isCurrentConditionFirst()&&!N.else_instances.length&&N.instances.length?N.instances:N.else_instances:N.instances;h=L;B=I!==L&&!w;if(E){var W=this.x;var X=this.y;this.x+=d;this.y+=k;this.set_bbox_changed()}d=0;for(k=N.length;d<k;d++)if(U=N[d],this.runtime.testOverlap(this,U)){e=!0;if(w)break;I!==L&&t.add(U)}E&&(this.x=W,this.y=X,this.set_bbox_changed());cr.clearArray(S);
return e}function c(){}function f(){}var n=cr.plugins_.Sprite.prototype;n.Type=function(L){this.plugin=L;this.runtime=L.runtime};var v=n.Type.prototype;v.onCreate=function(){if(!this.is_family){var L,d;this.all_frames=[];this.has_loaded_textures=!1;var k=0;for(L=this.animations.length;k<L;k++){var E=this.animations[k];var e={};e.name=E[0];e.speed=E[1];e.loop=E[2];e.repeatcount=E[3];e.repeatto=E[4];e.pingpong=E[5];e.sid=E[6];e.frames=[];var w=0;for(d=E[7].length;w<d;w++){var I=E[7][w];var N={};N.texture_file=
I[0];N.texture_filesize=I[1];N.offx=I[2];N.offy=I[3];N.width=I[4];N.height=I[5];N.duration=I[6];N.hotspotX=I[7];N.hotspotY=I[8];N.image_points=I[9];N.poly_pts=I[10];N.pixelformat=I[11];N.spritesheeted=0!==N.width;N.datauri="";N.getDataUri=b;var U={left:0,top:0,right:1,bottom:1};N.sheetTex=U;N.webGL_texture=null;(U=this.runtime.findWaitingTexture(I[0]))?N.texture_img=U:(N.texture_img=new Image,N.texture_img.cr_src=I[0],N.texture_img.cr_filesize=I[1],N.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(N.texture_img,
I[0]));cr.seal(N);e.frames.push(N);this.all_frames.push(N)}cr.seal(e);this.animations[k]=e}}};v.updateAllCurrentTexture=function(){var L;var d=0;for(L=this.instances.length;d<L;d++){var k=this.instances[d];k.curWebGLTexture=k.curFrame.webGL_texture}};v.onLostWebGLContext=function(){if(!this.is_family){var L;var d=0;for(L=this.all_frames.length;d<L;++d){var k=this.all_frames[d];k.texture_img.c2webGL_texture=null;k.webGL_texture=null}this.has_loaded_textures=!1;this.updateAllCurrentTexture()}};v.onRestoreWebGLContext=
function(){if(!this.is_family&&this.instances.length){var L;var d=0;for(L=this.all_frames.length;d<L;++d){var k=this.all_frames[d];k.webGL_texture=this.runtime.glwrap.loadTexture(k.texture_img,!1,this.runtime.linearSampling,k.pixelformat)}this.updateAllCurrentTexture()}};v.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){var L;var d=0;for(L=this.all_frames.length;d<L;++d){var k=this.all_frames[d];k.webGL_texture=this.runtime.glwrap.loadTexture(k.texture_img,
!1,this.runtime.linearSampling,k.pixelformat)}this.has_loaded_textures=!0}};v.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){var L;var d=0;for(L=this.all_frames.length;d<L;++d){var k=this.all_frames[d];this.runtime.glwrap.deleteTexture(k.webGL_texture);k.webGL_texture=null}this.has_loaded_textures=!1}};var y=[];v.preloadCanvas2D=function(L){var d;cr.clearArray(y);var k=0;for(d=this.all_frames.length;k<d;++k){var E=this.all_frames[k].texture_img;-1===
y.indexOf(E)&&(L.drawImage(E,0,0),y.push(E))}};n.Instance=function(L){this.type=L;this.runtime=L.runtime;L=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(L):this.collision_poly=new cr.CollisionPoly(L)};var K=n.Instance.prototype;K.onCreate=function(){this.visible=this.properties[0];this.inAnimTrigger=this.isTicking=!1;this.collisionsEnabled=this.properties[3];this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0];this.cur_frame=
this.properties[2];0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var L=this.cur_animation.frames[this.cur_frame];this.collision_poly.set_pts(L.poly_pts);this.hotspotX=L.hotspotX;this.hotspotY=L.hotspotY;this.animForwards=0<=this.cur_animation.speed;this.cur_anim_speed=Math.abs(this.cur_animation.speed);this.cur_anim_repeatto=this.cur_animation.repeatto;1===this.type.animations.length&&1===this.type.animations[0].frames.length||
0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0);this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder;this.frameStart=this.getNowTime();this.animPlaying=!0;this.animRepeats=0;this.changeAnimName=this.animTriggerName="";this.changeAnimFrom=0;this.changeAnimFrame=-1;this.type.loadTextures();var d,k;L=0;for(d=this.type.animations.length;L<d;L++){var E=this.type.animations[L];var e=0;for(k=E.frames.length;e<k;e++){var w=E.frames[e];0===w.width&&(w.width=w.texture_img.width,
w.height=w.texture_img.height);if(w.spritesheeted){var I=w.texture_img;var N=w.sheetTex;N.left=w.offx/I.width;N.top=w.offy/I.height;N.right=(w.offx+w.width)/I.width;N.bottom=(w.offy+w.height)/I.height;0===w.offx&&0===w.offy&&w.width===I.width&&w.height===I.height&&(w.spritesheeted=!1)}}}this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture};K.saveToJSON=function(){var L={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,
ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};this.animPlaying||(L.ap=this.animPlaying);this.animForwards||(L.af=this.animForwards);return L};K.loadFromJSON=function(L){var d=this.getAnimationBySid(L.a);d&&(this.cur_animation=d);this.cur_frame=L.f;0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);this.cur_anim_speed=L.cas;this.frameStart=L.fs;this.animRepeats=L.ar;this.animTimer.reset();
this.animTimer.sum=L.at;this.animPlaying=L.hasOwnProperty("ap")?L.ap:!0;this.animForwards=L.hasOwnProperty("af")?L.af:!0;L.hasOwnProperty("rt")?this.cur_anim_repeatto=L.rt:this.cur_anim_repeatto=this.cur_animation.repeatto;this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture;this.collision_poly.set_pts(this.curFrame.poly_pts);this.hotspotX=this.curFrame.hotspotX;this.hotspotY=this.curFrame.hotspotY};K.animationFinish=function(L){this.cur_frame=L?
0:this.cur_animation.frames.length-1;this.animPlaying=!1;this.animTriggerName=this.cur_animation.name;this.inAnimTrigger=!0;this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this);this.inAnimTrigger=!1;this.animRepeats=0};K.getNowTime=function(){return this.animTimer.sum};K.tick=function(){this.animTimer.add(this.runtime.getDt(this));this.changeAnimName.length&&this.doChangeAnim();0<=this.changeAnimFrame&&
this.doChangeAnimFrame();var L=this.getNowTime(),d=this.cur_animation,k=d.frames[this.cur_frame],E=k.duration/this.cur_anim_speed;this.animPlaying&&L>=this.frameStart+E&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=E,this.cur_frame>=d.frames.length&&(d.pingpong?(this.animForwards=!1,this.cur_frame=d.frames.length-2):d.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=d.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),
0>this.cur_frame&&(d.pingpong?(this.cur_frame=1,this.animForwards=!0,d.loop||(this.animRepeats++,this.animRepeats>=d.repeatcount&&this.animationFinish(!0))):d.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=d.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),0>this.cur_frame?this.cur_frame=0:this.cur_frame>=d.frames.length&&(this.cur_frame=d.frames.length-1),L>this.frameStart+d.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=
L),L=d.frames[this.cur_frame],this.OnFrameChanged(k,L),this.runtime.redraw=!0)};K.getAnimationByName=function(L){var d;var k=0;for(d=this.type.animations.length;k<d;k++){var E=this.type.animations[k];if(cr.equals_nocase(E.name,L))return E}return null};K.getAnimationBySid=function(L){var d;var k=0;for(d=this.type.animations.length;k<d;k++){var E=this.type.animations[k];if(E.sid===L)return E}return null};K.doChangeAnim=function(){var L=this.cur_animation.frames[this.cur_frame],d=this.getAnimationByName(this.changeAnimName);
this.changeAnimName="";!d||cr.equals_nocase(d.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=d,this.animForwards=0<=d.speed,this.cur_anim_speed=Math.abs(d.speed),this.cur_anim_repeatto=d.repeatto,0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.OnFrameChanged(L,this.cur_animation.frames[this.cur_frame]),
this.runtime.redraw=!0)};K.doChangeAnimFrame=function(){var L=this.cur_animation.frames[this.cur_frame],d=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame);0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);d!==this.cur_frame&&(this.OnFrameChanged(L,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0);this.changeAnimFrame=-1};K.OnFrameChanged=function(L,
d){var k=L.width,E=L.height,e=d.width,w=d.height;k!=e&&(this.width*=e/k);E!=w&&(this.height*=w/E);this.hotspotX=d.hotspotX;this.hotspotY=d.hotspotY;this.collision_poly.set_pts(d.poly_pts);this.set_bbox_changed();this.curFrame=d;this.curWebGLTexture=d.webGL_texture;k=0;for(E=this.behavior_insts.length;k<E;k++)if(e=this.behavior_insts[k],e.onSpriteFrameChanged)e.onSpriteFrameChanged(L,d);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)};K.draw=function(L){L.globalAlpha=this.opacity;
var d=this.curFrame,k=d.spritesheeted,E=d.texture_img,e=this.x,w=this.y,I=this.width,N=this.height;if(0===this.angle&&0<=I&&0<=N)e-=this.hotspotX*I,w-=this.hotspotY*N,this.runtime.pixel_rounding&&(e=Math.round(e),w=Math.round(w)),k?L.drawImage(E,d.offx,d.offy,d.width,d.height,e,w,I,N):L.drawImage(E,e,w,I,N);else{this.runtime.pixel_rounding&&(e=Math.round(e),w=Math.round(w));L.save();var U=0<I?1:-1,W=0<N?1:-1;L.translate(e,w);1===U&&1===W||L.scale(U,W);L.rotate(this.angle*U*W);e=-(this.hotspotX*cr.abs(I));
w=-(this.hotspotY*cr.abs(N));k?L.drawImage(E,d.offx,d.offy,d.width,d.height,e,w,cr.abs(I),cr.abs(N)):L.drawImage(E,e,w,cr.abs(I),cr.abs(N));L.restore()}};K.drawGL_earlyZPass=function(L){this.drawGL(L)};K.drawGL=function(L){L.setTexture(this.curWebGLTexture);L.setOpacity(this.opacity);var d=this.curFrame,k=this.bquad;if(this.runtime.pixel_rounding){var E=Math.round(this.x)-this.x,e=Math.round(this.y)-this.y;d.spritesheeted?L.quadTex(k.tlx+E,k.tly+e,k.trx+E,k.try_+e,k.brx+E,k.bry+e,k.blx+E,k.bly+e,
d.sheetTex):L.quad(k.tlx+E,k.tly+e,k.trx+E,k.try_+e,k.brx+E,k.bry+e,k.blx+E,k.bly+e)}else d.spritesheeted?L.quadTex(k.tlx,k.tly,k.trx,k.try_,k.brx,k.bry,k.blx,k.bly,d.sheetTex):L.quad(k.tlx,k.tly,k.trx,k.try_,k.brx,k.bry,k.blx,k.bly)};K.getImagePointIndexByName=function(L){var d=this.curFrame,k;var E=0;for(k=d.image_points.length;E<k;E++)if(cr.equals_nocase(L,d.image_points[E][0]))return E;return-1};K.getImagePoint=function(L,d){var k=this.curFrame,E=k.image_points;var e=cr.is_string(L)?this.getImagePointIndexByName(L):
L-1;e=cr.floor(e);if(0>e||e>=E.length)return d?this.x:this.y;L=(E[e][1]-k.hotspotX)*this.width;E=E[e][2];E=(E-k.hotspotY)*this.height;k=Math.cos(this.angle);e=Math.sin(this.angle);var w=L*k-E*e;E=E*k+L*e;L=w+this.x;E+=this.y;return d?L:E};var u=[],F=-2,D=[];l.prototype.OnCollision=function(L){if(!L)return!1;var d=this.runtime,k=d.getCurrentCondition(),E=k.type,e=null;k.extra.collmemory?e=k.extra.collmemory:(e={},k.extra.collmemory=e);k.extra.spriteCreatedDestroyCallback||(k.extra.spriteCreatedDestroyCallback=
!0,d.addDestroyCallback(function(G){var z=k.extra.collmemory;G=G.uid;var J;for(J in z)if(z.hasOwnProperty(J)){var Q=z[J];if(Q[0]===G||Q[1]===G)q(z[J]),delete z[J]}}));var w=E.getCurrentSol(),I=L.getCurrentSol();w=w.getObjects();var N,U,W=this.runtime.tickcount,X=W-1,Y=d.getCurrentEventStack().current_event;for(N=0;N<w.length;N++){var ea=w[N];if(I.select_all){ea.update_bbox();this.runtime.getCollisionCandidates(ea.layer,L,ea.bbox,D);var ha=D;this.runtime.addRegisteredCollisionCandidates(ea,L,ha)}else ha=
I.getObjects();for(U=0;U<ha.length;U++){var g=ha[U];if(d.testOverlap(ea,g)||d.checkRegisteredCollision(ea,g)){var p=m(e,ea,g);p=!p||F<X;M(e,ea,g,W);if(p){d.pushCopySol(Y.solModifiers);p=E.getCurrentSol();var C=L.getCurrentSol();p.select_all=!1;C.select_all=!1;E===L?(p.instances.length=2,p.instances[0]=ea,p.instances[1]=g,E.applySolToContainer()):(p.instances.length=1,C.instances.length=1,p.instances[0]=ea,C.instances[0]=g,E.applySolToContainer(),L.applySolToContainer());Y.retrigger();d.popSol(Y.solModifiers)}}else x(e,
ea,g)}cr.clearArray(D)}return!1};var h=null,t=new cr.ObjectSet,B=!1,S=[],V=new cr.rect(0,0,0,0);v.finish=function(L){if(B){if(L){var d=this.runtime.getCurrentEventStack().current_event.orblock;L=h.getCurrentSol();var k=t.valuesRef(),E;if(L.select_all){L.select_all=!1;cr.clearArray(L.instances);var e=0;for(E=k.length;e<E;++e)L.instances[e]=k[e];if(d)for(cr.clearArray(L.else_instances),e=0,E=h.instances.length;e<E;++e)k=h.instances[e],t.contains(k)||L.else_instances.push(k)}else if(d)for(d=L.instances.length,
e=0,E=k.length;e<E;++e)L.instances[d+e]=k[e],cr.arrayFindRemove(L.else_instances,k[e]);else cr.shallowAssignArray(L.instances,k);h.applySolToContainer()}t.clear();B=!1}};l.prototype.IsOverlapping=function(L){return a.call(this,L,0,0)};l.prototype.IsOverlappingOffset=function(L,d,k){return a.call(this,L,d,k)};l.prototype.IsAnimPlaying=function(L){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,L):cr.equals_nocase(this.cur_animation.name,L)};l.prototype.CompareFrame=function(L,
d){return cr.do_cmp(this.cur_frame,L,d)};l.prototype.CompareAnimSpeed=function(L,d){return cr.do_cmp(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed,L,d)};l.prototype.OnAnimFinished=function(L){return cr.equals_nocase(this.animTriggerName,L)};l.prototype.OnAnyAnimFinished=function(){return!0};l.prototype.OnFrameChanged=function(){return!0};l.prototype.IsMirrored=function(){return 0>this.width};l.prototype.IsFlipped=function(){return 0>this.height};l.prototype.OnURLLoaded=function(){return!0};
l.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled};n.cnds=new l;c.prototype.Spawn=function(L,d,k){if(L&&d&&(d=this.runtime.createInstance(L,d,this.getImagePoint(k,!0),this.getImagePoint(k,!1)))){"undefined"!==typeof d.angle&&(d.angle=this.angle,d.set_bbox_changed());this.runtime.isInOnDestroy++;var E;this.runtime.trigger(Object.getPrototypeOf(L.plugin).cnds.OnCreated,d);if(d.is_contained){var e=0;for(E=d.siblings.length;e<E;e++){var w=d.siblings[e];this.runtime.trigger(Object.getPrototypeOf(w.type.plugin).cnds.OnCreated,
w)}}this.runtime.isInOnDestroy--;e=this.runtime.getCurrentAction();k=!1;if(cr.is_undefined(e.extra.Spawn_LastExec)||e.extra.Spawn_LastExec<this.runtime.execcount)k=!0,e.extra.Spawn_LastExec=this.runtime.execcount;if(L!=this.type&&(L=L.getCurrentSol(),L.select_all=!1,k?(cr.clearArray(L.instances),L.instances[0]=d):L.instances.push(d),d.is_contained))for(e=0,E=d.siblings.length;e<E;e++)w=d.siblings[e],L=w.type.getCurrentSol(),L.select_all=!1,k?(cr.clearArray(L.instances),L.instances[0]=w):L.instances.push(w)}};
c.prototype.SetEffect=function(L){this.blend_mode=L;this.compositeOp=cr.effectToCompositeOp(L);cr.setGLBlend(this,L,this.runtime.gl);this.runtime.redraw=!0};c.prototype.StopAnim=function(){this.animPlaying=!1};c.prototype.StartAnim=function(L){this.animPlaying=!0;this.frameStart=this.getNowTime();1===L&&0!==this.cur_frame&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame());this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};c.prototype.SetAnim=function(L,d){this.changeAnimName=
L;this.changeAnimFrom=d;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnim()};c.prototype.SetAnimFrame=function(L){this.changeAnimFrame=L;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnimFrame()};c.prototype.SetAnimSpeed=function(L){this.cur_anim_speed=cr.abs(L);this.animForwards=0<=L;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};c.prototype.SetAnimRepeatToFrame=function(L){L=Math.floor(L);
0>L&&(L=0);L>=this.cur_animation.frames.length&&(L=this.cur_animation.frames.length-1);this.cur_anim_repeatto=L};c.prototype.SetMirrored=function(L){L=cr.abs(this.width)*(0===L?-1:1);this.width!==L&&(this.width=L,this.set_bbox_changed())};c.prototype.SetFlipped=function(L){L=cr.abs(this.height)*(0===L?-1:1);this.height!==L&&(this.height=L,this.set_bbox_changed())};c.prototype.SetScale=function(L){var d=this.curFrame,k=d.width*L*(0>this.width?-1:1);L=d.height*L*(0>this.height?-1:1);if(this.width!==
k||this.height!==L)this.width=k,this.height=L,this.set_bbox_changed()};c.prototype.LoadURL=function(L,d,k){var E=new Image,e=this,w=this.curFrame;E.onload=function(){w.texture_img.src===E.src?e.runtime.glwrap&&e.curFrame===w&&(e.curWebGLTexture=w.webGL_texture):(w.texture_img=E,w.offx=0,w.offy=0,w.width=E.width,w.height=E.height,w.spritesheeted=!1,w.datauri="",w.pixelformat=0,e.runtime.glwrap&&(w.webGL_texture&&e.runtime.glwrap.deleteTexture(w.webGL_texture),w.webGL_texture=e.runtime.glwrap.loadTexture(E,
!1,e.runtime.linearSampling),e.curFrame===w&&(e.curWebGLTexture=w.webGL_texture),e.type.updateAllCurrentTexture()));0===d&&(e.width=E.width,e.height=E.height,e.set_bbox_changed());e.runtime.redraw=!0;e.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,e)};"data:"!==L.substr(0,5)&&0===k&&(E.crossOrigin="anonymous");this.runtime.setImageSrc(E,L)};c.prototype.SetCollisions=function(L){this.collisionsEnabled!==(0!==L)&&((this.collisionsEnabled=0!==L)?this.set_bbox_changed():(this.collcells.right>=
this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))};n.acts=new c;f.prototype.AnimationFrame=function(L){L.set_int(this.cur_frame)};f.prototype.AnimationFrameCount=function(L){L.set_int(this.cur_animation.frames.length)};f.prototype.AnimationName=function(L){L.set_string(this.cur_animation.name)};f.prototype.AnimationSpeed=function(L){L.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)};f.prototype.ImagePointX=function(L,
d){L.set_float(this.getImagePoint(d,!0))};f.prototype.ImagePointY=function(L,d){L.set_float(this.getImagePoint(d,!1))};f.prototype.ImagePointCount=function(L){L.set_int(this.curFrame.image_points.length)};f.prototype.ImageWidth=function(L){L.set_float(this.curFrame.width)};f.prototype.ImageHeight=function(L){L.set_float(this.curFrame.height)};n.exps=new f})();cr.plugins_.Touch=function(b){this.runtime=b};
(function(){function b(h){f=h.x;n=h.y;v=h.z}function l(h,t,B,S){var V=y.length?y.pop():new q;V.init(h,t,B,S);return V}function q(){this.startindex=this.id=this.lasty=this.lastx=this.y=this.x=this.starty=this.startx=this.lasttime=this.time=this.starttime=0;this.tooFarForHold=this.triggeredHold=!1}function A(h){return h.sourceCapabilities&&h.sourceCapabilities.firesTouchEvents||h.originalEvent&&h.originalEvent.sourceCapabilities&&h.originalEvent.sourceCapabilities.firesTouchEvents}function M(){}function x(){}
function m(){}var a=cr.plugins_.Touch.prototype;a.Type=function(h){this.plugin=h;this.runtime=h.runtime};a.Type.prototype.onCreate=function(){};a.Instance=function(h){this.type=h;this.runtime=h.runtime;this.touches=[];this.mouseDown=!1};var c=a.Instance.prototype;c.findTouch=function(h){var t;var B=0;for(t=this.touches.length;B<t;B++)if(this.touches[B].id===h)return B;return-1};var f=0,n=0,v=0,y=[];q.prototype.init=function(h,t,B,S){var V=cr.performance_now();this.starttime=this.lasttime=this.time=
V;this.startx=h;this.starty=t;this.x=h;this.y=t;this.lastx=h;this.lasty=t;this.pressure=this.height=this.width=0;this.id=B;this.startindex=S;this.tooFarForHold=this.triggeredHold=!1};q.prototype.update=function(h,t,B,S,V,L){this.lasttime=this.time;this.time=h;this.lastx=this.x;this.lasty=this.y;this.x=t;this.y=B;this.width=S;this.height=V;this.pressure=L;!this.tooFarForHold&&15<=cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.tooFarForHold=!0)};q.prototype.maybeTriggerHold=function(h,
t){!this.triggeredHold&&500<=cr.performance_now()-this.starttime&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.triggeredHold=!0,h.trigger_index=this.startindex,h.trigger_id=this.id,h.getTouchIndex=t,h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,h),h.curTouchX=this.x,h.curTouchY=this.y,h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,h),h.getTouchIndex=0)};var K=-1E3,u=-1E3,F=-1E4;q.prototype.maybeTriggerTap=function(h,
t){if(!this.triggeredHold){var B=cr.performance_now();333>=B-this.starttime&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(h.trigger_index=this.startindex,h.trigger_id=this.id,h.getTouchIndex=t,666>=B-F&&25>cr.distanceTo(K,u,this.x,this.y)?(h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,h),h.curTouchX=this.x,h.curTouchY=this.y,h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,h),u=K=-1E3,F=-1E4):(h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,
h),h.curTouchX=this.x,h.curTouchY=this.y,h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,h),K=this.x,u=this.y,F=B),h.getTouchIndex=0)}};c.onCreate=function(){this.isWindows8=!("undefined"===typeof window.c2isWindows8||!window.c2isWindows8);this.getTouchIndex=this.trigger_permission=this.trigger_id=this.trigger_index=this.curTouchY=this.curTouchX=this.acc_z=this.acc_y=this.acc_x=this.acc_g_z=this.acc_g_y=this.acc_g_x=this.orient_gamma=this.orient_beta=this.orient_alpha=0;this.useMouseInput=
this.properties[0];var h=0<this.runtime.fullscreen_mode?document:this.runtime.canvas,t=document,B=this;"undefined"!==typeof PointerEvent?(h.addEventListener("pointerdown",function(k){B.onPointerStart(k)},!1),h.addEventListener("pointermove",function(k){B.onPointerMove(k)},!1),t.addEventListener("pointerup",function(k){B.onPointerEnd(k,!1)},!1),t.addEventListener("pointercancel",function(k){B.onPointerEnd(k,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(k){k.preventDefault()},
!1),document.addEventListener("MSGestureHold",function(k){k.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(k){k.preventDefault()},!1),document.addEventListener("gesturehold",function(k){k.preventDefault()},!1))):window.navigator.msPointerEnabled?(h.addEventListener("MSPointerDown",function(k){B.onPointerStart(k)},!1),h.addEventListener("MSPointerMove",function(k){B.onPointerMove(k)},!1),t.addEventListener("MSPointerUp",function(k){B.onPointerEnd(k,!1)},!1),t.addEventListener("MSPointerCancel",
function(k){B.onPointerEnd(k,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(k){k.preventDefault()},!1),document.addEventListener("MSGestureHold",function(k){k.preventDefault()},!1))):(h.addEventListener("touchstart",function(k){B.onTouchStart(k)},!1),h.addEventListener("touchmove",function(k){B.onTouchMove(k)},!1),t.addEventListener("touchend",function(k){B.onTouchEnd(k,!1)},!1),t.addEventListener("touchcancel",function(k){B.onTouchEnd(k,!0)},!1));if(this.isWindows8){var S=
function(k){k=k.reading;B.acc_x=k.accelerationX;B.acc_y=k.accelerationY;B.acc_z=k.accelerationZ},V=function(k){k=k.reading;B.orient_alpha=k.yawDegrees;B.orient_beta=k.pitchDegrees;B.orient_gamma=k.rollDegrees},L=Windows.Devices.Sensors.Accelerometer.getDefault();L&&(L.reportInterval=Math.max(L.minimumReportInterval,16),L.addEventListener("readingchanged",S));var d=Windows.Devices.Sensors.Inclinometer.getDefault();d&&(d.reportInterval=Math.max(d.minimumReportInterval,16),d.addEventListener("readingchanged",
V));document.addEventListener("visibilitychange",function(k){document.hidden||document.msHidden?(L&&L.removeEventListener("readingchanged",S),d&&d.removeEventListener("readingchanged",V)):(L&&L.addEventListener("readingchanged",S),d&&d.addEventListener("readingchanged",V))},!1)}else window.addEventListener("deviceorientation",function(k){B.orient_alpha=k.alpha||0;B.orient_beta=k.beta||0;B.orient_gamma=k.gamma||0},!1),window.addEventListener("devicemotion",function(k){k.accelerationIncludingGravity&&
(B.acc_g_x=k.accelerationIncludingGravity.x||0,B.acc_g_y=k.accelerationIncludingGravity.y||0,B.acc_g_z=k.accelerationIncludingGravity.z||0);k.acceleration&&(B.acc_x=k.acceleration.x||0,B.acc_y=k.acceleration.y||0,B.acc_z=k.acceleration.z||0)},!1);this.useMouseInput&&(document.addEventListener("mousemove",function(k){B.onMouseMove(k)}),document.addEventListener("mousedown",function(k){B.onMouseDown(k)}),document.addEventListener("mouseup",function(k){B.onMouseUp(k)}));!this.runtime.isiOS&&this.runtime.isCordova&&
navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(b,null,{frequency:40});this.runtime.tick2Me(this)};c.onPointerMove=function(h){if(h.pointerType!==h.MSPOINTER_TYPE_MOUSE&&"mouse"!==h.pointerType){h.preventDefault&&h.preventDefault();var t=this.findTouch(h.pointerId),B=cr.performance_now();0<=t&&(t=this.touches[t],2>B-t.time||t.update(B,h.pageX-this.runtime.canvas.offsetLeft,h.pageY-this.runtime.canvas.offsetTop,h.width||0,h.height||0,h.pressure||
0))}};c.onPointerStart=function(h){if(h.pointerType!==h.MSPOINTER_TYPE_MOUSE&&"mouse"!==h.pointerType&&-1===this.findTouch(h.pointerId)){h.preventDefault&&cr.isCanvasInputEvent(h)&&h.preventDefault();var t=h.pageX-this.runtime.canvas.offsetLeft,B=h.pageY-this.runtime.canvas.offsetTop;cr.performance_now();this.trigger_index=this.touches.length;this.trigger_id=h.pointerId;this.touches.push(l(t,B,h.pointerId,this.trigger_index));this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,
this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=t;this.curTouchY=B;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this);this.runtime.isInUserInputEvent=!1}};c.onPointerEnd=function(h,t){h.pointerType!==h.MSPOINTER_TYPE_MOUSE&&"mouse"!==h.pointerType&&(h.preventDefault&&cr.isCanvasInputEvent(h)&&h.preventDefault(),h=this.findTouch(h.pointerId),this.trigger_index=0<=h?this.touches[h].startindex:-1,this.trigger_id=0<=h?this.touches[h].id:
-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),0<=h&&(t||this.touches[h].maybeTriggerTap(this,h),100>y.length&&y.push(this.touches[h]),this.touches.splice(h,1)),this.runtime.isInUserInputEvent=!1)};c.onTouchMove=function(h){h.preventDefault&&h.preventDefault();var t=cr.performance_now(),B;var S=0;for(B=h.changedTouches.length;S<B;S++){var V=h.changedTouches[S];var L=
this.findTouch(V.identifier);if(0<=L){var d=this.runtime.canvas.offsetLeft,k=this.runtime.canvas.offsetTop;L=this.touches[L];2>t-L.time||L.update(t,V.pageX-d,V.pageY-k,2*(V.radiusX||V.webkitRadiusX||V.mozRadiusX||V.msRadiusX||0),2*(V.radiusY||V.webkitRadiusY||V.mozRadiusY||V.msRadiusY||0),V.force||V.webkitForce||V.mozForce||V.msForce||0)}}};c.onTouchStart=function(h){h.preventDefault&&cr.isCanvasInputEvent(h)&&h.preventDefault();var t=this.runtime.canvas.offsetLeft,B=this.runtime.canvas.offsetTop;
cr.performance_now();this.runtime.isInUserInputEvent=!0;var S;var V=0;for(S=h.changedTouches.length;V<S;V++){var L=h.changedTouches[V];var d=this.findTouch(L.identifier);if(-1===d){d=L.pageX-t;var k=L.pageY-B;this.trigger_index=this.touches.length;this.trigger_id=L.identifier;this.touches.push(l(d,k,L.identifier,this.trigger_index));this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=d;
this.curTouchY=k;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)}}this.runtime.isInUserInputEvent=!1};c.onTouchEnd=function(h,t){h.preventDefault&&cr.isCanvasInputEvent(h)&&h.preventDefault();this.runtime.isInUserInputEvent=!0;var B;var S=0;for(B=h.changedTouches.length;S<B;S++){var V=h.changedTouches[S];V=this.findTouch(V.identifier);0<=V&&(this.trigger_index=this.touches[V].startindex,this.trigger_id=this.touches[V].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,
this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),t||this.touches[V].maybeTriggerTap(this,V),100>y.length&&y.push(this.touches[V]),this.touches.splice(V,1))}this.runtime.isInUserInputEvent=!1};c.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==v?90*v:this.orient_alpha};c.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==n?90*n:this.orient_beta};c.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&
0!==f?90*f:this.orient_gamma};c.onMouseDown=function(h){A(h)||(this.onTouchStart({changedTouches:[{pageX:h.pageX,pageY:h.pageY,identifier:0}]}),this.mouseDown=!0)};c.onMouseMove=function(h){if(this.mouseDown&&!A(h))this.onTouchMove({changedTouches:[{pageX:h.pageX,pageY:h.pageY,identifier:0}]})};c.onMouseUp=function(h){h.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&h.preventDefault();this.runtime.had_a_click=!0;A(h)||(this.onTouchEnd({changedTouches:[{pageX:h.pageX,pageY:h.pageY,
identifier:0}]}),this.mouseDown=!1)};c.isClientPosOverCanvas=function(h,t){return 0<=h&&0<=t&&h<this.runtime.width&&t<this.runtime.height};c.tick2=function(){var h,t=cr.performance_now();var B=0;for(h=this.touches.length;B<h;++B){var S=this.touches[B];S.time<=t-50&&(S.lasttime=t);S.maybeTriggerHold(this,B)}};M.prototype.OnTouchStart=function(){return!0};M.prototype.OnTouchEnd=function(){return!0};M.prototype.IsInTouch=function(){return this.touches.length};M.prototype.OnTouchObject=function(h){return h&&
this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(h,this.curTouchX,this.curTouchY,!1):!1};var D=[];M.prototype.IsTouchingObject=function(h){if(!h)return!1;var t=h.getCurrentSol(),B=t.getObjects(),S,V;var L=0;for(S=B.length;L<S;L++){var d=B[L];d.update_bbox();var k=0;for(V=this.touches.length;k<V;k++){var E=this.touches[k];if(this.isClientPosOverCanvas(E.x,E.y)){var e=d.layer.canvasToLayer(E.x,E.y,!0);E=d.layer.canvasToLayer(E.x,E.y,!1);if(d.contains_pt(e,
E)){D.push(d);break}}}}return D.length?(t.select_all=!1,cr.shallowAssignArray(t.instances,D),h.applySolToContainer(),cr.clearArray(D),!0):!1};M.prototype.CompareTouchSpeed=function(h,t,B){h=Math.floor(h);if(0>h||h>=this.touches.length)return!1;var S=this.touches[h];h=cr.distanceTo(S.x,S.y,S.lastx,S.lasty);S=(S.time-S.lasttime)/1E3;var V=0;0<S&&(V=h/S);return cr.do_cmp(V,t,B)};M.prototype.OrientationSupported=function(){return"undefined"!==typeof window.DeviceOrientationEvent};M.prototype.MotionSupported=
function(){return"undefined"!==typeof window.DeviceMotionEvent};M.prototype.CompareOrientation=function(h,t,B){h=0===h?this.getAlpha():1===h?this.getBeta():this.getGamma();return cr.do_cmp(h,t,B)};M.prototype.CompareAcceleration=function(h,t,B){var S=0;0===h?S=this.acc_g_x:1===h?S=this.acc_g_y:2===h?S=this.acc_g_z:3===h?S=this.acc_x:4===h?S=this.acc_y:5===h&&(S=this.acc_z);return cr.do_cmp(S,t,B)};M.prototype.OnNthTouchStart=function(h){h=Math.floor(h);return h===this.trigger_index};M.prototype.OnNthTouchEnd=
function(h){h=Math.floor(h);return h===this.trigger_index};M.prototype.HasNthTouch=function(h){h=Math.floor(h);return this.touches.length>=h+1};M.prototype.OnHoldGesture=function(){return!0};M.prototype.OnTapGesture=function(){return!0};M.prototype.OnDoubleTapGesture=function(){return!0};M.prototype.OnHoldGestureObject=function(h){return h&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(h,this.curTouchX,this.curTouchY,!1):!1};M.prototype.OnTapGestureObject=
function(h){return h&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(h,this.curTouchX,this.curTouchY,!1):!1};M.prototype.OnDoubleTapGestureObject=function(h){return h&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(h,this.curTouchX,this.curTouchY,!1):!1};M.prototype.OnPermissionGranted=function(h){return this.trigger_permission===h};M.prototype.OnPermissionDenied=function(h){return this.trigger_permission===
h};a.cnds=new M;x.prototype.RequestPermission=function(h){var t=this,B=Promise.resolve(!0);0===h?window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission&&(B=window.DeviceOrientationEvent.requestPermission().then(function(S){return"granted"===S})):window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission&&(B=window.DeviceMotionEvent.requestPermission().then(function(S){return"granted"===S}));B.then(function(S){t.trigger_permission=h;S?t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionGranted,
t):t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionDenied,t)})};a.acts=new x;m.prototype.TouchCount=function(h){h.set_int(this.touches.length)};m.prototype.X=function(h,t){var B=this.getTouchIndex;if(0>B||B>=this.touches.length)h.set_float(0);else if(cr.is_undefined(t)){t=this.runtime.getLayerByNumber(0);var S=t.scale;var V=t.zoomRate;var L=t.parallaxX;var d=t.angle;t.scale=1;t.zoomRate=1;t.parallaxX=1;t.angle=0;h.set_float(t.canvasToLayer(this.touches[B].x,this.touches[B].y,!0));t.scale=
S;t.zoomRate=V;t.parallaxX=L;t.angle=d}else(t=cr.is_number(t)?this.runtime.getLayerByNumber(t):this.runtime.getLayerByName(t))?h.set_float(t.canvasToLayer(this.touches[B].x,this.touches[B].y,!0)):h.set_float(0)};m.prototype.XAt=function(h,t,B){t=Math.floor(t);if(0>t||t>=this.touches.length)h.set_float(0);else if(cr.is_undefined(B)){B=this.runtime.getLayerByNumber(0);var S=B.scale;var V=B.zoomRate;var L=B.parallaxX;var d=B.angle;B.scale=1;B.zoomRate=1;B.parallaxX=1;B.angle=0;h.set_float(B.canvasToLayer(this.touches[t].x,
this.touches[t].y,!0));B.scale=S;B.zoomRate=V;B.parallaxX=L;B.angle=d}else(B=cr.is_number(B)?this.runtime.getLayerByNumber(B):this.runtime.getLayerByName(B))?h.set_float(B.canvasToLayer(this.touches[t].x,this.touches[t].y,!0)):h.set_float(0)};m.prototype.XForID=function(h,t,B){t=this.findTouch(t);if(0>t)h.set_float(0);else if(t=this.touches[t],cr.is_undefined(B)){B=this.runtime.getLayerByNumber(0);var S=B.scale;var V=B.zoomRate;var L=B.parallaxX;var d=B.angle;B.scale=1;B.zoomRate=1;B.parallaxX=1;
B.angle=0;h.set_float(B.canvasToLayer(t.x,t.y,!0));B.scale=S;B.zoomRate=V;B.parallaxX=L;B.angle=d}else(B=cr.is_number(B)?this.runtime.getLayerByNumber(B):this.runtime.getLayerByName(B))?h.set_float(B.canvasToLayer(t.x,t.y,!0)):h.set_float(0)};m.prototype.Y=function(h,t){var B=this.getTouchIndex;if(0>B||B>=this.touches.length)h.set_float(0);else if(cr.is_undefined(t)){t=this.runtime.getLayerByNumber(0);var S=t.scale;var V=t.zoomRate;var L=t.parallaxY;var d=t.angle;t.scale=1;t.zoomRate=1;t.parallaxY=
1;t.angle=0;h.set_float(t.canvasToLayer(this.touches[B].x,this.touches[B].y,!1));t.scale=S;t.zoomRate=V;t.parallaxY=L;t.angle=d}else(t=cr.is_number(t)?this.runtime.getLayerByNumber(t):this.runtime.getLayerByName(t))?h.set_float(t.canvasToLayer(this.touches[B].x,this.touches[B].y,!1)):h.set_float(0)};m.prototype.YAt=function(h,t,B){t=Math.floor(t);if(0>t||t>=this.touches.length)h.set_float(0);else if(cr.is_undefined(B)){B=this.runtime.getLayerByNumber(0);var S=B.scale;var V=B.zoomRate;var L=B.parallaxY;
var d=B.angle;B.scale=1;B.zoomRate=1;B.parallaxY=1;B.angle=0;h.set_float(B.canvasToLayer(this.touches[t].x,this.touches[t].y,!1));B.scale=S;B.zoomRate=V;B.parallaxY=L;B.angle=d}else(B=cr.is_number(B)?this.runtime.getLayerByNumber(B):this.runtime.getLayerByName(B))?h.set_float(B.canvasToLayer(this.touches[t].x,this.touches[t].y,!1)):h.set_float(0)};m.prototype.YForID=function(h,t,B){t=this.findTouch(t);if(0>t)h.set_float(0);else if(t=this.touches[t],cr.is_undefined(B)){B=this.runtime.getLayerByNumber(0);
var S=B.scale;var V=B.zoomRate;var L=B.parallaxY;var d=B.angle;B.scale=1;B.zoomRate=1;B.parallaxY=1;B.angle=0;h.set_float(B.canvasToLayer(t.x,t.y,!1));B.scale=S;B.zoomRate=V;B.parallaxY=L;B.angle=d}else(B=cr.is_number(B)?this.runtime.getLayerByNumber(B):this.runtime.getLayerByName(B))?h.set_float(B.canvasToLayer(t.x,t.y,!1)):h.set_float(0)};m.prototype.AbsoluteX=function(h){this.touches.length?h.set_float(this.touches[0].x):h.set_float(0)};m.prototype.AbsoluteXAt=function(h,t){t=Math.floor(t);0>t||
t>=this.touches.length?h.set_float(0):h.set_float(this.touches[t].x)};m.prototype.AbsoluteXForID=function(h,t){t=this.findTouch(t);0>t?h.set_float(0):h.set_float(this.touches[t].x)};m.prototype.AbsoluteY=function(h){this.touches.length?h.set_float(this.touches[0].y):h.set_float(0)};m.prototype.AbsoluteYAt=function(h,t){t=Math.floor(t);0>t||t>=this.touches.length?h.set_float(0):h.set_float(this.touches[t].y)};m.prototype.AbsoluteYForID=function(h,t){t=this.findTouch(t);0>t?h.set_float(0):h.set_float(this.touches[t].y)};
m.prototype.SpeedAt=function(h,t){t=Math.floor(t);if(0>t||t>=this.touches.length)h.set_float(0);else{var B=this.touches[t];t=cr.distanceTo(B.x,B.y,B.lastx,B.lasty);B=(B.time-B.lasttime)/1E3;0>=B?h.set_float(0):h.set_float(t/B)}};m.prototype.SpeedForID=function(h,t){t=this.findTouch(t);if(0>t)h.set_float(0);else{var B=this.touches[t];t=cr.distanceTo(B.x,B.y,B.lastx,B.lasty);B=(B.time-B.lasttime)/1E3;0>=B?h.set_float(0):h.set_float(t/B)}};m.prototype.AngleAt=function(h,t){t=Math.floor(t);0>t||t>=this.touches.length?
h.set_float(0):(t=this.touches[t],h.set_float(cr.to_degrees(cr.angleTo(t.lastx,t.lasty,t.x,t.y))))};m.prototype.AngleForID=function(h,t){t=this.findTouch(t);0>t?h.set_float(0):(t=this.touches[t],h.set_float(cr.to_degrees(cr.angleTo(t.lastx,t.lasty,t.x,t.y))))};m.prototype.Alpha=function(h){h.set_float(this.getAlpha())};m.prototype.Beta=function(h){h.set_float(this.getBeta())};m.prototype.Gamma=function(h){h.set_float(this.getGamma())};m.prototype.AccelerationXWithG=function(h){h.set_float(this.acc_g_x)};
m.prototype.AccelerationYWithG=function(h){h.set_float(this.acc_g_y)};m.prototype.AccelerationZWithG=function(h){h.set_float(this.acc_g_z)};m.prototype.AccelerationX=function(h){h.set_float(this.acc_x)};m.prototype.AccelerationY=function(h){h.set_float(this.acc_y)};m.prototype.AccelerationZ=function(h){h.set_float(this.acc_z)};m.prototype.TouchIndex=function(h){h.set_int(this.trigger_index)};m.prototype.TouchID=function(h){h.set_float(this.trigger_id)};m.prototype.WidthForID=function(h,t){t=this.findTouch(t);
0>t?h.set_float(0):h.set_float(this.touches[t].width)};m.prototype.HeightForID=function(h,t){t=this.findTouch(t);0>t?h.set_float(0):h.set_float(this.touches[t].height)};m.prototype.PressureForID=function(h,t){t=this.findTouch(t);0>t?h.set_float(0):h.set_float(this.touches[t].pressure)};a.exps=new m})();cr.plugins_.Keyboard=function(b){this.runtime=b};
(function(){function b(){}function l(){}function q(m){m=Math.floor(m);switch(m){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"\u2190";case 38:return"\u2191";case 39:return"\u2192";case 40:return"\u2193";case 45:return"insert";case 46:return"del";
case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";
case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(m)}}
var A=cr.plugins_.Keyboard.prototype;A.Type=function(m){this.plugin=m;this.runtime=m.runtime};A.Type.prototype.onCreate=function(){};A.Instance=function(m){this.type=m;this.runtime=m.runtime;this.keyMap=Array(256);this.typedKeyMap=Array(256);this.usedKeys=Array(256);this.triggerKey=0};var M=A.Instance.prototype;M.onCreate=function(){var m=this;document.addEventListener("keydown",function(a){m.onKeyDown(a)});document.addEventListener("keyup",function(a){m.onKeyUp(a)})};var x=[32,33,34,35,36,37,38,
39,40,44];M.onKeyDown=function(m){var a=!1;window!=window.top&&-1<x.indexOf(m.which)&&(m.preventDefault(),a=!0,m.stopPropagation());if(this.keyMap[m.which])this.usedKeys[m.which]&&!a&&m.preventDefault();else{var c=m.which;this.typedKeyMap[c]=m.key;this.keyMap[c]=!0;this.triggerKey=c;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);var f=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this),n=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,
this);this.runtime.isInUserInputEvent=!1;if(f||n)this.usedKeys[c]=!0,a||m.preventDefault()}};M.onKeyUp=function(m){var a=m.which;this.typedKeyMap[a]=m.key;this.keyMap[a]=!1;this.triggerKey=a;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var c=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),f=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);this.runtime.isInUserInputEvent=
!1;if(c||f||this.usedKeys[m.which])this.usedKeys[a]=!0,m.preventDefault()};M.onWindowBlur=function(){var m;for(m=0;256>m;++m)if(this.keyMap[m]){this.keyMap[m]=!1;this.triggerKey=m;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var a=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),c=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);if(a||c)this.usedKeys[m]=!0}};M.saveToJSON=function(){return{triggerKey:this.triggerKey}};
M.loadFromJSON=function(m){this.triggerKey=m.triggerKey};b.prototype.IsKeyDown=function(m){return this.keyMap[m]};b.prototype.OnKey=function(m){return m===this.triggerKey};b.prototype.OnAnyKey=function(m){return!0};b.prototype.OnAnyKeyReleased=function(m){return!0};b.prototype.OnKeyReleased=function(m){return m===this.triggerKey};b.prototype.IsKeyCodeDown=function(m){m=Math.floor(m);return 0>m||m>=this.keyMap.length?!1:this.keyMap[m]};b.prototype.OnKeyCode=function(m){return m===this.triggerKey};
b.prototype.OnKeyCodeReleased=function(m){return m===this.triggerKey};A.cnds=new b;A.acts=new function(){};l.prototype.TypedKey=function(m){m.set_string(this.typedKeyMap[this.triggerKey]||"")};l.prototype.LastKeyCode=function(m){m.set_int(this.triggerKey)};l.prototype.StringFromKeyCode=function(m,a){m.set_string(q(a))};A.exps=new l})();cr.plugins_.Particles=function(b){this.runtime=b};
(function(){function b(a){this.owner=a;this.active=!1;this.angle=this.speed=this.y=this.x=0;this.opacity=1;this.age=this.gs=this.size=this.grow=0;cr.seal(this)}function l(){}function q(){}function A(){}var M=cr.plugins_.Particles.prototype;M.Type=function(a){this.plugin=a;this.runtime=a.runtime};var x=M.Type.prototype;x.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,
this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.spriteX=this.texture_data[3],this.spriteY=this.texture_data[4],this.spriteWidth=this.texture_data[5],this.spriteHeight=this.texture_data[6])};x.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};x.createParticleTexture=function(){var a=document.createElement("canvas"),c=this.spriteWidth,f=this.spriteHeight;a.width=c;
a.height=f;a.getContext("2d").drawImage(this.texture_img,this.spriteX,this.spriteY,c,f,0,0,c,f);this.webGL_texture=this.runtime.glwrap.loadTexture(a,!0,this.runtime.linearSampling,this.texture_pixelformat)};x.onRestoreWebGLContext=function(){!this.is_family&&this.instances.length&&(this.webGL_texture||this.createParticleTexture())};x.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||this.createParticleTexture()};x.unloadTextures=function(){this.is_family||this.instances.length||
!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};x.preloadCanvas2D=function(a){a.drawImage(this.texture_img,0,0)};b.prototype.init=function(){var a=this.owner;this.x=a.x-a.xrandom/2+Math.random()*a.xrandom;this.y=a.y-a.yrandom/2+Math.random()*a.yrandom;this.speed=a.initspeed-a.speedrandom/2+Math.random()*a.speedrandom;this.angle=a.angle-a.spraycone/2+Math.random()*a.spraycone;this.opacity=a.initopacity;this.size=a.initsize-a.sizerandom/2+Math.random()*
a.sizerandom;this.grow=a.growrate-a.growrandom/2+Math.random()*a.growrandom;this.age=this.gs=0};b.prototype.tick=function(a){var c=this.owner;this.x+=Math.cos(this.angle)*this.speed*a;this.y+=Math.sin(this.angle)*this.speed*a;this.y+=this.gs*a;this.speed+=c.acc*a;this.size+=this.grow*a;this.gs+=c.g*a;this.age+=a;1>this.size?this.active=!1:(0!==c.lifeanglerandom&&(this.angle+=Math.random()*c.lifeanglerandom*a-c.lifeanglerandom*a/2),0!==c.lifespeedrandom&&(this.speed+=Math.random()*c.lifespeedrandom*
a-c.lifespeedrandom*a/2),0!==c.lifeopacityrandom&&(this.opacity+=Math.random()*c.lifeopacityrandom*a-c.lifeopacityrandom*a/2,0>this.opacity?this.opacity=0:1<this.opacity&&(this.opacity=1)),1>=c.destroymode&&this.age>=c.timeout&&(this.active=!1),2===c.destroymode&&0>=this.speed&&(this.active=!1))};b.prototype.draw=function(a){var c=this.owner.opacity*this.opacity;if(0!==c){0===this.owner.destroymode&&(c*=1-this.age/this.owner.timeout);a.globalAlpha=c;c=this.x-this.size/2;var f=this.y-this.size/2;this.owner.runtime.pixel_rounding&&
(c=c+.5|0,f=f+.5|0);var n=this.owner.type;a.drawImage(n.texture_img,n.spriteX,n.spriteY,n.spriteWidth,n.spriteHeight,c,f,this.size,this.size)}};b.prototype.drawGL=function(a){var c=this.owner.opacity*this.opacity;0===this.owner.destroymode&&(c*=1-this.age/this.owner.timeout);var f=this.size,n=f*this.owner.particlescale,v=this.x-f/2,y=this.y-f/2;this.owner.runtime.pixel_rounding&&(v=v+.5|0,y=y+.5|0);1>n||0===c||(n<a.minPointSize||n>a.maxPointSize?(a.setOpacity(c),a.quad(v,y,v+f,y,v+f,y+f,v,y+f)):a.point(this.x,
this.y,n,c))};b.prototype.left=function(){return this.x-this.size/2};b.prototype.right=function(){return this.x+this.size/2};b.prototype.top=function(){return this.y-this.size/2};b.prototype.bottom=function(){return this.y+this.size/2};M.Instance=function(a){this.type=a;this.runtime=a.runtime};x=M.Instance.prototype;var m=[];x.onCreate=function(){var a=this.properties;this.rate=a[0];this.spraycone=cr.to_radians(a[1]);this.spraytype=a[2];this.spraying=!0;this.initspeed=a[4];this.initsize=a[5];this.initopacity=
a[6]/100;this.growrate=a[7];this.xrandom=a[8];this.yrandom=a[9];this.speedrandom=a[10];this.sizerandom=a[11];this.growrandom=a[12];this.acc=a[13];this.g=a[14];this.lifeanglerandom=a[15];this.lifespeedrandom=a[16];this.lifeopacityrandom=a[17];this.destroymode=a[18];this.timeout=a[19];this.particleCreateCounter=0;this.particlescale=1;this.particleBoxLeft=this.x;this.particleBoxTop=this.y;this.particleBoxRight=this.x;this.particleBoxBottom=this.y;this.add_bbox_changed_callback(function(c){c.bbox.set(c.particleBoxLeft,
c.particleBoxTop,c.particleBoxRight,c.particleBoxBottom);c.bquad.set_from_rect(c.bbox);c.bbox_changed=!1;c.update_collision_cell();c.update_render_cell()});this.recycled||(this.particles=[]);this.runtime.tickMe(this);this.type.loadTextures();if(1===this.spraytype)for(a=0;a<this.rate;a++)this.allocateParticle().opacity=0;this.first_tick=!0};x.saveToJSON=function(){var a={r:this.rate,sc:this.spraycone,st:this.spraytype,s:this.spraying,isp:this.initspeed,isz:this.initsize,io:this.initopacity,gr:this.growrate,
xr:this.xrandom,yr:this.yrandom,spr:this.speedrandom,szr:this.sizerandom,grnd:this.growrandom,acc:this.acc,g:this.g,lar:this.lifeanglerandom,lsr:this.lifespeedrandom,lor:this.lifeopacityrandom,dm:this.destroymode,to:this.timeout,pcc:this.particleCreateCounter,ft:this.first_tick,p:[]},c,f=a.p;var n=0;for(c=this.particles.length;n<c;n++){var v=this.particles[n];f.push([v.x,v.y,v.speed,v.angle,v.opacity,v.grow,v.size,v.gs,v.age])}return a};x.loadFromJSON=function(a){this.rate=a.r;this.spraycone=a.sc;
this.spraytype=a.st;this.spraying=a.s;this.initspeed=a.isp;this.initsize=a.isz;this.initopacity=a.io;this.growrate=a.gr;this.xrandom=a.xr;this.yrandom=a.yr;this.speedrandom=a.spr;this.sizerandom=a.szr;this.growrandom=a.grnd;this.acc=a.acc;this.g=a.g;this.lifeanglerandom=a.lar;this.lifespeedrandom=a.lsr;this.lifeopacityrandom=a.lor;this.destroymode=a.dm;this.timeout=a.to;this.particleCreateCounter=a.pcc;this.first_tick=a.ft;m.push.apply(m,this.particles);cr.clearArray(this.particles);var c,f=a.p;a=
0;for(c=f.length;a<c;a++){var n=this.allocateParticle();var v=f[a];n.x=v[0];n.y=v[1];n.speed=v[2];n.angle=v[3];n.opacity=v[4];n.grow=v[5];n.size=v[6];n.gs=v[7];n.age=v[8]}};x.onDestroy=function(){m.push.apply(m,this.particles);cr.clearArray(this.particles)};x.allocateParticle=function(){if(m.length){var a=m.pop();a.owner=this}else a=new b(this);this.particles.push(a);a.active=!0;return a};x.tick=function(){var a=this.runtime.getDt(this),c;if(0===this.spraytype&&this.spraying){this.particleCreateCounter+=
a*this.rate;var f=cr.floor(this.particleCreateCounter);this.particleCreateCounter-=f;for(c=0;c<f;c++){var n=this.allocateParticle();n.init()}}this.particleBoxLeft=this.x;this.particleBoxTop=this.y;this.particleBoxRight=this.x;this.particleBoxBottom=this.y;var v=c=0;for(f=this.particles.length;c<f;c++)n=this.particles[c],this.particles[v]=n,this.runtime.redraw=!0,1===this.spraytype&&this.first_tick&&n.init(),n.tick(a),n.active?(n.left()<this.particleBoxLeft&&(this.particleBoxLeft=n.left()),n.right()>
this.particleBoxRight&&(this.particleBoxRight=n.right()),n.top()<this.particleBoxTop&&(this.particleBoxTop=n.top()),n.bottom()>this.particleBoxBottom&&(this.particleBoxBottom=n.bottom()),v++):m.push(n);cr.truncateArray(this.particles,v);this.set_bbox_changed();this.first_tick=!1;1===this.spraytype&&0===this.particles.length&&this.runtime.DestroyInstance(this)};x.draw=function(a){var c,f=this.layer;var n=0;for(c=this.particles.length;n<c;n++){var v=this.particles[n];v.right()>=f.viewLeft&&v.bottom()>=
f.viewTop&&v.left()<=f.viewRight&&v.top()<=f.viewBottom&&v.draw(a)}};x.drawGL=function(a){this.particlescale=this.layer.getScale();a.setTexture(this.type.webGL_texture);var c,f=this.layer;var n=0;for(c=this.particles.length;n<c;n++){var v=this.particles[n];v.right()>=f.viewLeft&&v.bottom()>=f.viewTop&&v.left()<=f.viewRight&&v.top()<=f.viewBottom&&v.drawGL(a)}};l.prototype.IsSpraying=function(){return this.spraying};M.cnds=new l;q.prototype.SetSpraying=function(a){this.spraying=0!==a};q.prototype.SetEffect=
function(a){this.blend_mode=a;this.compositeOp=cr.effectToCompositeOp(a);cr.setGLBlend(this,a,this.runtime.gl);this.runtime.redraw=!0};q.prototype.SetRate=function(a){this.rate=a;var c;if(1===this.spraytype&&this.first_tick)if(a<this.particles.length)for(a=this.particles.length-a,c=0;c<a;c++)m.push(this.particles.pop());else if(a>this.particles.length)for(a-=this.particles.length,c=0;c<a;c++)this.allocateParticle().opacity=0};q.prototype.SetSprayCone=function(a){this.spraycone=cr.to_radians(a)};q.prototype.SetInitSpeed=
function(a){this.initspeed=a};q.prototype.SetInitSize=function(a){this.initsize=a};q.prototype.SetInitOpacity=function(a){this.initopacity=a/100};q.prototype.SetGrowRate=function(a){this.growrate=a};q.prototype.SetXRandomiser=function(a){this.xrandom=a};q.prototype.SetYRandomiser=function(a){this.yrandom=a};q.prototype.SetSpeedRandomiser=function(a){this.speedrandom=a};q.prototype.SetSizeRandomiser=function(a){this.sizerandom=a};q.prototype.SetGrowRateRandomiser=function(a){this.growrandom=a};q.prototype.SetParticleAcc=
function(a){this.acc=a};q.prototype.SetGravity=function(a){this.g=a};q.prototype.SetAngleRandomiser=function(a){this.lifeanglerandom=a};q.prototype.SetLifeSpeedRandomiser=function(a){this.lifespeedrandom=a};q.prototype.SetOpacityRandomiser=function(a){this.lifeopacityrandom=a};q.prototype.SetTimeout=function(a){this.timeout=a};M.acts=new q;A.prototype.ParticleCount=function(a){a.set_int(this.particles.length)};A.prototype.Rate=function(a){a.set_float(this.rate)};A.prototype.SprayCone=function(a){a.set_float(cr.to_degrees(this.spraycone))};
A.prototype.InitSpeed=function(a){a.set_float(this.initspeed)};A.prototype.InitSize=function(a){a.set_float(this.initsize)};A.prototype.InitOpacity=function(a){a.set_float(100*this.initopacity)};A.prototype.InitGrowRate=function(a){a.set_float(this.growrate)};A.prototype.XRandom=function(a){a.set_float(this.xrandom)};A.prototype.YRandom=function(a){a.set_float(this.yrandom)};A.prototype.InitSpeedRandom=function(a){a.set_float(this.speedrandom)};A.prototype.InitSizeRandom=function(a){a.set_float(this.sizerandom)};
A.prototype.InitGrowRandom=function(a){a.set_float(this.growrandom)};A.prototype.ParticleAcceleration=function(a){a.set_float(this.acc)};A.prototype.Gravity=function(a){a.set_float(this.g)};A.prototype.ParticleAngleRandom=function(a){a.set_float(this.lifeanglerandom)};A.prototype.ParticleSpeedRandom=function(a){a.set_float(this.lifespeedrandom)};A.prototype.ParticleOpacityRandom=function(a){a.set_float(this.lifeopacityrandom)};A.prototype.Timeout=function(a){a.set_float(this.timeout)};M.exps=new A})();
cr.plugins_.Audio=function(b){this.runtime=b};
(function(){function b(r){-1===xa.indexOf(r)&&xa.push(r)}function l(r){var H=r.instanceObject;try{var O=H.play()}catch(P){b(r);return}O?O.catch(function(P){b(r)}):Ca&&!g.isInUserInputEvent&&b(r)}function q(){var r,H;Da||ka||!J||(A(),"running"===J.state&&(Da=!0));var O=xa.slice(0);cr.clearArray(xa);if(!ba){var P=0;for(r=O.length;P<r;++P){var aa=O[P];aa.stopped||aa.is_paused||(H=aa.instanceObject.play())&&H.catch(function(ca){b(aa)})}}}function A(){"suspended"===J.state&&J.resume&&J.resume();if(J.createBuffer){var r=
J.createBuffer(1,220,22050),H=J.createBufferSource();H.buffer=r;H.connect(J.destination);f(H)}}function M(r){r=Math.pow(10,r/20);isFinite(r)||(r=0);0>r&&(r=0);1<r&&(r=1);return r}function x(r){0>r&&(r=0);1<r&&(r=1);return Math.log(r)/Math.log(10)*20}function m(r){r=r.toLowerCase();return oa.hasOwnProperty(r)&&oa[r].length?oa[r][0].getInputNode():J.destination}function a(){return J.createGain?J.createGain():J.createGainNode()}function c(r){return J.createDelay?J.createDelay(r):J.createDelayNode(r)}
function f(r,H){r.start?r.start(H||0):r.noteOn(H||0)}function n(r,H,O,P){r.start?r.start(P||0,H):r.noteGrainOn(P||0,H,O-H)}function v(r){try{r.stop?r.stop(0):r.noteOff(0)}catch(H){}}function y(r,H,O,P){if(r)if(r.cancelScheduledValues(0),0===P)r.value=H;else{var aa=J.currentTime;P+=aa;switch(O){case 0:r.setValueAtTime(H,P);break;case 1:r.setValueAtTime(r.value,aa);r.linearRampToValueAtTime(H,P);break;case 2:r.setValueAtTime(r.value,aa),r.exponentialRampToValueAtTime(H,P)}}}function K(r,H,O,P,aa,ca){this.type=
"filter";this.params=[r,H,O,P,aa,ca];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=ca;this.dryNode=a();this.dryNode.gain.value=1-ca;this.filterNode=J.createBiquadFilter();this.filterNode.type="number"===typeof this.filterNode.type?r:Ea[r];this.filterNode.frequency.value=H;this.filterNode.detune&&(this.filterNode.detune.value=O);this.filterNode.Q.value=P;this.filterNode.gain.value=aa;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode)}
function u(r,H,O){this.type="delay";this.params=[r,H,O];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=O;this.dryNode=a();this.dryNode.gain.value=1-O;this.mainNode=a();this.delayNode=c(r);this.delayNode.delayTime.value=r;this.delayGainNode=a();this.delayGainNode.gain.value=H;this.inputNode.connect(this.mainNode);this.inputNode.connect(this.dryNode);this.mainNode.connect(this.wetNode);this.mainNode.connect(this.delayNode);this.delayNode.connect(this.delayGainNode);this.delayGainNode.connect(this.mainNode)}
function F(r,H,O,P){this.type="convolve";this.params=[H,O,P];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=O;this.dryNode=a();this.dryNode.gain.value=1-O;this.convolveNode=J.createConvolver();r&&(this.convolveNode.normalize=H,this.convolveNode.buffer=r);this.inputNode.connect(this.convolveNode);this.inputNode.connect(this.dryNode);this.convolveNode.connect(this.wetNode)}function D(r,H,O,P,aa){this.type="flanger";this.params=[r,H,O,P,aa];this.inputNode=a();this.dryNode=a();this.dryNode.gain.value=
1-aa/2;this.wetNode=a();this.wetNode.gain.value=aa/2;this.feedbackNode=a();this.feedbackNode.gain.value=P;this.delayNode=c(r+H);this.delayNode.delayTime.value=r;this.oscNode=J.createOscillator();this.oscNode.frequency.value=O;this.oscGainNode=a();this.oscGainNode.gain.value=H;this.inputNode.connect(this.delayNode);this.inputNode.connect(this.dryNode);this.delayNode.connect(this.wetNode);this.delayNode.connect(this.feedbackNode);this.feedbackNode.connect(this.delayNode);this.oscNode.connect(this.oscGainNode);
this.oscGainNode.connect(this.delayNode.delayTime);f(this.oscNode)}function h(r,H,O,P,aa,ca){this.type="phaser";this.params=[r,H,O,P,aa,ca];this.inputNode=a();this.dryNode=a();this.dryNode.gain.value=1-ca/2;this.wetNode=a();this.wetNode.gain.value=ca/2;this.filterNode=J.createBiquadFilter();this.filterNode.type="number"===typeof this.filterNode.type?7:"allpass";this.filterNode.frequency.value=r;this.filterNode.detune&&(this.filterNode.detune.value=H);this.filterNode.Q.value=O;this.oscNode=J.createOscillator();
this.oscNode.frequency.value=aa;this.oscGainNode=a();this.oscGainNode.gain.value=P;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode);this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.filterNode.frequency);f(this.oscNode)}function t(r){this.type="gain";this.params=[r];this.node=a();this.node.gain.value=r}function B(r,H){this.type="tremolo";this.params=[r,H];this.node=a();this.node.gain.value=1-H/2;this.oscNode=J.createOscillator();
this.oscNode.frequency.value=r;this.oscGainNode=a();this.oscGainNode.gain.value=H/2;this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.node.gain);f(this.oscNode)}function S(r,H){this.type="ringmod";this.params=[r,H];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=H;this.dryNode=a();this.dryNode.gain.value=1-H;this.ringNode=a();this.ringNode.gain.value=0;this.oscNode=J.createOscillator();this.oscNode.frequency.value=r;this.oscNode.connect(this.ringNode.gain);f(this.oscNode);
this.inputNode.connect(this.ringNode);this.inputNode.connect(this.dryNode);this.ringNode.connect(this.wetNode)}function V(r,H,O,P,aa){this.type="distortion";this.params=[r,H,O,P,aa];this.inputNode=a();this.preGain=a();this.postGain=a();this.setDrive(O,Math.pow(10,P/20));this.wetNode=a();this.wetNode.gain.value=aa;this.dryNode=a();this.dryNode.gain.value=1-aa;this.waveShaper=J.createWaveShaper();this.curve=new Float32Array(65536);this.generateColortouchCurve(r,H);this.waveShaper.curve=this.curve;this.inputNode.connect(this.preGain);
this.inputNode.connect(this.dryNode);this.preGain.connect(this.waveShaper);this.waveShaper.connect(this.postGain);this.postGain.connect(this.wetNode)}function L(r,H,O,P,aa){this.type="compressor";this.params=[r,H,O,P,aa];this.node=J.createDynamicsCompressor();try{this.node.threshold.value=r,this.node.knee.value=H,this.node.ratio.value=O,this.node.attack.value=P,this.node.release.value=aa}catch(ca){}}function d(r,H){this.type="analyser";this.params=[r,H];this.node=J.createAnalyser();this.node.fftSize=
r;this.node.smoothingTimeConstant=H;this.freqBins=new Float32Array(this.node.frequencyBinCount);this.signal=new Uint8Array(r);this.rms=this.peak=0}function k(){this.obj=null;this.loadUid=0}function E(r,H,O){this.src=r;this.type=H;this.myapi=z;this.is_music=O;this.added_end_listener=!1;var P=this;this.mediaSourceNode=this.outNode=null;this.panWhenReady=[];this.seekWhenReady=0;this.failedToLoad=this.supportWebAudioAPI=this.pauseWhenReady=!1;this.needsSoftwareDecode="audio/webm; codecs=opus"===this.type&&
!ta;this.wasEverReady=!1;this.is_music&&this.needsSoftwareDecode&&(Fa=!0);1!==z||!O||ya||this.needsSoftwareDecode||(this.myapi=0,this.outNode=a());this.audioData=this.bufferObject=null;switch(this.myapi){case 0:this.bufferObject=new Audio;this.bufferObject.crossOrigin="anonymous";this.bufferObject.addEventListener("canplaythrough",function(){P.wasEverReady=!0});1===z&&J.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",
function(){!P.mediaSourceNode&&P.bufferObject&&(P.mediaSourceNode=J.createMediaElementSource(P.bufferObject),P.mediaSourceNode.connect(P.outNode))}));this.bufferObject.autoplay=!1;this.bufferObject.preload="auto";this.bufferObject.src=r;break;case 1:if(g.isWKWebView)g.fetchLocalFileViaCordovaAsArrayBuffer(r,function(ca){P.audioData=ca;P.decodeAudioBuffer()},function(ca){P.failedToLoad=!0});else{var aa=new XMLHttpRequest;aa.open("GET",r,!0);aa.responseType="arraybuffer";aa.onload=function(){P.audioData=
aa.response;P.decodeAudioBuffer()};aa.onerror=function(){P.failedToLoad=!0};aa.send()}break;case 2:this.bufferObject=!0}}function e(r,H){var O=this;this.tag=H;this.stopped=this.fresh=!0;this.src=r.src;this.buffer=r;this.myapi=z;this.is_music=r.is_music;this.playbackRate=1;this.hasPlaybackEnded=!0;this.is_paused=this.resume_me=!1;this.resume_position=0;this.is_silent=this.is_muted=this.looping=!1;this.volume=1;this.onended_handler=function(aa){if(!O.is_paused&&!O.resume_me){var ca=this;ca||(ca=aa.target);
ca===O.active_buffer&&(O.hasPlaybackEnded=!0,O.stopped=!0,C=O.tag,g.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,p))}};this.active_buffer=null;this.isTimescaled=1===fa&&!this.is_music||2===fa;this.mutevol=1;this.startTime=this.isTimescaled?g.kahanTime.sum:g.wallTime.sum;this.pannerNode=this.gainNode=null;this.pannerEnabled=!1;this.objectTracker=null;this.panConeOuterGain=this.panConeOuter=this.panConeInner=this.panAngle=this.panY=this.panX=0;this.instanceObject=null;var P=!1;1!==this.myapi||0!==
this.buffer.myapi||this.buffer.supportWebAudioAPI||(this.myapi=0);switch(this.myapi){case 0:this.is_music?(this.instanceObject=r.bufferObject,P=!r.added_end_listener,r.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=r.bufferObject.src,P=!0);P&&this.instanceObject.addEventListener("ended",function(){C=O.tag;O.stopped=!0;g.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,p)});break;case 1:this.gainNode=
a();this.gainNode.connect(m(H));1===this.buffer.myapi?r.bufferObject&&(this.instanceObject=J.createBufferSource(),this.instanceObject.buffer=r.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),this.buffer.added_end_listener||(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",function(){C=O.tag;O.stopped=!0;g.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,p)})));break;
case 2:this.instanceObject=new window.Media(G+this.src,null,null,function(aa){aa===window.Media.MEDIA_STOPPED&&(O.hasPlaybackEnded=!0,O.stopped=!0,C=O.tag,g.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,p))})}}function w(r,H){r=r.isPlaying()?1:0;H=H.isPlaying()?1:0;return r===H?0:r<H?1:-1}function I(r,H){cr.clearArray(na);if(r.length){var O;var P=0;for(O=R.length;P<O;P++){var aa=R[P];cr.equals_nocase(r,aa.tag)&&na.push(aa)}H&&na.sort(w)}else T&&!T.hasEnded()&&(cr.clearArray(na),na[0]=T)}function N(r){var H,
O=J.destination;if(oa.hasOwnProperty(r)){var P=oa[r];if(P.length){O=P[0].getInputNode();var aa=0;for(H=P.length;aa<H;aa++){var ca=P[aa];aa+1===H?ca.connectTo(J.destination):ca.connectTo(P[aa+1].getInputNode())}}}I(r);aa=0;for(H=na.length;aa<H;aa++)na[aa].reconnect(O);ua&&Aa===r&&(ua.disconnect(),ua.connect(O))}function U(r,H){oa.hasOwnProperty(r)?oa[r].push(H):oa[r]=[H];N(r)}function W(){}function X(){}function Y(){}function ea(r,H){var O=null;oa.hasOwnProperty(r)&&(O=oa[r]);return O&&0<=H&&H<O.length&&
O[H].freqBins?O[H]:null}var ha=cr.plugins_.Audio.prototype;ha.Type=function(r){this.plugin=r;this.runtime=r.runtime};ha.Type.prototype.onCreate=function(){};var g=null,p=null,C="",G="",z=0,J=null,Q=[],R=[],T=null,fa=0,ba=!1,Z=1,da=0,ia=0,ka=!1,ta=!!(new Audio).canPlayType("audio/webm; codecs=opus"),qa=1,Ba=1,Ga=10,Ha=1E4,Ia=1,ua=null,Aa="",Ca=!1,xa=[],ya=!1,Fa=!1,Da=!1;document.addEventListener("pointerup",q,!0);document.addEventListener("touchend",q,!0);document.addEventListener("click",q,!0);document.addEventListener("keydown",
q,!0);document.addEventListener("gamepadconnected",q,!0);var oa={},Ea="lowpass highpass bandpass lowshelf highshelf peaking notch allpass".split(" ");K.prototype.connectTo=function(r){this.wetNode.disconnect();this.wetNode.connect(r);this.dryNode.disconnect();this.dryNode.connect(r)};K.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};K.prototype.getInputNode=function(){return this.inputNode};K.prototype.setParam=
function(r,H,O,P){switch(r){case 0:H/=100;0>H&&(H=0);1<H&&(H=1);this.params[5]=H;y(this.wetNode.gain,H,O,P);y(this.dryNode.gain,1-H,O,P);break;case 1:this.params[1]=H;y(this.filterNode.frequency,H,O,P);break;case 2:this.params[2]=H;y(this.filterNode.detune,H,O,P);break;case 3:this.params[3]=H;y(this.filterNode.Q,H,O,P);break;case 4:this.params[4]=H,y(this.filterNode.gain,H,O,P)}};u.prototype.connectTo=function(r){this.wetNode.disconnect();this.wetNode.connect(r);this.dryNode.disconnect();this.dryNode.connect(r)};
u.prototype.remove=function(){this.inputNode.disconnect();this.mainNode.disconnect();this.delayNode.disconnect();this.delayGainNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};u.prototype.getInputNode=function(){return this.inputNode};u.prototype.setParam=function(r,H,O,P){switch(r){case 0:H/=100;0>H&&(H=0);1<H&&(H=1);this.params[2]=H;y(this.wetNode.gain,H,O,P);y(this.dryNode.gain,1-H,O,P);break;case 4:this.params[1]=M(H);y(this.delayGainNode.gain,M(H),O,P);break;case 5:this.params[0]=
H,y(this.delayNode.delayTime,H,O,P)}};F.prototype.connectTo=function(r){this.wetNode.disconnect();this.wetNode.connect(r);this.dryNode.disconnect();this.dryNode.connect(r)};F.prototype.remove=function(){this.inputNode.disconnect();this.convolveNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};F.prototype.getInputNode=function(){return this.inputNode};F.prototype.setParam=function(r,H,O,P){switch(r){case 0:H/=100,0>H&&(H=0),1<H&&(H=1),this.params[1]=H,y(this.wetNode.gain,H,O,P),
y(this.dryNode.gain,1-H,O,P)}};D.prototype.connectTo=function(r){this.dryNode.disconnect();this.dryNode.connect(r);this.wetNode.disconnect();this.wetNode.connect(r)};D.prototype.remove=function(){this.inputNode.disconnect();this.delayNode.disconnect();this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect();this.feedbackNode.disconnect()};D.prototype.getInputNode=function(){return this.inputNode};D.prototype.setParam=function(r,H,O,P){switch(r){case 0:H/=
100;0>H&&(H=0);1<H&&(H=1);this.params[4]=H;y(this.wetNode.gain,H/2,O,P);y(this.dryNode.gain,1-H/2,O,P);break;case 6:this.params[1]=H/1E3;y(this.oscGainNode.gain,H/1E3,O,P);break;case 7:this.params[2]=H;y(this.oscNode.frequency,H,O,P);break;case 8:this.params[3]=H/100,y(this.feedbackNode.gain,H/100,O,P)}};h.prototype.connectTo=function(r){this.dryNode.disconnect();this.dryNode.connect(r);this.wetNode.disconnect();this.wetNode.connect(r)};h.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();
this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect()};h.prototype.getInputNode=function(){return this.inputNode};h.prototype.setParam=function(r,H,O,P){switch(r){case 0:H/=100;0>H&&(H=0);1<H&&(H=1);this.params[5]=H;y(this.wetNode.gain,H/2,O,P);y(this.dryNode.gain,1-H/2,O,P);break;case 1:this.params[0]=H;y(this.filterNode.frequency,H,O,P);break;case 2:this.params[1]=H;y(this.filterNode.detune,H,O,P);break;case 3:this.params[2]=H;y(this.filterNode.Q,
H,O,P);break;case 6:this.params[3]=H;y(this.oscGainNode.gain,H,O,P);break;case 7:this.params[4]=H,y(this.oscNode.frequency,H,O,P)}};t.prototype.connectTo=function(r){this.node.disconnect();this.node.connect(r)};t.prototype.remove=function(){this.node.disconnect()};t.prototype.getInputNode=function(){return this.node};t.prototype.setParam=function(r,H,O,P){switch(r){case 4:this.params[0]=M(H),y(this.node.gain,M(H),O,P)}};B.prototype.connectTo=function(r){this.node.disconnect();this.node.connect(r)};
B.prototype.remove=function(){this.oscNode.disconnect();this.oscGainNode.disconnect();this.node.disconnect()};B.prototype.getInputNode=function(){return this.node};B.prototype.setParam=function(r,H,O,P){switch(r){case 0:H/=100;0>H&&(H=0);1<H&&(H=1);this.params[1]=H;y(this.node.gain.value,1-H/2,O,P);y(this.oscGainNode.gain.value,H/2,O,P);break;case 7:this.params[0]=H,y(this.oscNode.frequency,H,O,P)}};S.prototype.connectTo=function(r){this.wetNode.disconnect();this.wetNode.connect(r);this.dryNode.disconnect();
this.dryNode.connect(r)};S.prototype.remove=function(){this.oscNode.disconnect();this.ringNode.disconnect();this.inputNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};S.prototype.getInputNode=function(){return this.inputNode};S.prototype.setParam=function(r,H,O,P){switch(r){case 0:H/=100;0>H&&(H=0);1<H&&(H=1);this.params[1]=H;y(this.wetNode.gain,H,O,P);y(this.dryNode.gain,1-H,O,P);break;case 7:this.params[0]=H,y(this.oscNode.frequency,H,O,P)}};V.prototype.setDrive=function(r,
H){.01>r&&(r=.01);this.preGain.gain.value=r;this.postGain.gain.value=Math.pow(1/r,.6)*H};V.prototype.shape=function(r,H,O){O=1.05*O*H-H;var P=0>r?-r:r;return(P<H?P:H+O*(1-Math.exp(-(1/O)*(P-H))))*(0>r?-1:1)};V.prototype.generateColortouchCurve=function(r,H){r=Math.pow(10,r/20);H=Math.pow(10,H/20);for(var O,P=0;32768>P;++P)O=P/32768,O=this.shape(O,r,H),this.curve[32768+P]=O,this.curve[32768-P-1]=-O};V.prototype.connectTo=function(r){this.wetNode.disconnect();this.wetNode.connect(r);this.dryNode.disconnect();
this.dryNode.connect(r)};V.prototype.remove=function(){this.inputNode.disconnect();this.preGain.disconnect();this.waveShaper.disconnect();this.postGain.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};V.prototype.getInputNode=function(){return this.inputNode};V.prototype.setParam=function(r,H,O,P){switch(r){case 0:H/=100,0>H&&(H=0),1<H&&(H=1),this.params[4]=H,y(this.wetNode.gain,H,O,P),y(this.dryNode.gain,1-H,O,P)}};L.prototype.connectTo=function(r){this.node.disconnect();this.node.connect(r)};
L.prototype.remove=function(){this.node.disconnect()};L.prototype.getInputNode=function(){return this.node};L.prototype.setParam=function(r,H,O,P){};d.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins);this.node.getByteTimeDomainData(this.signal);for(var r=this.node.fftSize,H=0,O=this.peak=0,P;H<r;H++)P=(this.signal[H]-128)/128,0>P&&(P=-P),this.peak<P&&(this.peak=P),O+=P*P;this.peak=x(this.peak);this.rms=x(Math.sqrt(O/r))};d.prototype.connectTo=function(r){this.node.disconnect();
this.node.connect(r)};d.prototype.remove=function(){this.node.disconnect()};d.prototype.getInputNode=function(){return this.node};d.prototype.setParam=function(r,H,O,P){};k.prototype.setObject=function(r){this.obj=r};k.prototype.hasObject=function(){return!!this.obj};k.prototype.tick=function(r){};E.prototype.release=function(){var r,H;var O=r=0;for(H=R.length;r<H;++r){var P=R[r];R[O]=P;P.buffer===this?P.stop():++O}R.length=O;this.mediaSourceNode&&(this.mediaSourceNode.disconnect(),this.mediaSourceNode=
null);this.outNode&&(this.outNode.disconnect(),this.outNode=null);this.audioData=this.bufferObject=null};E.prototype.decodeAudioBuffer=function(){if(!this.bufferObject&&this.audioData){var r=this;if(this.needsSoftwareDecode){var H=this.audioData;this.audioData=null;window.OpusDecoder(H,function(O,P){if(O)r.onDecodeError(O);else O=new Float32Array(P),P=J.createBuffer(1,O.length,48E3),P.getChannelData(0).set(O),r.onDecodeComplete(P)})}else J.decodeAudioData(this.audioData,function(O){r.onDecodeComplete(O)},
function(O){r.onDecodeError(O)})}};E.prototype.onDecodeComplete=function(r){this.bufferObject=r;this.audioData=null;var H;if(cr.is_undefined(this.playTagWhenReady)||ba)cr.is_undefined(this.convolveWhenReady)||(O=this.convolveWhenReady.convolveNode,O.normalize=this.normalizeWhenReady,O.buffer=r);else if(this.panWhenReady.length){var O=0;for(H=this.panWhenReady.length;O<H;O++){r=this.panWhenReady[O];var P=new e(this,r.thistag);P.setPannerEnabled(!0);if("undefined"!==typeof r.objUid&&(r.obj=g.getObjectByUID(r.objUid),
!r.obj))continue;if(r.obj){var aa=cr.rotatePtAround(r.obj.x,r.obj.y,-r.obj.layer.getAngle(),da,ia,!0),ca=cr.rotatePtAround(r.obj.x,r.obj.y,-r.obj.layer.getAngle(),da,ia,!1);P.setPan(aa,ca,cr.to_degrees(r.obj.angle-r.obj.layer.getAngle()),r.ia,r.oa,r.og);P.setObject(r.obj)}else P.setPan(r.x,r.y,r.a,r.ia,r.oa,r.og);P.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady);this.pauseWhenReady&&P.pause();R.push(P)}cr.clearArray(this.panWhenReady)}else P=new e(this,this.playTagWhenReady||""),
P.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&P.pause(),R.push(P)};E.prototype.onDecodeError=function(r){self.failedToLoad=!0;console.error("Failed to decode audio '"+this.src+"': "+r)};E.prototype.isLoaded=function(){switch(this.myapi){case 0:var r=4<=this.bufferObject.readyState;r&&(this.wasEverReady=!0);return r||this.wasEverReady;case 1:return!!this.audioData||!!this.bufferObject;case 2:return!0}return!1};E.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case 0:return this.isLoaded();
case 1:return!!this.bufferObject;case 2:return!0}return!1};E.prototype.hasFailedToLoad=function(){switch(this.myapi){case 0:return!!this.bufferObject.error;case 1:return this.failedToLoad}return!1};e.prototype.hasEnded=function(){switch(this.myapi){case 0:return this.instanceObject.ended;case 1:return 1===this.buffer.myapi?!this.fresh&&!this.stopped&&this.instanceObject.loop||this.is_paused?!1:this.hasPlaybackEnded:this.instanceObject.ended;case 2:return this.hasPlaybackEnded}return!0};e.prototype.canBeRecycled=
function(){return this.fresh||this.stopped?!0:this.hasEnded()};e.prototype.setPannerEnabled=function(r){1===z&&(!this.pannerEnabled&&r?this.gainNode&&(this.pannerNode||(this.pannerNode=J.createPanner(),this.pannerNode.panningModel="number"===typeof this.pannerNode.panningModel?qa:["equalpower","HRTF","soundfield"][qa],this.pannerNode.distanceModel="number"===typeof this.pannerNode.distanceModel?Ba:["linear","inverse","exponential"][Ba],this.pannerNode.refDistance=Ga,this.pannerNode.maxDistance=Ha,
this.pannerNode.rolloffFactor=Ia),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(m(this.tag)),this.pannerEnabled=!0):this.pannerEnabled&&!r&&this.gainNode&&(this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(m(this.tag)),this.pannerEnabled=!1))};e.prototype.setPan=function(r,H,O,P,aa,ca){this.pannerEnabled&&1===z&&(this.pannerNode.setPosition(r,H,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(O)),Math.sin(cr.to_radians(O)),
0),this.pannerNode.coneInnerAngle=P,this.pannerNode.coneOuterAngle=aa,this.pannerNode.coneOuterGain=ca,this.panX=r,this.panY=H,this.panAngle=O,this.panConeInner=P,this.panConeOuter=aa,this.panConeOuterGain=ca)};e.prototype.setObject=function(r){this.pannerEnabled&&1===z&&(this.objectTracker||(this.objectTracker=new k),this.objectTracker.setObject(r))};e.prototype.tick=function(r){if(this.pannerEnabled&&1===z&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(r);
r=this.objectTracker.obj;var H=cr.rotatePtAround(r.x,r.y,-r.layer.getAngle(),da,ia,!0),O=cr.rotatePtAround(r.x,r.y,-r.layer.getAngle(),da,ia,!1);this.pannerNode.setPosition(H,O,0);"undefined"!==typeof this.objectTracker.obj.angle&&(r=r.angle-r.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(r),Math.sin(r),0))}};e.prototype.play=function(r,H,O,P){var aa=this.instanceObject;this.looping=r;this.volume=H;O=O||0;P=P||0;switch(this.myapi){case 0:1!==aa.playbackRate&&(aa.playbackRate=1);aa.volume!==
H*Z&&(aa.volume=H*Z);aa.loop!==r&&(aa.loop=r);aa.muted&&(aa.muted=!1);if(aa.currentTime!==O)try{aa.currentTime=O}catch(ca){}l(this);break;case 1:this.muted=!1;this.mutevol=1;if(1===this.buffer.myapi)this.gainNode.gain.value=H*Z,this.fresh||(this.instanceObject=J.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=r,this.hasPlaybackEnded=
!1,0===O?f(this.instanceObject,P):n(this.instanceObject,O,this.getDuration(),P);else{1!==aa.playbackRate&&(aa.playbackRate=1);aa.loop!==r&&(aa.loop=r);aa.volume=H*Z;if(aa.currentTime!==O)try{aa.currentTime=O}catch(ca){}l(this)}break;case 2:(!this.fresh&&this.stopped||0!==O)&&aa.seekTo(O),aa.play(),this.hasPlaybackEnded=!1}this.playbackRate=1;this.startTime=(this.isTimescaled?g.kahanTime.sum:g.wallTime.sum)-O;this.is_paused=this.stopped=this.fresh=!1};e.prototype.stop=function(){switch(this.myapi){case 0:this.instanceObject.paused||
this.instanceObject.pause();break;case 1:1===this.buffer.myapi?v(this.instanceObject):this.instanceObject.paused||this.instanceObject.pause();break;case 2:this.instanceObject.stop()}this.stopped=!0;this.is_paused=!1};e.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case 0:this.instanceObject.paused||this.instanceObject.pause();break;case 1:1===this.buffer.myapi?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=
this.getDuration()),this.is_paused=!0,v(this.instanceObject)):this.instanceObject.paused||this.instanceObject.pause();break;case 2:this.instanceObject.pause()}this.is_paused=!0}};e.prototype.resume=function(){if(!(this.fresh||this.stopped||this.hasEnded())&&this.is_paused){switch(this.myapi){case 0:l(this);break;case 1:1===this.buffer.myapi?(this.instanceObject=J.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=
this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=Z*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?g.kahanTime.sum:g.wallTime.sum)-this.resume_position/(this.playbackRate||.001),n(this.instanceObject,this.resume_position,this.getDuration())):l(this);break;case 2:this.instanceObject.play()}this.is_paused=!1}};e.prototype.seek=function(r){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case 0:try{this.instanceObject.currentTime=
r}catch(H){}break;case 1:if(1===this.buffer.myapi)this.is_paused?this.resume_position=r:(this.pause(),this.resume_position=r,this.resume());else try{this.instanceObject.currentTime=r}catch(H){}}};e.prototype.reconnect=function(r){1===this.myapi&&(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(r)):(this.gainNode.disconnect(),this.gainNode.connect(r)))};e.prototype.getDuration=function(r){var H=0;switch(this.myapi){case 0:"undefined"!==typeof this.instanceObject.duration&&
(H=this.instanceObject.duration);break;case 1:H=this.buffer.bufferObject.duration;break;case 2:H=this.instanceObject.getDuration()}r&&(H/=this.playbackRate||.001);return H};e.prototype.getPlaybackTime=function(r){var H=this.getDuration(),O=0;switch(this.myapi){case 0:"undefined"!==typeof this.instanceObject.currentTime&&(O=this.instanceObject.currentTime);break;case 1:if(1===this.buffer.myapi){if(this.is_paused)return this.resume_position;O=(this.isTimescaled?g.kahanTime.sum:g.wallTime.sum)-this.startTime}else"undefined"!==
typeof this.instanceObject.currentTime&&(O=this.instanceObject.currentTime)}r&&(O*=this.playbackRate);!this.looping&&O>H&&(O=H);return O};e.prototype.isPlaying=function(){return!this.is_paused&&!this.fresh&&!this.stopped&&!this.hasEnded()};e.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()};e.prototype.setVolume=function(r){this.volume=r;this.updateVolume()};e.prototype.updateVolume=function(){var r=this.volume*Z;isFinite(r)||(r=0);switch(this.myapi){case 0:"undefined"!==
typeof this.instanceObject.volume&&this.instanceObject.volume!==r&&(this.instanceObject.volume=r);break;case 1:1===this.buffer.myapi?this.gainNode.gain.value=r*this.mutevol:"undefined"!==typeof this.instanceObject.volume&&this.instanceObject.volume!==r&&(this.instanceObject.volume=r)}};e.prototype.getVolume=function(){return this.volume};e.prototype.doSetMuted=function(r){switch(this.myapi){case 0:this.instanceObject.muted!==!!r&&(this.instanceObject.muted=!!r);break;case 1:1===this.buffer.myapi?
(this.mutevol=r?0:1,this.gainNode.gain.value=Z*this.volume*this.mutevol):this.instanceObject.muted!==!!r&&(this.instanceObject.muted=!!r)}};e.prototype.setMuted=function(r){this.is_muted=!!r;this.doSetMuted(this.is_muted||this.is_silent)};e.prototype.setSilent=function(r){this.is_silent=!!r;this.doSetMuted(this.is_muted||this.is_silent)};e.prototype.setLooping=function(r){this.looping=r;switch(this.myapi){case 0:this.instanceObject.loop!==!!r&&(this.instanceObject.loop=!!r);break;case 1:this.instanceObject.loop!==
!!r&&(this.instanceObject.loop=!!r)}};e.prototype.setPlaybackRate=function(r){this.playbackRate=r;this.updatePlaybackRate()};e.prototype.getPlaybackRate=function(r){return this.playbackRate};e.prototype.updatePlaybackRate=function(){var r=this.playbackRate;this.isTimescaled&&(r*=g.timescale);switch(this.myapi){case 0:this.instanceObject.playbackRate!==r&&(this.instanceObject.playbackRate=r);break;case 1:1===this.buffer.myapi?this.instanceObject.playbackRate.value!==r&&(this.instanceObject.playbackRate.value=
r):this.instanceObject.playbackRate!==r&&(this.instanceObject.playbackRate=r)}};e.prototype.setSuspended=function(r){switch(this.myapi){case 0:r?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case 1:r?this.isPlaying()?(this.resume_me=!0,1===this.buffer.myapi?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=this.getDuration()),v(this.instanceObject)):this.instanceObject.pause()):
this.resume_me=!1:this.resume_me&&(1===this.buffer.myapi?(this.instanceObject=J.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=Z*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?g.kahanTime.sum:g.wallTime.sum)-this.resume_position/(this.playbackRate||
.001),n(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case 2:r?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play())}};ha.Instance=function(r){this.type=r;g=this.runtime=r.runtime;p=this;this.listenerTracker=null;this.listenerZ=-600;this.runtime.isWKWebView&&(ya=!0);!(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))||
this.runtime.isCrosswalk||this.runtime.isAmazonWebApp||ya||(Ca=!0);J=null;"undefined"!==typeof AudioContext?(z=1,J=new AudioContext):"undefined"!==typeof webkitAudioContext&&(z=1,J=new webkitAudioContext);this.runtime.isiOS&&J&&(J.close&&J.close(),"undefined"!==typeof AudioContext?J=new AudioContext:"undefined"!==typeof webkitAudioContext&&(J=new webkitAudioContext));1!==z&&this.runtime.isCordova&&"undefined"!==typeof window.Media&&(z=2);2===z&&(G=location.href,r=G.lastIndexOf("/"),-1<r&&(G=G.substr(0,
r+1)),G=G.replace("file://",""));this.runtime.tickMe(this)};var ra=ha.Instance.prototype;ra.onCreate=function(){this.runtime.audioInstance=this;fa=this.properties[0];this.saveload=this.properties[1];this.playinbackground=this.properties[2];this.nextPlayTime=0;qa=this.properties[4];Ba=this.properties[5];this.listenerZ=-this.properties[6];Ga=this.properties[7];Ha=this.properties[8];Ia=this.properties[9];this.listenerTracker=new k;var r=this.runtime.draw_width||this.runtime.width,H=this.runtime.draw_height||
this.runtime.height;1===z&&(J.listener.setPosition(r/2,H/2,this.listenerZ),J.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(P,aa){ua&&ua.disconnect();Aa=aa.toLowerCase();ua=J.createMediaStreamSource(P);ua.connect(m(Aa))});this.runtime.addSuspendCallback(function(P){p.onSuspend(P)});var O=this;this.runtime.addDestroyCallback(function(P){O.onInstanceDestroyed(P)})};ra.onInstanceDestroyed=function(r){var H;var O=0;for(H=R.length;O<H;O++){var P=R[O];P.objectTracker&&P.objectTracker.obj===
r&&(P.objectTracker.obj=null,P.pannerEnabled&&P.isPlaying()&&P.looping&&P.stop())}this.listenerTracker.obj===r&&(this.listenerTracker.obj=null)};ra.saveToJSON=function(){var r={silent:ba,masterVolume:Z,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},H=r.playing,O,P;var aa=0;for(O=R.length;aa<O;aa++){var ca=R[aa];if(ca.shouldSave()&&3!==this.saveload&&(!ca.is_music||1!==this.saveload)&&(ca.is_music||2!==this.saveload)){var la=
ca.getPlaybackTime();ca.looping&&(la%=ca.getDuration());la={tag:ca.tag,buffersrc:ca.buffer.src,buffertype:ca.buffer.type,is_music:ca.is_music,playbackTime:la,volume:ca.volume,looping:ca.looping,muted:ca.is_muted,playbackRate:ca.playbackRate,paused:ca.is_paused,resume_position:ca.resume_position};if(ca.pannerEnabled){la.pan={};var ma=la.pan;ca.objectTracker&&ca.objectTracker.hasObject()?ma.objUid=ca.objectTracker.obj.uid:(ma.x=ca.panX,ma.y=ca.panY,ma.a=ca.panAngle);ma.ia=ca.panConeInner;ma.oa=ca.panConeOuter;
ma.og=ca.panConeOuterGain}H.push(la)}}H=r.effects;for(P in oa)if(oa.hasOwnProperty(P)){ca=[];aa=0;for(O=oa[P].length;aa<O;aa++)ca.push({type:oa[P][aa].type,params:oa[P][aa].params});H[P]=ca}return r};var va=[];ra.loadFromJSON=function(r){var H=r.silent;Z=r.masterVolume;this.listenerZ=r.listenerZ;this.listenerTracker.setObject(null);var O=r.listenerUid;-1!==O&&(this.listenerTracker.loadUid=O,va.push(this.listenerTracker));O=r.playing;var P;if(3!==this.saveload){var aa=0;for(P=R.length;aa<P;aa++){var ca=
R[aa];ca.is_music&&1===this.saveload||(ca.is_music||2!==this.saveload)&&ca.stop()}}for(pa in oa)if(oa.hasOwnProperty(pa))for(aa=0,P=oa[pa].length;aa<P;aa++)oa[pa][aa].remove();cr.wipe(oa);for(pa in r.effects)if(r.effects.hasOwnProperty(pa)){var la=r.effects[pa];aa=0;for(P=la.length;aa<P;aa++){var ma=la[aa].type;var ja=la[aa].params;switch(ma){case "filter":U(pa,new K(ja[0],ja[1],ja[2],ja[3],ja[4],ja[5]));break;case "delay":U(pa,new u(ja[0],ja[1],ja[2]));break;case "convolve":ma=ja[2];ca=this.getAudioBuffer(ma,
!1);ca.bufferObject?ma=new F(ca.bufferObject,ja[0],ja[1],ma):(ma=new F(null,ja[0],ja[1],ma),ca.normalizeWhenReady=ja[0],ca.convolveWhenReady=ma);U(pa,ma);break;case "flanger":U(pa,new D(ja[0],ja[1],ja[2],ja[3],ja[4]));break;case "phaser":U(pa,new h(ja[0],ja[1],ja[2],ja[3],ja[4],ja[5]));break;case "gain":U(pa,new t(ja[0]));break;case "tremolo":U(pa,new B(ja[0],ja[1]));break;case "ringmod":U(pa,new S(ja[0],ja[1]));break;case "distortion":U(pa,new V(ja[0],ja[1],ja[2],ja[3],ja[4]));break;case "compressor":U(pa,
new L(ja[0],ja[1],ja[2],ja[3],ja[4]));break;case "analyser":U(pa,new d(ja[0],ja[1]))}}}aa=0;for(P=O.length;aa<P;aa++)if(3!==this.saveload){r=O[aa];ma=r.buffersrc;ca=r.buffertype||"";var sa=r.is_music;var pa=r.tag;la=r.playbackTime;var Ja=r.looping;var Ka=r.volume;var za=(ja=r.pan)&&ja.hasOwnProperty("objUid")?ja.objUid:-1;if(!sa||1!==this.saveload)if(sa||2!==this.saveload)(ca=this.getAudioInstance({url:ma,type:ca},pa,sa,Ja,Ka))?(ca.resume_position=r.resume_position,ca.setPannerEnabled(!!ja),ca.play(Ja,
Ka,la),ca.updatePlaybackRate(),ca.updateVolume(),ca.doSetMuted(ca.is_muted||ca.is_silent),r.paused&&ca.pause(),r.muted&&ca.setMuted(!0),ca.doSetMuted(ca.is_muted||ca.is_silent),ja&&(-1!==za?(ca.objectTracker=ca.objectTracker||new k,ca.objectTracker.loadUid=za,va.push(ca.objectTracker)):ca.setPan(ja.x,ja.y,ja.a,ja.ia,ja.oa,ja.og))):(ca=this.getAudioBuffer({url:ma,type:""},sa),ca.seekWhenReady=la,ca.pauseWhenReady=r.paused,ja&&(-1!==za?ca.panWhenReady.push({objUid:za,ia:ja.ia,oa:ja.oa,og:ja.og,thistag:pa}):
ca.panWhenReady.push({x:ja.x,y:ja.y,a:ja.a,ia:ja.ia,oa:ja.oa,og:ja.og,thistag:pa})))}if(H&&!ba){aa=0;for(P=R.length;aa<P;aa++)R[aa].setSilent(!0);ba=!0}else if(!H&&ba){aa=0;for(P=R.length;aa<P;aa++)R[aa].setSilent(!1);ba=!1}};ra.afterLoad=function(){var r;var H=0;for(r=va.length;H<r;H++){var O=va[H];var P=this.runtime.getObjectByUID(O.loadUid);O.setObject(P);O.loadUid=-1;P&&(da=P.x,ia=P.y)}cr.clearArray(va)};ra.onSuspend=function(r){if(!this.playinbackground){!r&&J&&J.resume&&(J.resume(),ka=!1);var H;
var O=0;for(H=R.length;O<H;O++)R[O].setSuspended(r);r&&J&&J.suspend&&(J.suspend(),ka=!0)}};ra.tick=function(){var r=this.runtime.dt,H;var O=0;for(H=R.length;O<H;O++){var P=R[O];P.tick(r);0!==fa&&P.updatePlaybackRate()}var aa;for(aa in oa)if(oa.hasOwnProperty(aa))for(P=oa[aa],O=0,H=P.length;O<H;O++){var ca=P[O];ca.tick&&ca.tick()}1===z&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(r),da=this.listenerTracker.obj.x,ia=this.listenerTracker.obj.y,J.listener.setPosition(this.listenerTracker.obj.x,
this.listenerTracker.obj.y,this.listenerZ))};var wa=[];ra.setPreloadList=function(r){var H,O=0;var P=0;for(H=r.length;P<H;++P){var aa=r[P];var ca=2*aa.size;wa.push({filename:aa.filename,size:ca,type:aa.type,obj:null});O+=ca}return O};ra.startPreloads=function(){var r;var H=0;for(r=wa.length;H<r;++H){var O=wa[H];var P=this.runtime.getProjectFileUrl(O.filename);O.obj=this.getAudioBuffer({url:P,type:O.type},!1)}};ra.getPreloadedSize=function(){var r=0,H;var O=0;for(H=wa.length;O<H;++O){var P=wa[O];P.obj.isLoadedAndDecoded()||
P.obj.hasFailedToLoad()||this.runtime.isAndroidStockBrowser?r+=P.size:P.obj.isLoaded()&&(r+=Math.floor(P.size/2))}return r};ra.releaseAllMusicBuffers=function(){var r,H;var O=r=0;for(H=Q.length;r<H;++r){var P=Q[r];Q[O]=P;P.is_music?P.release():++O}Q.length=O};ra.getAudioBuffer=function(r,H,O){var P,aa=null,ca=r.url;var la=0;for(P=Q.length;la<P;la++){var ma=Q[la];if(ma.src===ca){aa=ma;break}}aa||O||((ya||Fa)&&H&&this.releaseAllMusicBuffers(),aa=new E(ca,r.type,H),Q.push(aa));return aa};ra.getAudioInstance=
function(r,H,O,P,aa){var ca,la=r.url;var ma=0;for(ca=R.length;ma<ca;ma++){var ja=R[ma];if(ja.src===la&&(ja.canBeRecycled()||O))return ja.tag=H,ja}r=this.getAudioBuffer(r,O);if(!r.bufferObject)return"<preload>"!==H&&(r.playTagWhenReady=H,r.loopWhenReady=P,r.volumeWhenReady=aa),null;ja=new e(r,H);R.push(ja);return ja};var na=[];W.prototype.OnEnded=function(r){return cr.equals_nocase(C,r)};W.prototype.PreloadsComplete=function(){var r;var H=0;for(r=Q.length;H<r;H++)if(!Q[H].isLoadedAndDecoded()&&!Q[H].hasFailedToLoad())return!1;
return!0};W.prototype.AdvancedAudioSupported=function(){return 1===z};W.prototype.IsSilent=function(){return ba};W.prototype.IsAnyPlaying=function(){var r;var H=0;for(r=R.length;H<r;H++)if(R[H].isPlaying())return!0;return!1};W.prototype.IsTagPlaying=function(r){I(r);var H;r=0;for(H=na.length;r<H;r++)if(na[r].isPlaying())return!0;return!1};ha.cnds=new W;X.prototype.Play=function(r,H,O,P){if(!ba){O=M(O);var aa=r[1];if(r=this.runtime.getProjectAudioFileUrl(r[0]))if(T=this.getAudioInstance(r,P,aa,0!==
H,O))T.setPannerEnabled(!1),T.play(0!==H,O,0,this.nextPlayTime),this.nextPlayTime=0}};X.prototype.PlayAtPosition=function(r,H,O,P,aa,ca,la,ma,ja,sa){if(!ba){O=M(O);var pa=r[1];if(r=this.runtime.getProjectAudioFileUrl(r[0]))(T=this.getAudioInstance(r,sa,pa,0!==H,O))?(T.setPannerEnabled(!0),T.setPan(P,aa,ca,la,ma,M(ja)),T.play(0!==H,O,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(r,pa).panWhenReady.push({x:P,y:aa,a:ca,ia:la,oa:ma,og:M(ja),thistag:sa})}};X.prototype.PlayAtObject=function(r,
H,O,P,aa,ca,la,ma){if(!ba&&P&&(P=P.getFirstPicked())){O=M(O);var ja=r[1];if(r=this.runtime.getProjectAudioFileUrl(r[0]))(T=this.getAudioInstance(r,ma,ja,0!==H,O))?(T.setPannerEnabled(!0),ma=cr.rotatePtAround(P.x,P.y,-P.layer.getAngle(),da,ia,!0),r=cr.rotatePtAround(P.x,P.y,-P.layer.getAngle(),da,ia,!1),T.setPan(ma,r,cr.to_degrees(P.angle-P.layer.getAngle()),aa,ca,M(la)),T.setObject(P),T.play(0!==H,O,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(r,ja).panWhenReady.push({obj:P,ia:aa,
oa:ca,og:M(la),thistag:ma})}};X.prototype.PlayByName=function(r,H,O,P,aa){!ba&&(P=M(P),r=1===r,H=this.runtime.getProjectAudioFileUrl(H))&&(T=this.getAudioInstance(H,aa,r,0!==O,P))&&(T.setPannerEnabled(!1),T.play(0!==O,P,0,this.nextPlayTime),this.nextPlayTime=0)};X.prototype.PlayAtPositionByName=function(r,H,O,P,aa,ca,la,ma,ja,sa,pa){!ba&&(P=M(P),r=1===r,H=this.runtime.getProjectAudioFileUrl(H))&&((T=this.getAudioInstance(H,pa,r,0!==O,P))?(T.setPannerEnabled(!0),T.setPan(aa,ca,la,ma,ja,M(sa)),T.play(0!==
O,P,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(H,r).panWhenReady.push({x:aa,y:ca,a:la,ia:ma,oa:ja,og:M(sa),thistag:pa}))};X.prototype.PlayAtObjectByName=function(r,H,O,P,aa,ca,la,ma,ja){!ba&&aa&&(aa=aa.getFirstPicked())&&(P=M(P),r=1===r,H=this.runtime.getProjectAudioFileUrl(H))&&((T=this.getAudioInstance(H,ja,r,0!==O,P))?(T.setPannerEnabled(!0),ja=cr.rotatePtAround(aa.x,aa.y,-aa.layer.getAngle(),da,ia,!0),H=cr.rotatePtAround(aa.x,aa.y,-aa.layer.getAngle(),da,ia,!1),T.setPan(ja,
H,cr.to_degrees(aa.angle-aa.layer.getAngle()),ca,la,M(ma)),T.setObject(aa),T.play(0!==O,P,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(H,r).panWhenReady.push({obj:aa,ia:ca,oa:la,og:M(ma),thistag:ja}))};X.prototype.SetLooping=function(r,H){I(r);var O;r=0;for(O=na.length;r<O;r++)na[r].setLooping(0===H)};X.prototype.SetMuted=function(r,H){I(r);var O;r=0;for(O=na.length;r<O;r++)na[r].setMuted(0===H)};X.prototype.SetVolume=function(r,H){I(r);r=M(H);var O;H=0;for(O=na.length;H<O;H++)na[H].setVolume(r)};
X.prototype.Preload=function(r){if(!ba){var H=r[1];(r=this.runtime.getProjectAudioFileUrl(r[0]))&&2!==z&&this.getAudioInstance(r,"<preload>",H,!1)}};X.prototype.PreloadByName=function(r,H){ba||(r=1===r,(H=this.runtime.getProjectAudioFileUrl(H))&&2!==z&&this.getAudioInstance(H,"<preload>",r,!1))};X.prototype.SetPlaybackRate=function(r,H){I(r);0>H&&(H=0);var O;r=0;for(O=na.length;r<O;r++)na[r].setPlaybackRate(H)};X.prototype.Stop=function(r){I(r);var H;r=0;for(H=na.length;r<H;r++)na[r].stop()};X.prototype.StopAll=
function(){var r;var H=0;for(r=R.length;H<r;H++)R[H].stop()};X.prototype.SetPaused=function(r,H){I(r);var O;r=0;for(O=na.length;r<O;r++)0===H?na[r].pause():na[r].resume()};X.prototype.Seek=function(r,H){I(r);var O;r=0;for(O=na.length;r<O;r++)na[r].seek(H)};X.prototype.SetSilent=function(r){var H;2===r&&(r=ba?1:0);if(0===r&&!ba){r=0;for(H=R.length;r<H;r++)R[r].setSilent(!0);ba=!0}else if(1===r&&ba){r=0;for(H=R.length;r<H;r++)R[r].setSilent(!1);ba=!1}};X.prototype.SetMasterVolume=function(r){Z=M(r);
var H;r=0;for(H=R.length;r<H;r++)R[r].updateVolume()};X.prototype.AddFilterEffect=function(r,H,O,P,aa,ca,la){1!==z||0>H||H>=Ea.length||!J.createBiquadFilter||(r=r.toLowerCase(),la/=100,0>la&&(la=0),1<la&&(la=1),U(r,new K(H,O,P,aa,ca,la)))};X.prototype.AddDelayEffect=function(r,H,O,P){1===z&&(r=r.toLowerCase(),P/=100,0>P&&(P=0),1<P&&(P=1),U(r,new u(H,M(O),P)))};X.prototype.AddFlangerEffect=function(r,H,O,P,aa,ca){1===z&&J.createOscillator&&(r=r.toLowerCase(),ca/=100,0>ca&&(ca=0),1<ca&&(ca=1),U(r,new D(H/
1E3,O/1E3,P,aa/100,ca)))};X.prototype.AddPhaserEffect=function(r,H,O,P,aa,ca,la){1===z&&J.createOscillator&&(r=r.toLowerCase(),la/=100,0>la&&(la=0),1<la&&(la=1),U(r,new h(H,O,P,aa,ca,la)))};X.prototype.AddConvolutionEffect=function(r,H,O,P){if(1===z&&J.createConvolver){O=0===O;var aa=this.runtime.getProjectAudioFileUrl(H[0]);aa&&(H=this.getAudioBuffer(aa,!1),r=r.toLowerCase(),P/=100,0>P&&(P=0),1<P&&(P=1),H.bufferObject?P=new F(H.bufferObject,O,P,aa.url):(P=new F(null,O,P,aa.url),H.normalizeWhenReady=
O,H.convolveWhenReady=P),U(r,P))}};X.prototype.AddGainEffect=function(r,H){1===z&&(r=r.toLowerCase(),U(r,new t(M(H))))};X.prototype.AddMuteEffect=function(r){1===z&&(r=r.toLowerCase(),U(r,new t(0)))};X.prototype.AddTremoloEffect=function(r,H,O){1===z&&J.createOscillator&&(r=r.toLowerCase(),O/=100,0>O&&(O=0),1<O&&(O=1),U(r,new B(H,O)))};X.prototype.AddRingModEffect=function(r,H,O){1===z&&J.createOscillator&&(r=r.toLowerCase(),O/=100,0>O&&(O=0),1<O&&(O=1),U(r,new S(H,O)))};X.prototype.AddDistortionEffect=
function(r,H,O,P,aa,ca){1===z&&J.createWaveShaper&&(r=r.toLowerCase(),ca/=100,0>ca&&(ca=0),1<ca&&(ca=1),U(r,new V(H,O,P,aa,ca)))};X.prototype.AddCompressorEffect=function(r,H,O,P,aa,ca){1===z&&J.createDynamicsCompressor&&(r=r.toLowerCase(),U(r,new L(H,O,P,aa/1E3,ca/1E3)))};X.prototype.AddAnalyserEffect=function(r,H,O){1===z&&(r=r.toLowerCase(),U(r,new d(H,O)))};X.prototype.RemoveEffects=function(r){if(1===z){r=r.toLowerCase();var H;if(oa.hasOwnProperty(r)){var O=oa[r];if(O.length){var P=0;for(H=O.length;P<
H;P++)O[P].remove();cr.clearArray(O);N(r)}}}};X.prototype.SetEffectParameter=function(r,H,O,P,aa,ca){1===z&&(r=r.toLowerCase(),H=Math.floor(H),oa.hasOwnProperty(r)&&(r=oa[r],0>H||H>=r.length||r[H].setParam(O,P,aa,ca)))};X.prototype.SetListenerObject=function(r){r&&1===z&&(r=r.getFirstPicked())&&(this.listenerTracker.setObject(r),da=r.x,ia=r.y)};X.prototype.SetListenerZ=function(r){this.listenerZ=r};X.prototype.ScheduleNextPlay=function(r){J&&(this.nextPlayTime=r)};X.prototype.UnloadAudio=function(r){var H=
r[1];if(r=this.runtime.getProjectAudioFileUrl(r[0]))if(H=this.getAudioBuffer(r,H,!0))H.release(),cr.arrayFindRemove(Q,H)};X.prototype.UnloadAudioByName=function(r,H){r=1===r;if(H=this.runtime.getProjectAudioFileUrl(H))if(H=this.getAudioBuffer(H,r,!0))H.release(),cr.arrayFindRemove(Q,H)};X.prototype.UnloadAll=function(){var r;var H=0;for(r=Q.length;H<r;++H)Q[H].release();cr.clearArray(Q)};ha.acts=new X;Y.prototype.Duration=function(r,H){I(H,!0);na.length?r.set_float(na[0].getDuration()):r.set_float(0)};
Y.prototype.PlaybackTime=function(r,H){I(H,!0);na.length?r.set_float(na[0].getPlaybackTime(!0)):r.set_float(0)};Y.prototype.PlaybackRate=function(r,H){I(H,!0);na.length?r.set_float(na[0].getPlaybackRate()):r.set_float(0)};Y.prototype.Volume=function(r,H){I(H,!0);na.length?(H=na[0].getVolume(),r.set_float(x(H))):r.set_float(0)};Y.prototype.MasterVolume=function(r){r.set_float(x(Z))};Y.prototype.EffectCount=function(r,H){H=H.toLowerCase();var O=null;oa.hasOwnProperty(H)&&(O=oa[H]);r.set_int(O?O.length:
0)};Y.prototype.AnalyserFreqBinCount=function(r,H,O){H=H.toLowerCase();O=Math.floor(O);H=ea(H,O);r.set_int(H?H.node.frequencyBinCount:0)};Y.prototype.AnalyserFreqBinAt=function(r,H,O,P){H=H.toLowerCase();O=Math.floor(O);P=Math.floor(P);(H=ea(H,O))?0>P||P>=H.node.frequencyBinCount?r.set_float(0):r.set_float(H.freqBins[P]):r.set_float(0)};Y.prototype.AnalyserPeakLevel=function(r,H,O){H=H.toLowerCase();O=Math.floor(O);(H=ea(H,O))?r.set_float(H.peak):r.set_float(0)};Y.prototype.AnalyserRMSLevel=function(r,
H,O){H=H.toLowerCase();O=Math.floor(O);(H=ea(H,O))?r.set_float(H.rms):r.set_float(0)};Y.prototype.SampleRate=function(r){r.set_int(J?J.sampleRate:0)};Y.prototype.CurrentTime=function(r){r.set_float(J?J.currentTime:cr.performance_now())};ha.exps=new Y})();cr.plugins_.Arr=function(b){this.runtime=b};
(function(){function b(){return c.length?c.pop():[]}function l(f){var n;var v=0;for(n=f.length;v<n;v++)Array.isArray(f[v])&&l(f[v]);cr.clearArray(f);c.push(f)}function q(){}function A(){}function M(f,n){if(cr.is_number(f)&&cr.is_number(n))return f-n;f=""+f;n=""+n;return f<n?-1:f>n?1:0}function x(){}var m=cr.plugins_.Arr.prototype;m.Type=function(f){this.plugin=f;this.runtime=f.runtime};m.Type.prototype.onCreate=function(){};m.Instance=function(f){this.type=f;this.runtime=f.runtime};var a=m.Instance.prototype,
c=[];Array.isArray||(Array.isArray=function(f){return"[object Array]"===Object.prototype.toString.call(f)});a.onCreate=function(){this.cx=this.properties[0];this.cy=this.properties[1];this.cz=this.properties[2];this.recycled||(this.arr=b());var f=this.arr;f.length=this.cx;var n,v,y;for(n=0;n<this.cx;n++)for(f[n]||(f[n]=b()),f[n].length=this.cy,v=0;v<this.cy;v++)for(f[n][v]||(f[n][v]=b()),f[n][v].length=this.cz,y=0;y<this.cz;y++)f[n][v][y]=0;this.forX=[];this.forY=[];this.forZ=[];this.forDepth=-1};
a.onDestroy=function(){var f;for(f=0;f<this.cx;f++)l(this.arr[f]);cr.clearArray(this.arr)};a.at=function(f,n,v){f=Math.floor(f);n=Math.floor(n);v=Math.floor(v);return isNaN(f)||0>f||f>this.cx-1||isNaN(n)||0>n||n>this.cy-1||isNaN(v)||0>v||v>this.cz-1?0:this.arr[f][n][v]};a.set=function(f,n,v,y){f=Math.floor(f);n=Math.floor(n);v=Math.floor(v);isNaN(f)||0>f||f>this.cx-1||isNaN(n)||0>n||n>this.cy-1||isNaN(v)||0>v||v>this.cz-1||(this.arr[f][n][v]=y)};a.getAsJSON=function(){return JSON.stringify({c2array:!0,
size:[this.cx,this.cy,this.cz],data:this.arr})};a.saveToJSON=function(){return{size:[this.cx,this.cy,this.cz],data:this.arr}};a.loadFromJSON=function(f){var n=f.size;this.cx=n[0];this.cy=n[1];this.cz=n[2];this.arr=f.data};a.setSize=function(f,n,v){0>f&&(f=0);0>n&&(n=0);0>v&&(v=0);if(this.cx!==f||this.cy!==n||this.cz!==v){this.cx=f;this.cy=n;this.cz=v;var y,K,u=this.arr;u.length=f;for(f=0;f<this.cx;f++)for(cr.is_undefined(u[f])&&(u[f]=b()),u[f].length=n,y=0;y<this.cy;y++)for(cr.is_undefined(u[f][y])&&
(u[f][y]=b()),u[f][y].length=v,K=0;K<this.cz;K++)cr.is_undefined(u[f][y][K])&&(u[f][y][K]=0)}};a.getForX=function(){return 0<=this.forDepth&&this.forDepth<this.forX.length?this.forX[this.forDepth]:0};a.getForY=function(){return 0<=this.forDepth&&this.forDepth<this.forY.length?this.forY[this.forDepth]:0};a.getForZ=function(){return 0<=this.forDepth&&this.forDepth<this.forZ.length?this.forZ[this.forDepth]:0};q.prototype.CompareX=function(f,n,v){return cr.do_cmp(this.at(f,0,0),n,v)};q.prototype.CompareXY=
function(f,n,v,y){return cr.do_cmp(this.at(f,n,0),v,y)};q.prototype.CompareXYZ=function(f,n,v,y,K){return cr.do_cmp(this.at(f,n,v),y,K)};a.doForEachTrigger=function(f){this.runtime.pushCopySol(f.solModifiers);f.retrigger();this.runtime.popSol(f.solModifiers)};q.prototype.ArrForEach=function(f){var n=this.runtime.getCurrentEventStack().current_event;this.forDepth++;var v=this.forDepth;v===this.forX.length?(this.forX.push(0),this.forY.push(0),this.forZ.push(0)):(this.forX[v]=0,this.forY[v]=0,this.forZ[v]=
0);switch(f){case 0:for(this.forX[v]=0;this.forX[v]<this.cx;this.forX[v]++)for(this.forY[v]=0;this.forY[v]<this.cy;this.forY[v]++)for(this.forZ[v]=0;this.forZ[v]<this.cz;this.forZ[v]++)this.doForEachTrigger(n);break;case 1:for(this.forX[v]=0;this.forX[v]<this.cx;this.forX[v]++)for(this.forY[v]=0;this.forY[v]<this.cy;this.forY[v]++)this.doForEachTrigger(n);break;case 2:for(this.forX[v]=0;this.forX[v]<this.cx;this.forX[v]++)this.doForEachTrigger(n)}this.forDepth--;return!1};q.prototype.CompareCurrent=
function(f,n){return cr.do_cmp(this.at(this.getForX(),this.getForY(),this.getForZ()),f,n)};q.prototype.Contains=function(f){var n,v,y;for(n=0;n<this.cx;n++)for(v=0;v<this.cy;v++)for(y=0;y<this.cz;y++)if(this.arr[n][v][y]===f)return!0;return!1};q.prototype.IsEmpty=function(){return 0===this.cx||0===this.cy||0===this.cz};q.prototype.CompareSize=function(f,n,v){var y=0;switch(f){case 0:y=this.cx;break;case 1:y=this.cy;break;case 2:y=this.cz}return cr.do_cmp(y,n,v)};m.cnds=new q;A.prototype.Clear=function(f){var n,
v,y;for(n=0;n<this.cx;n++)for(v=0;v<this.cy;v++)for(y=0;y<this.cz;y++)this.arr[n][v][y]=f};A.prototype.SetSize=function(f,n,v){this.setSize(f,n,v)};A.prototype.SetX=function(f,n){this.set(f,0,0,n)};A.prototype.SetXY=function(f,n,v){this.set(f,n,0,v)};A.prototype.SetXYZ=function(f,n,v,y){this.set(f,n,v,y)};A.prototype.Push=function(f,n,v){var y=0,K=0,u=this.arr;switch(v){case 0:0===f?(y=u.length,u.push(b())):(y=0,u.unshift(b()));for(u[y].length=this.cy;K<this.cy;K++)for(u[y][K]=b(),u[y][K].length=
this.cz,v=0;v<this.cz;v++)u[y][K][v]=n;this.cx++;break;case 1:for(;y<this.cx;y++)for(0===f?(K=u[y].length,u[y].push(b())):(K=0,u[y].unshift(b())),u[y][K].length=this.cz,v=0;v<this.cz;v++)u[y][K][v]=n;this.cy++;break;case 2:for(;y<this.cx;y++)for(K=0;K<this.cy;K++)0===f?u[y][K].push(n):u[y][K].unshift(n);this.cz++}};A.prototype.Pop=function(f,n){var v=0,y=this.arr;switch(n){case 0:if(0===this.cx)break;0===f?l(y.pop()):l(y.shift());this.cx--;break;case 1:if(0===this.cy)break;for(;v<this.cx;v++)0===
f?l(y[v].pop()):l(y[v].shift());this.cy--;break;case 2:if(0!==this.cz){for(;v<this.cx;v++)for(n=0;n<this.cy;n++)0===f?y[v][n].pop():y[v][n].shift();this.cz--}}};A.prototype.Reverse=function(f){var n=0,v=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(f){case 0:v.reverse();break;case 1:for(;n<this.cx;n++)v[n].reverse();break;case 2:for(;n<this.cx;n++)for(f=0;f<this.cy;f++)v[n][f].reverse()}};A.prototype.Sort=function(f){var n=0,v=0,y=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(f){case 0:y.sort(function(K,
u){return M(K[0][0],u[0][0])});break;case 1:for(;n<this.cx;n++)y[n].sort(function(K,u){return M(K[0],u[0])});break;case 2:for(;n<this.cx;n++)for(v=0;v<this.cy;v++)y[n][v].sort(M)}};A.prototype.Delete=function(f,n){var v=0;f=Math.floor(f);var y=this.arr;if(!(0>f))switch(n){case 0:if(f>=this.cx)break;l(y[f]);y.splice(f,1);this.cx--;break;case 1:if(f>=this.cy)break;for(;v<this.cx;v++)l(y[v][f]),y[v].splice(f,1);this.cy--;break;case 2:if(!(f>=this.cz)){for(;v<this.cx;v++)for(n=0;n<this.cy;n++)y[v][n].splice(f,
1);this.cz--}}};A.prototype.Insert=function(f,n,v){var y=0,K=0;n=Math.floor(n);var u=this.arr;if(!(0>n))switch(v){case 0:if(n>this.cx)break;y=n;u.splice(y,0,b());for(u[y].length=this.cy;K<this.cy;K++)for(u[y][K]=b(),u[y][K].length=this.cz,v=0;v<this.cz;v++)u[y][K][v]=f;this.cx++;break;case 1:if(n>this.cy)break;for(;y<this.cx;y++)for(K=n,u[y].splice(K,0,b()),u[y][K].length=this.cz,v=0;v<this.cz;v++)u[y][K][v]=f;this.cy++;break;case 2:if(!(n>this.cz)){for(;y<this.cx;y++)for(K=0;K<this.cy;K++)u[y][K].splice(n,
0,f);this.cz++}}};A.prototype.JSONLoad=function(f){try{var n=JSON.parse(f)}catch(v){return}n.c2array&&(f=n.size,this.cx=f[0],this.cy=f[1],this.cz=f[2],this.arr=n.data)};A.prototype.JSONDownload=function(f){var n=document.createElement("a");if("undefined"===typeof n.download)f="data:text/html,"+encodeURIComponent("<p><a download='"+f+"' href=\"data:application/json,"+encodeURIComponent(this.getAsJSON())+'">Download link</a></p>'),window.open(f);else{var v=document.getElementsByTagName("body")[0];n.textContent=
f;n.href="data:application/json,"+encodeURIComponent(this.getAsJSON());n.download=f;v.appendChild(n);n.click();v.removeChild(n)}};m.acts=new A;x.prototype.At=function(f,n,v,y){f.set_any(this.at(n,v||0,y||0))};x.prototype.Width=function(f){f.set_int(this.cx)};x.prototype.Height=function(f){f.set_int(this.cy)};x.prototype.Depth=function(f){f.set_int(this.cz)};x.prototype.CurX=function(f){f.set_int(this.getForX())};x.prototype.CurY=function(f){f.set_int(this.getForY())};x.prototype.CurZ=function(f){f.set_int(this.getForZ())};
x.prototype.CurValue=function(f){f.set_any(this.at(this.getForX(),this.getForY(),this.getForZ()))};x.prototype.Front=function(f){f.set_any(this.at(0,0,0))};x.prototype.Back=function(f){f.set_any(this.at(this.cx-1,0,0))};x.prototype.IndexOf=function(f,n){for(var v=0;v<this.cx;v++)if(this.arr[v][0][0]===n){f.set_int(v);return}f.set_int(-1)};x.prototype.LastIndexOf=function(f,n){for(var v=this.cx-1;0<=v;v--)if(this.arr[v][0][0]===n){f.set_int(v);return}f.set_int(-1)};x.prototype.AsJSON=function(f){f.set_string(this.getAsJSON())};
m.exps=new x})();cr.plugins_.Browser=function(b){this.runtime=b};
(function(){function b(){c&&f&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(D){n.onSWMessage(D)})}function l(){if(!y&&navigator.getBattery){var D=navigator.getBattery();y=!0;D&&D.then(function(h){v=h})}}function q(){}function A(){}function M(D){console&&console.warn&&console.warn("Fullscreen request failed: ",D);u.setSize(window.innerWidth,window.innerHeight)}function x(){}var m=cr.plugins_.Browser.prototype;m.Type=function(D){this.plugin=D;this.runtime=D.runtime};
var a=m.Type.prototype;a.onCreate=function(){};var c=!1,f=!1;document.addEventListener("DOMContentLoaded",function(){if(window.C3_RegisterSW&&navigator.serviceWorker){var D=document.createElement("script");D.onload=function(){c=!0;b()};D.src="offlineclient.js";document.head.appendChild(D)}});var n=null;a.onAppBegin=function(){f=!0;b()};m.Instance=function(D){this.type=D;this.runtime=D.runtime};a=m.Instance.prototype;a.onCreate=function(){var D=this;window.addEventListener("resize",function(){D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,
D)});n=this;"undefined"!==typeof navigator.onLine&&(window.addEventListener("online",function(){D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,D)}),window.addEventListener("offline",function(){D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,D)}));document.addEventListener("backbutton",function(){D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,D)});document.addEventListener("menubutton",function(){D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,
D)});document.addEventListener("searchbutton",function(){D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,D)});document.addEventListener("tizenhwkey",function(h){switch(h.keyName){case "back":var t=D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,D);!t&&window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case "menu":(t=D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,D))||h.preventDefault()}});this.runtime.isWindows10&&"undefined"!==
typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(h){D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,D)&&(h.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(h){return!!D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,D)});this.runtime.addSuspendCallback(function(h){h?D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,D):D.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,
D)});this.is_arcade="undefined"!==typeof window.is_scirra_arcade};a.onSWMessage=function(D){D=D.data.type;"downloading-update"===D?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===D||"update-pending"===D?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===D&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var v=null,y=!1;q.prototype.CookiesEnabled=function(){return navigator?navigator.cookieEnabled:
!1};q.prototype.IsOnline=function(){return navigator?navigator.onLine:!1};q.prototype.HasJava=function(){return navigator?navigator.javaEnabled():!1};q.prototype.OnOnline=function(){return!0};q.prototype.OnOffline=function(){return!0};q.prototype.IsDownloadingUpdate=function(){return!1};q.prototype.PageVisible=function(){return!this.runtime.isSuspended};q.prototype.OnPageVisible=function(){return!0};q.prototype.OnPageHidden=function(){return!0};q.prototype.OnResize=function(){return!0};q.prototype.IsFullscreen=
function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen)};q.prototype.OnBackButton=function(){return!0};q.prototype.OnMenuButton=function(){return!0};q.prototype.OnSearchButton=function(){return!0};q.prototype.IsMetered=function(){var D=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return D?!!D.metered:!1};q.prototype.IsCharging=function(){var D=navigator.battery||navigator.mozBattery||navigator.webkitBattery;if(D)return!!D.charging;
l();return v?!!v.charging:!0};q.prototype.IsPortraitLandscape=function(D){return(window.innerWidth<=window.innerHeight?0:1)===D};q.prototype.SupportsFullscreen=function(){if(this.runtime.isNWjs)return!0;var D=this.runtime.canvas;return!!(D.requestFullscreen||D.mozRequestFullScreen||D.msRequestFullscreen||D.webkitRequestFullScreen)};q.prototype.OnUpdateFound=function(){return!0};q.prototype.OnUpdateReady=function(){return!0};q.prototype.OnOfflineReady=function(){return!0};m.cnds=new q;A.prototype.Alert=
function(D){alert(D.toString())};A.prototype.Close=function(){window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||window.close()};A.prototype.Focus=function(){this.runtime.isNWjs?nw.Window.get().focus():this.is_arcade||window.focus()};A.prototype.Blur=function(){this.runtime.isNWjs?nw.Window.get().blur():this.is_arcade||window.blur()};
A.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():!this.is_arcade&&window.back&&window.back()};A.prototype.GoForward=function(){!this.is_arcade&&window.forward&&window.forward()};A.prototype.GoHome=function(){!this.is_arcade&&window.home&&window.home()};A.prototype.GoToURL=function(D,h){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(D)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(D,{openExternal:!0}):
this.runtime.isCordova?window.open(D,"_system"):this.runtime.isPreview?window.open(D,"_blank"):this.is_arcade||(2!==h||this.is_arcade?1!==h||this.is_arcade?window.location=D:window.parent.location=D:window.top.location=D)};A.prototype.GoToURLWindow=function(D,h){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(D)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(D,{openExternal:!0}):this.runtime.isCordova?window.open(D,"_system"):this.is_arcade||window.open(D,
h)};A.prototype.Reload=function(){this.is_arcade||window.location.reload()};var K=!0,u=null;A.prototype.RequestFullScreen=function(D,h){2<=D&&(D+=1);6===D&&(D=2);document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||document.fullScreenElement||(this.runtime.fullscreen_scaling=2<=D?D:0,D={navigationUI:"auto"},1===h?D.navigationUI="hide":2===h&&(D.navigationUI="show"),h=document.documentElement,K&&(K=!1,u=this.runtime,h.addEventListener("mozfullscreenerror",
M),h.addEventListener("webkitfullscreenerror",M),h.addEventListener("MSFullscreenError",M),h.addEventListener("fullscreenerror",M)),h.requestFullscreen?h.requestFullscreen(D):h.mozRequestFullScreen?h.mozRequestFullScreen(D):h.msRequestFullscreen?h.msRequestFullscreen(D):h.webkitRequestFullScreen&&("undefined"!==typeof Element&&"undefined"!==typeof Element.ALLOW_KEYBOARD_INPUT?h.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):h.webkitRequestFullScreen()))};A.prototype.CancelFullScreen=function(){document.exitFullscreen?
document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()};A.prototype.Vibrate=function(D){try{var h=D.split(","),t;var B=0;for(t=h.length;B<t;B++)h[B]=parseInt(h[B],10);navigator.vibrate?navigator.vibrate(h):navigator.mozVibrate?navigator.mozVibrate(h):navigator.webkitVibrate?navigator.webkitVibrate(h):navigator.msVibrate&&navigator.msVibrate(h)}catch(S){}};
A.prototype.InvokeDownload=function(D,h){if(h){var t=document.createElement("a");if("undefined"===typeof t.download)window.open(D);else{var B=document.getElementsByTagName("body")[0];t.textContent=h;t.href=D;t.download=h;B.appendChild(t);D=new MouseEvent("click");t.dispatchEvent(D);B.removeChild(t)}}};A.prototype.InvokeDownloadString=function(D,h,t){if(t){var B="data:"+h+","+encodeURIComponent(D);D=document.createElement("a");"undefined"===typeof D.download?window.open(B):(h=document.getElementsByTagName("body")[0],
D.textContent=t,D.href=B,D.download=t,h.appendChild(D),t=new MouseEvent("click"),D.dispatchEvent(t),h.removeChild(D))}};A.prototype.ConsoleLog=function(D,h){"undefined"!==typeof console&&(0===D&&console.log&&console.log(h.toString()),1===D&&console.warn&&console.warn(h.toString()),2===D&&console.error&&console.error(h.toString()))};A.prototype.ConsoleGroup=function(D){console&&console.group&&console.group(D)};A.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()};A.prototype.ExecJs=
function(D){try{eval&&eval(D)}catch(h){console&&console.error&&console.error("Error executing Javascript: ",h)}};var F="portrait landscape portrait-primary portrait-secondary landscape-primary landscape-secondary".split(" ");A.prototype.LockOrientation=function(D){D=Math.floor(D);0>D||D>=F.length||(this.runtime.autoLockOrientation=!1,D=F[D],screen.orientation&&screen.orientation.lock?screen.orientation.lock(D):screen.lockOrientation?screen.lockOrientation(D):screen.webkitLockOrientation?screen.webkitLockOrientation(D):
screen.mozLockOrientation?screen.mozLockOrientation(D):screen.msLockOrientation&&screen.msLockOrientation(D))};A.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1;screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()};m.acts=
new A;x.prototype.URL=function(D){D.set_string(window.location.toString())};x.prototype.Protocol=function(D){D.set_string(window.location.protocol)};x.prototype.Domain=function(D){D.set_string(window.location.hostname)};x.prototype.PathName=function(D){D.set_string(window.location.pathname)};x.prototype.Hash=function(D){D.set_string(window.location.hash)};x.prototype.Referrer=function(D){D.set_string(document.referrer)};x.prototype.Title=function(D){D.set_string(document.title)};x.prototype.Name=
function(D){D.set_string(navigator.appName)};x.prototype.Version=function(D){D.set_string(navigator.appVersion)};x.prototype.Language=function(D){navigator&&navigator.language?D.set_string(navigator.language):D.set_string("")};x.prototype.Platform=function(D){D.set_string(navigator.platform)};x.prototype.Product=function(D){navigator&&navigator.product?D.set_string(navigator.product):D.set_string("")};x.prototype.Vendor=function(D){navigator&&navigator.vendor?D.set_string(navigator.vendor):D.set_string("")};
x.prototype.UserAgent=function(D){D.set_string(navigator.userAgent)};x.prototype.QueryString=function(D){D.set_string(window.location.search)};x.prototype.QueryParam=function(D,h){(h=RegExp("[?&]"+h+"=([^&]*)").exec(window.location.search))?D.set_string(decodeURIComponent(h[1].replace(/\+/g," "))):D.set_string("")};x.prototype.Bandwidth=function(D){var h=navigator.connection||navigator.mozConnection||navigator.webkitConnection;h?"undefined"!==typeof h.bandwidth?D.set_float(h.bandwidth):"undefined"!==
typeof h.downlinkMax?D.set_float(h.downlinkMax):D.set_float(Number.POSITIVE_INFINITY):D.set_float(Number.POSITIVE_INFINITY)};x.prototype.ConnectionType=function(D){var h=navigator.connection||navigator.mozConnection||navigator.webkitConnection;h?D.set_string(h.type||"unknown"):D.set_string("unknown")};x.prototype.BatteryLevel=function(D){var h=navigator.battery||navigator.mozBattery||navigator.webkitBattery;h?D.set_float(h.level):(l(),v?D.set_float(v.level):D.set_float(1))};x.prototype.BatteryTimeLeft=
function(D){var h=navigator.battery||navigator.mozBattery||navigator.webkitBattery;h?D.set_float(h.dischargingTime):(l(),v?D.set_float(v.dischargingTime):D.set_float(Number.POSITIVE_INFINITY))};x.prototype.ExecJS=function(D,h){if(eval){var t=0;try{t=eval(h)}catch(B){console&&console.error&&console.error("Error executing Javascript: ",B)}"number"===typeof t?D.set_any(t):"string"===typeof t?D.set_any(t):"boolean"===typeof t?D.set_any(t?1:0):D.set_any(0)}else D.set_any(0)};x.prototype.ScreenWidth=function(D){D.set_int(screen.width)};
x.prototype.ScreenHeight=function(D){D.set_int(screen.height)};x.prototype.DevicePixelRatio=function(D){D.set_float(this.runtime.devicePixelRatio)};x.prototype.WindowInnerWidth=function(D){D.set_int(window.innerWidth)};x.prototype.WindowInnerHeight=function(D){D.set_int(window.innerHeight)};x.prototype.WindowOuterWidth=function(D){D.set_int(window.outerWidth)};x.prototype.WindowOuterHeight=function(D){D.set_int(window.outerHeight)};m.exps=new x})();cr.plugins_.Function=function(b){this.runtime=b};
(function(){function b(){this.name="";this.retVal=0;this.params=[]}function l(){c++;c===a.length&&a.push(new b);return a[c]}function q(){return 0>c?null:a[c]}function A(){}function M(){}function x(){}var m=cr.plugins_.Function.prototype;m.Type=function(f){this.plugin=f;this.runtime=f.runtime};m.Type.prototype.onCreate=function(){};m.Instance=function(f){this.type=f;this.runtime=f.runtime};var a=[],c=-1;m.Instance.prototype.onCreate=function(){var f=this;window.c2_callFunction=function(n,v){var y,
K=l();K.name=n.toLowerCase();K.retVal=0;if(v)for(K.params.length=v.length,n=0,y=v.length;n<y;++n){var u=v[n];K.params[n]="number"===typeof u||"string"===typeof u?u:"boolean"===typeof u?u?1:0:0}else cr.clearArray(K.params);f.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,f,K.name);c--;return K.retVal}};A.prototype.OnFunction=function(f){var n=q();return n?cr.equals_nocase(f,n.name):!1};A.prototype.CompareParam=function(f,n,v){var y=q();if(!y)return!1;f=cr.floor(f);var K=0;0<=f&&f<y.params.length&&
(K=y.params[f]);return cr.do_cmp(K,n,v)};m.cnds=new A;M.prototype.CallFunction=function(f,n){var v=l();v.name=f.toLowerCase();v.retVal=0;cr.shallowAssignArray(v.params,n);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,v.name);c--};M.prototype.SetReturnValue=function(f){var n=q();n&&(n.retVal=f)};M.prototype.CallExpression=function(f){};m.acts=new M;x.prototype.ReturnValue=function(f){if(a.length){var n=c+1;n>=a.length&&(n=a.length-1);n=a[n]}else n=null;n?f.set_any(n.retVal):
f.set_int(0)};x.prototype.ParamCount=function(f){var n=q();n?f.set_int(n.params.length):f.set_int(0)};x.prototype.Param=function(f,n){n=cr.floor(n);var v=q();v?0<=n&&n<v.params.length?f.set_any(v.params[n]):f.set_int(0):f.set_int(0)};x.prototype.Call=function(f,n){var v=l();v.name=n.toLowerCase();v.retVal=0;cr.clearArray(v.params);var y;var K=2;for(y=arguments.length;K<y;K++)v.params.push(arguments[K]);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,v.name);c--;f.set_any(v.retVal)};
m.exps=new x})();cr.plugins_.Spritefont2=function(b){this.runtime=b};
(function(){function b(u,F){return u.length?u.pop():new F}function l(u,F,D){if(D){var h;D=0;for(h=F.length;D<h;D++)u.length<c&&u.push(F[D]);cr.clearArray(F)}else for(h in F)Object.prototype.hasOwnProperty.call(F,h)&&(u.length<c&&u.push(F[h]),delete F[h])}function q(u,F,D){var h=u.lines;D=D.replace(/\s\s*$/,"");F>=h.length&&h.push(b(f,Object));F=h[F];F.text=D;F.width=u.measureWidth(D);u.textWidth=cr.max(u.textWidth,F.width)}function A(){}function M(){}function x(){}var m=cr.plugins_.Spritefont2.prototype;
m.onCreate=function(){};m.Type=function(u){this.plugin=u;this.runtime=u.runtime};var a=m.Type.prototype;a.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.spriteX=this.texture_data[3],this.spriteY=
this.texture_data[4],this.spriteWidth=this.texture_data[5],this.spriteHeight=this.texture_data[6],this.webGL_texture=null)};a.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};a.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat));var u;var F=0;for(u=this.instances.length;F<u;F++)this.instances[F].webGL_texture=
this.webGL_texture}};a.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};a.preloadCanvas2D=function(u){u.drawImage(this.texture_img,0,0)};m.Instance=function(u){this.type=u;this.runtime=u.runtime};a=m.Instance.prototype;a.onDestroy=function(){l(f,this.lines,!0);l(n,this.clipList,!1);l(v,this.clipUV,!1);cr.wipe(this.characterWidthList)};a.onCreate=function(){this.texture_img=this.type.texture_img;
this.text=this.properties[0];this.characterWidth=this.properties[2];this.characterHeight=this.properties[3];this.characterSet=this.properties[4];var u=this.properties[5];this.characterScale=this.properties[6];this.characterSpacing=this.properties[7];this.lineHeight=this.properties[8];this.halign=this.properties[9]/2;this.valign=this.properties[10]/2;this.wrapbyword=0===this.properties[11];this.visible=this.properties[12];this.textHeight=this.textWidth=0;this.recycled?(cr.clearArray(this.lines),cr.wipe(this.clipList),
cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={});this.text_changed=!0;this.lastwrapwidth=this.width;this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture);this.LoadCharacterSpacingData(u);this.SplitSheet()};a.saveToJSON=function(){var u={t:this.text,
csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,ha:this.halign,va:this.valign,cw:{}},F;for(F in this.characterWidthList)u.cw[F]=this.characterWidthList[F];return u};a.loadFromJSON=function(u){this.text=u.t;this.characterScale=u.csc;this.characterSpacing=u.csp;this.lineHeight=u.lh;this.textWidth=u.tw;this.textHeight=u.th;this.last_render_tick=u.lrt;u.hasOwnProperty("ha")&&(this.halign=u.ha);u.hasOwnProperty("va")&&
(this.valign=u.va);for(var F in u.cw)this.characterWidthList[F]=u.cw[F];this.text_changed=!0;this.lastwrapwidth=this.width};var c=1E3,f=[],n=[],v=[];a.SplitSheet=function(){var u=this.texture_img.width,F=this.texture_img.height,D=this.type.spriteX,h=this.type.spriteY,t=this.characterWidth,B=this.characterHeight,S=D/u,V=h/F;u=t/u;F=B/F;for(var L=this.characterSet,d=Math.floor(this.type.spriteWidth/t),k=Math.floor(this.type.spriteHeight/B),E=0;E<L.length&&!(E>=d*k);E++){var e=E%d,w=Math.floor(E/d),
I=L.charAt(E);if(this.runtime.glwrap){var N=this.clipUV,U=e*u+S,W=w*F+V;e=(e+1)*u+S;w=(w+1)*F+V;void 0===N[I]&&(N[I]=b(v,cr.rect));N[I].left=U;N[I].top=W;N[I].right=e;N[I].bottom=w}else N=this.clipList,e=e*t+D,w=w*B+h,U=t,W=B,void 0===N[I]&&(N[I]=b(n,Object)),N[I].x=e,N[I].y=w,N[I].w=U,N[I].h=W}};var y=[];m.TokeniseWords=function(u){cr.clearArray(y);for(var F="",D,h=0;h<u.length;)if(D=u.charAt(h),"\n"===D)F.length&&(y.push(F),F=""),y.push("\n"),++h;else if(" "===D||"\t"===D||"-"===D){do F+=u.charAt(h),
h++;while(h<u.length&&(" "===u.charAt(h)||"\t"===u.charAt(h)));y.push(F);F=""}else h<u.length&&(F+=D,h++);F.length&&y.push(F)};m.WordWrap=function(u){var F=u.text,D=u.lines;if(F&&F.length){var h=u.width;if(2>=h)l(f,D,!0);else{var t=u.characterScale,B=u.characterSpacing;if(F.length*(u.characterWidth*t+B)-B<=h&&-1===F.indexOf("\n")&&(B=u.measureWidth(F),B<=h)){l(f,D,!0);D.push(b(f,Object));D[0].text=F;D[0].width=B;u.textWidth=B;u.textHeight=u.characterHeight*t+u.lineHeight;return}this.WrapText(u);u.textHeight=
D.length*(u.characterHeight*t+u.lineHeight)}}else l(f,D,!0)};m.WrapText=function(u){var F=u.wrapbyword,D=u.text,h=u.lines,t=u.width;F&&(this.TokeniseWords(D),D=y);var B="",S,V=0,L=!1;for(S=0;S<D.length;S++)if("\n"===D[S])!0===L?L=!1:(q(u,V,B),V++),B="";else{L=!1;var d=B;B+=D[S];var k=u.measureWidth(B.replace(/\s\s*$/,""));k>t&&(""===d?(q(u,V,B),B="",L=!0):(q(u,V,d),B=D[S]),V++,F||" "!==B||(B=""))}B.replace(/\s\s*$/,"").length&&(q(u,V,B),V++);for(S=V;S<h.length;S++)f.length<c&&f.push(h[S]);h.length=
V};a.measureWidth=function(u){for(var F=this.characterSpacing,D=u.length,h=0,t=0;t<D;t++)h+=this.getCharacterWidth(u.charAt(t))*this.characterScale+F;return h-(0<h?F:0)};a.getCharacterWidth=function(u){var F=this.characterWidthList;return void 0!==F[u]?F[u]:this.characterWidth};a.rebuildText=function(){if(this.text_changed||this.width!==this.lastwrapwidth)this.textHeight=this.textWidth=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width};a.draw=function(u,F){F=this.texture_img;
if(""!==this.text&&null!=F&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){u.globalAlpha=this.opacity;F=this.x;var D=this.y;this.runtime.pixel_rounding&&(F=Math.round(F),D=Math.round(D));var h=this.layer.viewLeft,t=this.layer.viewTop,B=this.layer.viewRight,S=this.layer.viewBottom;u.save();u.translate(F,D);u.rotate(this.angle);var V=this.angle,L=this.halign,d=this.characterScale,k=this.characterHeight*d,E=this.lineHeight,e=this.characterSpacing,w=this.lines,
I=this.valign*cr.max(0,this.height-this.textHeight),N=-(this.hotspotX*this.width);I=-(this.hotspotY*this.height)+I;for(var U,W,X=0;X<w.length;X++){var Y=w[X].text;var ea=L*cr.max(0,this.width-w[X].width);var ha=N+ea;I+=E;if(0===V&&D+I+k<t)I+=k;else{for(var g=0;g<Y.length;g++){U=Y.charAt(g);ea=this.getCharacterWidth(U);var p=this.clipList[U];if(0===V&&F+ha+ea*d+e<h)ha+=ea*d+e;else{if(ha+ea*d>this.width+.00001)break;void 0!==p&&(U=ha,W=I,0===V&&1===d&&(U=Math.round(U),W=Math.round(W)),u.drawImage(this.texture_img,
p.x,p.y,p.w,p.h,U,W,p.w*d,p.h*d));ha+=ea*d+e;if(0===V&&F+ha>B)break}}I+=k;if(0===V&&(I+k+E>this.height||D+I>S))break}}u.restore()}};var K=new cr.quad;a.drawGL=function(u){u.setTexture(this.webGL_texture);u.setOpacity(this.opacity);if(this.text&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){this.update_bbox();var F=this.bquad,D=0,h=0;this.runtime.pixel_rounding&&(D=Math.round(this.x)-this.x,h=Math.round(this.y)-this.y);var t=this.layer.viewLeft,B=this.layer.viewTop,
S=this.layer.viewRight,V=this.layer.viewBottom,L=this.angle,d=this.halign,k=this.valign,E=this.characterScale,e=this.characterHeight*E,w=this.lineHeight,I=this.characterSpacing,N=this.lines,U=this.textHeight,W;if(0!==L){var X=Math.cos(L);var Y=Math.sin(L)}k*=cr.max(0,this.height-U);D=F.tlx+D;F=F.tly+h;h=k;for(k=0;k<N.length;k++){U=N[k].text;var ea=W=d*cr.max(0,this.width-N[k].width);h+=w;if(0===L&&F+h+e<B)h+=e;else{for(var ha=0;ha<U.length;ha++){var g=U.charAt(ha);W=this.getCharacterWidth(g);g=this.clipUV[g];
if(0===L&&D+ea+W*E+I<t)ea+=W*E+I;else{if(ea+W*E>this.width+.00001)break;if(void 0!==g){var p=this.characterWidth*E,C=this.characterHeight*E;var G=ea;var z=h;0===L&&1===E&&(G=Math.round(G),z=Math.round(z));K.tlx=G;K.tly=z;K.trx=G+p;K.try_=z;K.blx=G;K.bly=z+C;K.brx=G+p;K.bry=z+C;0!==L&&(z=K,p=X,C=Y,G=z.tlx*p-z.tly*C,z.tly=z.tly*p+z.tlx*C,z.tlx=G,G=z.trx*p-z.try_*C,z.try_=z.try_*p+z.trx*C,z.trx=G,G=z.blx*p-z.bly*C,z.bly=z.bly*p+z.blx*C,z.blx=G,G=z.brx*p-z.bry*C,z.bry=z.bry*p+z.brx*C,z.brx=G);K.offset(D,
F);u.quadTex(K.tlx,K.tly,K.trx,K.try_,K.brx,K.bry,K.blx,K.bly,g)}ea+=W*E+I;if(0===L&&D+ea>S)break}}h+=e;if(0===L&&(h+e+w>this.height||F+h>V))break}}}};A.prototype.CompareText=function(u,F){return F?this.text==u:cr.equals_nocase(this.text,u)};m.cnds=new A;M.prototype.SetText=function(u){cr.is_number(u)&&1E9>u&&(u=Math.round(1E10*u)/1E10);u=u.toString();this.text!==u&&(this.text=u,this.text_changed=!0,this.runtime.redraw=!0)};M.prototype.AppendText=function(u){cr.is_number(u)&&(u=Math.round(1E10*u)/
1E10);if(u=u.toString())this.text+=u,this.text_changed=!0,this.runtime.redraw=!0};M.prototype.SetScale=function(u){u!==this.characterScale&&(this.characterScale=u,this.text_changed=!0,this.runtime.redraw=!0)};M.prototype.SetCharacterSpacing=function(u){u!==this.CharacterSpacing&&(this.characterSpacing=u,this.text_changed=!0,this.runtime.redraw=!0)};M.prototype.SetLineHeight=function(u){u!==this.lineHeight&&(this.lineHeight=u,this.text_changed=!0,this.runtime.redraw=!0)};a.SetCharWidth=function(u,
F){F=parseInt(F,10);this.characterWidthList[u]!==F&&(this.characterWidthList[u]=F,this.text_changed=!0,this.runtime.redraw=!0)};a.LoadCharacterSpacingData=function(u){var F,D;if(u){try{var h=JSON.parse(u)}catch(V){return}if(Array.isArray(h))for(u=0,F=h.length;u<F;++u){var t=h[u];if(Array.isArray(t)&&2===t.length&&"number"===typeof t[0]&&"string"===typeof t[1]){var B=t[0];t=t[1];var S=0;for(D=t.length;S<D;++S)this.SetCharWidth(t.charAt(S),B)}}}};M.prototype.SetCharacterWidth=function(u,F){if(""!==
u)for(var D=0;D<u.length;D++)this.SetCharWidth(u.charAt(D),F)};M.prototype.SetEffect=function(u){this.blend_mode=u;this.compositeOp=cr.effectToCompositeOp(u);cr.setGLBlend(this,u,this.runtime.gl);this.runtime.redraw=!0};M.prototype.SetHAlign=function(u){this.halign=u/2;this.text_changed=!0;this.runtime.redraw=!0};M.prototype.SetVAlign=function(u){this.valign=u/2;this.text_changed=!0;this.runtime.redraw=!0};m.acts=new M;x.prototype.CharacterWidth=function(u,F){u.set_int(this.getCharacterWidth(F))};
x.prototype.CharacterHeight=function(u){u.set_int(this.characterHeight)};x.prototype.CharacterScale=function(u){u.set_float(this.characterScale)};x.prototype.CharacterSpacing=function(u){u.set_int(this.characterSpacing)};x.prototype.LineHeight=function(u){u.set_int(this.lineHeight)};x.prototype.Text=function(u){u.set_string(this.text)};x.prototype.TextWidth=function(u){this.rebuildText();u.set_float(this.textWidth)};x.prototype.TextHeight=function(u){this.rebuildText();u.set_float(this.textHeight)};
m.exps=new x})();cr.behaviors.solid=function(b){this.runtime=b};
(function(){function b(){}function l(){}var q=cr.behaviors.solid.prototype;q.Type=function(M,x){this.behavior=M;this.objtype=x;this.runtime=M.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(M,x){this.type=M;this.behavior=M.behavior;this.inst=x;this.runtime=M.runtime};var A=q.Instance.prototype;A.onCreate=function(){this.inst.extra.solidEnabled=this.properties[0]};A.tick=function(){};b.prototype.IsEnabled=function(){return this.inst.extra.solidEnabled};q.cnds=new b;l.prototype.SetEnabled=
function(M){this.inst.extra.solidEnabled=!!M};q.acts=new l})();cr.behaviors.scrollto=function(b){this.runtime=b;this.shakeMode=this.shakeEnd=this.shakeStart=this.shakeMag=0};
(function(){function b(){}function l(){}var q=cr.behaviors.scrollto.prototype;q.Type=function(M,x){this.behavior=M;this.objtype=x;this.runtime=M.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(M,x){this.type=M;this.behavior=M.behavior;this.inst=x;this.runtime=M.runtime};var A=q.Instance.prototype;A.onCreate=function(){this.enabled=this.properties[0]};A.saveToJSON=function(){return{smg:this.behavior.shakeMag,ss:this.behavior.shakeStart,se:this.behavior.shakeEnd,smd:this.behavior.shakeMode}};
A.loadFromJSON=function(M){this.behavior.shakeMag=M.smg;this.behavior.shakeStart=M.ss;this.behavior.shakeEnd=M.se;this.behavior.shakeMode=M.smd};A.tick=function(){};A.tick2=function(){if(this.enabled){var M=this.behavior.my_instances.valuesRef(),x=0,m=0,a,c=0;var f=0;for(a=M.length;f<a;f++){a:{var n,v=M[f];var y=0;for(n=v.behavior_insts.length;y<n;++y){var K=v.behavior_insts[y];if(K.behavior instanceof cr.behaviors.scrollto)break a}K=null}K&&K.enabled&&(x+=M[f].x,m+=M[f].y,++c)}M=this.inst.layer.layout;
a=this.runtime.kahanTime.sum;K=f=0;a>=this.behavior.shakeStart&&a<this.behavior.shakeEnd&&(f=this.behavior.shakeMag*Math.min(this.runtime.timescale,1),0===this.behavior.shakeMode&&(f*=1-(a-this.behavior.shakeStart)/(this.behavior.shakeEnd-this.behavior.shakeStart)),a=Math.random()*Math.PI*2,K=Math.random()*f,f=Math.cos(a)*K,K*=Math.sin(a));M.scrollToX(x/c+f);M.scrollToY(m/c+K)}};b.prototype.IsEnabled=function(){return this.enabled};q.cnds=new b;l.prototype.Shake=function(M,x,m){this.behavior.shakeMag=
M;this.behavior.shakeStart=this.runtime.kahanTime.sum;this.behavior.shakeEnd=this.behavior.shakeStart+x;this.behavior.shakeMode=m};l.prototype.SetEnabled=function(M){this.enabled=0!==M};q.acts=new l})();cr.behaviors.Platform=function(b){this.runtime=b};
(function(){function b(){}function l(){}function q(){}var A=cr.behaviors.Platform.prototype;A.Type=function(x,m){this.behavior=x;this.objtype=m;this.runtime=x.runtime};A.Type.prototype.onCreate=function(){};A.Instance=function(x,m){this.type=x;this.behavior=x.behavior;this.inst=m;this.runtime=x.runtime;this.simjump=this.simright=this.simleft=this.ignoreInput=this.canDoubleJump=this.doubleJumped=this.jumped=this.jumpkey=this.rightkey=this.leftkey=!1;this.lastFloorObject=null;this.loadFloorObject=-1;
this.lastFloorY=this.lastFloorX=0;this.floorIsJumpthru=!1;this.fallthrough=this.animMode=this.ceilingCollisionMode=0;this.firstTick=!0;this.dy=this.dx=0};var M=A.Instance.prototype;M.updateGravity=function(){this.downx=Math.cos(this.ga);this.downy=Math.sin(this.ga);this.rightx=Math.cos(this.ga-Math.PI/2);this.righty=Math.sin(this.ga-Math.PI/2);this.downx=cr.round6dp(this.downx);this.downy=cr.round6dp(this.downy);this.rightx=cr.round6dp(this.rightx);this.righty=cr.round6dp(this.righty);this.g1=this.g;
0>this.g&&(this.downx*=-1,this.downy*=-1,this.g=Math.abs(this.g))};M.onCreate=function(){this.maxspeed=this.properties[0];this.acc=this.properties[1];this.dec=this.properties[2];this.jumpStrength=this.properties[3];this.g1=this.g=this.properties[4];this.maxFall=this.properties[5];this.enableDoubleJump=this.properties[6];this.jumpSustain=this.properties[7]/1E3;this.defaultControls=this.properties[8];this.enabled=this.properties[9];this.wasOnFloor=!1;this.wasOverJumpthru=this.runtime.testOverlapJumpThru(this.inst);
this.loadOverJumpthru=-1;this.sustainTime=0;this.ga=cr.to_radians(90);this.updateGravity();var x=this;this.defaultControls&&(document.addEventListener("keydown",function(m){x.onKeyDown(m)}),document.addEventListener("keyup",function(m){x.onKeyUp(m)}));this.recycled||(this.myDestroyCallback=function(m){x.onInstanceDestroyed(m)});this.runtime.addDestroyCallback(this.myDestroyCallback);this.inst.extra.isPlatformBehavior=!0};M.saveToJSON=function(){return{ii:this.ignoreInput,lfx:this.lastFloorX,lfy:this.lastFloorY,
lfo:this.lastFloorObject?this.lastFloorObject.uid:-1,am:this.animMode,en:this.enabled,fall:this.fallthrough,ft:this.firstTick,dx:this.dx,dy:this.dy,ms:this.maxspeed,acc:this.acc,dec:this.dec,js:this.jumpStrength,g:this.g,g1:this.g1,mf:this.maxFall,wof:this.wasOnFloor,woj:this.wasOverJumpthru?this.wasOverJumpthru.uid:-1,ga:this.ga,edj:this.enableDoubleJump,cdj:this.canDoubleJump,dj:this.doubleJumped,sus:this.jumpSustain,cc:this.ceilingCollisionMode}};M.loadFromJSON=function(x){this.ignoreInput=x.ii;
this.lastFloorX=x.lfx;this.lastFloorY=x.lfy;this.loadFloorObject=x.lfo;this.animMode=x.am;this.enabled=x.en;this.fallthrough=x.fall;this.firstTick=x.ft;this.dx=x.dx;this.dy=x.dy;this.maxspeed=x.ms;this.acc=x.acc;this.dec=x.dec;this.jumpStrength=x.js;this.g=x.g;this.g1=x.g1;this.maxFall=x.mf;this.wasOnFloor=x.wof;this.loadOverJumpthru=x.woj;this.ga=x.ga;this.enableDoubleJump=x.edj;this.canDoubleJump=x.cdj;this.doubleJumped=x.dj;this.jumpSustain=x.sus;this.ceilingCollisionMode=x.cc||0;this.simjump=
this.simright=this.simleft=this.jumped=this.jumpkey=this.rightkey=this.leftkey=!1;this.sustainTime=0;this.updateGravity()};M.afterLoad=function(){this.lastFloorObject=-1===this.loadFloorObject?null:this.runtime.getObjectByUID(this.loadFloorObject);this.wasOverJumpthru=-1===this.loadOverJumpthru?null:this.runtime.getObjectByUID(this.loadOverJumpthru)};M.onInstanceDestroyed=function(x){this.lastFloorObject==x&&(this.lastFloorObject=null)};M.onDestroy=function(){this.lastFloorObject=null;this.runtime.removeDestroyCallback(this.myDestroyCallback)};
M.onKeyDown=function(x){switch(x.which){case 38:x.preventDefault();this.jumpkey=!0;break;case 37:x.preventDefault();this.leftkey=!0;break;case 39:x.preventDefault(),this.rightkey=!0}};M.onKeyUp=function(x){switch(x.which){case 38:x.preventDefault();this.jumped=this.jumpkey=!1;break;case 37:x.preventDefault();this.leftkey=!1;break;case 39:x.preventDefault(),this.rightkey=!1}};M.onWindowBlur=function(){this.jumpkey=this.rightkey=this.leftkey=!1};M.getGDir=function(){return 0>this.g?-1:1};M.isOnFloor=
function(){var x,m=null;var a=this.inst.x;var c=this.inst.y;this.inst.x+=this.downx;this.inst.y+=this.downy;this.inst.set_bbox_changed();if(this.lastFloorObject&&this.runtime.testOverlap(this.inst,this.lastFloorObject)&&(!this.runtime.typeHasBehavior(this.lastFloorObject.type,cr.behaviors.solid)||this.lastFloorObject.extra.solidEnabled))return this.inst.x=a,this.inst.y=c,this.inst.set_bbox_changed(),this.lastFloorObject;(x=this.runtime.testOverlapSolid(this.inst))||0!==this.fallthrough||(m=this.runtime.testOverlapJumpThru(this.inst,
!0));this.inst.x=a;this.inst.y=c;this.inst.set_bbox_changed();if(x){if(this.runtime.testOverlap(this.inst,x))return null;this.floorIsJumpthru=!1;return x}if(m&&m.length){c=x=0;for(a=m.length;x<a;x++)m[c]=m[x],this.runtime.testOverlap(this.inst,m[x])||c++;if(1<=c)return this.floorIsJumpthru=!0,m[0]}return null};M.tick=function(){};M.posttick=function(){var x=this.runtime.getDt(this.inst),m;this.jumpkey||this.simjump||(this.jumped=!1);var a=this.leftkey||this.simleft;var c=this.rightkey||this.simright;
var f=(m=this.jumpkey||this.simjump)&&!this.jumped;this.simjump=this.simright=this.simleft=!1;if(this.enabled){this.ignoreInput&&(f=m=c=a=!1);m||(this.sustainTime=0);var n=this.lastFloorObject;var v=!1;this.firstTick&&((this.runtime.testOverlapSolid(this.inst)||this.runtime.testOverlapJumpThru(this.inst))&&this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,4,!0),this.firstTick=!1);if(n&&0===this.dy&&(n.y!==this.lastFloorY||n.x!==this.lastFloorX)){var y=n.x-this.lastFloorX;var K=n.y-this.lastFloorY;
this.inst.x+=y;this.inst.y+=K;this.inst.set_bbox_changed();this.lastFloorX=n.x;this.lastFloorY=n.y;v=!0;this.runtime.testOverlapSolid(this.inst)&&this.runtime.pushOutSolid(this.inst,-y,-K,2.5*Math.sqrt(y*y+K*K))}var u=this.isOnFloor();if(K=this.runtime.testOverlapSolid(this.inst)){var F=Math.abs(this.inst.width);var D=Math.abs(this.inst.height);if(this.inst.extra.inputPredicted)this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,10,!1);else if(this.runtime.pushOutSolidAxis(this.inst,-this.downx,
-this.downy,D/8))this.runtime.registerCollision(this.inst,K);else if(this.runtime.pushOutSolidAxis(this.inst,this.rightx,this.righty,F/2))this.runtime.registerCollision(this.inst,K);else if(this.runtime.pushOutSolidAxis(this.inst,this.downx,this.downy,D/2))this.runtime.registerCollision(this.inst,K);else if(this.runtime.pushOutSolidNearest(this.inst,Math.max(F,D)/2))this.runtime.registerCollision(this.inst,K);else return}u?(this.canDoubleJump=this.doubleJumped=!1,0<this.dy&&(this.wasOnFloor||(this.runtime.pushInFractional(this.inst,
-this.downx,-this.downy,u,16),this.wasOnFloor=!0),this.dy=0),n!=u)?(this.lastFloorObject=u,this.lastFloorX=u.x,this.lastFloorY=u.y,this.runtime.registerCollision(this.inst,u)):v&&(K=this.runtime.testOverlapSolid(this.inst))&&(this.runtime.registerCollision(this.inst,K),0!==y&&(0<y?this.runtime.pushOutSolid(this.inst,-this.rightx,-this.righty):this.runtime.pushOutSolid(this.inst,this.rightx,this.righty)),this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy)):m||(this.canDoubleJump=!0);if(u&&
f||!u&&this.enableDoubleJump&&m&&this.canDoubleJump&&!this.doubleJumped)n=this.inst.x,v=this.inst.y,this.inst.x-=this.downx,this.inst.y-=this.downy,this.inst.set_bbox_changed(),this.runtime.testOverlapSolid(this.inst)?f=!1:(this.sustainTime=this.jumpSustain,this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnJump,this.inst),this.animMode=2,this.dy=-this.jumpStrength,f=!0,u?this.jumped=!0:this.doubleJumped=!0),this.inst.x=n,this.inst.y=v,this.inst.set_bbox_changed();u||(m&&0<this.sustainTime?
(this.dy=-this.jumpStrength,this.sustainTime-=x):(this.lastFloorObject=null,this.dy+=this.g*x,this.dy>this.maxFall&&(this.dy=this.maxFall)),f&&(this.jumped=!0));this.wasOnFloor=!!u;a==c&&(0>this.dx?(this.dx+=this.dec*x,0<this.dx&&(this.dx=0)):0<this.dx&&(this.dx-=this.dec*x,0>this.dx&&(this.dx=0)));K=0;a&&!c&&(K=0<this.dx?-(this.acc+this.dec):-this.acc);c&&!a&&(K=0>this.dx?this.acc+this.dec:this.acc);this.dx+=K*x;this.dx>this.maxspeed?this.dx=this.maxspeed:this.dx<-this.maxspeed&&(this.dx=-this.maxspeed);
a=!1;0!==this.dx&&(n=this.inst.x,v=this.inst.y,y=this.runtime.accelerate(this.dx,-this.maxspeed,this.maxspeed,K,x)*this.rightx,K=this.runtime.accelerate(this.dx,-this.maxspeed,this.maxspeed,K,x)*this.righty,this.inst.x+=this.rightx*(1<this.dx?1:-1)-this.downx,this.inst.y+=this.righty*(1<this.dx?1:-1)-this.downy,this.inst.set_bbox_changed(),m=!1,F=this.runtime.testOverlapSolid(this.inst),this.inst.x=n+y,this.inst.y=v+K,this.inst.set_bbox_changed(),c=this.runtime.testOverlapSolid(this.inst),!c&&u&&
(c=this.runtime.testOverlapJumpThru(this.inst))&&(this.inst.x=n,this.inst.y=v,this.inst.set_bbox_changed(),this.runtime.testOverlap(this.inst,c)?(c=null,m=!1):m=!0,this.inst.x=n+y,this.inst.y=v+K,this.inst.set_bbox_changed()),c?(y=Math.abs(this.dx*x)+2,F||!this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,y,m,c))?(this.runtime.registerCollision(this.inst,c),y=Math.max(Math.abs(this.dx*x*2.5),30),this.runtime.pushOutSolid(this.inst,this.rightx*(0>this.dx?1:-1),this.righty*(0>this.dx?1:-1),
y,!1)?!u||m||this.floorIsJumpthru||(n=this.inst.x,v=this.inst.y,this.inst.x+=this.downx,this.inst.y+=this.downy,this.runtime.testOverlapSolid(this.inst)?this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,3,!1)||(this.inst.x=n,this.inst.y=v,this.inst.set_bbox_changed()):(this.inst.x=n,this.inst.y=v,this.inst.set_bbox_changed())):(this.inst.x=n,this.inst.y=v,this.inst.set_bbox_changed()),m||(this.dx=0)):!F&&!f&&Math.abs(this.dy)<Math.abs(this.jumpStrength/4)&&(this.dy=0,u||(a=!0)):(n=this.isOnFloor(),
u&&!n?(K=Math.ceil(Math.abs(this.dx*x))+2,n=this.inst.x,v=this.inst.y,this.inst.x+=this.downx*K,this.inst.y+=this.downy*K,this.inst.set_bbox_changed(),this.runtime.testOverlapSolid(this.inst)||this.runtime.testOverlapJumpThru(this.inst)?this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,K+2,!0):(this.inst.x=n,this.inst.y=v,this.inst.set_bbox_changed())):n&&(!u&&this.floorIsJumpthru&&(this.lastFloorObject=n,this.lastFloorX=n.x,this.lastFloorY=n.y,this.dy=0,a=!0),0===this.dy&&this.runtime.pushInFractional(this.inst,
-this.downx,-this.downy,n,16))));if(0!==this.dy){n=this.inst.x;v=this.inst.y;this.inst.x+=this.runtime.accelerate(this.dy,-Infinity,this.maxFall,this.g,x)*this.downx;this.inst.y+=this.runtime.accelerate(this.dy,-Infinity,this.maxFall,this.g,x)*this.downy;y=this.inst.x;c=this.inst.y;this.inst.set_bbox_changed();K=this.runtime.testOverlapSolid(this.inst);m=!1;if(!K&&0<this.dy&&!u){if((m=0<this.fallthrough?null:this.runtime.testOverlapJumpThru(this.inst,!0))&&m.length){if(this.wasOverJumpthru){this.inst.x=
n;this.inst.y=v;this.inst.set_bbox_changed();var h=F=0;for(D=m.length;F<D;F++)m[h]=m[F],this.runtime.testOverlap(this.inst,m[F])||h++;m.length=h;this.inst.x=y;this.inst.y=c;this.inst.set_bbox_changed()}1<=m.length&&(K=m[0])}m=!!K}if(K)if(this.runtime.registerCollision(this.inst,K),this.sustainTime=0,y=m?Math.abs(this.dy*x*2.5+10):Math.max(Math.abs(this.dy*x*2.5+10),30),this.runtime.pushOutSolid(this.inst,this.downx*(0>this.dy?1:-1),this.downy*(0>this.dy?1:-1),y,m,K)){this.lastFloorObject=K;this.lastFloorX=
K.x;this.lastFloorY=K.y;(this.floorIsJumpthru=m)&&(a=!0);if(0<this.dy||0===this.ceilingCollisionMode)this.dy=0;0>this.dy&&1===this.ceilingCollisionMode&&this.runtime.pushInFractional(this.inst,this.downx,this.downy,K,32)}else this.inst.x=n,this.inst.y=v,this.inst.set_bbox_changed(),this.wasOnFloor=!0,m||(this.dy=0)}3!==this.animMode&&0<this.dy&&!u&&(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnFall,this.inst),this.animMode=3);(u||a)&&0<=this.dy&&(3===this.animMode||a||f&&0===this.dy?
(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnLand,this.inst),this.animMode=0===this.dx&&0===this.dy?0:1):(0!==this.animMode&&0===this.dx&&0===this.dy&&(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnStop,this.inst),this.animMode=0),1===this.animMode||0===this.dx&&0===this.dy||f||(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnMove,this.inst),this.animMode=1)));0<this.fallthrough&&this.fallthrough--;this.wasOverJumpthru=this.runtime.testOverlapJumpThru(this.inst)}};
b.prototype.IsMoving=function(){return 0!==this.dx||0!==this.dy};b.prototype.CompareSpeed=function(x,m){return cr.do_cmp(Math.sqrt(this.dx*this.dx+this.dy*this.dy),x,m)};b.prototype.IsOnFloor=function(){if(0!==this.dy)return!1;var x,m=null;var a=this.inst.x;var c=this.inst.y;this.inst.x+=this.downx;this.inst.y+=this.downy;this.inst.set_bbox_changed();(x=this.runtime.testOverlapSolid(this.inst))||0!==this.fallthrough||(m=this.runtime.testOverlapJumpThru(this.inst,!0));this.inst.x=a;this.inst.y=c;this.inst.set_bbox_changed();
if(x)return!this.runtime.testOverlap(this.inst,x);if(m&&m.length){c=x=0;for(a=m.length;x<a;x++)m[c]=m[x],this.runtime.testOverlap(this.inst,m[x])||c++;if(1<=c)return!0}return!1};b.prototype.IsByWall=function(x){var m=this.inst.x,a=this.inst.y;0===x?(this.inst.x-=2*this.rightx,this.inst.y-=2*this.righty):(this.inst.x+=2*this.rightx,this.inst.y+=2*this.righty);this.inst.set_bbox_changed();if(!this.runtime.testOverlapSolid(this.inst))return this.inst.x=m,this.inst.y=a,this.inst.set_bbox_changed(),!1;
this.inst.x-=3*this.downx;this.inst.y-=3*this.downy;this.inst.set_bbox_changed();x=this.runtime.testOverlapSolid(this.inst);this.inst.x=m;this.inst.y=a;this.inst.set_bbox_changed();return x};b.prototype.IsJumping=function(){return 0>this.dy};b.prototype.IsFalling=function(){return 0<this.dy};b.prototype.OnJump=function(){return!0};b.prototype.OnFall=function(){return!0};b.prototype.OnStop=function(){return!0};b.prototype.OnMove=function(){return!0};b.prototype.OnLand=function(){return!0};b.prototype.IsDoubleJumpEnabled=
function(){return this.enableDoubleJump};b.prototype.IsEnabled=function(){return this.enabled};A.cnds=new b;l.prototype.SetIgnoreInput=function(x){this.ignoreInput=x};l.prototype.SetMaxSpeed=function(x){this.maxspeed=x;0>this.maxspeed&&(this.maxspeed=0)};l.prototype.SetAcceleration=function(x){this.acc=x;0>this.acc&&(this.acc=0)};l.prototype.SetDeceleration=function(x){this.dec=x;0>this.dec&&(this.dec=0)};l.prototype.SetJumpStrength=function(x){this.jumpStrength=x;0>this.jumpStrength&&(this.jumpStrength=
0)};l.prototype.SetGravity=function(x){this.g1!==x&&(this.g=x,this.updateGravity(),this.runtime.testOverlapSolid(this.inst)&&(this.runtime.pushOutSolid(this.inst,this.downx,this.downy,10),this.inst.x+=2*this.downx,this.inst.y+=2*this.downy,this.inst.set_bbox_changed()),this.lastFloorObject=null)};l.prototype.SetMaxFallSpeed=function(x){this.maxFall=x;0>this.maxFall&&(this.maxFall=0)};l.prototype.SimulateControl=function(x){switch(x){case 0:this.simleft=!0;break;case 1:this.simright=!0;break;case 2:this.simjump=
!0}};l.prototype.SetVectorX=function(x){this.dx=x};l.prototype.SetVectorY=function(x){this.dy=x};l.prototype.SetGravityAngle=function(x){x=cr.to_radians(x);x=cr.clamp_angle(x);this.ga!==x&&(this.ga=x,this.updateGravity(),this.lastFloorObject=null)};l.prototype.SetEnabled=function(x){this.enabled!==(1===x)&&(this.enabled=1===x,this.enabled||(this.lastFloorObject=null))};l.prototype.FallThrough=function(){var x=this.inst.x,m=this.inst.y;this.inst.x+=this.downx;this.inst.y+=this.downy;this.inst.set_bbox_changed();
var a=this.runtime.testOverlapJumpThru(this.inst,!1);this.inst.x=x;this.inst.y=m;this.inst.set_bbox_changed();a&&(this.fallthrough=3,this.lastFloorObject=null)};l.prototype.SetDoubleJumpEnabled=function(x){this.enableDoubleJump=0!==x};l.prototype.SetJumpSustain=function(x){this.jumpSustain=x/1E3};l.prototype.SetCeilingCollision=function(x){this.ceilingCollisionMode=x};A.acts=new l;q.prototype.Speed=function(x){x.set_float(Math.sqrt(this.dx*this.dx+this.dy*this.dy))};q.prototype.MaxSpeed=function(x){x.set_float(this.maxspeed)};
q.prototype.Acceleration=function(x){x.set_float(this.acc)};q.prototype.Deceleration=function(x){x.set_float(this.dec)};q.prototype.JumpStrength=function(x){x.set_float(this.jumpStrength)};q.prototype.Gravity=function(x){x.set_float(this.g)};q.prototype.GravityAngle=function(x){x.set_float(cr.to_degrees(this.ga))};q.prototype.MaxFallSpeed=function(x){x.set_float(this.maxFall)};q.prototype.MovingAngle=function(x){x.set_float(cr.to_degrees(Math.atan2(this.dy,this.dx)))};q.prototype.VectorX=function(x){x.set_float(this.dx)};
q.prototype.VectorY=function(x){x.set_float(this.dy)};q.prototype.JumpSustain=function(x){x.set_float(1E3*this.jumpSustain)};A.exps=new q})();cr.behaviors.Persist=function(b){this.runtime=b};
(function(){var b=cr.behaviors.Persist.prototype;b.Type=function(q,A){this.behavior=q;this.objtype=A;this.runtime=q.runtime};b.Type.prototype.onCreate=function(){};b.Instance=function(q,A){this.type=q;this.behavior=q.behavior;this.inst=A;this.runtime=q.runtime};var l=b.Instance.prototype;l.onCreate=function(){this.myProperty=this.properties[0]};l.onDestroy=function(){};l.tick=function(){this.runtime.getDt(this.inst)};b.cnds=new function(){};b.acts=new function(){};b.exps=new function(){}})();
cr.behaviors.jumpthru=function(b){this.runtime=b};
(function(){function b(){}function l(){}var q=cr.behaviors.jumpthru.prototype;q.Type=function(M,x){this.behavior=M;this.objtype=x;this.runtime=M.runtime};q.Type.prototype.onCreate=function(){};q.Instance=function(M,x){this.type=M;this.behavior=M.behavior;this.inst=x;this.runtime=M.runtime};var A=q.Instance.prototype;A.onCreate=function(){this.inst.extra.jumpthruEnabled=this.properties[0]};A.tick=function(){};b.prototype.IsEnabled=function(){return this.inst.extra.jumpthruEnabled};q.cnds=new b;l.prototype.SetEnabled=
function(M){this.inst.extra.jumpthruEnabled=!!M};q.acts=new l})();cr.behaviors.Sin=function(b){this.runtime=b};
(function(){function b(){}function l(){}function q(){}var A=cr.behaviors.Sin.prototype;A.Type=function(f,n){this.behavior=f;this.objtype=n;this.runtime=f.runtime};A.Type.prototype.onCreate=function(){};A.Instance=function(f,n){this.type=f;this.behavior=f.behavior;this.inst=n;this.runtime=f.runtime;this.i=0};var M=A.Instance.prototype,x=2*Math.PI,m=Math.PI/2,a=3*Math.PI/2,c=[0,1,8,3,4,2,5,6,7];M.onCreate=function(){this.movement=c[this.properties[0]];this.wave=this.properties[1];this.period=this.properties[2];
this.period+=Math.random()*this.properties[3];0===this.period?this.i=0:(this.i=this.properties[4]/this.period*x,this.i+=Math.random()*this.properties[5]/this.period*x);this.mag=this.properties[6];this.mag+=Math.random()*this.properties[7];this.isEnabled=this.properties[8];this.ratio=this.initialValue2=this.initialValue=0;5===this.movement&&(this.mag=cr.to_radians(this.mag));this.init()};M.saveToJSON=function(){return{i:this.i,a:this.isEnabled,mv:this.movement,w:this.wave,p:this.period,mag:this.mag,
iv:this.initialValue,iv2:this.initialValue2,r:this.ratio,lkv:this.lastKnownValue,lkv2:this.lastKnownValue2}};M.loadFromJSON=function(f){this.i=f.i;this.isEnabled=f.a;this.movement=f.mv;this.wave=f.w;this.period=f.p;this.mag=f.mag;this.initialValue=f.iv;this.initialValue2=f.iv2||0;this.ratio=f.r;this.lastKnownValue=f.lkv;this.lastKnownValue2=f.lkv2||0};M.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=
this.inst.width;this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle;break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x,this.initialValue2=this.inst.y}this.lastKnownValue=this.initialValue;this.lastKnownValue2=this.initialValue2};M.waveFunc=function(f){f%=x;switch(this.wave){case 0:return Math.sin(f);
case 1:return f<=m?f/m:f<=a?1-2*(f-m)/Math.PI:(f-a)/m-1;case 2:return 2*f/x-1;case 3:return-2*f/x+1;case 4:return f<Math.PI?-1:1}return 0};M.tick=function(){var f=this.runtime.getDt(this.inst);this.isEnabled&&0!==f&&(0===this.period?this.i=0:(this.i+=f/this.period*x,this.i%=x),this.updateFromPhase())};M.updateFromPhase=function(){switch(this.movement){case 0:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue);this.inst.x=this.initialValue+this.waveFunc(this.i)*
this.mag;this.lastKnownValue=this.inst.x;break;case 1:this.inst.y!==this.lastKnownValue&&(this.initialValue+=this.inst.y-this.lastKnownValue);this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag;this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*
this.mag;break;case 5:this.inst.angle!==this.lastKnownValue&&(this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue)));this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag);this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+this.waveFunc(this.i)*this.mag/100;0>this.inst.opacity?this.inst.opacity=0:1<this.inst.opacity&&(this.inst.opacity=1);break;case 8:this.inst.x!==this.lastKnownValue&&(this.initialValue+=
this.inst.x-this.lastKnownValue),this.inst.y!==this.lastKnownValue2&&(this.initialValue2+=this.inst.y-this.lastKnownValue2),this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.inst.y=this.initialValue2+Math.sin(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x,this.lastKnownValue2=this.inst.y}this.inst.set_bbox_changed()};M.onSpriteFrameChanged=function(f,n){switch(this.movement){case 2:this.initialValue*=n.width/f.width;this.ratio=
n.height/n.width;break;case 3:this.initialValue*=n.width/f.width;break;case 4:this.initialValue*=n.height/f.height}};b.prototype.IsEnabled=function(){return this.isEnabled};b.prototype.CompareMovement=function(f){return this.movement===f};b.prototype.ComparePeriod=function(f,n){return cr.do_cmp(this.period,f,n)};b.prototype.CompareMagnitude=function(f,n){return 5===this.movement?cr.do_cmp(this.mag,f,cr.to_radians(n)):cr.do_cmp(this.mag,f,n)};b.prototype.CompareWave=function(f){return this.wave===
f};A.cnds=new b;l.prototype.SetEnabled=function(f){this.isEnabled=1===f};l.prototype.SetPeriod=function(f){this.period=f};l.prototype.SetMagnitude=function(f){this.mag=f;5===this.movement&&(this.mag=cr.to_radians(this.mag))};l.prototype.SetMovement=function(f){5===this.movement&&5!==f&&(this.mag=cr.to_degrees(this.mag));this.movement=f;this.init()};l.prototype.SetWave=function(f){this.wave=f};l.prototype.SetPhase=function(f){this.i=f*x%x;this.updateFromPhase()};l.prototype.UpdateInitialState=function(){this.init()};
A.acts=new l;q.prototype.CyclePosition=function(f){f.set_float(this.i/x)};q.prototype.Period=function(f){f.set_float(this.period)};q.prototype.Magnitude=function(f){5===this.movement?f.set_float(cr.to_degrees(this.mag)):f.set_float(this.mag)};q.prototype.Value=function(f){f.set_float(this.waveFunc(this.i)*this.mag)};A.exps=new q})();cr.behaviors.Rex_MoveTo=function(b){this.runtime=b};
(function(){function b(a){if(null==a||"object"!=typeof a)return a;var c=a.constructor(),f;for(f in a)a.hasOwnProperty(f)&&(c[f]=a[f]);return c}function l(){}function q(){}function A(){}var M=cr.behaviors.Rex_MoveTo.prototype;M.Type=function(a,c){this.behavior=a;this.objtype=c;this.runtime=a.runtime};M.Type.prototype.onCreate=function(){};M.Instance=function(a,c){this.type=a;this.behavior=a.behavior;this.inst=c;this.runtime=a.runtime};var x=M.Instance.prototype;x.onCreate=function(){this.enabled=this.properties[0];
this.recycled||(this.moveParams={});this.moveParams.max=this.properties[1];this.moveParams.acc=this.properties[2];this.moveParams.dec=this.properties[3];this.soildStopEnable=this.properties[4];this.isContinueMode=this.properties[5];this.recycled||(this.target={x:0,y:0,a:0});this.isMoving=!1;this.remainDt=this.remainDistance=this.currentSpeed=0;this.recycled||(this.prePosition={x:0,y:0});this.prePosition.x=0;this.prePosition.y=0;this.movingAngleData=m(this.movingAngleData);this.movingAngleStartData=
m(this.movingAngleStartData);this.lastTick=null;this.isMyCall=!1};var m=function(a){null==a&&(a={});a.x=0;a.y=0;a.a=-1;return a};x.tick=function(){this.remainDt=0;if(this.enabled&&this.isMoving){var a=this.runtime.getDt(this.inst);this.move(a)}};x.move=function(a){if(0!=a){this.prePosition.x===this.inst.x&&this.prePosition.y===this.inst.y||this.resetCurrentPosition();var c=!1;0!=this.moveParams.dec&&(c=this.currentSpeed*this.currentSpeed/(2*this.moveParams.dec)>=this.remainDistance);c=c?-this.moveParams.dec:
this.moveParams.acc;0!=c&&this.setCurrentSpeed(this.currentSpeed+c*a);a*=this.currentSpeed;this.remainDistance-=a;c=!1;var f=this.target.a,n=Math.cos(f);f=Math.sin(f);0>=this.remainDistance||0>=this.currentSpeed?(c=!0,this.inst.x=this.target.x,this.inst.y=this.target.y,0<this.currentSpeed&&(this.remainDt=-this.remainDistance/this.currentSpeed),this.getMovingAngle(),this.setCurrentSpeed(0),this.remainDistance=0):(this.inst.x+=a*n,this.inst.y+=a*f);this.inst.set_bbox_changed();var v=!1;if(this.soildStopEnable){var y=
this.runtime.testOverlapSolid(this.inst);y&&(this.runtime.registerCollision(this.inst,y),this.runtime.pushOutSolid(this.inst,-n,-f,Math.max(a,50)),v=!0)}this.prePosition.x=this.inst.x;this.prePosition.y=this.inst.y;v?(this.isMoving=!1,this.isMyCall=!0,this.runtime.trigger(cr.behaviors.Rex_MoveTo.prototype.cnds.OnSolidStop,this.inst),this.isMyCall=!1):c&&(this.isMoving=!1,this.isMyCall=!0,this.runtime.trigger(cr.behaviors.Rex_MoveTo.prototype.cnds.OnHitTarget,this.inst),this.isMyCall=!1)}};x.tick2=
function(){this.movingAngleData.x=this.inst.x;this.movingAngleData.y=this.inst.y};x.setCurrentSpeed=function(a){null!=a?this.currentSpeed=a>this.moveParams.max?this.moveParams.max:a:0==this.moveParams.acc&&(this.currentSpeed=this.moveParams.max)};x.resetCurrentPosition=function(){var a=this.target.x-this.inst.x,c=this.target.y-this.inst.y;this.target.a=Math.atan2(c,a);this.remainDistance=Math.sqrt(a*a+c*c);this.prePosition.x=this.inst.x;this.prePosition.y=this.inst.y};x.setTargetPos=function(a,c){this.target.x=
a;this.target.y=c;this.setCurrentSpeed(null);this.resetCurrentPosition();this.movingAngleData.x=this.inst.x;this.movingAngleData.y=this.inst.y;this.isMoving=!0;this.movingAngleStartData.x=this.inst.x;this.movingAngleStartData.y=this.inst.y;this.movingAngleStartData.a=cr.to_clamped_degrees(cr.angleTo(this.inst.x,this.inst.y,a,c));this.isContinueMode&&this.move(this.remainDt)};x.isTickChanged=function(){var a=this.runtime.tickcount,c=this.lastTick!=a;this.lastTick=a;return c};x.getMovingAngle=function(a){if(this.isTickChanged()){a=
this.inst.x-this.movingAngleData.x;var c=this.inst.y-this.movingAngleData.y;if(0!=a||0!=c)this.movingAngleData.a=cr.to_clamped_degrees(Math.atan2(c,a))}return this.movingAngleData.a};x.saveToJSON=function(){return{en:this.enabled,v:b(this.moveParams),t:b(this.target),is_m:this.isMoving,c_spd:this.currentSpeed,rd:this.remainDistance,pp:b(this.prePosition),ma:b(this.movingAngleData),ms:b(this.movingAngleStartData),lt:this.lastTick}};x.loadFromJSON=function(a){this.enabled=a.en;this.moveParams=a.v;this.target=
a.t;this.isMoving=a.is_m;this.currentSpeed=a.c_spd;this.remainDistance=a.rd;this.prePosition=a.pp;this.movingAngleData=a.ma;this.movingAngleStartData=a.ms;this.lastTick=a.lt};M.cnds=new l;l.prototype.OnHitTarget=function(){return this.isMyCall};l.prototype.CompareSpeed=function(a,c){return cr.do_cmp(this.currentSpeed,a,c)};l.prototype.OnMoving=function(){return!1};l.prototype.IsMoving=function(){return this.enabled&&this.isMoving};l.prototype.CompareMovingAngle=function(a,c){return-1!=this.getMovingAngle()?
cr.do_cmp(this.getMovingAngle(),a,c):!1};l.prototype.OnSolidStop=function(){return this.isMyCall};M.acts=new q;q.prototype.SetEnabled=function(a){this.enabled=1===a};q.prototype.SetMaxSpeed=function(a){this.moveParams.max=a;this.setCurrentSpeed(null)};q.prototype.SetAcceleration=function(a){this.moveParams.acc=a;this.setCurrentSpeed(null)};q.prototype.SetDeceleration=function(a){this.moveParams.dec=a};q.prototype.SetTargetPos=function(a,c){this.setTargetPos(a,c)};q.prototype.SetCurrentSpeed=function(a){this.setCurrentSpeed(a)};
q.prototype.SetTargetPosOnObject=function(a){a&&(a=a.getFirstPicked(),null!=a&&this.setTargetPos(a.x,a.y))};q.prototype.SetTargetPosByDeltaXY=function(a,c){this.setTargetPos(this.inst.x+a,this.inst.y+c)};q.prototype.SetTargetPosByDistanceAngle=function(a,c){c=cr.to_clamped_radians(c);this.setTargetPos(this.inst.x+a*Math.cos(c),this.inst.y+a*Math.sin(c))};q.prototype.Stop=function(){this.isMoving=!1};q.prototype.SetTargetPosOnUID=function(a){a=this.runtime.getObjectByUID(a);null!=a&&this.setTargetPos(a.x,
a.y)};q.prototype.SetStopBySolid=function(a){this.soildStopEnable=1===a};M.exps=new A;A.prototype.Activated=function(a){a.set_int(this.enabled?1:0)};A.prototype.Speed=function(a){a.set_float(this.currentSpeed)};A.prototype.MaxSpeed=function(a){a.set_float(this.moveParams.max)};A.prototype.Acc=function(a){a.set_float(this.moveParams.acc)};A.prototype.Dec=function(a){a.set_float(this.moveParams.dec)};A.prototype.TargetX=function(a){a.set_float(this.target.x)};A.prototype.TargetY=function(a){a.set_float(this.target.y)};
A.prototype.MovingAngle=function(a){a.set_float(this.getMovingAngle())};A.prototype.MovingAngleStart=function(a){a.set_float(this.movingAngleStartData.a)}})();
cr.behaviors.DragnDrop=function(b){this.runtime=b;var l=this;document.addEventListener("mousemove",function(q){l.onMouseMove(q)});document.addEventListener("mousedown",function(q){l.onMouseDown(q)});document.addEventListener("mouseup",function(q){l.onMouseUp(q)});b=0<this.runtime.fullscreen_mode?document:this.runtime.canvas;"undefined"!==typeof PointerEvent?(b.addEventListener("pointerdown",function(q){l.onPointerStart(q)},!1),b.addEventListener("pointermove",function(q){l.onPointerMove(q)},!1),b.addEventListener("pointerup",
function(q){l.onPointerEnd(q)},!1),b.addEventListener("pointercancel",function(q){l.onPointerEnd(q)},!1)):window.navigator.msPointerEnabled?(b.addEventListener("MSPointerDown",function(q){l.onPointerStart(q)},!1),b.addEventListener("MSPointerMove",function(q){l.onPointerMove(q)},!1),b.addEventListener("MSPointerUp",function(q){l.onPointerEnd(q)},!1),b.addEventListener("MSPointerCancel",function(q){l.onPointerEnd(q)},!1)):(b.addEventListener("touchstart",function(q){l.onTouchStart(q)},!1),b.addEventListener("touchmove",
function(q){l.onTouchMove(q)},!1),b.addEventListener("touchend",function(q){l.onTouchEnd(q)},!1),b.addEventListener("touchcancel",function(q){l.onTouchEnd(q)},!1))};
(function(){function b(x){var m;var a=0;for(m=x.behavior_insts.length;a<m;a++)if(x.behavior_insts[a]instanceof A.Instance)return x.behavior_insts[a];return null}function l(){}function q(){}var A=cr.behaviors.DragnDrop.prototype;A.onMouseDown=function(x){if(1===x.which)this.onInputDown("leftmouse",x.pageX,x.pageY)};A.onMouseMove=function(x){if(1===x.which)this.onInputMove("leftmouse",x.pageX,x.pageY)};A.onMouseUp=function(x){if(1===x.which)this.onInputUp("leftmouse")};A.onTouchStart=function(x){x.preventDefault&&
cr.isCanvasInputEvent(x)&&x.preventDefault();var m;var a=0;for(m=x.changedTouches.length;a<m;a++){var c=x.changedTouches[a];var f=c.identifier;this.onInputDown(f?f.toString():"<none>",c.pageX,c.pageY)}};A.onTouchMove=function(x){x.preventDefault&&x.preventDefault();var m;var a=0;for(m=x.changedTouches.length;a<m;a++){var c=x.changedTouches[a];var f=c.identifier;this.onInputMove(f?f.toString():"<none>",c.pageX,c.pageY)}};A.onTouchEnd=function(x){x.preventDefault&&cr.isCanvasInputEvent(x)&&x.preventDefault();
var m;var a=0;for(m=x.changedTouches.length;a<m;a++){var c=x.changedTouches[a];c=c.identifier;this.onInputUp(c?c.toString():"<none>")}};A.onPointerStart=function(x){x.pointerType!==x.MSPOINTER_TYPE_MOUSE&&"mouse"!==x.pointerType&&(x.preventDefault&&cr.isCanvasInputEvent(x)&&x.preventDefault(),this.onInputDown(x.pointerId.toString(),x.pageX,x.pageY))};A.onPointerMove=function(x){x.pointerType!==x.MSPOINTER_TYPE_MOUSE&&"mouse"!==x.pointerType&&(x.preventDefault&&x.preventDefault(),this.onInputMove(x.pointerId.toString(),
x.pageX,x.pageY))};A.onPointerEnd=function(x){x.pointerType!==x.MSPOINTER_TYPE_MOUSE&&"mouse"!==x.pointerType&&(x.preventDefault&&cr.isCanvasInputEvent(x)&&x.preventDefault(),this.onInputUp(x.pointerId.toString()))};A.onInputDown=function(x,m,a){m-=this.runtime.canvas.offsetLeft;a-=this.runtime.canvas.offsetTop;var c=this.my_instances.valuesRef(),f,n=null;var v=0;for(f=c.length;v<f;v++){var y=c[v];var K=b(y);if(K.enabled&&!K.dragging){K=y.layer.canvasToLayer(m,a,!0);var u=y.layer.canvasToLayer(m,
a,!1);y.update_bbox();if(y.contains_pt(K,u))if(n)y.layer.index>n.layer.index?(n=y,F=K,D=u):y.layer.index===n.layer.index&&y.get_zindex()>n.get_zindex()&&(n=y,F=K,D=u);else{n=y;var F=K;var D=u}}}if(n)b(n).onDown(x,F,D)};A.onInputMove=function(x,m,a){m-=this.runtime.canvas.offsetLeft;a-=this.runtime.canvas.offsetTop;var c=this.my_instances.valuesRef(),f;var n=0;for(f=c.length;n<f;n++){var v=c[n];var y=b(v);if(y.enabled&&y.dragging&&(!y.dragging||y.dragsource===x)){var K=v.layer.canvasToLayer(m,a,!0);
v=v.layer.canvasToLayer(m,a,!1);y.onMove(K,v)}}};A.onInputUp=function(x){var m=this.my_instances.valuesRef(),a;var c=0;for(a=m.length;c<a;c++){var f=m[c];f=b(f);if(f.dragging&&f.dragsource===x)f.onUp()}};A.Type=function(x,m){this.behavior=x;this.objtype=m;this.runtime=x.runtime};A.Type.prototype.onCreate=function(){};A.Instance=function(x,m){this.type=x;this.behavior=x.behavior;this.inst=m;this.runtime=x.runtime};var M=A.Instance.prototype;M.onCreate=function(){this.dragging=!1;this.dy=this.dx=0;
this.dragsource="<none>";this.axes=this.properties[0];this.enabled=this.properties[1]};M.saveToJSON=function(){return{enabled:this.enabled}};M.loadFromJSON=function(x){this.enabled=x.enabled;this.dragging=!1};M.onDown=function(x,m,a){this.dx=m-this.inst.x;this.dy=a-this.inst.y;this.dragging=!0;this.dragsource=x;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDragStart,this.inst);this.runtime.isInUserInputEvent=!1};M.onMove=function(x,m){x-=this.dx;m-=
this.dy;if(0===this.axes){if(this.inst.x!==x||this.inst.y!==m)this.inst.x=x,this.inst.y=m,this.inst.set_bbox_changed()}else 1===this.axes?this.inst.x!==x&&(this.inst.x=x,this.inst.set_bbox_changed()):2===this.axes&&this.inst.y!==m&&(this.inst.y=m,this.inst.set_bbox_changed())};M.onUp=function(){this.dragging=!1;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDrop,this.inst);this.runtime.isInUserInputEvent=!1};M.tick=function(){};l.prototype.IsDragging=
function(){return this.dragging};l.prototype.OnDragStart=function(){return!0};l.prototype.OnDrop=function(){return!0};l.prototype.IsEnabled=function(){return!!this.enabled};A.cnds=new l;q.prototype.SetEnabled=function(x){this.enabled=0!==x;this.enabled||(this.dragging=!1)};q.prototype.SetAxes=function(x){this.axes=x};q.prototype.Drop=function(){if(this.dragging)this.onUp()};A.acts=new q;A.exps=new function(){}})();
cr.getObjectRefTable=function(){return[cr.plugins_.Sprite,cr.behaviors.solid,cr.behaviors.scrollto,cr.behaviors.Platform,cr.behaviors.Persist,cr.plugins_.Touch,cr.behaviors.jumpthru,cr.plugins_.Keyboard,cr.behaviors.Sin,cr.behaviors.Rex_MoveTo,cr.plugins_.Particles,cr.plugins_.Audio,cr.behaviors.DragnDrop,cr.plugins_.Arr,cr.plugins_.Browser,cr.plugins_.Function,cr.plugins_.Spritefont2,cr.system_object.prototype.cnds.IsGroupActive,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.plugins_.Sprite.prototype.acts.SetAnim,
cr.behaviors.Platform.prototype.acts.SimulateControl,cr.plugins_.Sprite.prototype.acts.SetMirrored,cr.plugins_.Touch.prototype.cnds.IsInTouch,cr.plugins_.Keyboard.prototype.cnds.IsKeyDown,cr.plugins_.Sprite.prototype.cnds.OnCollision,cr.plugins_.Sprite.prototype.acts.Destroy,cr.system_object.prototype.acts.CreateObject,cr.behaviors.Rex_MoveTo.prototype.acts.SetTargetPos,cr.plugins_.Sprite.prototype.acts.Spawn,cr.plugins_.Audio.prototype.acts.Play,cr.system_object.prototype.acts.AddVar,cr.plugins_.Sprite.prototype.cnds.CompareX,
cr.system_object.prototype.cnds.CompareVar,cr.system_object.prototype.acts.Wait,cr.system_object.prototype.acts.GoToLayout,cr.system_object.prototype.cnds.EveryTick,cr.system_object.prototype.acts.RestartLayout,cr.system_object.prototype.acts.ResetGlobals,cr.system_object.prototype.cnds.OnLayoutStart,cr.plugins_.Sprite.prototype.cnds.CompareY,cr.plugins_.Sprite.prototype.cnds.CompareFrame,cr.system_object.prototype.acts.SetVar,cr.plugins_.Sprite.prototype.acts.SetAnimFrame,cr.plugins_.Sprite.prototype.acts.SetOpacity,
cr.plugins_.Function.prototype.acts.CallFunction,cr.plugins_.Function.prototype.cnds.OnFunction,cr.plugins_.Arr.prototype.acts.SetXY,cr.plugins_.Arr.prototype.cnds.ArrForEach,cr.plugins_.Arr.prototype.exps.CurX,cr.system_object.prototype.exps.int,cr.system_object.prototype.exps.random,cr.system_object.prototype.cnds.While,cr.plugins_.Arr.prototype.cnds.CompareXY,cr.system_object.prototype.cnds.Repeat,cr.plugins_.Arr.prototype.exps.At,cr.behaviors.DragnDrop.prototype.acts.SetEnabled,cr.plugins_.Touch.prototype.cnds.OnTouchObject,
cr.plugins_.Audio.prototype.acts.StopAll,cr.plugins_.Spritefont2.prototype.acts.SetText,cr.plugins_.Sprite.prototype.acts.MoveToTop,cr.system_object.prototype.cnds.TriggerOnce]};
self.C3_JsPropNameTable=[{Solid:0},{chao:0},{ScrollTo:0},{Platform:0},{Persist:0},{player:0},{setadireita:0},{setaesquerda:0},{Touch:0},{bt_jump:0},{Jumpthru:0},{plataforma2:0},{bloco:0},{Keyboard:0},{Sine:0},{plataforma3:0},{espinhos:0},{bk_neve:0},{bk_deserto:0},{bk_floresta:0},{objetos_deserto:0},{objetos_neve:0},{coin1:0},{coin_cavalo:0},{MoveTo:0},{ponte:0},{chave:0},{coinNeve:0},{Particles:0},{Audio:0},{ave:0},{barreira:0},{varal:0},{moldura:0},{coin_cavalo2:0},{DragDrop:0},{Letra_C:0},{Letra_N:0},
{coin2:0},{coin3:0},{coinCav_amarelo:0},{coinCav_branco:0},{Sprite:0},{placa:0},{caramujo:0},{Sprite2:0},{paredepg3:0},{basepg3:0},{Nrosa:0},{SIL_DI:0},{Nneve:0},{LetraN:0},{SIL_VA:0},{Nomes:0},{silabas_pag1:0},{Array:0},{Particles2:0},{smile_feliz:0},{som:0},{borda_cana:0},{objetivo:0},{obj2:0},{boneco1:0},{OBJ1:0},{pegar:0},{bt_pgInstrucao:0},{Nbola:0},{Ncaneca:0},{LetraC:0},{Sprite5:0},{um2:0},{um1:0},{um3:0},{um4:0},{dois:0},{Browser:0},{arrSorteioPosicao:0},{arrPosicaoLetras:0},{Function:0},
{silCA_smb:0},{silVA_smb:0},{silLO_smb:0},{banner1:0},{qd_silabas2:0},{qd_silabas3:0},{qd_silabas:0},{cavalo:0},{gato:0},{SIL_CA:0},{SIL_GA:0},{SIL_TA:0},{silGA_smb:0},{silTo_smb:0},{SIL_TA_DI:0},{silDI_smb:0},{silNOS_smb:0},{silSAU_smb:0},{silRO_smb:0},{silTA_smb:0},{silTU_smb:0},{tatu:0},{dinossauro:0},{logolied:0},{bonecos_juntos:0},{iniciar:0},{todcores7:0},{banner_parabens:0},{spfTituloFase:0},{spfDescricaoObjetivo:0},{letras:0},{Ponto_erro:0},{Ponto_acerto:0},{Pontos_errospg3:0},{Pontos_acertopg3:0},
{indice:0},{erro_colisao:0},{acerto_colisao:0},{erro_pag1:0},{acerto_pag1:0},{erro_pag6:0},{acerto_pag6:0},{acerto_pag5:0},{erropag_5:0},{frame_sorteado:0},{sorteioPosicaoVazia:0},{posicaoLetra:0},{acerto_pg5:0},{erro_pag5:0},{Erro_pag2:0},{Acerto_pag2:0},{erro_pg4:0},{acerto_pg4:0}];